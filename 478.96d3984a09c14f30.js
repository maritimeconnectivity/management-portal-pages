(self.webpackChunkmanagement_portal=self.webpackChunkmanagement_portal||[]).push([[478],{6478:(pt,T,M)=>{"use strict";M.r(T),M.d(T,{ListViewModule:()=>Ew});var D=M(4466),_=M(9808),r=M(5e3),b=M(8555);let E=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-list-view"]],decls:1,vars:0,template:function(e,t){1&e&&r._UZ(0,"router-outlet")},directives:[b.lC],encapsulation:2}),s})();var O=M(2770),w=M(8304),I=M(1606),A=M(7030),d=M(4385),g=(()=>((g||(g={})).AttributeNameEnum={ImoNumber:"imo-number",MmsiNumber:"mmsi-number",Callsign:"callsign",Flagstate:"flagstate",AisClass:"ais-class",PortOfRegister:"port-of-register"},g))();const c=s=>{const i={};for(const e in s)if("attributes"===e)for(const t in s[e]){const n=U(s[e][t].attributeName);Object.values(g.AttributeNameEnum).find(a=>a===n)&&(i[C(n)]=s[e][t].attributeValue)}else i[e]=s[e];return i},C=s=>s.split("-").reduce((i,e,t)=>0===t?e.toLowerCase():`${i}${e.charAt(0).toUpperCase()}${e.substr(1).toLowerCase()}`,""),U=s=>s.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);var L=M(7229);const H=(s,i,e,t)=>i.authState.rolesLoaded?s!==w._g.Instance?!!te(i.authState.permission,L.Xg.SiteAdmin)||(s===w._g.User?te(i.authState.permission,L.Xg.UserAdmin):s===w._g.Device?te(i.authState.permission,L.Xg.DeviceAdmin):s===w._g.Vessel?te(i.authState.permission,L.Xg.VesselAdmin):s===w._g.MMS?te(i.authState.permission,L.Xg.MMSAdmin):s===w._g.Service?te(i.authState.permission,L.Xg.ServiceAdmin):(s===w._g.Organization||s===w._g.Role)&&te(i.authState.permission,L.Xg.OrgAdmin)):e?X(i.authState.user.keycloakMSRPermissions,L.aK.MSRAdmin)||t&&X(i.authState.user.keycloakMSRPermissions,L.aK.OrgServiceAdmin):X(i.authState.user.keycloakMSRPermissions,L.aK.OrgServiceAdmin)||X(i.authState.user.keycloakMSRPermissions,L.aK.MSRAdmin):(console.log("Role hasn't been loaded!"),!1),te=(s,i)=>{switch(i){case L.Xg.User:return!0;case L.Xg.SiteAdmin:return L.fQ.isSiteAdmin(s);case L.Xg.OrgAdmin:return L.fQ.isOrgAdmin(s);case L.Xg.ApproveOrg:return L.fQ.canApproveOrg(s);case L.Xg.EntityAdmin:return L.fQ.isEntityAdmin(s);case L.Xg.ServiceAdmin:return L.fQ.isServiceAdmin(s);case L.Xg.DeviceAdmin:return L.fQ.isDeviceAdmin(s);case L.Xg.VesselAdmin:return L.fQ.isVesselAdmin(s);case L.Xg.UserAdmin:return L.fQ.isUserAdmin(s);default:return!1}},X=(s,i)=>{switch(i){case L.aK.User:return!0;case L.aK.OrgServiceAdmin:return L.fQ.isOrgServiceAdmin(s);case L.aK.LedgerAdmin:return L.fQ.isLedgerAdmin(s);case L.aK.MSRAdmin:return L.fQ.isMSRAdmin(s);default:return!1}};var K=M(8329),ee=M(8996),_e=M(6009),Ke=M(3542),P=M(2447),se=M(2826),y=M(3037),oe=M(7126),Me=M(6941),pe=M(384),We=M(1062),we=M(9631);function $e(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",9),r.NdJ("click",function(){return r.CHM(e),r.oxw().onAddNew()}),r._uU(1,"Add new"),r.qZA()}}function Y(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"ng2-smart-table",10),r.NdJ("userRowSelect",function(n){return r.CHM(e),r.oxw().onEdit(n)})("delete",function(n){return r.CHM(e),r.oxw().onDelete(n)}),r.qZA()}if(2&s){const e=r.oxw();r.Q6J("settings",e.settings)("source",e.source)}}let Fe=(()=>{class s{constructor(e,t,n,a,o,u,l,m,k,B,F,V,le){this.router=e,this.iconsLibrary=t,this.userControllerService=n,this.deviceControllerService=a,this.roleControllerService=o,this.vesselControllerService=u,this.serviceControllerService=l,this.instanceControllerService=m,this.mmsControllerService=k,this.organizationControllerService=B,this.notifierService=F,this.authService=V,this.translate=le,this.menuType=w._g.Device,this.title=" for ",this.contextForAttributes="list",this.orgName="MCC",this.orgMrn="",this.iconName="circle",this.menuTypeName="",this.data=[],this.isLoading=!1,this.mySettings={actions:{edit:!1,position:"right"},mode:"external",delete:{deleteButtonContent:'<i class="nb-trash"></i>',confirmDelete:!0},columns:{...A.A[this.menuType],name:{title:"Nameeeee"}},hideSubHeader:!0},this.showTables=!0,this.source=new d.nC,this.isForServiceForOrg=!1,this.isAdmin=!1,this.deleteData=(ve,W,q,ne,ae)=>ve===w._g.User?this.userControllerService.deleteUser(W,q):ve===w._g.Device?this.deviceControllerService.deleteDevice(W,q):ve===w._g.Vessel?this.vesselControllerService.deleteVessel(W,q):ve===w._g.MMS?this.mmsControllerService.deleteMMS(W,q):ve===w._g.Service&&ne?this.serviceControllerService.deleteService(W,q,ne):ve===w._g.Organization||ve===w._g.OrgCandidate?this.organizationControllerService.deleteOrg(q):ve===w._g.Role&&ae?this.roleControllerService.deleteRole(W,ae):ve===w._g.Instance||ve===w._g.InstanceOfOrg?this.instanceControllerService.deleteInstance(ae):new I.Observable,this.loadMyOrganization=()=>this.organizationControllerService.getOrganization1(this.authService.authState.orgMrn),this.loadServiceInstances=()=>this.instanceControllerService.getInstances(),this.loadDataContent=(ve,W)=>ve===w._g.User?this.userControllerService.getOrganizationUsers(W):ve===w._g.Device?this.deviceControllerService.getOrganizationDevices(W):ve===w._g.Vessel?this.vesselControllerService.getOrganizationVessels(W):ve===w._g.MMS?this.mmsControllerService.getOrganizationMMSes(W):ve===w._g.Service?this.serviceControllerService.getOrganizationServices(W):ve===w._g.Organization?this.organizationControllerService.getOrganization():ve===w._g.OrgCandidate?this.organizationControllerService.getUnapprovedOrganizations():new I.Observable,this.loadRoles=ve=>this.roleControllerService.getRoles(ve),(0,O.$M)(le),t.registerFontPack("fas",{packClass:"fas",iconClassPrefix:"fa"})}ngOnInit(){const e=this.router.url.split("/").pop();e===w._g.InstanceOfOrg?(this.isForServiceForOrg=!0,this.menuType=w._g.Instance):this.menuType=e.replace("-","").substr(0,e.length-1),Object.values(w._g).includes(this.menuType)?(this.menuTypeName=w.RJ[this.menuType.toString()],this.iconName=w.nZ[this.menuType.toString()],this.orgMrn=this.authService.authState.orgMrn):this.router.navigate(["**"]),this.authService.authState.rolesLoaded?this.isAdmin=H(this.menuType,this.authService,!1):this.authService.rolesLoaded.subscribe(t=>{this.isAdmin=H(this.menuType,this.authService,!1)}),this.fetchValues()}fetchValues(){if(!A.A.hasOwnProperty(this.menuType.toString()))throw this.isLoading=!1,new Error(`${this.translate.instant("error.resource.noDataService")}${this.menuType}`);if(this.mySettings.columns=Object.assign({},...Object.entries(A.A[this.menuType.toString()]).filter(([e,t])=>Array.isArray(t.visibleFrom)&&t.visibleFrom.includes(this.contextForAttributes)).map(([e,t])=>({[e]:t}))),this.settings=Object.assign({},this.mySettings),this.title=`${(s=>"string"!=typeof s?"":s.charAt(0).toUpperCase()+s.slice(1))(this.menuTypeName)} list`,this.isLoading=!0,!Object.values(w._g).includes(this.menuType))throw this.isLoading=!1,new Error(`${this.translate.instant("error.resource.noDataService")}${this.menuType}`);this.menuType===w._g.Organization||this.menuType===w._g.OrgCandidate?this.loadDataContent(this.menuType).subscribe(e=>{this.refreshData(this.formatResponse(e.content)),this.isLoading=!1},e=>this.notifierService.notify("error",e.message)):this.menuType===w._g.Role?this.loadMyOrganization().subscribe(e=>this.loadRoles(e.mrn).subscribe(t=>{this.refreshData(t),this.isLoading=!1},t=>this.notifierService.notify("error",t.message)),e=>this.notifierService.notify("error",e.message)):this.menuType===w._g.Instance||this.menuType===w._g.InstanceOfOrg?this.loadServiceInstances().subscribe(e=>{this.refreshData(this.formatResponseForService(this.isForServiceForOrg?e.filter(t=>t.organizationId===this.orgMrn):e)),this.isLoading=!1},e=>this.notifierService.notify("error",e.message)):this.loadMyOrganization().subscribe(e=>this.loadDataContent(this.menuType,e.mrn).subscribe(t=>{this.refreshData(this.formatResponse(t.content)),this.isLoading=!1},t=>this.notifierService.notify("error",t.message)),e=>this.notifierService.notify("error",e.message))}refreshData(e){e?(this.source.load(e),this.data=e):this.source.load([])}formatResponse(e){return e.map(t=>c(t))}formatResponseForService(e){return e.map(t=>(s=>{const i={};for(const e in s)i[e]=s[e];return i})(t))}onDelete(e){this.isAdmin?this.delete(this.menuType,this.orgMrn,e.data.mrn,e.data.instanceVersion,e.data.id):this.notifierService.notify("error",this.translate.instant("error.resource.permissionError"))}delete(e,t,n,a,o){let u=this.translate.instant("warning.list.beforeDeletion");u=w.DC.indexOf(this.menuType)>=0?u+this.translate.instant("warning.list.beforeRevoke"):u,confirm(u)&&this.deleteData(e,t,n,a,o).subscribe(l=>{this.notifierService.notify("success",this.menuTypeName+this.translate.instant("success.list.delete")),this.fetchValues()},l=>this.notifierService.notify("error",this.translate.instant("error.resource.errorInDeletion")+l.error.message))}onEdit(e){const t=this.menuType===w._g.Instance?e.data.id:e.data.mrn;this.router.navigate([this.router.url,t?encodeURIComponent(t):e.data.id],{queryParams:{name:e.data.roleName?e.data.roleName:e.data.name?e.data.name:e.data.lastName+" "+e.data.firstName,version:e.data.instanceVersion}})}onAddNew(){this.router.navigate([this.router.url,"new"])}onSearch(e){const t=e.srcElement.value;e&&e.srcElement&&t.length>0?this.source.setFilter([{field:"id",search:t},{field:"name",search:t},{field:"mrn",search:t}],!1):(this.source.reset(),this.refreshData())}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(b.F0),r.Y36(K.B7b),r.Y36(ee.p),r.Y36(_e.$),r.Y36(Ke.U),r.Y36(P.HI),r.Y36(se.e),r.Y36(y.$),r.Y36(P.Tg),r.Y36(oe.r),r.Y36(Me.lG),r.Y36(pe.e),r.Y36(We.sK))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-list"]],decls:13,vars:5,consts:[[1,"row"],[1,"col","my-auto"],[1,"icon_header"],["pack","fas",3,"icon"],[1,"col-md-auto"],[3,"search"],["type","button","nbButton","","status","primary",3,"click",4,"ngIf"],["nbSpinnerSize","large","nbSpinnerStatus","primary",3,"nbSpinner"],[3,"settings","source","userRowSelect","delete",4,"ngIf"],["type","button","nbButton","","status","primary",3,"click"],[3,"settings","source","userRowSelect","delete"]],template:function(e,t){1&e&&(r.TgZ(0,"nb-card")(1,"nb-card-header")(2,"div",0)(3,"div",1)(4,"span",2),r._UZ(5,"nb-icon",3),r.qZA(),r._uU(6),r.qZA(),r.TgZ(7,"div",4)(8,"ngx-search-input",5),r.NdJ("search",function(a){return t.onSearch(a)}),r.qZA()(),r.TgZ(9,"div",4),r.YNc(10,$e,2,0,"button",6),r.qZA()()(),r.TgZ(11,"nb-card-body",7),r.YNc(12,Y,1,2,"ng2-smart-table",8),r.qZA()()),2&e&&(r.xp6(5),r.Q6J("icon",t.iconName),r.xp6(1),r.hij("",t.title," "),r.xp6(4),r.Q6J("ngIf",t.isAdmin),r.xp6(1),r.Q6J("nbSpinner",t.isLoading),r.xp6(1),r.Q6J("ngIf",t.showTables))},directives:[K.Asz,K.ndF,K.fMN,we.J,_.O5,K.DPz,K.yKW,K.Q7R,d.T5],styles:["[_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{transform:translate(0)}nb-card-body[_ngcontent-%COMP%]{overflow:visible;padding-top:0}nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}.icon_header[_ngcontent-%COMP%]{display:inline-block;width:28px}"]}),s})();const ut="MCPADMIN";var Et=M(3550),Pe=M(3075),st=M(1457);function It(s,i){if(1&s&&(r.TgZ(0,"div"),r._UZ(1,"input",14),r.qZA()),2&s){const e=r.oxw();r.xp6(1),r.s9C("value",e.xml?e.xml.name:"")}}function wt(s,i){if(1&s&&(r.TgZ(0,"div")(1,"span"),r._uU(2),r.qZA()()),2&s){const e=r.oxw();r.xp6(2),r.Oqu(e.xml?e.xml.name:"No name")}}function Wt(s,i){if(1&s&&(r.TgZ(0,"div"),r._UZ(1,"input",15),r.qZA()),2&s){const e=r.oxw();r.xp6(1),r.s9C("value",e.xml?e.xml.comment:"")}}function Kt(s,i){if(1&s&&(r.TgZ(0,"div")(1,"span"),r._uU(2),r.qZA()()),2&s){const e=r.oxw();r.xp6(2),r.Oqu(e.xml?e.xml.comment:"")}}function f(s,i){if(1&s&&(r.TgZ(0,"div"),r._UZ(1,"input",16),r.qZA()),2&s){const e=r.oxw();r.xp6(1),r.s9C("value",e.xml?e.xml.contentContentType:"")}}function ie(s,i){if(1&s&&(r.TgZ(0,"div")(1,"span"),r._uU(2),r.qZA()()),2&s){const e=r.oxw();r.xp6(2),r.Oqu(e.xml?e.xml.contentContentType:"")}}function Q(s,i){1&s&&(r.TgZ(0,"p")(1,"span",6),r._uU(2,"Press 'Validate' to save XML"),r.qZA()())}function x(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",17),r.NdJ("click",function(){return r.CHM(e),r.oxw().validate()}),r._uU(1,"Validate"),r.qZA()}}function N(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",18),r.NdJ("click",function(){return r.CHM(e),r.oxw().save()}),r._uU(1,"Save and apply"),r.qZA()}if(2&s){const e=r.oxw();r.Q6J("disabled",!e.isValidated)}}let J=(()=>{class s{constructor(e,t,n,a){this.ref=e,this.xmlControllerService=t,this.notifierService=n,this.dialogService=a,this.isValidated=!1,this.initialXml={id:0,name:"",content:'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<serviceInstance xmlns="http://iala-aism.org/g1128/v1.3/ServiceInstanceSchema.xsd" xmlns:ns2="http://iala-aism.org/g1128/v1.3/ServiceSpecificationSchema.xsd">\n</serviceInstance>',comment:"",contentContentType:"G1128 Instance Specification XML"}}ngOnInit(){this.xml&&(this.initialXml=this.xml),this.formGroup=new Pe.cw({name:new Pe.NI,content:new Pe.NI,comment:new Pe.NI,contentContentType:new Pe.NI}),this.xml&&(this.formGroup.get("name").setValue(this.xml.name),this.formGroup.get("content").setValue(this.xml.content),this.formGroup.get("comment").setValue(this.xml.comment),this.formGroup.get("contentContentType").setValue(this.xml.contentContentType))}isThereAnyDifference(e,t){return Object.entries(t).filter(n=>t[n[0]]!==n[1]).length>0}dismiss(){this.isEditing&&this.isThereAnyDifference(this.initialXml,this.formGroup.value),this.ref.close()}validate(){this.xmlControllerService.validateXmlWithG1128Schema(this.formGroup.value.content,"INSTANCE").subscribe(t=>{this.isValidated=!0,this.notifierService.notify("success","XML is valid according to G1128 instance schema")},t=>{this.isValidated=!1,this.notifierService.notify("error",t.message)})}getFormValue(){return Object.assign({},{id:this.initialXml.id},this.formGroup.value)}save(){this.onUpdate(this.getFormValue())}open2(e){this.dialogService.open(e,{context:"this is some additional data passed to dialog"})}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(K.X4l),r.Y36(st.n),r.Y36(Me.lG),r.Y36(K.Gln))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-xml-edit-dialog"]],inputs:{xml:"xml",isEditing:"isEditing",onUpdate:"onUpdate"},decls:44,vars:11,consts:[[1,"modal-window"],[1,"row"],[1,"col"],[1,"col-md-auto"],["href","https://www.iala-aism.org/product/g1128-specification-of-e-nav-technical-service-fillable-annex-f-service-instance-description/","target","_blank"],[3,"formGroup"],[1,"label"],[1,"col-sm-10"],[4,"ngIf"],["rows","20","nbInput","","formControlName","content","fullWidth","","placeholder","G1128 Service Instance XML"],[1,"buttons-row"],["nbButton","","status","primary",3,"click",4,"ngIf"],["nbButton","","status","success",3,"disabled","click",4,"ngIf"],["nbButton","","status","danger",3,"click"],["nbInput","","fullWidth","","formControlName","name","placeholder","Enter name",3,"value"],["nbInput","","fullWidth","","formControlName","comment","placeholder","Enter comment",3,"value"],["nbInput","","formControlName","contentContentType","fullWidth","",3,"value"],["nbButton","","status","primary",3,"click"],["nbButton","","status","success",3,"disabled","click"]],template:function(e,t){1&e&&(r.TgZ(0,"nb-card",0)(1,"nb-card-header")(2,"div",1)(3,"div",2),r._uU(4," G1128 XML editor "),r.qZA(),r.TgZ(5,"div",3)(6,"a",4),r._uU(7,"What is G1128?"),r.qZA()()()(),r.TgZ(8,"nb-card-body")(9,"form",5)(10,"div",1)(11,"div",2)(12,"span",6),r._uU(13,"Name"),r.qZA()(),r.TgZ(14,"div",7),r.YNc(15,It,2,1,"div",8),r.YNc(16,wt,3,1,"div",8),r.qZA()(),r.TgZ(17,"div",1)(18,"div",2)(19,"span",6),r._uU(20,"Content"),r.qZA(),r.TgZ(21,"textarea",9),r._uU(22),r.qZA()()(),r.TgZ(23,"div",1)(24,"div",2)(25,"span",6),r._uU(26,"Comment"),r.qZA()(),r.TgZ(27,"div",7),r.YNc(28,Wt,2,1,"div",8),r.YNc(29,Kt,3,1,"div",8),r.qZA()(),r.TgZ(30,"div",1)(31,"div",2)(32,"span",6),r._uU(33,"ContentType"),r.qZA()(),r.TgZ(34,"div",7),r.YNc(35,f,2,1,"div",8),r.YNc(36,ie,3,1,"div",8),r.qZA()()()(),r.TgZ(37,"nb-card-footer"),r.YNc(38,Q,3,0,"p",8),r.TgZ(39,"div",10),r.YNc(40,x,2,0,"button",11),r.YNc(41,N,2,1,"button",12),r.TgZ(42,"button",13),r.NdJ("click",function(){return t.dismiss()}),r._uU(43,"Close"),r.qZA()()()()),2&e&&(r.xp6(9),r.Q6J("formGroup",t.formGroup),r.xp6(6),r.Q6J("ngIf",t.isEditing),r.xp6(1),r.Q6J("ngIf",!t.isEditing),r.xp6(6),r.Oqu(t.xml?t.xml.content:""),r.xp6(6),r.Q6J("ngIf",t.isEditing),r.xp6(1),r.Q6J("ngIf",!t.isEditing),r.xp6(6),r.Q6J("ngIf",t.isEditing),r.xp6(1),r.Q6J("ngIf",!t.isEditing),r.xp6(2),r.Q6J("ngIf",t.isEditing),r.xp6(2),r.Q6J("ngIf",t.isEditing),r.xp6(1),r.Q6J("ngIf",t.isEditing))},directives:[K.Asz,K.ndF,K.yKW,Pe._Y,Pe.JL,Pe.sg,_.O5,K.h8i,Pe.Fj,Pe.JJ,Pe.u,K.XWE,K.DPz],styles:[".modal-window[_ngcontent-%COMP%]{width:60rem}nb-card-body[_ngcontent-%COMP%]{overflow:visible;padding-top:0}nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}[_nghost-%COMP%]   .buttons-row[_ngcontent-%COMP%]{margin:-.5rem}[_nghost-%COMP%]   button[nbButton][_ngcontent-%COMP%]{margin:.5rem}[dir=ltr]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-right:.5rem}[dir=rtl]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-left:.5rem}[_nghost-%COMP%]   .actions-card[_ngcontent-%COMP%]{height:8rem}"]}),s})();var ue=M(9670);let me=(()=>{class s{constructor(e){this.authService=e,this.idpNamespace=ue.X.IDP_NAMESPACE,this.mrnMCP="urn:mrn:mcp:"}shortIdFromMrn(e){const t=e.split(":");return t[t.length-1]}mrnPreFix(){return this.mrnPreFixForOrg(this.authService.authState.orgMrn)}mrnPreFixForOrg(e){return e.split(":org:")[0]+":"}orgShortId(){return this.authService.authState.orgMrn?this.shortIdFromMrn(this.authService.authState.orgMrn):void 0}mrnMcpIdpRegexForOrg(){return"urn:mrn:mcp:(device|org|user|vessel|service|mms):"+this.idpNamespace+":((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)|)*)$"}mrnRegex(){return"urn:mrn:([a-z0-9]([a-z0-9]|-){0,20}[a-z0-9]):([a-z0-9][-a-z0-9]{0,20}[a-z0-9]):((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)|)*)((?+((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)||?)*))?(?=((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)||?)*))?)?(#(((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)||?)*))?$"}mrnMcpIdpRegex(e){return"urn:mrn:mcp:(device|org|user|vessel|service|mms):"+this.idpNamespace+":"+(e||this.orgShortId())+"((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)|)*)$"}mrnMask(e,t){switch(e){case w._g.Device:return this.mrnMaskForDevice(t);case w._g.User:return this.mrnMaskForUser(t);case w._g.Organization:return this.mrnMaskForOrganization();case w._g.Vessel:return this.mrnMaskForVessel(t);case w._g.Instance:return this.mrnMaskForInstance(t);case w._g.Design:return this.mrnMaskForDesign(t);case w._g.Service:return this.mrnMaskForInstance(t);case w._g.MMS:return this.mrnMaskForMms(t);default:return this.mrnMaskForOrganization()}}mrnPattern(){return"^((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)|/)*)$"}mrnPatternError(){return"It should contain at least 3 characters and only a-z 0-9 + , / ~ - . : = @ ; $ _ ! * '"}mrnMaskForVessel(e){return this.mrnMCP+"vessel:"+this.idpNamespace+":"+(e||this.orgShortId())+":"}mrnMaskForMms(e){return this.mrnMCP+"mms:"+this.idpNamespace+":"+(e||this.orgShortId())+":"}mrnMaskForDevice(e){return this.mrnMCP+"device:"+this.idpNamespace+":"+(e||this.orgShortId())+":"}mrnMaskForOrganization(){return this.mrnMCP+"org:"+this.idpNamespace+":"}mrnMaskForUserOfOrg(e){return this.mrnMCP+"user:"+this.idpNamespace+":"+this.shortIdFromMrn(e)+":"}mrnMaskForUser(e){return this.mrnMCP+"user:"+this.idpNamespace+":"+(e||this.orgShortId())+":"}mrnMaskForSpecification(){return this.mrnMCP+"service:"+this.idpNamespace+":"+this.orgShortId()+":specification:"}mrnMaskForInstance(e){return this.mrnMCP+"service:"+this.idpNamespace+":"+(e||this.orgShortId())+":instance:"}mrnMaskForDesign(e){return this.mrnMCP+"service:"+this.idpNamespace+":"+(e||this.orgShortId())+":design:"}mrnMaskTextForInstance(){return this.mrnMCP+"service:"+this.idpNamespace+":"+this.orgShortId()+":instance:"}checkMrnForSpecification(e){const t=`^${this.mrnMaskForSpecification()}((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)|/)*)$`;return new RegExp(t).test(e)}checkMrnForDesign(e){const t=`^${this.mrnMaskForDesign()}((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)|/)*)$`;return new RegExp(t).test(e)}checkMrnForInstance(e){const t=`^${this.mrnMaskForInstance()}((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)((([-._a-z0-9]|~)|%[0-9a-f][0-9a-f]|([!$&'()*+,;=])|:|@)|/)*)$`;return new RegExp(t,"g").test(e)}checkMrn(e,t){try{const a=e.indexOf(t);if(a<0)return!1;var n=!0;return e.substring(a).split(":").forEach(u=>{u.toLowerCase().match(this.mrnPattern())||(n=!1)}),n}catch{return!1}}}return s.\u0275fac=function(e){return new(e||s)(r.LFG(pe.e))},s.\u0275prov=r.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var j=M(1247);const Se=s=>{switch(s){case j.r.RevokationReasonEnum.Aacompromise:return{value:s,title:"AA compromised",description:"This reason indicates that it is known or suspected that the certificate subject's private key has been compromised. It applies to authority attribute (AA) certificates only.",reference:"https://docs.oracle.com/javase/8/docs/api/java/security/cert/CRLReason.html"};case j.r.RevokationReasonEnum.Affiliationchanged:return{value:s,title:"Affiliation changed",description:"The user has terminated his or her relationship with the organization indicated in the Distinguished Name attribute of the certificate. This revocation code is typically used when an individual is terminated or has resigned from an organization. You do not have to revoke a certificate when a user changes departments, unless your security policy requires different certificate be issued by a departmental CA.",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Cacompromise:return{value:s,title:"CA compromised",description:"The token or disk location where the CA's private key is stored has been compromised and is in the possession of an unauthorized individual. When a CA's private key is revoked, this results in all certificates issued by the CA that are signed using the private key associated with the revoked certificate being considered revoked.",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Certificatehold:return{value:s,title:"Certificate Hold",description:"A temporary revocation that indicates that a CA will not vouch for a certificate at a specific point in time. Once a certificate is revoked with a CertificateHold reason code, the certificate can then be revoked with another Reason Code, or unrevoked and returned to use.",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Cessationofoperation:return{value:s,title:"Cessation of Operation",description:"If a CA is decommissioned, no longer to be used, the CA's certificate should be revoked with this reason code. Do not revoke the CA's certificate if the CA no longer issues new certificates, yet still publishes CRLs for the currently issued certificates.",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Keycompromise:return{value:s,title:"Key compromised",description:"The token or disk location where the private key associated with the certificate has been compromised and is in the possession of an unauthorized individual. This can include the case where a laptop is stolen, or a smart card is lost.",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Privilegewithdrawn:return{value:s,title:"Privilege withdrawn",description:"A certificate (public-key or attribute certificate) was revoked because a privilege contained within that certificate has been withdrawn",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Removefromcrl:return{value:s,title:"Remove from CRL",description:'If a certificate is revoked with the CertificateHold reason code, it is possible to "unrevoke" a certificate. The unrevoking process still lists the certificate in the CRL, but with the reason code set to RemoveFromCRL.',reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Superseded:return{value:s,title:"Superseded",description:"A replacement certificate has been issued to a user, and the reason does not fall under the previous reasons. This revocation reason is typically used when a smart card fails, the password for a token is forgotten by a user, or the user has changed their legal name.",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};case j.r.RevokationReasonEnum.Unspecified:return{value:s,title:"Unspecified",description:"It is possible to revoke a certificate without providing a specific reason code. While it is possible to revoke a certificate with the Unspecified reason code, this is not recommended, as it does not provide an audit trail as to why a certificate is revoked.",reference:"https://docs.microsoft.com/en-us/previous-versions/tn-archive/cc700843(v=technet.10)?redirectedfrom=MSDN#revocation-reasons"};default:return{value:s,title:j.r.RevokationReasonEnum[s],description:"No description",reference:""}}};var Ne=M(6276),Ae=M(1831);let De=(()=>{class s{constructor(e,t,n,a,o,u){this.organizationsService=e,this.devicesService=t,this.servicesService=n,this.usersService=a,this.vesselsService=o,this.mmsService=u}ngOnInit(){}formatCerts(e){let t=[];for(const n in e){const a=e[n];for(const o in a)e[n][o]=a[o];a.revoked&&(a.revokeInfo=a.revokedAt,a.revokeReasonText=Se(a.revokeReason).title),t.push(a)}return t}splitByRevokeStatus(e){let t=[],n=[];for(const a in e){const o=e[a];o.revoked?n.push(o):t.push(o)}return t.sort((a,o)=>a.end-o.end),n.sort((a,o)=>a.end-o.end),{activeCertificates:this.formatCerts(t),revokedCertificates:this.formatCerts(n)}}issueNewCertificateFromMIR(e,t,n,a){if(null==e||!t)throw new Error("Internal state lost");switch(e){case w.py.Organization:return this.organizationsService.newOrgCert(t);case w.py.Device:return this.devicesService.newDeviceCert(n,t);case w.py.Service:return this.servicesService.newServiceCert(n,t,a);case w.py.User:return this.usersService.newUserCert(n,t);case w.py.Vessel:return this.vesselsService.newVesselCert(n,t);case w.py.MMS:return this.mmsService.newMMSCert(n,t)}}issueNewCertificate(e,t,n,a,o){if(null==t||!n)throw new Error("Internal state lost");switch(t){case w.py.Organization:return this.organizationsService.newOrgCertFromCsr(e,n);case w.py.Device:return this.devicesService.newDeviceCertFromCsr(e,a,n);case w.py.Service:return this.servicesService.newServiceCertFromCsr(e,a,n,o);case w.py.User:return this.usersService.newUserCertFromCsr(e,a,n);case w.py.Vessel:return this.vesselsService.newVesselCertFromCsr(e,a,n);case w.py.MMS:return this.mmsService.newMMSCertFromCsr(e,a,n)}}revokeCertificate(e,t,n,a,o,u){if(null==e||!t)throw new Error("Internal state lost");switch(e){case w.py.Organization:return this.organizationsService.revokeOrgCert(o,t,a);case w.py.Device:return this.devicesService.revokeDeviceCert(o,n,t,a);case w.py.Service:return this.servicesService.revokeServiceCert(o,n,t,u,a);case w.py.User:return this.usersService.revokeUserCert(o,n,t,a);case w.py.Vessel:return this.vesselsService.revokeVesselCert(o,n,t,a);case w.py.MMS:return this.mmsService.revokeMMSCert(o,n,t,a)}}}return s.\u0275fac=function(e){return new(e||s)(r.LFG(oe.r),r.LFG(_e.$),r.LFG(se.e),r.LFG(ee.p),r.LFG(Ne.H),r.LFG(Ae.T))},s.\u0275prov=r.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();const lt=["stringInput"],Xe=["selectInput"];function Ft(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",8),r.NdJ("click",function(n){return r.CHM(e),r.oxw(2).onRemoveItem(n)}),r._uU(1,"X"),r.qZA()}if(2&s){const e=r.oxw().$implicit,t=r.oxw();r.s9C("value",e),r.Q6J("size",t.tiny)}}function _r(s,i){if(1&s&&(r.TgZ(0,"div",5)(1,"span",6),r._uU(2),r.qZA(),r.YNc(3,Ft,2,2,"button",7),r.qZA()),2&s){const e=i.$implicit,t=r.oxw();r.xp6(2),r.Oqu(e),r.xp6(1),r.Q6J("ngIf",t.isEditing)}}function Yt(s,i){1&s&&(r.TgZ(0,"div",9)(1,"span",10),r._uU(2,"No item"),r.qZA()())}function Ar(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"input",11,12),r.NdJ("keyup.enter",function(n){return r.CHM(e),r.oxw().onAddItem(n.target.value)})("focusout",function(n){return r.CHM(e),r.oxw().onFocusOut(n)}),r.qZA()}if(2&s){const e=r.oxw();r.MGl("id","input_",e.fieldName,""),r.s9C("placeholder",void 0!==e.placeholder?e.placeholder:""),r.s9C("required",!0===e.required)}}function St(s,i){if(1&s&&(r.TgZ(0,"nb-option",16),r._uU(1),r.qZA()),2&s){const e=i.$implicit;r.s9C("value",e.value),r.xp6(1),r.Oqu(e.title)}}function Jn(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"nb-select",13,14),r.NdJ("selectedChange",function(n){return r.CHM(e),r.oxw().onAddItem(n)}),r.YNc(2,St,2,2,"nb-option",15),r.qZA()}if(2&s){const e=r.oxw();r.xp6(2),r.Q6J("ngForOf",e.options)}}let ya=(()=>{class s{constructor(e){this.iconsLibrary=e,this.onUpdate=new r.vpe,this.onAddItem=t=>{t&&t.length>0&&this.items.indexOf(t)<0&&(this.items.push(t),this.cleanInput()),this.update()},this.cleanInput=()=>{this.selectInput&&this.selectInput.reset(),this.stringInput&&(this.stringInput.nativeElement.value="")},this.forceFocusIn=()=>{this.selectInput&&this.selectInput.nativeElement.focus(),this.stringInput&&this.stringInput.nativeElement.focus()},this.onRemoveItem=t=>{if("mouse"===t.pointerType&&t.target.value){const n=this.items.indexOf(t.target.value,0);n>-1&&this.items.splice(n,1),this.update()}},this.onFocusOut=t=>{t.target.value.length>0&&t.relatedTarget&&(alert("Please press Enter key to register the value or erase it"),this.forceFocusIn())},this.update=()=>{this.onUpdate.emit({data:this.items,fieldName:this.fieldName})},e.registerFontPack("fa",{packClass:"fa",iconClassPrefix:"fa"})}ngOnInit(){}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(K.B7b))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-input-button-list"]],viewQuery:function(e,t){if(1&e&&(r.Gf(lt,5),r.Gf(Xe,5)),2&e){let n;r.iGM(n=r.CRH())&&(t.stringInput=n.first),r.iGM(n=r.CRH())&&(t.selectInput=n.first)}},inputs:{items:"items",isEditing:"isEditing",fieldName:"fieldName",placeholder:"placeholder",required:"required",options:"options"},outputs:{onUpdate:"onUpdate"},decls:6,vars:4,consts:[[1,"button_container","pb-2"],["class","bg-primary align-baseline rounded p-1",4,"ngFor","ngForOf"],["class","bg-light align-baseline p-1 w-100 text-center",4,"ngIf"],["type","text","nbInput","","fullWidth","","class","form-control",3,"id","placeholder","required","keyup.enter","focusout",4,"ngIf"],["fullWidth","","required","required === true",3,"selectedChange",4,"ngIf"],[1,"bg-primary","align-baseline","rounded","p-1"],[1,"text-white"],["class","rounded-circle bg-primary text-white border-0","nbButton","",3,"size","value","click",4,"ngIf"],["nbButton","",1,"rounded-circle","bg-primary","text-white","border-0",3,"size","value","click"],[1,"bg-light","align-baseline","p-1","w-100","text-center"],[1,"text-secondary","font-weight-bold"],["type","text","nbInput","","fullWidth","",1,"form-control",3,"id","placeholder","required","keyup.enter","focusout"],["stringInput",""],["fullWidth","","required","required === true",3,"selectedChange"],["selectInput",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){1&e&&(r.TgZ(0,"div")(1,"div",0),r.YNc(2,_r,4,2,"div",1),r.YNc(3,Yt,3,0,"div",2),r.qZA(),r.YNc(4,Ar,2,3,"input",3),r.YNc(5,Jn,3,1,"nb-select",4),r.qZA()),2&e&&(r.xp6(2),r.Q6J("ngForOf",t.items),r.xp6(1),r.Q6J("ngIf",t.isEditing&&t.items&&0===t.items.length),r.xp6(1),r.Q6J("ngIf",t.isEditing&&!t.options),r.xp6(1),r.Q6J("ngIf",t.isEditing&&t.options))},directives:[_.sg,_.O5,K.DPz,K.h8i,K.rs,K.q51],styles:[".button_container[_ngcontent-%COMP%]{display:flex;width:100%;padding:1px;gap:5px;flex-wrap:wrap}"]}),s})();var jt=M(2916),Kl=M(1502),uc=M(9454),cc=M(2313);function hc(s,i){if(1&s&&r._UZ(0,"img",6),2&s){const e=r.oxw(2);r.uIk("src",e.image,r.LSH)}}function jl(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",7),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).clickToRemoveImage()}),r.TgZ(1,"div",8)(2,"span",9),r._uU(3,"click to remove"),r.qZA()()()}}function kr(s,i){if(1&s&&r._UZ(0,"img",6),2&s){const e=r.oxw(2);r.uIk("src",e.image,r.LSH)}}function Kn(s,i){if(1&s&&(r.TgZ(0,"div",3),r.YNc(1,hc,1,1,"img",4),r.YNc(2,jl,4,0,"div",5),r.YNc(3,kr,1,1,"img",4),r.qZA()),2&s){const e=r.oxw();r.Q6J("nbSpinner",e.isLoading),r.xp6(1),r.Q6J("ngIf",!e.isEditing),r.xp6(1),r.Q6J("ngIf",e.isEditing),r.xp6(1),r.Q6J("ngIf",e.isEditing)}}function gm(s,i){1&s&&(r.TgZ(0,"button",10),r._uU(1,"No image"),r.qZA())}function pm(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"input",11),r.NdJ("change",function(n){return r.CHM(e),r.oxw().changeFile(n)}),r.qZA()}if(2&s){const e=r.oxw();r.s9C("accept",e.accept)}}let vm=(()=>{class s{constructor(e,t,n,a,o){this.logoControllerService=e,this.vesselImageControllerService=t,this.notifierService=n,this.sanitizer=a,this.translate=o,this.accept="",this.isLoading=!1,this.clickToRemoveImage=()=>{const u=this.translate.instant("warning.resource.beforeDeletion");confirm(u)&&(this.isLoading=!0,this.deleteImage(this.menuType,this.entityMrn,this.orgMrn).subscribe(l=>{this.notifierService.notify("success",this.translate.instant("success.resource.uploadImage")),this.isLoading=!1,this.image=void 0},l=>{this.notifierService.notify("error",this.translate.instant("error.resource.errorInDeletion")+l.error.message),this.isLoading=!1}))},this.changeFile=u=>{const l=u.target.files[0],m=new FileReader;this.isLoading=!0,m.addEventListener("load",k=>{this.image=k.target.result;const B=l.type;"image/png"!==B&&"image/jpeg"!==B||this.updatePut(this.menuType,l,this.entityMrn,this.orgMrn,B).subscribe(F=>{this.isLoading=!1},F=>this.notifierService.notify("error",this.translate.instant("error.resource.updateImageFailed")+F.error.message))},!1),m.readAsDataURL(l)},(0,O.$M)(o)}ngOnInit(){this.accept=this.allowedExtensions?this.allowedExtensions.join(","):"",this.entityMrn&&this.getImage(this.menuType,this.entityMrn,this.orgMrn).subscribe(e=>{const t=URL.createObjectURL(new Blob([e]));this.image=this.sanitizer.bypassSecurityTrustUrl(t)},e=>{console.log(e)})}updatePut(e,t,n,a,o){return e===w._g.Organization?this.logoControllerService.updateLogoPut(t,n):e===w._g.Vessel?this.vesselImageControllerService.updateVesselImagePut(t,a,n):new jt.y}getImage(e,t,n){return e===w._g.Organization?this.logoControllerService.getLogo(t):e===w._g.Vessel?this.vesselImageControllerService.getVesselImage(n,t):new jt.y}deleteImage(e,t,n){return e===w._g.Organization?this.logoControllerService.deleteLogo(t):e===w._g.Vessel?this.vesselImageControllerService.deleteVesselImage(n,t):new jt.y}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(Kl.J),r.Y36(uc.X),r.Y36(Me.lG),r.Y36(cc.H7),r.Y36(We.sK))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-input-image"]],inputs:{menuType:"menuType",isEditing:"isEditing",orgMrn:"orgMrn",entityMrn:"entityMrn",allowedExtensions:"allowedExtensions"},decls:4,vars:3,consts:[["class","image_container","nbSpinnerSize","large","nbSpinnerStatus","primary",3,"nbSpinner",4,"ngIf"],["type","button","nbButton","","class","m-0","fullWidth","","disabled","",4,"ngIf"],["type","file",3,"accept","change",4,"ngIf"],["nbSpinnerSize","large","nbSpinnerStatus","primary",1,"image_container",3,"nbSpinner"],["class","mh-100",4,"ngIf"],["class","h-100 image_text",3,"click",4,"ngIf"],[1,"mh-100"],[1,"h-100","image_text",3,"click"],[1,"container"],[1,"text-white","font-weight-bold"],["type","button","nbButton","","fullWidth","","disabled","",1,"m-0"],["type","file",3,"accept","change"]],template:function(e,t){1&e&&(r.TgZ(0,"div"),r.YNc(1,Kn,4,4,"div",0),r.YNc(2,gm,2,0,"button",1),r.YNc(3,pm,1,1,"input",2),r.qZA()),2&e&&(r.xp6(1),r.Q6J("ngIf",t.image),r.xp6(1),r.Q6J("ngIf",!t.image),r.xp6(1),r.Q6J("ngIf",t.isEditing))},directives:[_.O5,K.Q7R,K.DPz],styles:[".image_container[_ngcontent-%COMP%]{height:100px;position:relative;display:inline-block}.image_text[_ngcontent-%COMP%]{position:absolute;background-color:#14141460;display:block}"]}),s})();function ym(s,i){if(1&s&&(r.TgZ(0,"div",2)(1,"div",3),r._UZ(2,"nb-icon",4),r.TgZ(3,"span",5),r._uU(4),r.qZA()()()),2&s){const e=r.oxw();r.Q6J("nbSpinner",e.isLoading),r.xp6(2),r.Q6J("icon","ship"),r.xp6(2),r.Oqu(e.getTitle(e.entity.mrn,e.entity.name))}}function wm(s,i){if(1&s&&(r.TgZ(0,"div",2)(1,"div",3),r._UZ(2,"nb-icon",6),r.TgZ(3,"span",7),r._uU(4),r.qZA()()()),2&s){const e=r.oxw();r.Q6J("nbSpinner",e.isLoading),r.xp6(2),r.Q6J("icon","ship"),r.xp6(2),r.hij(" No ",e.menuType," assigned")}}function Sm(s,i){if(1&s&&(r.TgZ(0,"nb-option",10),r._uU(1),r.qZA()),2&s){const e=i.$implicit;r.s9C("value",e.value),r.xp6(1),r.Oqu(e.title)}}function bm(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"nb-select",8),r.NdJ("selectedChange",function(n){return r.CHM(e),r.oxw().onMenuItemSelected({value:n})})("selectedChange",function(n){return r.CHM(e),r.oxw().selectedEntityMrn=n}),r.YNc(1,Sm,2,2,"nb-option",9),r.qZA()}if(2&s){const e=r.oxw();r.s9C("status",!e.entity&&e.required?"danger":""),r.Q6J("selected",e.selectedEntityMrn),r.xp6(1),r.Q6J("ngForOf",e.options)}}let _m=(()=>{class s{constructor(e,t,n){this.vesselControllerService=e,this.iconsLibrary=t,this.notifierService=n,this.onUpdate=new r.vpe,this.options=[],this.isLoading=!1,this.selectedEntityMrn="",this.getTitle=(a,o)=>o.includes(a)?o:o+" ("+a+")",this.getOption=(a,o)=>({title:this.getTitle(a,o),value:a}),this.onUpdateEntity=(a,o)=>{this.entity={mrn:a,name:o}},this.onMenuItemSelected=a=>{this.onUpdateEntity(a.value,this.options.filter(o=>o.value===a.value).pop().title),this.onUpdate.emit({fieldName:this.menuType,value:this.entity})},t.registerFontPack("fas",{packClass:"fas",iconClassPrefix:"fa"})}ngOnInit(){this.menuType===w._g.Vessel&&(this.isLoading=!0,this.vesselControllerService.getOrganizationVessels(this.orgMrn).subscribe(e=>{this.isLoading=!1,e.content.forEach(t=>this.options.push(this.getOption(t.mrn,t.name))),this.entity&&this.options.forEach(t=>{t.value===this.entity.mrn&&(this.selectedEntityMrn=this.entity.mrn)})},e=>this.notifierService.notify("error","There was error in fetching "+this.menuType+" - "+e.error.message)))}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(Ne.H),r.Y36(K.B7b),r.Y36(Me.lG))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-input-mcp-entity"]],inputs:{menuType:"menuType",isEditing:"isEditing",orgMrn:"orgMrn",entity:"entity",required:"required"},outputs:{onUpdate:"onUpdate"},decls:4,vars:3,consts:[["class","container","nbSpinnerStatus","primary",3,"nbSpinner",4,"ngIf"],["type","string","fullWidth","","required","required === true",3,"selected","status","selectedChange",4,"ngIf"],["nbSpinnerStatus","primary",1,"container",3,"nbSpinner"],[1,"row","justify-content-center","align-items-center","bg-light"],["pack","fas",3,"icon"],[1,"font-weight-bold","p-2"],["pack","fas",1,"text-secondary",3,"icon"],[1,"text-secondary","font-weight-bold","p-2"],["type","string","fullWidth","","required","required === true",3,"selected","status","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){1&e&&(r.TgZ(0,"div"),r.YNc(1,ym,5,3,"div",0),r.YNc(2,wm,5,3,"div",0),r.YNc(3,bm,2,3,"nb-select",1),r.qZA()),2&e&&(r.xp6(1),r.Q6J("ngIf",t.entity&&!t.isEditing),r.xp6(1),r.Q6J("ngIf",!t.entity&&!t.isEditing),r.xp6(1),r.Q6J("ngIf",t.isEditing))},directives:[_.O5,K.Q7R,K.fMN,K.rs,_.sg,K.q51],styles:[""]}),s})();var Am=M(8831);function km(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",8),r.NdJ("click",function(n){return r.CHM(e),r.oxw(2).deleteFile(n)}),r._uU(1,"X"),r.qZA()}if(2&s){const e=r.oxw().$implicit,t=r.oxw();r.s9C("value",e.id),r.Q6J("size",t.tiny)}}function Em(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",5),r.NdJ("click",function(n){return r.CHM(e),r.oxw().downloadFile(n)}),r.TgZ(1,"span",6),r._uU(2),r.qZA(),r.YNc(3,km,2,2,"button",7),r.qZA()}if(2&s){const e=i.$implicit,t=r.oxw();r.s9C("value",e.id),r.xp6(2),r.Oqu(e.name),r.xp6(1),r.Q6J("ngIf",t.isEditing)}}function Cm(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",8),r.NdJ("click",function(n){return r.CHM(e),r.oxw(2).deleteFile(n)}),r._uU(1,"X"),r.qZA()}if(2&s){const e=r.oxw(2);r.s9C("value",e.file.id),r.Q6J("size",e.tiny)}}function Nm(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",9)(1,"div",10)(2,"div",11),r.NdJ("click",function(n){return r.CHM(e),r.oxw().downloadFile(n)}),r.TgZ(3,"span",6),r._uU(4),r.qZA()(),r.TgZ(5,"div",12),r.YNc(6,Cm,2,2,"button",7),r.qZA()()()}if(2&s){const e=r.oxw();r.xp6(2),r.s9C("value",e.file.id),r.xp6(2),r.Oqu(e.file.name),r.xp6(2),r.Q6J("ngIf",e.isEditing)}}function Im(s,i){1&s&&(r.TgZ(0,"div",13)(1,"button",14),r._uU(2,"No file"),r.qZA()())}function Tm(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"input",15),r.NdJ("change",function(n){return r.CHM(e),r.oxw().changeFile(n)}),r.qZA()}}let Bm=(()=>{class s{constructor(e,t,n){this.iconsLibrary=e,this.docControllerService=t,this.notifierService=n,this.onUpdate=new r.vpe,this.onDelete=new r.vpe,this.isLoading=!1,this.docDtoList=[],this.downloadFile=a=>{if(this.file&&this.file.filecontent){const l=atob(this.file.filecontent.replace(/\s/g,"")),m=l.length,k=new ArrayBuffer(m),B=new Uint8Array(k);for(var o=0;o<m;o++)B[o]=l.charCodeAt(o);const F=new Blob([B],{type:this.file.filecontentContentType}),V=window.URL.createObjectURL(F),le=document.createElement("a");le.href=V,le.setAttribute("download",this.file.name),le.click()}},this.loadDocs=()=>{if(this.docIds&&this.docIds.length>0)for(const a of this.docIds)this.docControllerService.getDoc(a).subscribe(o=>{this.docDtoList.push(o)},o=>{})},this.deleteFileFromBackend=a=>{this.docControllerService.deleteDoc(a).subscribe(o=>{this.notifierService.notify("success","File has been successfully deleted"),this.onDelete.emit({fieldName:this.fieldName}),this.isLoading=!1},o=>{this.notifierService.notify("error","There was error in deletion - "+o.error.message),this.isLoading=!1})},this.deleteFile=a=>{this.isLoading=!0,this.isForSingleDoc()||confirm("Are you sure you want to delete?")&&this.deleteFileFromBackend(this.file.id),this.onDelete.emit({fieldName:this.fieldName})},this.updateFileFromBackend=a=>{},this.createFileFromBackend=a=>{this.docControllerService.createDoc(a).subscribe(o=>{this.isLoading=!1,this.notifierService.notify("success","File has been successfully uploaded"),o.id&&this.docIds&&this.docIds.indexOf(o.id)<0&&this.docIds.push(o.id),this.onUpdate.emit({fieldName:this.fieldName,data:this.docIds}),this.loadDocs()},o=>this.notifierService.notify("error","There was error in updating image - "+o.error.message))},this.changeFile=a=>{const[o]=a.target.files,u=new FileReader;this.isLoading=!0,u.addEventListener("load",l=>{const m=l.target.result.substr(l.target.result.indexOf("base64,")+7),k={name:o.name,comment:"",mimetype:o.type,filecontent:m,filecontentContentType:o.type,instanceId:this.instanceId};this.isForSingleDoc()?this.onUpdate.emit({fieldName:this.fieldName,data:k}):this.createFileFromBackend(k)},!1),u.readAsDataURL(o)},this.update=()=>{this.onUpdate.emit({data:this.docIds,fieldName:this.fieldName})},this.isForSingleDoc=()=>"instanceAsDoc"===this.fieldName,e.registerFontPack("fa",{packClass:"fa",iconClassPrefix:"fa"})}ngOnInit(){this.loadDocs()}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(K.B7b),r.Y36(Am.k),r.Y36(Me.lG))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-input-file-list"]],inputs:{docIds:"docIds",file:"file",isEditing:"isEditing",fieldName:"fieldName",placeholder:"placeholder",required:"required",options:"options",instanceId:"instanceId"},outputs:{onUpdate:"onUpdate",onDelete:"onDelete"},decls:6,vars:4,consts:[[1,"button_container","pb-2"],["class","bg-info align-baseline rounded p-1 w-100",3,"value","click",4,"ngFor","ngForOf"],["class","bg-info align-baseline rounded p-1 w-100",4,"ngIf"],["class","bg-light align-baseline p-0 w-100 text-center",4,"ngIf"],["type","file",3,"change",4,"ngIf"],[1,"bg-info","align-baseline","rounded","p-1","w-100",3,"value","click"],[1,"text-white"],["class","rounded-circle bg-info text-white border-0","nbButton","",3,"size","value","click",4,"ngIf"],["nbButton","",1,"rounded-circle","bg-info","text-white","border-0",3,"size","value","click"],[1,"bg-info","align-baseline","rounded","p-1","w-100"],[1,"d-flex"],[1,"mr-auto","p-2",3,"value","click"],[1,"p-2"],[1,"bg-light","align-baseline","p-0","w-100","text-center"],["type","button","nbButton","","fullWidth","","disabled","",1,"m-0"],["type","file",3,"change"]],template:function(e,t){1&e&&(r.TgZ(0,"div")(1,"div",0),r.YNc(2,Em,4,3,"div",1),r.YNc(3,Nm,7,3,"div",2),r.YNc(4,Im,3,0,"div",3),r.qZA(),r.YNc(5,Tm,1,0,"input",4),r.qZA()),2&e&&(r.xp6(2),r.Q6J("ngForOf",t.docDtoList),r.xp6(1),r.Q6J("ngIf",t.file),r.xp6(1),r.Q6J("ngIf",0===t.docDtoList.length&&!t.file),r.xp6(1),r.Q6J("ngIf",t.isEditing))},directives:[_.sg,_.O5,K.DPz],styles:[".button_container[_ngcontent-%COMP%]{display:flex;width:100%;padding:1px;gap:5px;flex-wrap:wrap}"]}),s})(),xm=(()=>{class s extends K.O$F{}return s.\u0275fac=function(){let i;return function(t){return(i||(i=r.n5z(s)))(t||s)}}(),s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-day-cell"]],hostAttrs:[1,"day-cell"],hostBindings:function(e,t){1&e&&r.NdJ("click",function(){return t.onClick()})},features:[r.qOj],decls:4,vars:2,consts:[[1,"caption"]],template:function(e,t){1&e&&(r.TgZ(0,"div"),r._uU(1),r.qZA(),r.TgZ(2,"span",0),r._uU(3),r.qZA()),2&e&&(r.xp6(1),r.Oqu(t.day),r.xp6(2),r.hij("",(t.day+100)*t.day,"$"))},styles:["[_nghost-%COMP%]{text-align:center;flex-direction:column}[_nghost-%COMP%]   .caption[_ngcontent-%COMP%]{display:block}.selected[_nghost-%COMP%]   .caption[_ngcontent-%COMP%], [_nghost-%COMP%]:hover   .caption[_ngcontent-%COMP%]{color:var(--text-control-color)}.bounding-month[_nghost-%COMP%]   .caption[_ngcontent-%COMP%]{color:inherit}"]}),s})();function Rm(s,i){if(1&s&&(r.TgZ(0,"nb-option",16),r._uU(1),r.qZA()),2&s){const e=i.$implicit;r.Q6J("value",e.value),r.xp6(1),r.hij(" ",e.title,"")}}function Om(s,i){if(1&s&&(r.TgZ(0,"span",17)(1,"a",18),r._uU(2,"(Reference)"),r.qZA()()),2&s){const e=r.oxw();r.xp6(1),r.s9C("href",e.reference,r.LSH)}}let Vm=(()=>{class s{constructor(e){this.ref=e,this.date=new Date,this.reasons=[],this.description="",this.reference="",this.dayCellComponent=xm,this.isLoading=!1;for(const t in P.r5.RevokationReasonEnum)this.reasons.push(Se(t.toLocaleLowerCase()))}doRevoke(){this.isLoading=!0,this.certificateService.revokeCertificate(this.entityType,this.entityMrn,this.orgMrn,this.certificateId,{revokedAt:this.date,revokationReason:this.revokationReason},this.instanceVersion).subscribe(t=>{this.ref.close(),this.notifierService.notify("success","Certificate has been successfully revoked"),this.isLoading=!1,this.updateCertificate()},t=>{this.isLoading=!1,410!==t.status?this.notifierService.notify("error","Error when trying to issue new certificate",t.error.message):this.notifierService.notify("error","Generating certificates with server generated keys is not supported by this ID provider")})}ngOnInit(){}dismiss(){this.ref.close(),this.updateCertificate()}onMenuItemSelected(e){const t=Se(e);this.revokationReason=t.value,this.description=t.description,this.reference=t.reference}onDateChange(e){this.date=e}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(K.X4l))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-cert-revoke-dialog"]],inputs:{entityMrn:"entityMrn",entityTitle:"entityTitle",orgMrn:"orgMrn",certificateId:"certificateId",instanceVersion:"instanceVersion",entityType:"entityType",certificateService:"certificateService",notifierService:"notifierService",updateCertificate:"updateCertificate"},decls:30,vars:7,consts:[[1,"modal-window"],["nbSpinnerSize","large","nbSpinnerStatus","primary",3,"nbSpinner"],[1,"container"],[1,"row"],[1,"col"],[1,"subtitle"],["fullWidth","","placeholder","Choose a reason",3,"selectedChange"],[3,"value",4,"ngFor","ngForOf"],["nbInput","","fullWidth","","placeholder","Choose a date",3,"nbDatepicker"],[3,"dateChange"],["formpicker",""],[1,"headline"],["class","reference",4,"ngIf"],[1,"buttons-row"],["type","button","nbButton","","status","primary",3,"click"],["type","button","nbButton","","status","danger",3,"click"],[3,"value"],[1,"reference"],["target","_blank",3,"href"]],template:function(e,t){if(1&e&&(r.TgZ(0,"nb-card",0)(1,"nb-card-header"),r._uU(2),r.qZA(),r.TgZ(3,"nb-card-body",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"span",5),r._uU(8," Revocation reason: "),r.qZA(),r._UZ(9,"br"),r.TgZ(10,"nb-select",6),r.NdJ("selectedChange",function(a){return t.onMenuItemSelected(a)}),r.YNc(11,Rm,2,2,"nb-option",7),r.qZA()(),r.TgZ(12,"div",4)(13,"span",5),r._uU(14," Revocation date: "),r.qZA(),r._UZ(15,"br")(16,"input",8),r.TgZ(17,"nb-datepicker",9,10),r.NdJ("dateChange",function(a){return t.onDateChange(a)}),r.qZA()()(),r.TgZ(19,"div",3)(20,"div",4)(21,"div",11),r._uU(22),r.YNc(23,Om,3,1,"span",12),r.qZA()()()()(),r.TgZ(24,"nb-card-footer")(25,"div",13)(26,"button",14),r.NdJ("click",function(){return t.doRevoke()}),r._uU(27,"Revoke"),r.qZA(),r.TgZ(28,"button",15),r.NdJ("click",function(){return t.dismiss()}),r._uU(29,"Cancel"),r.qZA()()()()),2&e){const n=r.MAs(18);r.xp6(2),r.AsE(" Revoke certificate for ",t.entityTitle," (",t.entityMrn,") "),r.xp6(1),r.Q6J("nbSpinner",t.isLoading),r.xp6(8),r.Q6J("ngForOf",t.reasons),r.xp6(5),r.Q6J("nbDatepicker",n),r.xp6(6),r.hij(" ",t.description," "),r.xp6(1),r.Q6J("ngIf",t.reference.length)}},directives:[K.Asz,K.ndF,K.yKW,K.Q7R,K.rs,_.sg,K.q51,K.h8i,K.$kf,K.B4C,_.O5,K.XWE,K.DPz],styles:[".modal-window[_ngcontent-%COMP%]{width:40rem}.headline[_ngcontent-%COMP%]{padding:10px}.reference[_ngcontent-%COMP%], .reference[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#646464}[_nghost-%COMP%]   .buttons-row[_ngcontent-%COMP%]{margin:-.5rem}[_nghost-%COMP%]   button[nbButton][_ngcontent-%COMP%]{margin:.5rem}[dir=ltr]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-right:.5rem}[dir=rtl]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-left:.5rem}[_nghost-%COMP%]   .actions-card[_ngcontent-%COMP%]{height:8rem}"]}),s})();var Ce=M(5861),ye=M(6801);function h(s,i,e){var t;return s instanceof Object&&null!==(t=s[i])&&void 0!==t?t:e}function rf(s,i=0,e=s.byteLength-i,t=!1){let n="";for(const a of new Uint8Array(s,i,e)){const o=a.toString(16).toUpperCase();1===o.length&&(n+="0"),n+=o,t&&(n+=" ")}return n.trim()}function Er(s,i){let e=0;if(1===s.length)return s[0];for(let t=s.length-1;t>=0;t--)e+=s[s.length-1-t]*Math.pow(2,i*t);return e}function ds(s,i,e=-1){const t=e;let n=s,a=0,o=Math.pow(2,i);for(let u=1;u<8;u++){if(s<o){let l;if(t<0)l=new ArrayBuffer(u),a=u;else{if(t<u)return new ArrayBuffer(0);l=new ArrayBuffer(t),a=t}const m=new Uint8Array(l);for(let k=u-1;k>=0;k--){const B=Math.pow(2,k*i);m[a-k-1]=Math.floor(n/B),n-=m[a-k-1]*B}return l}o*=Math.pow(2,i)}return new ArrayBuffer(0)}function jn(...s){let i=0,e=0;for(const a of s)i+=a.byteLength;const t=new ArrayBuffer(i),n=new Uint8Array(t);for(const a of s)n.set(new Uint8Array(a),e),e+=a.byteLength;return t}function fc(...s){let i=0,e=0;for(const a of s)i+=a.length;const t=new ArrayBuffer(i),n=new Uint8Array(t);for(const a of s)n.set(a,e),e+=a.length;return n}function nf(){const s=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const l=0===s[0]&&0==(128&s[1]);(255===s[0]&&128&s[1]||l)&&this.warnings.push("Needlessly long format")}const i=new ArrayBuffer(this.valueHex.byteLength),e=new Uint8Array(i);for(let u=0;u<this.valueHex.byteLength;u++)e[u]=0;e[0]=128&s[0];const t=Er(e,8),n=new ArrayBuffer(this.valueHex.byteLength),a=new Uint8Array(n);for(let u=0;u<this.valueHex.byteLength;u++)a[u]=s[u];return a[0]&=127,Er(a,8)-t}function $n(s,i){if(s.byteLength!==i.byteLength)return!1;const e=new Uint8Array(s),t=new Uint8Array(i);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function $t(s,i){const e=s.toString(10);if(i<e.length)return"";const t=i-e.length,n=new Array(t);for(let o=0;o<t;o++)n[o]="0";return n.join("").concat(e)}const af="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",of="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";function dc(s,i=!1,e=!1,t=!1){let n=0,a=0,o=0,u="";const l=i?of:af;if(t){let m=0;for(let k=0;k<s.length;k++)if(0!==s.charCodeAt(k)){m=k;break}s=s.slice(m)}for(;n<s.length;){const m=s.charCodeAt(n++);n>=s.length&&(a=1);const k=s.charCodeAt(n++);n>=s.length&&(o=1);const B=s.charCodeAt(n++),F=m>>2,V=(3&m)<<4|k>>4;let le=(15&k)<<2|B>>6,ve=63&B;1===a?le=ve=64:1===o&&(ve=64),u+=e?64===le?`${l.charAt(F)}${l.charAt(V)}`:64===ve?`${l.charAt(F)}${l.charAt(V)}${l.charAt(le)}`:`${l.charAt(F)}${l.charAt(V)}${l.charAt(le)}${l.charAt(ve)}`:`${l.charAt(F)}${l.charAt(V)}${l.charAt(le)}${l.charAt(ve)}`}return u}function wa(s,i=!1,e=!1){const t=i?of:af;function n(l){for(let m=0;m<64;m++)if(t.charAt(m)===l)return m;return 64}function a(l){return 64===l?0:l}let o=0,u="";for(;o<s.length;){const l=n(s.charAt(o++)),m=o>=s.length?0:n(s.charAt(o++)),k=o>=s.length?0:n(s.charAt(o++)),B=o>=s.length?0:n(s.charAt(o++)),F=a(l)<<2|a(m)>>4,V=(15&a(m))<<4|a(k)>>2,le=(3&a(k))<<6|a(B);u+=String.fromCharCode(F),64!==k&&(u+=String.fromCharCode(V)),64!==B&&(u+=String.fromCharCode(le))}if(e){let m=-1;for(let k=u.length-1;k>=0;k--)if(0!==u.charCodeAt(k)){m=k;break}u=-1!==m?u.slice(0,m+1):""}return u}function $l(s){let i="";const e=new Uint8Array(s);for(const t of e)i+=String.fromCharCode(t);return i}function Cr(s){const i=s.length,e=new ArrayBuffer(i),t=new Uint8Array(e);for(let n=0;n<i;n++)t[n]=s.charCodeAt(n);return e}const Dm=Math.log(2);function Um(s){const i=Math.log(s)/Dm,e=Math.floor(i),t=Math.round(i);return e===t?e:t}function ge(s,i){for(const e of i)delete s[e]}function ql(){if("undefined"==typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function mc(s){let i=0,e=0;for(let n=0;n<s.length;n++)i+=s[n].byteLength;const t=new Uint8Array(i);for(let n=0;n<s.length;n++){const a=s[n];t.set(new Uint8Array(a),e),e+=a.byteLength}return t.buffer}function ms(s,i,e,t){return i instanceof Uint8Array?i.byteLength?e<0?(s.error="Wrong parameter: inputOffset less than zero",!1):t<0?(s.error="Wrong parameter: inputLength less than zero",!1):!(i.byteLength-e-t<0&&(s.error="End of input reached before message was fully decoded (inconsistent offset and length values)",1)):(s.error="Wrong parameter: inputBuffer has zero length",!1):(s.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class gc{constructor(){this.items=[]}write(i){this.items.push(i)}final(){return mc(this.items)}}const Sa=[new Uint8Array([1])],lf="0123456789",pc="name",uf="valueHexView",ss=new ArrayBuffer(0),Zl=new Uint8Array(0),ba="EndOfContent",cf="OCTET STRING",hf="BIT STRING";function gs(s){var i;return(i=class extends s{constructor(...t){var n;super(...t);const a=t[0]||{};this.isHexOnly=null!==(n=a.isHexOnly)&&void 0!==n&&n,this.valueHexView=a.valueHex?ye.vJ.toUint8Array(a.valueHex):Zl}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(t){this.valueHexView=new Uint8Array(t)}fromBER(t,n,a){const o=t instanceof ArrayBuffer?new Uint8Array(t):t;if(!ms(this,o,n,a))return-1;const u=n+a;return this.valueHexView=o.subarray(n,u),this.valueHexView.length?(this.blockLength=a,u):(this.warnings.push("Zero buffer length"),n)}toBER(t=!1){return this.isHexOnly?t?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",ss)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:ye.ep.ToHex(this.valueHexView)}}}).NAME="hexBlock",i}let qn=(()=>{class s{constructor({blockLength:e=0,error:t="",warnings:n=[],valueBeforeDecode:a=Zl}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=ye.vJ.toUint8Array(a)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:ye.ep.ToHex(this.valueBeforeDecodeView)}}}return s.NAME="baseBlock",s})(),qt=(()=>{class s extends qn{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}return s.NAME="valueBlock",s})(),qm=(()=>{class s extends(gs(qn)){constructor({idBlock:e={}}={}){var t,n,a,o;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?ye.vJ.toUint8Array(e.valueHex):Zl,this.tagClass=null!==(n=e.tagClass)&&void 0!==n?n:-1,this.tagNumber=null!==(a=e.tagNumber)&&void 0!==a?a:-1,this.isConstructed=null!==(o=e.isConstructed)&&void 0!==o&&o):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",ss}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const a=new Uint8Array(1);if(!e){let o=this.tagNumber;o&=31,t|=o,a[0]=t}return a.buffer}if(!this.isHexOnly){const a=ds(this.tagNumber,7),o=new Uint8Array(a),u=a.byteLength,l=new Uint8Array(u+1);if(l[0]=31|t,!e){for(let m=0;m<u-1;m++)l[m+1]=128|o[m];l[u]=o[u-1]}return l.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=31|t,!e){const a=this.valueHexView;for(let o=0;o<a.length-1;o++)n[o+1]=128|a[o];n[this.valueHexView.byteLength]=a[a.length-1]}return n.buffer}fromBER(e,t,n){const a=ye.vJ.toUint8Array(e);if(!ms(this,a,t,n))return-1;const o=a.subarray(t,t+n);if(0===o.length)return this.error="Zero buffer length",-1;switch(192&o[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&o[0]),this.isHexOnly=!1;const l=31&o[0];if(31!==l)this.tagNumber=l,this.blockLength=1;else{let m=1,k=this.valueHexView=new Uint8Array(255),B=255;for(;128&o[m];){if(k[m-1]=127&o[m],m++,m>=o.length)return this.error="End of input reached before message was fully decoded",-1;if(m===B){B+=255;const V=new Uint8Array(B);for(let le=0;le<k.length;le++)V[le]=k[le];k=this.valueHexView=new Uint8Array(B)}}this.blockLength=m+1,k[m-1]=127&o[m];const F=new Uint8Array(m);for(let V=0;V<m;V++)F[V]=k[V];k=this.valueHexView=new Uint8Array(m),k.set(F),this.blockLength<=9?this.tagNumber=Er(k,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}return s.NAME="identificationBlock",s})(),Zm=(()=>{class s extends qn{constructor({lenBlock:e={}}={}){var t,n,a;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(n=e.longFormUsed)&&void 0!==n&&n,this.length=null!==(a=e.length)&&void 0!==a?a:0}fromBER(e,t,n){const a=ye.vJ.toUint8Array(e);if(!ms(this,a,t,n))return-1;const o=a.subarray(t,t+n);if(0===o.length)return this.error="Zero buffer length",-1;if(255===o[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===o[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&o[0]),!1===this.longFormUsed)return this.length=o[0],this.blockLength=1,t+this.blockLength;const u=127&o[0];if(u>8)return this.error="Too big integer",-1;if(u+1>o.length)return this.error="End of input reached before message was fully decoded",-1;const l=t+1,m=a.subarray(l,l+u);return 0===m[u-1]&&this.warnings.push("Needlessly long encoded length"),this.length=Er(m,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=u+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const a=ds(this.length,8);if(a.byteLength>127)return this.error="Too big length",ss;if(t=new ArrayBuffer(a.byteLength+1),e)return t;const o=new Uint8Array(a);n=new Uint8Array(t),n[0]=128|a.byteLength;for(let u=0;u<a.byteLength;u++)n[u+1]=o[u];return t}return t=new ArrayBuffer(1),!1===e&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}return s.NAME="lengthBlock",s})();const Be={};let Jt=(()=>{class s extends qn{constructor({name:e="",optional:t=!1,primitiveSchema:n,...a}={},o){super(a),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new qm(a),this.lenBlock=new Zm(a),this.valueBlock=o?new o(a):new qt(a)}fromBER(e,t,n){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}toBER(e,t){const n=t||new gc;t||ff(this);const a=this.idBlock.toBER(e);if(n.write(a),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const o=this.valueBlock.toBER(e);this.lenBlock.length=o.byteLength;const u=this.lenBlock.toBER(e);n.write(u),n.write(o)}return t?ss:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return"ascii"===e?this.onAsciiEncoding():ye.ep.ToHex(this.toBER())}onAsciiEncoding(){return`${this.constructor.NAME} : ${ye.ep.ToHex(this.valueBlock.valueBeforeDecodeView)}`}isEqual(e){return this===e||e instanceof this.constructor&&$n(this.toBER(),e.toBER())}}return s.NAME="BaseBlock",s})();function ff(s){if(s instanceof Be.Constructed)for(const i of s.valueBlock.value)ff(i)&&(s.lenBlock.isIndefiniteForm=!0);return!!s.lenBlock.isIndefiniteForm}let zm=(()=>{class s extends Jt{constructor({value:e="",...t}={},n){super(t,n),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,n){const a=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),a)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}return s.NAME="BaseStringBlock",s})(),Gm=(()=>{class s extends(gs(qt)){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}return s.NAME="PrimitiveValueBlock",s})();class Ue extends Jt{constructor(i={}){super(i,Gm),this.idBlock.isConstructed=!1}}function Zn(s,i=0,e=s.length){const t=i;let n=new Jt({},qt);const a=new qn;if(!ms(a,s,i,e))return n.error=a.error,{offset:-1,result:n};if(!s.subarray(i,i+e).length)return n.error="Zero buffer length",{offset:-1,result:n};let u=n.idBlock.fromBER(s,i,e);if(n.idBlock.warnings.length&&n.warnings.concat(n.idBlock.warnings),-1===u)return n.error=n.idBlock.error,{offset:-1,result:n};if(u=n.lenBlock.fromBER(s,i=u,e-=n.idBlock.blockLength),n.lenBlock.warnings.length&&n.warnings.concat(n.lenBlock.warnings),-1===u)return n.error=n.lenBlock.error,{offset:-1,result:n};if(i=u,e-=n.lenBlock.blockLength,!n.idBlock.isConstructed&&n.lenBlock.isIndefiniteForm)return n.error="Indefinite length form used for primitive encoding form",{offset:-1,result:n};let l=Jt;if(1===n.idBlock.tagClass){if(n.idBlock.tagNumber>=37&&!1===n.idBlock.isHexOnly)return n.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:n};switch(n.idBlock.tagNumber){case 0:if(n.idBlock.isConstructed&&n.lenBlock.length>0)return n.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:n};l=Be.EndOfContent;break;case 1:l=Be.Boolean;break;case 2:l=Be.Integer;break;case 3:l=Be.BitString;break;case 4:l=Be.OctetString;break;case 5:l=Be.Null;break;case 6:l=Be.ObjectIdentifier;break;case 10:l=Be.Enumerated;break;case 12:l=Be.Utf8String;break;case 13:l=Be.RelativeObjectIdentifier;break;case 14:l=Be.TIME;break;case 15:return n.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:n};case 16:l=Be.Sequence;break;case 17:l=Be.Set;break;case 18:l=Be.NumericString;break;case 19:l=Be.PrintableString;break;case 20:l=Be.TeletexString;break;case 21:l=Be.VideotexString;break;case 22:l=Be.IA5String;break;case 23:l=Be.UTCTime;break;case 24:l=Be.GeneralizedTime;break;case 25:l=Be.GraphicString;break;case 26:l=Be.VisibleString;break;case 27:l=Be.GeneralString;break;case 28:l=Be.UniversalString;break;case 29:l=Be.CharacterString;break;case 30:l=Be.BmpString;break;case 31:l=Be.DATE;break;case 32:l=Be.TimeOfDay;break;case 33:l=Be.DateTime;break;case 34:l=Be.Duration;break;default:{const m=n.idBlock.isConstructed?new Be.Constructed:new Be.Primitive;m.idBlock=n.idBlock,m.lenBlock=n.lenBlock,m.warnings=n.warnings,n=m}}}else l=n.idBlock.isConstructed?Be.Constructed:Be.Primitive;return n=function Wm(s,i){if(s instanceof i)return s;const e=new i;return e.idBlock=s.idBlock,e.lenBlock=s.lenBlock,e.warnings=s.warnings,e.valueBeforeDecodeView=s.valueBeforeDecodeView,e}(n,l),u=n.fromBER(s,i,n.lenBlock.isIndefiniteForm?e:n.lenBlock.length),n.valueBeforeDecodeView=s.subarray(t,t+n.blockLength),{offset:u,result:n}}function Ct(s){if(!s.byteLength){const i=new Jt({},qt);return i.error="Input buffer has zero length",{offset:-1,result:i}}return Zn(ye.vJ.toUint8Array(s).slice(),0,s.byteLength)}function Ym(s,i){return s?1:i}Be.Primitive=Ue,Ue.NAME="PRIMITIVE";let Nr=(()=>{class s extends qt{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const a=ye.vJ.toUint8Array(e);if(!ms(this,a,t,n))return-1;if(this.valueBeforeDecodeView=a.subarray(t,t+n),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let o=t;for(;Ym(this.isIndefiniteForm,n)>0;){const u=Zn(a,o,n);if(-1===u.offset)return this.error=u.result.error,this.warnings.concat(u.result.warnings),-1;if(o=u.offset,this.blockLength+=u.result.blockLength,n-=u.result.blockLength,this.value.push(u.result),this.isIndefiniteForm&&u.result.constructor.NAME===ba)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===ba?this.value.pop():this.warnings.push("No EndOfContent block encoded")),o}toBER(e,t){const n=t||new gc;for(let a=0;a<this.value.length;a++)this.value[a].toBER(e,n);return t?ss:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}return s.NAME="ConstructedValueBlock",s})();class $ extends Jt{constructor(i={}){super(i,Nr),this.idBlock.isConstructed=!0}fromBER(i,e,t){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const n=this.valueBlock.fromBER(i,e,this.lenBlock.isIndefiniteForm?t:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),n)}onAsciiEncoding(){const i=[];for(const t of this.valueBlock.value)i.push(t.toString("ascii").split("\n").map(n=>`  ${n}`).join("\n"));const e=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return i.length?`${e} :\n${i.join("\n")}`:`${e} :`}}Be.Constructed=$,$.NAME="CONSTRUCTED";let Qm=(()=>{class s extends qt{fromBER(e,t,n){return t}toBER(e){return ss}}return s.override="EndOfContentValueBlock",s})();class pf extends Jt{constructor(i={}){super(i,Qm),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}Be.EndOfContent=pf,pf.NAME=ba;class _t extends Jt{constructor(i={}){super(i,qt),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(i,e,t){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=t,e+t>i.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):e+t}toBER(i,e){const t=new ArrayBuffer(2);if(!i){const n=new Uint8Array(t);n[0]=5,n[1]=0}return e&&e.write(t),t}onAsciiEncoding(){return`${this.constructor.NAME}`}}Be.Null=_t,_t.NAME="NULL";let Xm=(()=>{class s extends(gs(qt)){constructor({value:e,...t}={}){super(t),this.valueHexView=t.valueHex?ye.vJ.toUint8Array(t.valueHex):new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,n){const a=ye.vJ.toUint8Array(e);return ms(this,a,t,n)?(this.valueHexView=a.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,nf.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}return s.NAME="BooleanValueBlock",s})();class Bs extends Jt{constructor(i={}){super(i,Xm),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(i){this.valueBlock.value=i}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}Be.Boolean=Bs,Bs.NAME="BOOLEAN";let eg=(()=>{class s extends(gs(Nr)){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let a=0;if(this.isConstructed){if(this.isHexOnly=!1,a=Nr.prototype.fromBER.call(this,e,t,n),-1===a)return a;for(let o=0;o<this.value.length;o++){const u=this.value[o].constructor.NAME;if(u===ba){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(u!==cf)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=super.fromBER(e,t,n),this.blockLength=n;return a}toBER(e,t){return this.isConstructed?Nr.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}return s.NAME="OctetStringValueBlock",s})();class de extends Jt{constructor({idBlock:i={},lenBlock:e={},...t}={}){var n,a;null!==(n=t.isConstructed)&&void 0!==n||(t.isConstructed=!!(null===(a=t.value)||void 0===a?void 0:a.length)),super({idBlock:{isConstructed:t.isConstructed,...i},lenBlock:{...e,isIndefiniteForm:!!t.isIndefiniteForm},...t},eg),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(i,e,t){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===t)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),e;if(!this.valueBlock.isConstructed){const a=(i instanceof ArrayBuffer?new Uint8Array(i):i).subarray(e,e+t);try{if(a.byteLength){const o=Zn(a,0,a.byteLength);-1!==o.offset&&o.offset===t&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(i,e,t)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?$.prototype.onAsciiEncoding.call(this):`${this.constructor.NAME} : ${ye.ep.ToHex(this.valueBlock.valueHexView)}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const i=[];for(const e of this.valueBlock.value)e instanceof de&&i.push(e.valueBlock.valueHexView);return ye.vJ.concat(i)}}Be.OctetString=de,de.NAME=cf;let tg=(()=>{class s extends(gs(Nr)){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let a=-1;if(this.isConstructed){if(a=Nr.prototype.fromBER.call(this,e,t,n),-1===a)return a;for(const l of this.value){const m=l.constructor.NAME;if(m===ba){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(m!==hf)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const k=l.valueBlock;if(this.unusedBits>0&&k.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=k.unusedBits}return a}const o=ye.vJ.toUint8Array(e);if(!ms(this,o,t,n))return-1;const u=o.subarray(t,t+n);if(this.unusedBits=u[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const l=u.subarray(1);try{if(l.byteLength){const m=Zn(l,0,l.byteLength);-1!==m.offset&&m.offset===n-1&&(this.value=[m.result])}}catch{}}return this.valueHexView=u.subarray(1),this.blockLength=u.length,t+n}toBER(e,t){if(this.isConstructed)return Nr.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return ss;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}return s.NAME="BitStringValueBlock",s})();var bf;class et extends Jt{constructor({idBlock:i={},lenBlock:e={},...t}={}){var n,a;null!==(n=t.isConstructed)&&void 0!==n||(t.isConstructed=!!(null===(a=t.value)||void 0===a?void 0:a.length)),super({idBlock:{isConstructed:t.isConstructed,...i},lenBlock:{...e,isIndefiniteForm:!!t.isIndefiniteForm},...t},tg),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(i,e,t){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(i,e,t)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return $.prototype.onAsciiEncoding.call(this);{const i=[],e=this.valueBlock.valueHexView;for(const n of e)i.push(n.toString(2).padStart(8,"0"));const t=i.join("");return`${this.constructor.NAME} : ${t.substring(0,t.length-this.valueBlock.unusedBits)}`}}}function sg(s,i){const e=new Uint8Array([0]),t=new Uint8Array(s),n=new Uint8Array(i);let a=t.slice(0);const o=a.length-1,u=n.slice(0),l=u.length-1;let m=0,B=0;for(let F=l<o?o:l;F>=0;F--,B++)m=1==B<u.length?a[o-B]+u[l-B]+e[0]:a[o-B]+e[0],e[0]=m/10,1==B>=a.length?a=fc(new Uint8Array([m%10]),a):a[o-B]=m%10;return e[0]>0&&(a=fc(e,a)),a}function _f(s){if(s>=Sa.length)for(let i=Sa.length;i<=s;i++){const e=new Uint8Array([0]);let t=Sa[i-1].slice(0);for(let n=t.length-1;n>=0;n--){const a=new Uint8Array([(t[n]<<1)+e[0]]);e[0]=a[0]/10,t[n]=a[0]%10}e[0]>0&&(t=fc(e,t)),Sa.push(t)}return Sa[s]}function rg(s,i){let e=0;const t=new Uint8Array(s),n=new Uint8Array(i),a=t.slice(0),o=a.length-1,u=n.slice(0),l=u.length-1;let m,k=0;for(let B=l;B>=0;B--,k++)m=a[o-k]-u[l-k]-e,1==m<0?(e=1,a[o-k]=m+10):(e=0,a[o-k]=m);if(e>0)for(let B=o-l+1;B>=0;B--,k++){if(m=a[o-k]-e,!(m<0)){e=0,a[o-k]=m;break}e=1,a[o-k]=m+10}return a.slice()}Be.BitString=et,et.NAME=hf;class vc extends(gs(qt)){constructor({value:i,...e}={}){super(e),this._valueDec=0,e.valueHex&&this.setValueHex(),void 0!==i&&(this.valueDec=i)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=nf.call(this)))}set valueDec(i){this._valueDec=i,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function Pm(s){const i=s<0?-1*s:s;let e=128;for(let t=1;t<8;t++){if(i<=e){if(s<0){const u=ds(e-i,8,t);return new Uint8Array(u)[0]|=128,u}let n=ds(i,8,t),a=new Uint8Array(n);if(128&a[0]){const o=n.slice(0),u=new Uint8Array(o);n=new ArrayBuffer(n.byteLength+1),a=new Uint8Array(n);for(let l=0;l<o.byteLength;l++)a[l+1]=u[l];a[0]=0}return n}e*=Math.pow(2,8)}return new ArrayBuffer(0)}(i))}get valueDec(){return this._valueDec}fromDER(i,e,t,n=0){const a=this.fromBER(i,e,t);if(-1===a)return a;const o=this.valueHexView;return 0===o[0]&&0!=(128&o[1])?this.valueHexView=o.subarray(1):0!==n&&o.length<n&&(n-o.length>1&&(n=o.length+1),this.valueHexView=o.subarray(n-o.length)),a}toDER(i=!1){const e=this.valueHexView;switch(!0){case 0!=(128&e[0]):{const t=new Uint8Array(this.valueHexView.length+1);t[0]=0,t.set(e,1),this.valueHexView=t}break;case 0===e[0]&&0==(128&e[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(i)}fromBER(i,e,t){const n=super.fromBER(i,e,t);return-1===n||this.setValueHex(),n}toBER(i){return i?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const i=8*this.valueHexView.length-1;let n,e=new Uint8Array(8*this.valueHexView.length/3),t=0;const a=this.valueHexView;let o="",u=!1;for(let l=a.byteLength-1;l>=0;l--){n=a[l];for(let m=0;m<8;m++)1==(1&n)&&(t===i?(e=rg(_f(t),e),o="-"):e=sg(e,_f(t))),t++,n>>=1}for(let l=0;l<e.length;l++)e[l]&&(u=!0),u&&(o+=lf.charAt(e[l]));return!1===u&&(o+=lf.charAt(0)),o}}bf=vc,vc.NAME="IntegerValueBlock",Object.defineProperty(bf.prototype,"valueHex",{set:function(s){this.valueHexView=new Uint8Array(s),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class z extends Jt{constructor(i={}){super(i,vc),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return ql(),BigInt(this.valueBlock.toString())}static fromBigInt(i){ql();const e=BigInt(i),t=new gc,n=e.toString(16).replace(/^-/,""),a=new Uint8Array(ye.ep.FromHex(n));if(e<0){const u=new Uint8Array(a.length+(128&a[0]?1:0));u[0]|=128;const m=BigInt(`0x${ye.ep.ToHex(u)}`)+e,k=ye.vJ.toUint8Array(ye.ep.FromHex(m.toString(16)));k[0]|=128,t.write(k)}else 128&a[0]&&t.write(new Uint8Array([0])),t.write(a);return new z({valueHex:t.final()})}convertToDER(){const i=new z({valueHex:this.valueBlock.valueHexView});return i.valueBlock.toDER(),i}convertFromDER(){return new z({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}Be.Integer=z,z.NAME="INTEGER";class _a extends z{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Be.Enumerated=_a,_a.NAME="ENUMERATED";let Ef=(()=>{class s extends(gs(qt)){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const a=ye.vJ.toUint8Array(e);if(!ms(this,a,t,n))return-1;const o=a.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let l=0;l<n&&(this.valueHexView[l]=127&o[l],this.blockLength++,0!=(128&o[l]));l++);const u=new Uint8Array(this.blockLength);for(let l=0;l<this.blockLength;l++)u[l]=this.valueHexView[l];return this.valueHexView=u,0!=(128&o[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Er(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){ql();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let a=0;a<n.length;a++)n[a]=parseInt(t.slice(7*a,7*a+7),2)+(a+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,o=new Uint8Array(this.blockLength);for(let u=0;u<this.blockLength-1;u++)o[u]=128|a[u];return o[this.blockLength-1]=a[this.blockLength-1],o.buffer}const t=ds(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",ss;const n=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),o=t.byteLength-1;for(let u=0;u<o;u++)n[u]=128|a[u];n[o]=a[o]}return n}toString(){let e="";if(this.isHexOnly)e=ye.ep.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}return s.NAME="sidBlock",s})(),ng=(()=>{class s extends qt{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let a=t;for(;n>0;){const o=new Ef;if(a=o.fromBER(e,a,n),-1===a)return this.blockLength=0,this.error=o.error,a;0===this.value.length&&(o.isFirstSid=!0),this.blockLength+=o.blockLength,n-=o.blockLength,this.value.push(o)}return a}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const a=this.value[n].toBER(e);if(0===a.byteLength)return this.error=this.value[n].error,ss;t.push(a)}return mc(t)}fromString(e){this.value=[];let t=0,n=0,a="",o=!1;do{if(n=e.indexOf(".",t),a=-1===n?e.substring(t):e.substring(t,n),t=n+1,o){const u=this.value[0];let l=0;switch(u.valueDec){case 0:break;case 1:l=40;break;case 2:l=80;break;default:return void(this.value=[])}const m=parseInt(a,10);if(isNaN(m))return;u.valueDec=m+l,o=!1}else{const u=new Ef;if(a>Number.MAX_SAFE_INTEGER){ql();const l=BigInt(a);u.valueBigInt=l}else if(u.valueDec=parseInt(a,10),isNaN(u.valueDec))return;this.value.length||(u.isFirstSid=!0,o=!0),this.value.push(u)}}while(-1!==n)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let a=this.value[n].toString();0!==n&&(e=`${e}.`),t?(a=`{${a}}`,this.value[n].isFirstSid?e=`2.{${a} - 80}`:e+=a):e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}return s.NAME="ObjectIdentifierValueBlock",s})();class Oe extends Jt{constructor(i={}){super(i,ng),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(i){this.valueBlock.fromString(i)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Be.ObjectIdentifier=Oe,Oe.NAME="OBJECT IDENTIFIER";let Nf=(()=>{class s extends(gs(qn)){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(0===n)return t;const a=ye.vJ.toUint8Array(e);if(!ms(this,a,t,n))return-1;const o=a.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let l=0;l<n&&(this.valueHexView[l]=127&o[l],this.blockLength++,0!=(128&o[l]));l++);const u=new Uint8Array(this.blockLength);for(let l=0;l<this.blockLength;l++)u[l]=this.valueHexView[l];return this.valueHexView=u,0!=(128&o[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Er(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const a=this.valueHexView,o=new Uint8Array(this.blockLength);for(let u=0;u<this.blockLength-1;u++)o[u]=128|a[u];return o[this.blockLength-1]=a[this.blockLength-1],o.buffer}const t=ds(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",ss;const n=new Uint8Array(t.byteLength);if(!e){const a=new Uint8Array(t),o=t.byteLength-1;for(let u=0;u<o;u++)n[u]=128|a[u];n[o]=a[o]}return n.buffer}toString(){let e="";return e=this.isHexOnly?ye.ep.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}return s.NAME="relativeSidBlock",s})(),ig=(()=>{class s extends qt{constructor({value:e="",...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let a=t;for(;n>0;){const o=new Nf;if(a=o.fromBER(e,a,n),-1===a)return this.blockLength=0,this.error=o.error,a;this.blockLength+=o.blockLength,n-=o.blockLength,this.value.push(o)}return a}toBER(e,t){const n=[];for(let a=0;a<this.value.length;a++){const o=this.value[a].toBER(e);if(0===o.byteLength)return this.error=this.value[a].error,ss;n.push(o)}return mc(n)}fromString(e){this.value=[];let t=0,n=0,a="";do{n=e.indexOf(".",t),a=-1===n?e.substring(t):e.substring(t,n),t=n+1;const o=new Nf;if(o.valueDec=parseInt(a,10),isNaN(o.valueDec))return!0;this.value.push(o)}while(-1!==n);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let a=this.value[n].toString();0!==n&&(e=`${e}.`),t&&(a=`{${a}}`),e+=a}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}return s.NAME="RelativeObjectIdentifierValueBlock",s})();class Tf extends Jt{constructor(i={}){super(i,ig),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(i){this.valueBlock.fromString(i)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Be.RelativeObjectIdentifier=Tf,Tf.NAME="RelativeObjectIdentifier";class R extends ${constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}Be.Sequence=R,R.NAME="SEQUENCE";class At extends ${constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}Be.Set=At,At.NAME="SET";let ag=(()=>{class s extends(gs(qt)){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=""}toJSON(){return{...super.toJSON(),value:this.value}}}return s.NAME="StringValueBlock",s})(),og=(()=>{class s extends ag{}return s.NAME="SimpleStringValueBlock",s})(),Qt=(()=>{class s extends zm{constructor({...e}={}){super(e,og)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,ye.vJ.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let a=0;a<t;a++)n[a]=e.charCodeAt(a);this.valueBlock.value=e}}return s.NAME="SIMPLE STRING",s})(),lg=(()=>{class s extends Qt{fromBuffer(e){this.valueBlock.valueHexView=ye.vJ.toUint8Array(e);try{this.valueBlock.value=ye.ep.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=ye.ep.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(ye.ep.FromUtf8String(e)),this.valueBlock.value=e}}return s.NAME="Utf8StringValueBlock",s})();class cs extends lg{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Be.Utf8String=cs,cs.NAME="UTF8String";let ug=(()=>{class s extends Qt{fromBuffer(e){this.valueBlock.value=ye.ep.ToUtf16String(e),this.valueBlock.valueHexView=ye.vJ.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(ye.ep.FromUtf16String(e))}}return s.NAME="BmpStringValueBlock",s})();class rs extends ug{constructor({...i}={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}Be.BmpString=rs,rs.NAME="BMPString";let cg=(()=>{class s extends Qt{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let a=0;a<n.length;a+=4)n[a]=n[a+3],n[a+1]=n[a+2],n[a+2]=0,n[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let a=0;a<t;a++){const o=ds(e.charCodeAt(a),8),u=new Uint8Array(o);if(u.length>4)continue;const l=4-u.length;for(let m=u.length-1;m>=0;m--)n[4*a+m+l]=u[m]}this.valueBlock.value=e}}return s.NAME="UniversalStringValueBlock",s})();class Aa extends cg{constructor({...i}={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}Be.UniversalString=Aa,Aa.NAME="UniversalString";class zn extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}Be.NumericString=zn,zn.NAME="NumericString";class Xt extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}Be.PrintableString=Xt,Xt.NAME="PrintableString";class ka extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}Be.TeletexString=ka,ka.NAME="TeletexString";class yc extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Be.VideotexString=yc,yc.NAME="VideotexString";class zl extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Be.IA5String=zl,zl.NAME="IA5String";class wc extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}Be.GraphicString=wc,wc.NAME="GraphicString";class Gl extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Be.VisibleString=Gl,Gl.NAME="VisibleString";class Sc extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Be.GeneralString=Sc,Sc.NAME="GeneralString";class bc extends Qt{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}Be.CharacterString=bc,bc.NAME="CharacterString";class Gn extends Gl{constructor({value:i,valueDate:e,...t}={}){if(super(t),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,i){this.fromString(i),this.valueBlock.valueHexView=new Uint8Array(i.length);for(let n=0;n<i.length;n++)this.valueBlock.valueHexView[n]=i.charCodeAt(n)}e&&(this.fromDate(e),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(i){this.fromString(String.fromCharCode.apply(null,ye.vJ.toUint8Array(i)))}toBuffer(){const i=this.toString(),e=new ArrayBuffer(i.length),t=new Uint8Array(e);for(let n=0;n<i.length;n++)t[n]=i.charCodeAt(n);return e}fromDate(i){this.year=i.getUTCFullYear(),this.month=i.getUTCMonth()+1,this.day=i.getUTCDate(),this.hour=i.getUTCHours(),this.minute=i.getUTCMinutes(),this.second=i.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(i){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(i);if(null===t)return void(this.error="Wrong input string for conversion");const n=parseInt(t[1],10);this.year=n>=50?1900+n:2e3+n,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(i="iso"){if("iso"===i){const e=new Array(7);return e[0]=$t(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=$t(this.month,2),e[2]=$t(this.day,2),e[3]=$t(this.hour,2),e[4]=$t(this.minute,2),e[5]=$t(this.second,2),e[6]="Z",e.join("")}return super.toString(i)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Be.UTCTime=Gn,Gn.NAME="UTCTime";class ht extends Gn{constructor(i={}){var e;super(i),null!==(e=this.millisecond)&&void 0!==e||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(i){super.fromDate(i),this.millisecond=i.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(i){let o,e=!1,t="",n="",a=0,u=0,l=0;if("Z"===i[i.length-1])t=i.substring(0,i.length-1),e=!0;else{const B=new Number(i[i.length-1]);if(isNaN(B.valueOf()))throw new Error("Wrong input string for conversion");t=i}if(e){if(-1!==t.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==t.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let B=1,F=t.indexOf("+"),V="";if(-1===F&&(F=t.indexOf("-"),B=-1),-1!==F){if(V=t.substring(F+1),t=t.substring(0,F),2!==V.length&&4!==V.length)throw new Error("Wrong input string for conversion");let le=parseInt(V.substring(0,2),10);if(isNaN(le.valueOf()))throw new Error("Wrong input string for conversion");if(u=B*le,4===V.length){if(le=parseInt(V.substring(2,4),10),isNaN(le.valueOf()))throw new Error("Wrong input string for conversion");l=B*le}}}let m=t.indexOf(".");if(-1===m&&(m=t.indexOf(",")),-1!==m){const B=new Number(`0${t.substring(m)}`);if(isNaN(B.valueOf()))throw new Error("Wrong input string for conversion");a=B.valueOf(),n=t.substring(0,m)}else n=t;switch(!0){case 8===n.length:if(o=/(\d{4})(\d{2})(\d{2})/gi,-1!==m)throw new Error("Wrong input string for conversion");break;case 10===n.length:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==m){let B=60*a;this.minute=Math.floor(B),B=60*(B-this.minute),this.second=Math.floor(B),B=1e3*(B-this.second),this.millisecond=Math.floor(B)}break;case 12===n.length:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m){let B=60*a;this.second=Math.floor(B),B=1e3*(B-this.second),this.millisecond=Math.floor(B)}break;case 14===n.length:o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==m&&(this.millisecond=Math.floor(1e3*a));break;default:throw new Error("Wrong input string for conversion")}const k=o.exec(n);if(null===k)throw new Error("Wrong input string for conversion");for(let B=1;B<k.length;B++)switch(B){case 1:this.year=parseInt(k[B],10);break;case 2:this.month=parseInt(k[B],10);break;case 3:this.day=parseInt(k[B],10);break;case 4:this.hour=parseInt(k[B],10)+u;break;case 5:this.minute=parseInt(k[B],10)+l;break;case 6:this.second=parseInt(k[B],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===e){const B=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=B.getUTCFullYear(),this.month=B.getUTCMonth(),this.day=B.getUTCDay(),this.hour=B.getUTCHours(),this.minute=B.getUTCMinutes(),this.second=B.getUTCSeconds(),this.millisecond=B.getUTCMilliseconds()}}toString(i="iso"){if("iso"===i){const e=[];return e.push($t(this.year,4)),e.push($t(this.month,2)),e.push($t(this.day,2)),e.push($t(this.hour,2)),e.push($t(this.minute,2)),e.push($t(this.second,2)),0!==this.millisecond&&(e.push("."),e.push($t(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(i)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Be.GeneralizedTime=ht,ht.NAME="GeneralizedTime";class Zf extends cs{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Be.DATE=Zf,Zf.NAME="DATE";class Gf extends cs{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}Be.TimeOfDay=Gf,Gf.NAME="TimeOfDay";class Yf extends cs{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}Be.DateTime=Yf,Yf.NAME="DateTime";class Xf extends cs{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Be.Duration=Xf,Xf.NAME="Duration";class td extends cs{constructor(i={}){super(i),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Be.TIME=td,td.NAME="TIME";class He{constructor({name:i="",optional:e=!1}={}){this.name=i,this.optional=e}}class ft extends He{constructor({value:i=[],...e}={}){super(e),this.value=i}}class ze extends He{constructor({value:i=new He,local:e=!1,...t}={}){super(t),this.value=i,this.local=e}}class Wl{constructor({data:i=Zl}={}){this.dataView=ye.vJ.toUint8Array(i)}get data(){return this.dataView.slice().buffer}set data(i){this.dataView=ye.vJ.toUint8Array(i)}fromBER(i,e,t){const n=e+t;return this.dataView=ye.vJ.toUint8Array(i).subarray(e,n),n}toBER(i){return this.dataView.slice().buffer}}function ce(s,i,e){if(e instanceof ft){for(let a=0;a<e.value.length;a++)if(ce(s,i,e.value[a]).verified)return{verified:!0,result:s};{const a={verified:!1,result:{error:"Wrong values for Choice type"}};return e.hasOwnProperty(pc)&&(a.name=e.name),a}}if(e instanceof He)return e.hasOwnProperty(pc)&&(s[e.name]=i),{verified:!0,result:s};if(!(s instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(i instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!("idBlock"in e))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!("fromBER"in e.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!("toBER"in e.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const t=e.idBlock.toBER(!1);if(0===t.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===e.idBlock.fromBER(t,0,t.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===e.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(e.idBlock.tagClass!==i.idBlock.tagClass)return{verified:!1,result:s};if(!1===e.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(e.idBlock.tagNumber!==i.idBlock.tagNumber)return{verified:!1,result:s};if(!1===e.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(e.idBlock.isConstructed!==i.idBlock.isConstructed)return{verified:!1,result:s};if(!("isHexOnly"in e.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(e.idBlock.isHexOnly!==i.idBlock.isHexOnly)return{verified:!1,result:s};if(e.idBlock.isHexOnly){if(!(uf in e.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const a=e.idBlock.valueHexView,o=i.idBlock.valueHexView;if(a.length!==o.length)return{verified:!1,result:s};for(let u=0;u<a.length;u++)if(a[u]!==o[1])return{verified:!1,result:s}}if(e.name&&(e.name=e.name.replace(/^\s+|\s+$/g,""),e.name&&(s[e.name]=i)),e instanceof Be.Constructed){let a=0,o={verified:!1,result:{error:"Unknown error"}},u=e.valueBlock.value.length;if(u>0&&e.valueBlock.value[0]instanceof ze&&(u=i.valueBlock.value.length),0===u)return{verified:!0,result:s};if(0===i.valueBlock.value.length&&0!==e.valueBlock.value.length){let l=!0;for(let m=0;m<e.valueBlock.value.length;m++)l=l&&(e.valueBlock.value[m].optional||!1);return l?{verified:!0,result:s}:(e.name&&(e.name=e.name.replace(/^\s+|\s+$/g,""),e.name&&delete s[e.name]),s.error="Inconsistent object length",{verified:!1,result:s})}for(let l=0;l<u;l++)if(l-a>=i.valueBlock.value.length){if(!1===e.valueBlock.value[l].optional){const m={verified:!1,result:s};return s.error="Inconsistent length between ASN.1 data and schema",e.name&&(e.name=e.name.replace(/^\s+|\s+$/g,""),e.name&&(delete s[e.name],m.name=e.name)),m}}else if(e.valueBlock.value[0]instanceof ze){if(o=ce(s,i.valueBlock.value[l],e.valueBlock.value[0].value),!1===o.verified){if(!e.valueBlock.value[0].optional)return e.name&&(e.name=e.name.replace(/^\s+|\s+$/g,""),e.name&&delete s[e.name]),o;a++}if(pc in e.valueBlock.value[0]&&e.valueBlock.value[0].name.length>0){let m={};m="local"in e.valueBlock.value[0]&&e.valueBlock.value[0].local?i:s,void 0===m[e.valueBlock.value[0].name]&&(m[e.valueBlock.value[0].name]=[]),m[e.valueBlock.value[0].name].push(i.valueBlock.value[l])}}else if(o=ce(s,i.valueBlock.value[l-a],e.valueBlock.value[l]),!1===o.verified){if(!e.valueBlock.value[l].optional)return e.name&&(e.name=e.name.replace(/^\s+|\s+$/g,""),e.name&&delete s[e.name]),o;a++}if(!1===o.verified){const l={verified:!1,result:s};return e.name&&(e.name=e.name.replace(/^\s+|\s+$/g,""),e.name&&(delete s[e.name],l.name=e.name)),l}return{verified:!0,result:s}}if(e.primitiveSchema&&uf in i.valueBlock){const a=Zn(i.valueBlock.valueHexView);if(-1===a.offset){const o={verified:!1,result:a.result};return e.name&&(e.name=e.name.replace(/^\s+|\s+$/g,""),e.name&&(delete s[e.name],o.name=e.name)),o}return ce(s,a.result,e.primitiveSchema)}return{verified:!0,result:s}}class vt{constructor(i={}){if("view"in i)this.fromUint8Array(i.view);else if("buffer"in i)this.fromArrayBuffer(i.buffer);else if("string"in i)this.fromString(i.string);else if("hexstring"in i)this.fromHexString(i.hexstring);else if("length"in i&&i.length>0){if(this.length=i.length,i.stub)for(let e=0;e<this._view.length;e++)this._view[e]=i.stub}else this.length=0}set buffer(i){this._buffer=i,this._view=new Uint8Array(this._buffer)}get buffer(){return this._buffer}set view(i){this._buffer=new ArrayBuffer(i.length),this._view=new Uint8Array(this._buffer),this._view.set(i)}get view(){return this._view}get length(){return this.view.byteLength}set length(i){this._buffer=new ArrayBuffer(i),this._view=new Uint8Array(this._buffer)}clear(){this._buffer=new ArrayBuffer(0),this._view=new Uint8Array(this._buffer)}fromArrayBuffer(i){this._buffer=i,this._view=new Uint8Array(this._buffer)}fromUint8Array(i){this.fromArrayBuffer(new Uint8Array(i).buffer)}fromString(i){const e=i.length;this.length=e;for(let t=0;t<e;t++)this.view[t]=i.charCodeAt(t)}toString(i=0,e=this.view.length-i){let t="";(i>=this.view.length||i<0)&&(i=0),(e>=this.view.length||e<0)&&(e=this.view.length-i);for(let n=i;n<i+e;n++)t+=String.fromCharCode(this.view[n]);return t}fromHexString(i){const e=i.length;this.buffer=new ArrayBuffer(e>>1),this.view=new Uint8Array(this.buffer);const t=new Map;t.set("0",0),t.set("1",1),t.set("2",2),t.set("3",3),t.set("4",4),t.set("5",5),t.set("6",6),t.set("7",7),t.set("8",8),t.set("9",9),t.set("A",10),t.set("a",10),t.set("B",11),t.set("b",11),t.set("C",12),t.set("c",12),t.set("D",13),t.set("d",13),t.set("E",14),t.set("e",14),t.set("F",15),t.set("f",15);let n=0,a=0;for(let o=0;o<e;o++)o%2?(a|=t.get(i.charAt(o)),this.view[n]=a,n++):a=t.get(i.charAt(o))<<4}toHexString(i=0,e=this.view.length-i){let t="";(i>=this.view.length||i<0)&&(i=0),(e>=this.view.length||e<0)&&(e=this.view.length-i);for(let n=i;n<i+e;n++){const a=this.view[n].toString(16).toUpperCase();t=t+(1==a.length?"0":"")+a}return t}copy(i=0,e=this.length-i){if(!i&&!this.length)return new vt;if(i<0||i>this.length-1)throw new Error(`Wrong start position: ${i}`);return new vt({buffer:this._buffer.slice(i,i+e)})}slice(i=0,e=this.length){if(!i&&!this.length)return new vt;if(i<0||i>this.length-1)throw new Error(`Wrong start position: ${i}`);return new vt({buffer:this._buffer.slice(i,e)})}realloc(i){const e=new ArrayBuffer(i);new Uint8Array(e).set(i>this._view.length?this._view:new Uint8Array(this._buffer,0,i)),this._buffer=e,this._view=new Uint8Array(this._buffer)}append(i){const e=this.length,t=i.length,n=i._view.subarray();this.realloc(e+t),this._view.set(n,e)}insert(i,e=0,t=this.length-e){return!(e>this.length-1||(t>this.length-e&&(t=this.length-e),t>i.length&&(t=i.length),this._view.set(t==i.length?i._view:i._view.subarray(0,t),e),0))}isEqual(i){if(this.length!=i.length)return!1;for(let e=0;e<i.length;e++)if(this.view[e]!=i.view[e])return!1;return!0}isEqualView(i){if(i.length!=this.view.length)return!1;for(let e=0;e<i.length;e++)if(this.view[e]!=i[e])return!1;return!0}findPattern(i,e,t,n){const{start:a,length:o,backward:u}=this.prepareFindParameters(e,t,n),l=i.length;if(l>o)return-1;const m=[];for(let k=0;k<l;k++)m.push(i.view[k]);for(let k=0;k<=o-l;k++){let B=!0;const F=u?a-l-k:a+k;for(let V=0;V<l;V++)if(this.view[V+F]!=m[V]){B=!1;break}if(B)return u?a-l-k:a+l+k}return-1}findFirstIn(i,e,t,n){const{start:a,length:o,backward:u}=this.prepareFindParameters(e,t,n),l={id:-1,position:u?0:a+o,length:0};for(let m=0;m<i.length;m++){const k=this.findPattern(i[m],a,o,u);if(-1!=k){let B=!1;const F=i[m].length;u?k-F>=l.position-l.length&&(B=!0):k-F<=l.position-l.length&&(B=!0),B&&(l.position=k,l.id=m,l.length=F)}}return l}findAllIn(i,e,t){let{start:n,length:a}=this.prepareFindParameters(e,t);const o=[];let u={id:-1,position:n};for(;;){const l=u.position;if(u=this.findFirstIn(i,u.position,a),-1==u.id)break;a-=u.position-l,o.push({id:u.id,position:u.position})}return o}findAllPatternIn(i,e,t){const{start:n,length:a}=this.prepareFindParameters(e,t),o=[],u=i.length;if(u>a)return-1;const l=Array.from(i.view);for(let m=0;m<=a-u;m++){let k=!0;const B=n+m;for(let F=0;F<u;F++)if(this.view[F+B]!=l[F]){k=!1;break}k&&(o.push(n+u+m),m+=u-1)}return o}findFirstNotIn(i,e,t,n){let{start:a,length:o,backward:u}=this.prepareFindParameters(e,t,n);const l={left:{id:-1,position:a},right:{id:-1,position:0},value:new vt};let m=o;for(;m>0;){if(l.right=this.findFirstIn(i,u?a-o+m:a+o-m,m,u),-1==l.right.id){o=m,u?a-=o:a=l.left.position,l.value=new vt({buffer:this._buffer.slice(a,a+o)});break}if(l.right.position!=(u?l.left.position-i[l.right.id].length:l.left.position+i[l.right.id].length)){u?(a=l.right.position+i[l.right.id].length,o=l.left.position-l.right.position-i[l.right.id].length):(a=l.left.position,o=l.right.position-l.left.position-i[l.right.id].length),l.value=new vt({buffer:this._buffer.slice(a,a+o)});break}l.left=l.right,m-=i[l.right.id].length}if(u){const k=l.right;l.right=l.left,l.left=k}return l}findAllNotIn(i,e,t){let{start:n,length:a}=this.prepareFindParameters(e,t);const o=[];let u={left:{id:-1,position:n},right:{id:-1,position:n},value:new vt};do{const l=u.right.position;u=this.findFirstNotIn(i,u.right.position,a),a-=u.right.position-l,o.push({left:{id:u.left.id,position:u.left.position},right:{id:u.right.id,position:u.right.position},value:u.value})}while(-1!=u.right.id);return o}findFirstSequence(i,e,t,n){let{start:a,length:o,backward:u}=this.prepareFindParameters(e,t,n);const l=this.skipNotPatterns(i,a,o,u);if(-1==l)return{position:-1,value:new vt};const m=this.skipPatterns(i,l,o-(u?a-l:l-a),u);return u?(a=m,o=l-m):(a=l,o=m-l),{position:m,value:new vt({buffer:this._buffer.slice(a,a+o)})}}findAllSequences(i,e,t){let{start:n,length:a}=this.prepareFindParameters(e,t);const o=[];let u={position:n,value:new vt};do{const l=u.position;u=this.findFirstSequence(i,u.position,a),-1!=u.position&&(a-=u.position-l,o.push({position:u.position,value:u.value}))}while(-1!=u.position);return o}findPairedPatterns(i,e,t,n){const a=[];if(i.isEqual(e))return a;const{start:o,length:u}=this.prepareFindParameters(t,n);let l=0;const m=this.findAllPatternIn(i,o,u);if(!Array.isArray(m)||0==m.length)return a;const k=this.findAllPatternIn(e,o,u);if(!Array.isArray(k)||0==k.length)return a;for(;l<m.length&&0!=k.length;)if(m[0]!=k[0]){if(m[l]>k[0])break;for(;m[l]<k[0]&&(l++,!(l>=m.length)););a.push({left:m[l-1],right:k[0]}),m.splice(l-1,1),k.splice(0,1),l=0}else a.push({left:m[0],right:k[0]}),m.splice(0,1),k.splice(0,1);return a.sort((B,F)=>B.left-F.left),a}findPairedArrays(i,e,t,n){const{start:a,length:o}=this.prepareFindParameters(t,n),u=[];let l=0;const m=this.findAllIn(i,a,o);if(0==m.length)return u;const k=this.findAllIn(e,a,o);if(0==k.length)return u;for(;l<m.length&&0!=k.length;)if(m[0].position!=k[0].position){if(m[l].position>k[0].position)break;for(;m[l].position<k[0].position&&(l++,!(l>=m.length)););u.push({left:m[l-1],right:k[0]}),m.splice(l-1,1),k.splice(0,1),l=0}else u.push({left:m[0],right:k[0]}),m.splice(0,1),k.splice(0,1);return u.sort((B,F)=>B.left.position-F.left.position),u}replacePattern(i,e,t,n,a=null){let u,o=[];const l={status:-1,searchPatternPositions:[],replacePatternPositions:[]},{start:m,length:k}=this.prepareFindParameters(t,n);if(null==a){if(o=this.findAllIn([i],m,k),0==o.length)return l}else o=a;l.searchPatternPositions.push(...Array.from(o,le=>le.position));const B=i.length-e.length,F=new ArrayBuffer(this.view.length-o.length*B),V=new Uint8Array(F);for(V.set(new Uint8Array(this.buffer,0,m)),u=0;u<o.length;u++){const le=0==u?m:o[u-1].position;V.set(new Uint8Array(this.buffer,le,o[u].position-i.length-le),le-u*B),V.set(e.view,o[u].position-i.length-u*B),l.replacePatternPositions.push(o[u].position-i.length-u*B)}return u--,V.set(new Uint8Array(this.buffer,o[u].position,this.length-o[u].position),o[u].position-i.length+e.length-u*B),this.buffer=F,this.view=new Uint8Array(this.buffer),l.status=1,l}skipPatterns(i,e,t,n){const{start:a,length:o,backward:u}=this.prepareFindParameters(e,t,n);let l=a;for(let m=0;m<i.length;m++){const k=i[m].length,B=u?l-k:l;let F=!0;for(let V=0;V<k;V++)if(this.view[V+B]!=i[m].view[V]){F=!1;break}if(F)if(m=-1,u){if(l-=k,l<=0)return l}else if(l+=k,l>=a+o)return l}return l}skipNotPatterns(i,e,t,n){const{start:a,length:o,backward:u}=this.prepareFindParameters(e,t,n);let l=-1;for(let m=0;m<o;m++){for(let k=0;k<i.length;k++){const B=i[k].length,F=u?a-m-B:a+m;let V=!0;for(let le=0;le<B;le++)if(this.view[le+F]!=i[k].view[le]){V=!1;break}if(V){l=u?a-m:a+m;break}}if(-1!=l)break}return l}prepareFindParameters(i=null,e=null,t=!1){return null===i&&(i=t?this.length:0),i>this.length&&(i=this.length),t?(null===e&&(e=i),e>i&&(e=i)):(null===e&&(e=this.length-i),e>this.length-i&&(e=this.length-i)),{start:i,length:e,backward:t}}}let Ea=(()=>{class s{constructor(e={}){this._stream=new vt,this._length=0,this._start=0,this.backward=!1,this.appendBlock=0,this.prevLength=0,this.prevStart=0,this.stream="view"in e?new vt({view:e.view}):"buffer"in e?new vt({buffer:e.buffer}):"string"in e?new vt({string:e.string}):"hexstring"in e?new vt({hexstring:e.hexstring}):"stream"in e?e.stream.slice():new vt,"backward"in e&&e.backward&&(this.backward=e.backward,this._start=this.stream.length),"length"in e&&e.length>0&&(this._length=e.length),"start"in e&&e.start&&e.start>0&&(this._start=e.start),"appendBlock"in e&&e.appendBlock&&e.appendBlock>0&&(this.appendBlock=e.appendBlock)}set stream(e){this._stream=e,this.prevLength=this._length,this._length=e.length,this.prevStart=this._start,this._start=0}get stream(){return this._stream}set length(e){this.prevLength=this._length,this._length=e}get length(){return this.appendBlock?this.start:this._length}set start(e){e>this.stream.length||(this.prevStart=this._start,this.prevLength=this._length,this._length-=this.backward?this._start-e:e-this._start,this._start=e)}get start(){return this._start}get buffer(){return this._stream.buffer.slice(0,this._length)}resetPosition(){this._start=this.prevStart,this._length=this.prevLength}findPattern(e,t=null){(null==t||t>this.length)&&(t=this.length);const n=this.stream.findPattern(e,this.start,this.length,this.backward);if(-1==n)return n;if(this.backward){if(n<this.start-e.length-t)return-1}else if(n>this.start+e.length+t)return-1;return this.start=n,n}findFirstIn(e,t=null){(null==t||t>this.length)&&(t=this.length);const n=this.stream.findFirstIn(e,this.start,this.length,this.backward);if(-1==n.id)return n;if(this.backward){if(n.position<this.start-e[n.id].length-t)return{id:-1,position:this.backward?0:this.start+this.length}}else if(n.position>this.start+e[n.id].length+t)return{id:-1,position:this.backward?0:this.start+this.length};return this.start=n.position,n}findAllIn(e){return this.stream.findAllIn(e,this.backward?this.start-this.length:this.start,this.length)}findFirstNotIn(e,t=null){(null==t||t>this._length)&&(t=this._length);const n=this._stream.findFirstNotIn(e,this._start,this._length,this.backward);if(-1==n.left.id&&-1==n.right.id)return n;if(this.backward){if(-1!=n.right.id&&n.right.position<this._start-e[n.right.id].length-t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new vt}}else if(-1!=n.left.id&&n.left.position>this._start+e[n.left.id].length+t)return{left:{id:-1,position:this._start},right:{id:-1,position:0},value:new vt};return this.start=this.backward?-1==n.left.id?0:n.left.position:-1==n.right.id?this._start+this._length:n.right.position,n}findAllNotIn(e){return this._stream.findAllNotIn(e,this.backward?this._start-this._length:this._start,this._length)}findFirstSequence(e,t=null,n=null){(null==t||t>this._length)&&(t=this._length),(null==n||n>t)&&(n=t);const a=this._stream.findFirstSequence(e,this._start,t,this.backward);if(0==a.value.length)return a;if(this.backward){if(a.position<this._start-a.value.length-n)return{position:-1,value:new vt}}else if(a.position>this._start+a.value.length+n)return{position:-1,value:new vt};return this.start=a.position,a}findAllSequences(e){return this.stream.findAllSequences(e,this.backward?this.start-this.length:this.start,this.length)}findPairedPatterns(e,t,n=null){(null==n||n>this.length)&&(n=this.length);const o=this.stream.findPairedPatterns(e,t,this.backward?this.start-this.length:this.start,this.length);if(o.length)if(this.backward){if(o[0].right<this.start-t.length-n)return[]}else if(o[0].left>this.start+e.length+n)return[];return o}findPairedArrays(e,t,n=null){(null==n||n>this.length)&&(n=this.length);const o=this.stream.findPairedArrays(e,t,this.backward?this.start-this.length:this.start,this.length);if(o.length)if(this.backward){if(o[0].right.position<this.start-t[o[0].right.id].length-n)return[]}else if(o[0].left.position>this.start+e[o[0].left.id].length+n)return[];return o}replacePattern(e,t){return this.stream.replacePattern(e,t,this.backward?this.start-this.length:this.start,this.length)}skipPatterns(e){const t=this.stream.skipPatterns(e,this.start,this.length,this.backward);return this.start=t,t}skipNotPatterns(e){const t=this.stream.skipNotPatterns(e,this.start,this.length,this.backward);return-1==t?-1:(this.start=t,t)}append(e){this.beforeAppend(e.length),this._stream.view.set(e.view,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendView(e){this.beforeAppend(e.length),this._stream.view.set(e,this._start),this._length+=2*e.length,this.start=this._start+e.length,this.prevLength-=2*e.length}appendChar(e){this.beforeAppend(1),this._stream.view[this._start]=e,this._length+=2,this.start=this._start+1,this.prevLength-=2}appendUint16(e){this.beforeAppend(2);const t=new Uint16Array([e]),n=new Uint8Array(t.buffer);this.stream.view[this._start]=n[1],this._stream.view[this._start+1]=n[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendUint24(e){this.beforeAppend(3);const t=new Uint32Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[2],this._stream.view[this._start+1]=n[1],this._stream.view[this._start+2]=n[0],this._length+=6,this.start=this._start+3,this.prevLength-=6}appendUint32(e){this.beforeAppend(4);const t=new Uint32Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[3],this._stream.view[this._start+1]=n[2],this._stream.view[this._start+2]=n[1],this._stream.view[this._start+3]=n[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}appendInt16(e){this.beforeAppend(2);const t=new Int16Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[1],this._stream.view[this._start+1]=n[0],this._length+=4,this.start=this._start+2,this.prevLength-=4}appendInt32(e){this.beforeAppend(4);const t=new Int32Array([e]),n=new Uint8Array(t.buffer);this._stream.view[this._start]=n[3],this._stream.view[this._start+1]=n[2],this._stream.view[this._start+2]=n[1],this._stream.view[this._start+3]=n[0],this._length+=8,this.start=this._start+4,this.prevLength-=8}getBlock(e,t=!0){if(this._length<=0)return new Uint8Array(0);let n;if(this._length<e&&(e=this._length),this.backward){const a=this._stream.view.subarray(this._length-e,this._length);n=new Uint8Array(e);for(let o=0;o<e;o++)n[e-1-o]=a[o]}else n=this._stream.view.subarray(this._start,this._start+e);return t&&(this.start+=this.backward?-1*e:e),n}getUint16(e=!0){const t=this.getBlock(2,e);return t.length<2?0:t[0]<<8|t[1]}getInt16(e=!0){const t=this.getUint16(e),n=32768;return t&n?-(n-(t^n)):t}getUint24(e=!0){const t=this.getBlock(4,e);return t.length<3?0:t[0]<<16|t[1]<<8|t[2]}getUint32(e=!0){const t=this.getBlock(4,e);return t.length<4?0:16777216*t[0]+(t[1]<<16)+(t[2]<<8)+t[3]}getInt32(e=!0){const t=this.getUint32(e),n=2147483648;return t&n?-(n-(t^n)):t}beforeAppend(e){this._start+e>this._stream.length&&(e>this.appendBlock&&(this.appendBlock=e+s.APPEND_BLOCK),this._stream.realloc(this._stream.length+this.appendBlock))}}return s.APPEND_BLOCK=1e3,s})();const Tt=new ArrayBuffer(0),S="";let ct=(()=>{class s extends TypeError{constructor(){super(...arguments),this.name=s.NAME}static isType(e,t){if("string"==typeof t){if("Array"===t&&Array.isArray(e))return!0;if("ArrayBuffer"===t&&e instanceof ArrayBuffer)return!0;if("ArrayBufferView"===t&&ArrayBuffer.isView(e))return!0;if(typeof e===t)return!0}else if(e instanceof t)return!0;return!1}static assert(e,t,...n){for(const o of n)if(this.isType(e,o))return;const a=n.map(o=>o instanceof Function&&"name"in o?o.name:`${o}`);throw new s(`Parameter '${t}' is not of type ${a.length>1?`(${a.join(" or ")})`:a[0]}`)}}return s.NAME="ArgumentError",s})(),it=(()=>{class s extends TypeError{constructor(e,t=null,n){super(),this.name=s.NAME,this.field=e,t&&(this.target=t),this.message=n||`Absent mandatory parameter '${e}' ${t?` in '${t}'`:S}`}static assert(...e){let n,a,t=null;"string"==typeof e[0]?(t=e[0],n=e[1],a=e.slice(2)):(n=e[0],a=e.slice(1)),ct.assert(n,"parameters","object");for(const o of a)if(null==n[o])throw new s(o,t)}static assertEmpty(e,t,n){if(null==e)throw new s(t,n)}}return s.NAME="ParameterError",s})();class re extends Error{static assertSchema(i,e){if(!i.verified)throw new Error(`Object's schema was not verified against input data for ${e}`)}static assert(i,e){if(-1===i.offset)throw new re(`Error during parsing of ASN.1 data. Data is not correct for '${e}'.`)}constructor(i){super(i),this.name="AsnError"}}let he=(()=>{class s{static blockName(){return this.CLASS_NAME}static fromBER(e){const t=Ct(e);re.assert(t,this.name);try{return new this({schema:t.result})}catch{throw new re(`Cannot create '${this.CLASS_NAME}' from ASN.1 object`)}}static defaultValues(e){throw new Error(`Invalid member name for ${this.CLASS_NAME} class: ${e}`)}static schema(e={}){throw new Error(`Method '${this.CLASS_NAME}.schema' should be overridden`)}get className(){return this.constructor.CLASS_NAME}toString(e="hex"){let t;try{t=this.toSchema()}catch{t=this.toSchema(!0)}return ye.ep.ToString(t.toBER(),e)}}return s.CLASS_NAME="PkiObject",s})();function xs(s){let i=!1,e=S;const t=s.trim();for(let n=0;n<t.length;n++)32===t.charCodeAt(n)?!1===i&&(i=!0):(i&&(e+=" ",i=!1),e+=t[n]);return e.toLowerCase()}const Ca="type",_c="value";let Ac=(()=>{class s extends he{constructor(e={}){super(),this.type=h(e,Ca,s.defaultValues(Ca)),this.value=h(e,_c,s.defaultValues(_c)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ca:return S;case _c:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.type||S}),new He({name:t.value||S})]})}fromSchema(e){ge(e,[Ca,"typeValue"]);const t=ce(e,e,s.schema({names:{type:Ca,value:"typeValue"}}));re.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.value=t.result.typeValue}toSchema(){return new R({value:[new Oe({value:this.type}),this.value]})}toJSON(){const e={type:this.type};return e.value=0!==Object.keys(this.value).length?this.value.toJSON():this.value,e}isEqual(e){const t=[cs.blockName(),rs.blockName(),Aa.blockName(),zn.blockName(),Xt.blockName(),ka.blockName(),yc.blockName(),zl.blockName(),wc.blockName(),Gl.blockName(),Sc.blockName(),bc.blockName()];if(e instanceof ArrayBuffer)return ye.vJ.isEqual(this.value.valueBeforeDecodeView,e);if(e.constructor.blockName()===s.blockName()){if(this.type!==e.type)return!1;const n=[!1,!1],a=this.value.constructor.blockName();for(const u of t)a===u&&(n[0]=!0),e.value.constructor.blockName()===u&&(n[1]=!0);if(n[0]!==n[1])return!1;if(n[0]&&n[1]){const u=xs(this.value.valueBlock.value),l=xs(e.value.valueBlock.value);if(0!==u.localeCompare(l))return!1}else if(!ye.vJ.isEqual(this.value.valueBeforeDecodeView,e.value.valueBeforeDecodeView))return!1;return!0}return!1}}return s.CLASS_NAME="AttributeTypeAndValue",s})();const Ir="typesAndValues",Yl="valueBeforeDecode";let dt=(()=>{class s extends he{constructor(e={}){super(),this.typesAndValues=h(e,Ir,s.defaultValues(Ir)),this.valueBeforeDecode=h(e,Yl,s.defaultValues(Yl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ir:return[];case Yl:return Tt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ir:return 0===t.length;case Yl:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.repeatedSequence||S,value:new At({value:[new ze({name:t.repeatedSet||S,value:Ac.schema(t.typeAndValue||{})})]})})]})}fromSchema(e){ge(e,["RDN",Ir]);const t=ce(e,e,s.schema({names:{blockName:"RDN",repeatedSet:Ir}}));re.assertSchema(t,this.className),Ir in t.result&&(this.typesAndValues=Array.from(t.result.typesAndValues,n=>new Ac({schema:n}))),this.valueBeforeDecode=t.result.RDN.valueBeforeDecodeView.slice().buffer}toSchema(){if(0===this.valueBeforeDecode.byteLength)return new R({value:[new At({value:Array.from(this.typesAndValues,t=>t.toSchema())})]});const e=Ct(this.valueBeforeDecode);if(re.assert(e,"RelativeDistinguishedNames"),!(e.result instanceof R))throw new Error("ASN.1 result should be SEQUENCE");return e.result}toJSON(){return{typesAndValues:Array.from(this.typesAndValues,e=>e.toJSON())}}isEqual(e){if(e instanceof s){if(this.typesAndValues.length!==e.typesAndValues.length)return!1;for(const[t,n]of this.typesAndValues.entries())if(!1===n.isEqual(e.typesAndValues[t]))return!1;return!0}return e instanceof ArrayBuffer&&$n(this.valueBeforeDecode,e)}}return s.CLASS_NAME="RelativeDistinguishedNames",s})();const Na="type",Ia="value";function fg(s={},i=!1){const e=h(s,"names",{});return new R({optional:i,value:[new $({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:e.country_name||S,value:[new ft({value:[new zn,new Xt]})]}),new $({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:e.administration_domain_name||S,value:[new ft({value:[new zn,new Xt]})]}),new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:e.network_address||S,isHexOnly:!0}),new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:e.terminal_identifier||S,isHexOnly:!0}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:e.private_domain_name||S,value:[new ft({value:[new zn,new Xt]})]}),new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:e.organization_name||S,isHexOnly:!0}),new Ue({optional:!0,name:e.numeric_user_identifier||S,idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new $({optional:!0,name:e.personal_name||S,idBlock:{tagClass:3,tagNumber:5},value:[new Ue({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new $({optional:!0,name:e.organizational_unit_names||S,idBlock:{tagClass:3,tagNumber:6},value:[new ze({value:new Xt})]})]})}function dg(s=!1){return new R({optional:s,value:[new Xt,new Xt]})}function mg(s=!1){return new At({optional:s,value:[new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new He]})]})}let bt=(()=>{class s extends he{constructor(e={}){super(),this.type=h(e,Na,s.defaultValues(Na)),this.value=h(e,Ia,s.defaultValues(Ia)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Na:return 9;case Ia:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Na:return t===s.defaultValues(e);case Ia:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new ft({value:[new $({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||S,value:[new Oe,new $({idBlock:{tagClass:3,tagNumber:0},value:[new He]})]}),new Ue({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:1}}),new Ue({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:2}}),new $({idBlock:{tagClass:3,tagNumber:3},name:t.blockName||S,value:[fg(t.builtInStandardAttributes||{},!1),dg(!0),mg(!0)]}),new $({idBlock:{tagClass:3,tagNumber:4},name:t.blockName||S,value:[dt.schema(t.directoryName||{})]}),new $({idBlock:{tagClass:3,tagNumber:5},name:t.blockName||S,value:[new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ft({value:[new ka,new Xt,new Aa,new cs,new rs]})]}),new $({idBlock:{tagClass:3,tagNumber:1},value:[new ft({value:[new ka,new Xt,new Aa,new cs,new rs]})]})]}),new Ue({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:6}}),new Ue({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:7}}),new Ue({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:8}})]})}fromSchema(e){ge(e,["blockName","otherName","rfc822Name","dNSName","x400Address","directoryName","ediPartyName","uniformResourceIdentifier","iPAddress","registeredID"]);const t=ce(e,e,s.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));switch(re.assertSchema(t,this.className),this.type=t.result.blockName.idBlock.tagNumber,this.type){case 0:case 3:this.value=t.result.blockName;break;case 1:case 2:case 6:{const n=t.result.blockName;n.idBlock.tagClass=1,n.idBlock.tagNumber=22;const o=Ct(n.toBER(!1));re.assert(o,"GeneralName value"),this.value=o.result.valueBlock.value}break;case 4:this.value=new dt({schema:t.result.directoryName});break;case 5:this.value=t.result.ediPartyName;break;case 7:this.value=new de({valueHex:t.result.blockName.valueBlock.valueHex});break;case 8:{const n=t.result.blockName;n.idBlock.tagClass=1,n.idBlock.tagNumber=6;const o=Ct(n.toBER(!1));re.assert(o,"GeneralName registeredID"),this.value=o.result.valueBlock.toString()}}}toSchema(){switch(this.type){case 0:case 3:case 5:return new $({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:{const e=new zl({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 4:return new $({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:{const e=this.value;return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}case 8:{const e=new Oe({value:this.value});return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.type,e}default:return s.schema()}}toJSON(){const e={type:this.type,value:S};if("string"==typeof this.value)e.value=this.value;else try{e.value=this.value.toJSON()}catch{}return e}}return s.CLASS_NAME="GeneralName",s})();const Ta="accessMethod",Ba="accessLocation",gg=[Ta,Ba];let rd=(()=>{class s extends he{constructor(e={}){super(),this.accessMethod=h(e,Ta,s.defaultValues(Ta)),this.accessLocation=h(e,Ba,s.defaultValues(Ba)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ta:return S;case Ba:return new bt;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.accessMethod||S}),bt.schema(t.accessLocation||{})]})}fromSchema(e){ge(e,gg);const t=ce(e,e,s.schema({names:{accessMethod:Ta,accessLocation:{names:{blockName:Ba}}}}));re.assertSchema(t,this.className),this.accessMethod=t.result.accessMethod.valueBlock.toString(),this.accessLocation=new bt({schema:t.result.accessLocation})}toSchema(){return new R({value:[new Oe({value:this.accessMethod}),this.accessLocation.toSchema()]})}toJSON(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}return s.CLASS_NAME="AccessDescription",s})();const Rs="seconds",Os="millis",Vs="micros";let Wn=(()=>{class s extends he{constructor(e={}){super(),Rs in e&&(this.seconds=h(e,Rs,s.defaultValues(Rs))),Os in e&&(this.millis=h(e,Os,s.defaultValues(Os))),Vs in e&&(this.micros=h(e,Vs,s.defaultValues(Vs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Rs:case Os:case Vs:return 0;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Rs:case Os:case Vs:return t===s.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,optional:!0,value:[new z({optional:!0,name:t.seconds||S}),new Ue({name:t.millis||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ue({name:t.micros||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){ge(e,[Rs,Os,Vs]);const t=ce(e,e,s.schema({names:{seconds:Rs,millis:Os,micros:Vs}}));if(re.assertSchema(t,this.className),"seconds"in t.result&&(this.seconds=t.result.seconds.valueBlock.valueDec),"millis"in t.result){const n=new z({valueHex:t.result.millis.valueBlock.valueHex});this.millis=n.valueBlock.valueDec}if("micros"in t.result){const n=new z({valueHex:t.result.micros.valueBlock.valueHex});this.micros=n.valueBlock.valueDec}}toSchema(){const e=[];if(void 0!==this.seconds&&e.push(new z({value:this.seconds})),void 0!==this.millis){const t=new z({value:this.millis});e.push(new Ue({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHexView}))}if(void 0!==this.micros){const t=new z({value:this.micros});e.push(new Ue({idBlock:{tagClass:3,tagNumber:1},valueHex:t.valueBlock.valueHexView}))}return new R({value:e})}toJSON(){const e={};return void 0!==this.seconds&&(e.seconds=this.seconds),void 0!==this.millis&&(e.millis=this.millis),void 0!==this.micros&&(e.micros=this.micros),e}}return s.CLASS_NAME="Accuracy",s})();const Ql="algorithmId",xa="algorithmParams",nd="algorithm",kc="params",pg=[nd,kc];let G=(()=>{class s extends he{constructor(e={}){super(),this.algorithmId=h(e,Ql,s.defaultValues(Ql)),xa in e&&(this.algorithmParams=h(e,xa,s.defaultValues(xa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ql:return S;case xa:return new He;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ql:return t===S;case xa:return t instanceof He;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,optional:t.optional||!1,value:[new Oe({name:t.algorithmIdentifier||S}),new He({name:t.algorithmParams||S,optional:!0})]})}fromSchema(e){ge(e,pg);const t=ce(e,e,s.schema({names:{algorithmIdentifier:nd,algorithmParams:kc}}));re.assertSchema(t,this.className),this.algorithmId=t.result.algorithm.valueBlock.toString(),kc in t.result&&(this.algorithmParams=t.result.params)}toSchema(){const e=[];return e.push(new Oe({value:this.algorithmId})),this.algorithmParams&&!(this.algorithmParams instanceof He)&&e.push(this.algorithmParams),new R({value:e})}toJSON(){const e={algorithmId:this.algorithmId};return this.algorithmParams&&!(this.algorithmParams instanceof He)&&(e.algorithmParams=this.algorithmParams.toJSON()),e}isEqual(e){return e instanceof s&&this.algorithmId===e.algorithmId&&(this.algorithmParams?!!e.algorithmParams&&JSON.stringify(this.algorithmParams)===JSON.stringify(e.algorithmParams):!e.algorithmParams)}}return s.CLASS_NAME="AlgorithmIdentifier",s})();const Yn="altNames",vg=[Yn];let id=(()=>{class s extends he{constructor(e={}){super(),this.altNames=h(e,Yn,s.defaultValues(Yn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===Yn?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.altNames||S,value:bt.schema()})]})}fromSchema(e){ge(e,vg);const t=ce(e,e,s.schema({names:{altNames:Yn}}));re.assertSchema(t,this.className),Yn in t.result&&(this.altNames=Array.from(t.result.altNames,n=>new bt({schema:n})))}toSchema(){return new R({value:Array.from(this.altNames,e=>e.toSchema())})}toJSON(){return{altNames:Array.from(this.altNames,e=>e.toJSON())}}}return s.CLASS_NAME="AltName",s})();const Qn="type",Xn="values",yg=[Qn,Xn];let at=(()=>{class s extends he{constructor(e={}){super(),this.type=h(e,Qn,s.defaultValues(Qn)),this.values=h(e,Xn,s.defaultValues(Xn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qn:return S;case Xn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Qn:return t===S;case Xn:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.type||S}),new At({name:t.setName||S,value:[new ze({name:t.values||S,value:new He})]})]})}fromSchema(e){ge(e,yg);const t=ce(e,e,s.schema({names:{type:Qn,values:Xn}}));re.assertSchema(t,this.className),this.type=t.result.type.valueBlock.toString(),this.values=t.result.values}toSchema(){return new R({value:[new Oe({value:this.type}),new At({value:this.values})]})}toJSON(){return{type:this.type,values:Array.from(this.values,e=>e.toJSON())}}}return s.CLASS_NAME="Attribute",s})();const Ra="notBeforeTime",Oa="notAfterTime",wg=[Ra,Oa];let ei=(()=>{class s extends he{constructor(e={}){super(),this.notBeforeTime=h(e,Ra,s.defaultValues(Ra)),this.notAfterTime=h(e,Oa,s.defaultValues(Oa)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ra:case Oa:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ht({name:t.notBeforeTime||S}),new ht({name:t.notAfterTime||S})]})}fromSchema(e){ge(e,wg);const t=ce(e,e,s.schema({names:{notBeforeTime:Ra,notAfterTime:Oa}}));re.assertSchema(t,this.className),this.notBeforeTime=t.result.notBeforeTime.toDate(),this.notAfterTime=t.result.notAfterTime.toDate()}toSchema(){return new R({value:[new ht({valueDate:this.notBeforeTime}),new ht({valueDate:this.notAfterTime})]})}toJSON(){return{notBeforeTime:this.notBeforeTime,notAfterTime:this.notAfterTime}}}return s.CLASS_NAME="AttCertValidityPeriod",s})();const Va="names",ad="generalNames";let xt=(()=>{class s extends he{constructor(e={}){super(),this.names=h(e,Va,s.defaultValues(Va)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return"names"===e?[]:super.defaultValues(e)}static schema(e={},t=!1){const n=h(e,Va,{});return new R({optional:t,name:n.blockName||S,value:[new ze({name:n.generalNames||S,value:bt.schema()})]})}fromSchema(e){ge(e,[Va,ad]);const t=ce(e,e,s.schema({names:{blockName:Va,generalNames:ad}}));re.assertSchema(t,this.className),this.names=Array.from(t.result.generalNames,n=>new bt({schema:n}))}toSchema(){return new R({value:Array.from(this.names,e=>e.toSchema())})}toJSON(){return{names:Array.from(this.names,e=>e.toJSON())}}}return s.CLASS_NAME="GeneralNames",s})();const _g="2.5.29.15",od="2.5.29.17",ld="2.5.29.18",Ec="2.5.29.19",ud="2.5.29.28",cd="2.5.29.29",hd="2.5.29.30",fd="2.5.29.31",Cc="2.5.29.46",dd="2.5.29.32",es="2.5.29.32.0",md="2.5.29.33",Nc="2.5.29.35",gd="2.5.29.36",Ic="1.3.6.1.5.5.7.1.1",Tc="1.2.840.113549.1.7.1",vd="1.2.840.113549.1.7.3",yd="1.2.840.113549.1.7.6",wd="1.2.840.113549.1.9.22.1",Sd="1.2.840.113549.1.9.22.3",bd="1.2.840.113549.1.9.23.1",Tr="keyIdentifier",Br="authorityCertIssuer",xr="authorityCertSerialNumber",Mg=[Tr,Br,xr];let _d=(()=>{class s extends he{constructor(e={}){super(),Tr in e&&(this.keyIdentifier=h(e,Tr,s.defaultValues(Tr))),Br in e&&(this.authorityCertIssuer=h(e,Br,s.defaultValues(Br))),xr in e&&(this.authorityCertSerialNumber=h(e,xr,s.defaultValues(xr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tr:return new de;case Br:return[];case xr:return new z;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Ue({name:t.keyIdentifier||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ze({name:t.authorityCertIssuer||S,value:bt.schema()})]}),new Ue({name:t.authorityCertSerialNumber||S,optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}fromSchema(e){ge(e,Mg);const t=ce(e,e,s.schema({names:{keyIdentifier:Tr,authorityCertIssuer:Br,authorityCertSerialNumber:xr}}));re.assertSchema(t,this.className),Tr in t.result&&(this.keyIdentifier=new de({valueHex:t.result.keyIdentifier.valueBlock.valueHex})),Br in t.result&&(this.authorityCertIssuer=Array.from(t.result.authorityCertIssuer,n=>new bt({schema:n}))),xr in t.result&&(this.authorityCertSerialNumber=new z({valueHex:t.result.authorityCertSerialNumber.valueBlock.valueHex}))}toSchema(){const e=[];return this.keyIdentifier&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.keyIdentifier.valueBlock.valueHexView})),this.authorityCertIssuer&&e.push(new $({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.authorityCertIssuer,t=>t.toSchema())})),this.authorityCertSerialNumber&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:2},valueHex:this.authorityCertSerialNumber.valueBlock.valueHexView})),new R({value:e})}toJSON(){const e={};return this.keyIdentifier&&(e.keyIdentifier=this.keyIdentifier.toJSON()),this.authorityCertIssuer&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,t=>t.toJSON())),this.authorityCertSerialNumber&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}return s.CLASS_NAME="AuthorityKeyIdentifier",s})();const Rr="pathLenConstraint",Or="cA";let Ad=(()=>{class s extends he{constructor(e={}){super(),this.cA=h(e,Or,!1),Rr in e&&(this.pathLenConstraint=h(e,Rr,0)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e!==Or&&super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Bs({optional:!0,name:t.cA||S}),new z({optional:!0,name:t.pathLenConstraint||S})]})}fromSchema(e){ge(e,[Or,Rr]);const t=ce(e,e,s.schema({names:{cA:Or,pathLenConstraint:Rr}}));re.assertSchema(t,this.className),Or in t.result&&(this.cA=t.result.cA.valueBlock.value),Rr in t.result&&(this.pathLenConstraint=t.result.pathLenConstraint.valueBlock.isHexOnly?t.result.pathLenConstraint:t.result.pathLenConstraint.valueBlock.valueDec)}toSchema(){const e=[];return this.cA!==s.defaultValues(Or)&&e.push(new Bs({value:this.cA})),Rr in this&&e.push(this.pathLenConstraint instanceof z?this.pathLenConstraint:new z({value:this.pathLenConstraint})),new R({value:e})}toJSON(){const e={};return this.cA!==s.defaultValues(Or)&&(e.cA=this.cA),Rr in this&&(e.pathLenConstraint=this.pathLenConstraint instanceof z?this.pathLenConstraint.toJSON():this.pathLenConstraint),e}}return s.CLASS_NAME="BasicConstraints",s})();const xc="certificateIndex",Rc="keyIndex";let Fg=(()=>{class s extends he{constructor(e={}){super(),this.certificateIndex=h(e,xc,s.defaultValues(xc)),this.keyIndex=h(e,Rc,s.defaultValues(Rc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xc:case Rc:return 0;default:return super.defaultValues(e)}}static schema(){return new z}fromSchema(e){if(e.constructor.blockName()!==z.blockName())throw new Error("Object's schema was not verified against input data for CAVersion");let t=e.valueBlock.valueHex.slice(0);const n=new Uint8Array(t);switch(!0){case t.byteLength<4:{const F=new ArrayBuffer(4);new Uint8Array(F).set(n,4-t.byteLength),t=F.slice(0)}break;case t.byteLength>4:{const F=new ArrayBuffer(4);new Uint8Array(F).set(n.slice(0,4)),t=F.slice(0)}}const a=t.slice(0,2),o=new Uint8Array(a);let u=o[0];o[0]=o[1],o[1]=u;const l=new Uint16Array(a);this.keyIndex=l[0];const m=t.slice(2),k=new Uint8Array(m);u=k[0],k[0]=k[1],k[1]=u;const B=new Uint16Array(m);this.certificateIndex=B[0]}toSchema(){const e=new ArrayBuffer(2);new Uint16Array(e)[0]=this.certificateIndex;const n=new Uint8Array(e);let a=n[0];n[0]=n[1],n[1]=a;const o=new ArrayBuffer(2);new Uint16Array(o)[0]=this.keyIndex;const l=new Uint8Array(o);return a=l[0],l[0]=l[1],l[1]=a,new z({valueHex:jn(o,e)})}toJSON(){return{certificateIndex:this.certificateIndex,keyIndex:this.keyIndex}}}return s.CLASS_NAME="CAVersion",s})();const Pa="policyQualifierId",Da="qualifier",Hg=[Pa,Da];let kd=(()=>{class s extends he{constructor(e={}){super(),this.policyQualifierId=h(e,Pa,s.defaultValues(Pa)),this.qualifier=h(e,Da,s.defaultValues(Da)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pa:return S;case Da:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.policyQualifierId||S}),new He({name:t.qualifier||S})]})}fromSchema(e){ge(e,Hg);const t=ce(e,e,s.schema({names:{policyQualifierId:Pa,qualifier:Da}}));re.assertSchema(t,this.className),this.policyQualifierId=t.result.policyQualifierId.valueBlock.toString(),this.qualifier=t.result.qualifier}toSchema(){return new R({value:[new Oe({value:this.policyQualifierId}),this.qualifier]})}toJSON(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}return s.CLASS_NAME="PolicyQualifierInfo",s})();const Ua="policyIdentifier",Vr="policyQualifiers",Jg=[Ua,Vr];let Ed=(()=>{class s extends he{constructor(e={}){super(),this.policyIdentifier=h(e,Ua,s.defaultValues(Ua)),Vr in e&&(this.policyQualifiers=h(e,Vr,s.defaultValues(Vr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ua:return S;case Vr:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.policyIdentifier||S}),new R({optional:!0,value:[new ze({name:t.policyQualifiers||S,value:kd.schema()})]})]})}fromSchema(e){ge(e,Jg);const t=ce(e,e,s.schema({names:{policyIdentifier:Ua,policyQualifiers:Vr}}));re.assertSchema(t,this.className),this.policyIdentifier=t.result.policyIdentifier.valueBlock.toString(),Vr in t.result&&(this.policyQualifiers=Array.from(t.result.policyQualifiers,n=>new kd({schema:n})))}toSchema(){const e=[];return e.push(new Oe({value:this.policyIdentifier})),this.policyQualifiers&&e.push(new R({value:Array.from(this.policyQualifiers,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={policyIdentifier:this.policyIdentifier};return this.policyQualifiers&&(e.policyQualifiers=Array.from(this.policyQualifiers,t=>t.toJSON())),e}}return s.CLASS_NAME="PolicyInformation",s})();const La="certificatePolicies",Kg=[La];let Cd=(()=>{class s extends he{constructor(e={}){super(),this.certificatePolicies=h(e,La,s.defaultValues(La)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===La?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.certificatePolicies||S,value:Ed.schema()})]})}fromSchema(e){ge(e,Kg);const t=ce(e,e,s.schema({names:{certificatePolicies:La}}));re.assertSchema(t,this.className),this.certificatePolicies=Array.from(t.result.certificatePolicies,n=>new Ed({schema:n}))}toSchema(){return new R({value:Array.from(this.certificatePolicies,e=>e.toSchema())})}toJSON(){return{certificatePolicies:Array.from(this.certificatePolicies,e=>e.toJSON())}}}return s.CLASS_NAME="CertificatePolicies",s})();const Ma="templateID",ps="templateMajorVersion",vs="templateMinorVersion",jg=[Ma,ps,vs];class ti extends he{constructor(i={}){super(),this.templateID=h(i,Ma,ti.defaultValues(Ma)),ps in i&&(this.templateMajorVersion=h(i,ps,ti.defaultValues(ps))),vs in i&&(this.templateMinorVersion=h(i,vs,ti.defaultValues(vs))),i.schema&&this.fromSchema(i.schema)}static defaultValues(i){switch(i){case Ma:return S;case ps:case vs:return 0;default:return super.defaultValues(i)}}static schema(i={}){const e=h(i,"names",{});return new R({name:e.blockName||S,value:[new Oe({name:e.templateID||S}),new z({name:e.templateMajorVersion||S,optional:!0}),new z({name:e.templateMinorVersion||S,optional:!0})]})}fromSchema(i){ge(i,jg);const e=ce(i,i,ti.schema({names:{templateID:Ma,templateMajorVersion:ps,templateMinorVersion:vs}}));re.assertSchema(e,this.className),this.templateID=e.result.templateID.valueBlock.toString(),ps in e.result&&(this.templateMajorVersion=e.result.templateMajorVersion.valueBlock.valueDec),vs in e.result&&(this.templateMinorVersion=e.result.templateMinorVersion.valueBlock.valueDec)}toSchema(){const i=[];return i.push(new Oe({value:this.templateID})),ps in this&&i.push(new z({value:this.templateMajorVersion})),vs in this&&i.push(new z({value:this.templateMinorVersion})),new R({value:i})}toJSON(){const i={templateID:this.templateID};return ps in this&&(i.templateMajorVersion=this.templateMajorVersion),vs in this&&(i.templateMinorVersion=this.templateMinorVersion),i}}const Pr="distributionPoint",Nd="distributionPointNames",Dr="reasons",Ur="cRLIssuer",Id="cRLIssuerNames",$g=[Pr,Nd,Dr,Ur,Id];let Td=(()=>{class s extends he{constructor(e={}){super(),Pr in e&&(this.distributionPoint=h(e,Pr,s.defaultValues(Pr))),Dr in e&&(this.reasons=h(e,Dr,s.defaultValues(Dr))),Ur in e&&(this.cRLIssuer=h(e,Ur,s.defaultValues(Ur))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Pr:return[];case Dr:return new et;case Ur:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ft({value:[new $({name:t.distributionPoint||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ze({name:t.distributionPointNames||S,value:bt.schema()})]}),new $({name:t.distributionPoint||S,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:dt.schema().valueBlock.value})]})]}),new Ue({name:t.reasons||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new $({name:t.cRLIssuer||S,optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new ze({name:t.cRLIssuerNames||S,value:bt.schema()})]})]})}fromSchema(e){ge(e,$g);const t=ce(e,e,s.schema({names:{distributionPoint:Pr,distributionPointNames:Nd,reasons:Dr,cRLIssuer:Ur,cRLIssuerNames:Id}}));re.assertSchema(t,this.className),Pr in t.result&&(0===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(t.result.distributionPointNames,n=>new bt({schema:n}))),1===t.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=new dt({schema:new R({value:t.result.distributionPoint.valueBlock.value})}))),Dr in t.result&&(this.reasons=new et({valueHex:t.result.reasons.valueBlock.valueHex})),Ur in t.result&&(this.cRLIssuer=Array.from(t.result.cRLIssuerNames,n=>new bt({schema:n})))}toSchema(){const e=[];if(this.distributionPoint){let t;t=new $(this.distributionPoint instanceof Array?{idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,n=>n.toSchema())}:{idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return this.reasons&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHexView})),this.cRLIssuer&&e.push(new $({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={};return this.distributionPoint&&(e.distributionPoint=this.distributionPoint instanceof Array?Array.from(this.distributionPoint,t=>t.toJSON()):this.distributionPoint.toJSON()),this.reasons&&(e.reasons=this.reasons.toJSON()),this.cRLIssuer&&(e.cRLIssuer=Array.from(this.cRLIssuer,t=>t.toJSON())),e}}return s.CLASS_NAME="DistributionPoint",s})();const Fa="distributionPoints",qg=[Fa];let Bd=(()=>{class s extends he{constructor(e={}){super(),this.distributionPoints=h(e,Fa,s.defaultValues(Fa)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===Fa?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.distributionPoints||S,value:Td.schema()})]})}fromSchema(e){ge(e,qg);const t=ce(e,e,s.schema({names:{distributionPoints:Fa}}));re.assertSchema(t,this.className),this.distributionPoints=Array.from(t.result.distributionPoints,n=>new Td({schema:n}))}toSchema(){return new R({value:Array.from(this.distributionPoints,e=>e.toSchema())})}toJSON(){return{distributionPoints:Array.from(this.distributionPoints,e=>e.toJSON())}}}return s.CLASS_NAME="CRLDistributionPoints",s})();const Ha="keyPurposes",Zg=[Ha];let zg=(()=>{class s extends he{constructor(e={}){super(),this.keyPurposes=h(e,Ha,s.defaultValues(Ha)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===Ha?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.keyPurposes||S,value:new Oe})]})}fromSchema(e){ge(e,Zg);const t=ce(e,e,s.schema({names:{keyPurposes:Ha}}));re.assertSchema(t,this.className),this.keyPurposes=Array.from(t.result.keyPurposes,n=>n.valueBlock.toString())}toSchema(){return new R({value:Array.from(this.keyPurposes,e=>new Oe({value:e}))})}toJSON(){return{keyPurposes:Array.from(this.keyPurposes)}}}return s.CLASS_NAME="ExtKeyUsage",s})();const Ja="accessDescriptions";let xd=(()=>{class s extends he{constructor(e={}){super(),this.accessDescriptions=h(e,Ja,s.defaultValues(Ja)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===Ja?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.accessDescriptions||S,value:rd.schema()})]})}fromSchema(e){ge(e,[Ja]);const t=ce(e,e,s.schema({names:{accessDescriptions:Ja}}));re.assertSchema(t,this.className),this.accessDescriptions=Array.from(t.result.accessDescriptions,n=>new rd({schema:n}))}toSchema(){return new R({value:Array.from(this.accessDescriptions,e=>e.toSchema())})}toJSON(){return{accessDescriptions:Array.from(this.accessDescriptions,e=>e.toJSON())}}}return s.CLASS_NAME="InfoAccess",s})();const Lr="distributionPoint",Rd="distributionPointNames",Ps="onlyContainsUserCerts",Ds="onlyContainsCACerts",Us="onlySomeReasons",Ls="indirectCRL",Ms="onlyContainsAttributeCerts",Gg=[Lr,Rd,Ps,Ds,Us,Ls,Ms];let Wg=(()=>{class s extends he{constructor(e={}){super(),Lr in e&&(this.distributionPoint=h(e,Lr,s.defaultValues(Lr))),this.onlyContainsUserCerts=h(e,Ps,s.defaultValues(Ps)),this.onlyContainsCACerts=h(e,Ds,s.defaultValues(Ds)),Us in e&&(this.onlySomeReasons=h(e,Us,s.defaultValues(Us))),this.indirectCRL=h(e,Ls,s.defaultValues(Ls)),this.onlyContainsAttributeCerts=h(e,Ms,s.defaultValues(Ms)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Lr:return[];case Ps:case Ds:return!1;case Us:return 0;case Ls:case Ms:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ft({value:[new $({name:t.distributionPoint||S,idBlock:{tagClass:3,tagNumber:0},value:[new ze({name:t.distributionPointNames||S,value:bt.schema()})]}),new $({name:t.distributionPoint||S,idBlock:{tagClass:3,tagNumber:1},value:dt.schema().valueBlock.value})]})]}),new Ue({name:t.onlyContainsUserCerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ue({name:t.onlyContainsCACerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new Ue({name:t.onlySomeReasons||S,optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new Ue({name:t.indirectCRL||S,optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new Ue({name:t.onlyContainsAttributeCerts||S,optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}fromSchema(e){ge(e,Gg);const t=ce(e,e,s.schema({names:{distributionPoint:Lr,distributionPointNames:Rd,onlyContainsUserCerts:Ps,onlyContainsCACerts:Ds,onlySomeReasons:Us,indirectCRL:Ls,onlyContainsAttributeCerts:Ms}}));if(re.assertSchema(t,this.className),Lr in t.result)switch(!0){case 0===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(t.result.distributionPointNames,n=>new bt({schema:n}));break;case 1===t.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=new dt({schema:new R({value:t.result.distributionPoint.valueBlock.value})});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if(Ps in t.result){const n=new Uint8Array(t.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==n[0]}if(Ds in t.result){const n=new Uint8Array(t.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==n[0]}if(Us in t.result){const n=new Uint8Array(t.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=n[0]}if(Ls in t.result){const n=new Uint8Array(t.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==n[0]}if(Ms in t.result){const n=new Uint8Array(t.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==n[0]}}toSchema(){const e=[];if(this.distributionPoint){let t;this.distributionPoint instanceof Array?t=new $({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,n=>n.toSchema())}):(t=this.distributionPoint.toSchema(),t.idBlock.tagClass=3,t.idBlock.tagNumber=1),e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(this.onlyContainsUserCerts!==s.defaultValues(Ps)&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==s.defaultValues(Ds)&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),void 0!==this.onlySomeReasons){const t=new ArrayBuffer(1);new Uint8Array(t)[0]=this.onlySomeReasons,e.push(new Ue({idBlock:{tagClass:3,tagNumber:3},valueHex:t}))}return this.indirectCRL!==s.defaultValues(Ls)&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==s.defaultValues(Ms)&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new R({value:e})}toJSON(){const e={};return this.distributionPoint&&(e.distributionPoint=this.distributionPoint instanceof Array?Array.from(this.distributionPoint,t=>t.toJSON()):this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==s.defaultValues(Ps)&&(e.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==s.defaultValues(Ds)&&(e.onlyContainsCACerts=this.onlyContainsCACerts),Us in this&&(e.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==s.defaultValues(Ls)&&(e.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==s.defaultValues(Ms)&&(e.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),e}}return s.CLASS_NAME="IssuingDistributionPoint",s})();const Ka="base",si="minimum",Fs="maximum",Yg=[Ka,si,Fs];let Xl=(()=>{class s extends he{constructor(e={}){super(),this.base=h(e,Ka,s.defaultValues(Ka)),this.minimum=h(e,si,s.defaultValues(si)),Fs in e&&(this.maximum=h(e,Fs,s.defaultValues(Fs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ka:return new bt;case si:case Fs:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[bt.schema(t.base||{}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.minimum||S})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new z({name:t.maximum||S})]})]})}fromSchema(e){ge(e,Yg);const t=ce(e,e,s.schema({names:{base:{names:{blockName:Ka}},minimum:si,maximum:Fs}}));re.assertSchema(t,this.className),this.base=new bt({schema:t.result.base}),si in t.result&&(this.minimum=t.result.minimum.valueBlock.isHexOnly?t.result.minimum:t.result.minimum.valueBlock.valueDec),Fs in t.result&&(this.maximum=t.result.maximum.valueBlock.isHexOnly?t.result.maximum:t.result.maximum.valueBlock.valueDec)}toSchema(){const e=[];if(e.push(this.base.toSchema()),0!==this.minimum){let t=0;t=this.minimum instanceof z?this.minimum:new z({value:this.minimum}),e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if(Fs in this){let t=0;t=this.maximum instanceof z?this.maximum:new z({value:this.maximum}),e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[t]}))}return new R({value:e})}toJSON(){const e={base:this.base.toJSON()};return 0!==this.minimum&&(e.minimum="number"==typeof this.minimum?this.minimum:this.minimum.toJSON()),void 0!==this.maximum&&(e.maximum="number"==typeof this.maximum?this.maximum:this.maximum.toJSON()),e}}return s.CLASS_NAME="GeneralSubtree",s})();const Mr="permittedSubtrees",Fr="excludedSubtrees",Qg=[Mr,Fr];let Xg=(()=>{class s extends he{constructor(e={}){super(),Mr in e&&(this.permittedSubtrees=h(e,Mr,s.defaultValues(Mr))),Fr in e&&(this.excludedSubtrees=h(e,Fr,s.defaultValues(Fr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mr:case Fr:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ze({name:t.permittedSubtrees||S,value:Xl.schema()})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ze({name:t.excludedSubtrees||S,value:Xl.schema()})]})]})}fromSchema(e){ge(e,Qg);const t=ce(e,e,s.schema({names:{permittedSubtrees:Mr,excludedSubtrees:Fr}}));re.assertSchema(t,this.className),Mr in t.result&&(this.permittedSubtrees=Array.from(t.result.permittedSubtrees,n=>new Xl({schema:n}))),Fr in t.result&&(this.excludedSubtrees=Array.from(t.result.excludedSubtrees,n=>new Xl({schema:n})))}toSchema(){const e=[];return this.permittedSubtrees&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.permittedSubtrees,t=>t.toSchema())})),this.excludedSubtrees&&e.push(new $({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.excludedSubtrees,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={};return this.permittedSubtrees&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,t=>t.toJSON())),this.excludedSubtrees&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,t=>t.toJSON())),e}}return s.CLASS_NAME="NameConstraints",s})();const ys="requireExplicitPolicy",ws="inhibitPolicyMapping",ep=[ys,ws];let tp=(()=>{class s extends he{constructor(e={}){super(),ys in e&&(this.requireExplicitPolicy=h(e,ys,s.defaultValues(ys))),ws in e&&(this.inhibitPolicyMapping=h(e,ws,s.defaultValues(ws))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ys:case ws:return 0;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Ue({name:t.requireExplicitPolicy||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ue({name:t.inhibitPolicyMapping||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){ge(e,ep);const t=ce(e,e,s.schema({names:{requireExplicitPolicy:ys,inhibitPolicyMapping:ws}}));if(re.assertSchema(t,this.className),ys in t.result){const n=t.result.requireExplicitPolicy;n.idBlock.tagClass=1,n.idBlock.tagNumber=2;const o=Ct(n.toBER(!1));re.assert(o,"Integer"),this.requireExplicitPolicy=o.result.valueBlock.valueDec}if(ws in t.result){const n=t.result.inhibitPolicyMapping;n.idBlock.tagClass=1,n.idBlock.tagNumber=2;const o=Ct(n.toBER(!1));re.assert(o,"Integer"),this.inhibitPolicyMapping=o.result.valueBlock.valueDec}}toSchema(){const e=[];if(ys in this){const t=new z({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if(ws in this){const t=new z({value:this.inhibitPolicyMapping});t.idBlock.tagClass=3,t.idBlock.tagNumber=1,e.push(t)}return new R({value:e})}toJSON(){const e={};return ys in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),ws in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}return s.CLASS_NAME="PolicyConstraints",s})();const ja="issuerDomainPolicy",$a="subjectDomainPolicy",sp=[ja,$a];let Od=(()=>{class s extends he{constructor(e={}){super(),this.issuerDomainPolicy=h(e,ja,s.defaultValues(ja)),this.subjectDomainPolicy=h(e,$a,s.defaultValues($a)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ja:case $a:return S;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.issuerDomainPolicy||S}),new Oe({name:t.subjectDomainPolicy||S})]})}fromSchema(e){ge(e,sp);const t=ce(e,e,s.schema({names:{issuerDomainPolicy:ja,subjectDomainPolicy:$a}}));re.assertSchema(t,this.className),this.issuerDomainPolicy=t.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=t.result.subjectDomainPolicy.valueBlock.toString()}toSchema(){return new R({value:[new Oe({value:this.issuerDomainPolicy}),new Oe({value:this.subjectDomainPolicy})]})}toJSON(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}return s.CLASS_NAME="PolicyMapping",s})();const qa="mappings",rp=[qa];let np=(()=>{class s extends he{constructor(e={}){super(),this.mappings=h(e,qa,s.defaultValues(qa)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===qa?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.mappings||S,value:Od.schema()})]})}fromSchema(e){ge(e,rp);const t=ce(e,e,s.schema({names:{mappings:qa}}));re.assertSchema(t,this.className),this.mappings=Array.from(t.result.mappings,n=>new Od({schema:n}))}toSchema(){return new R({value:Array.from(this.mappings,e=>e.toSchema())})}toJSON(){return{mappings:Array.from(this.mappings,e=>e.toJSON())}}}return s.CLASS_NAME="PolicyMappings",s})();const Hs="notBefore",Js="notAfter",ip=[Hs,Js];let ap=(()=>{class s extends he{constructor(e={}){super(),Hs in e&&(this.notBefore=h(e,Hs,s.defaultValues(Hs))),Js in e&&(this.notAfter=h(e,Js,s.defaultValues(Js))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hs:case Js:return new Date;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Ue({name:t.notBefore||S,optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new Ue({name:t.notAfter||S,optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}fromSchema(e){ge(e,ip);const t=ce(e,e,s.schema({names:{notBefore:Hs,notAfter:Js}}));if(re.assertSchema(t,this.className),Hs in t.result){const n=new ht;n.fromBuffer(t.result.notBefore.valueBlock.valueHex),this.notBefore=n.toDate()}if(Js in t.result){const n=new ht({valueHex:t.result.notAfter.valueBlock.valueHex});n.fromBuffer(t.result.notAfter.valueBlock.valueHex),this.notAfter=n.toDate()}}toSchema(){const e=[];return Hs in this&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:0},valueHex:new ht({valueDate:this.notBefore}).valueBlock.valueHexView})),Js in this&&e.push(new Ue({idBlock:{tagClass:3,tagNumber:1},valueHex:new ht({valueDate:this.notAfter}).valueBlock.valueHexView})),new R({value:e})}toJSON(){const e={};return this.notBefore&&(e.notBefore=this.notBefore),this.notAfter&&(e.notAfter=this.notAfter),e}}return s.CLASS_NAME="PrivateKeyUsagePeriod",s})();const ri="id",Ss="type",ni="values",op=[ri,Ss],lp=[ni];let Vd=(()=>{class s extends he{constructor(e={}){super(),this.id=h(e,ri,s.defaultValues(ri)),Ss in e&&(this.type=h(e,Ss,s.defaultValues(Ss))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ri:return S;case Ss:return new _t;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ri:return t===S;case Ss:return t instanceof _t;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.id||S}),new He({name:t.type||S,optional:!0})]})}fromSchema(e){ge(e,op);const t=ce(e,e,s.schema({names:{id:ri,type:Ss}}));re.assertSchema(t,this.className),this.id=t.result.id.valueBlock.toString(),Ss in t.result&&(this.type=t.result.type)}toSchema(){const e=[new Oe({value:this.id})];return Ss in this&&e.push(this.type),new R({value:e})}toJSON(){const e={id:this.id};return this.type&&(e.type=this.type.toJSON()),e}}return s.CLASS_NAME="QCStatement",s})(),up=(()=>{class s extends he{constructor(e={}){super(),this.values=h(e,ni,s.defaultValues(ni)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===ni?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===ni?0===t.length:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.values||S,value:Vd.schema(t.value||{})})]})}fromSchema(e){ge(e,lp);const t=ce(e,e,s.schema({names:{values:ni}}));re.assertSchema(t,this.className),this.values=Array.from(t.result.values,n=>new Vd({schema:n}))}toSchema(){return new R({value:Array.from(this.values,e=>e.toSchema())})}toJSON(){return{values:Array.from(this.values,e=>e.toJSON())}}}return s.CLASS_NAME="QCStatements",s})();var Hr;class Ks{static register(i,e,t){this.namedCurves[i.toLowerCase()]=this.namedCurves[e]={name:i,id:e,size:t}}static find(i){return this.namedCurves[i.toLowerCase()]||null}}Hr=Ks,Ks.namedCurves={},Hr.register("P-256","1.2.840.10045.3.1.7",32),Hr.register("P-384","1.3.132.0.34",48),Hr.register("P-521","1.3.132.0.35",66),Hr.register("brainpoolP256r1","1.3.36.3.3.2.8.1.1.7",32),Hr.register("brainpoolP384r1","1.3.36.3.3.2.8.1.1.11",48),Hr.register("brainpoolP512r1","1.3.36.3.3.2.8.1.1.13",64);const su="namedCurve";let js=(()=>{class s extends he{constructor(e={}){super(),this.x=h(e,"x",s.defaultValues("x")),this.y=h(e,"y",s.defaultValues("y")),this.namedCurve=h(e,su,s.defaultValues(su)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case"x":case"y":return Tt;case su:return S;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"x":case"y":return t instanceof ArrayBuffer&&$n(t,s.defaultValues(e));case su:return"string"==typeof t&&t===s.defaultValues(e);default:return super.defaultValues(e)}}static schema(){return new Wl}fromSchema(e){const t=ye.vJ.toUint8Array(e);if(4!==t[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");const n=Ks.find(this.namedCurve);if(!n)throw new Error(`Incorrect curve OID: ${this.namedCurve}`);const a=n.size;if(t.byteLength!==2*a+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.namedCurve=n.name,this.x=t.slice(1,a+1).buffer,this.y=t.slice(1+a,2*a+1).buffer}toSchema(){return new Wl({data:jn(new Uint8Array([4]).buffer,this.x,this.y)})}toJSON(){const e=Ks.find(this.namedCurve);return{crv:e?e.name:this.namedCurve,x:dc($l(this.x),!0,!0,!1),y:dc($l(this.y),!0,!0,!1)}}fromJSON(e){it.assert("json",e,"crv","x","y");let t=0;const n=Ks.find(e.crv);n&&(this.namedCurve=n.id,t=n.size);const a=Cr(wa(e.x,!0));if(a.byteLength<t){this.x=new ArrayBuffer(t);const u=new Uint8Array(this.x),l=new Uint8Array(a);u.set(l,1)}else this.x=a.slice(0,t);const o=Cr(wa(e.y,!0));if(o.byteLength<t){this.y=new ArrayBuffer(t);const u=new Uint8Array(this.y),l=new Uint8Array(o);u.set(l,1)}else this.y=o.slice(0,t)}}return s.CLASS_NAME="ECPublicKey",s})();const Za="modulus",za="publicExponent",cp=[Za,za];let Pd=(()=>{class s extends he{constructor(e={}){super(),this.modulus=h(e,Za,s.defaultValues(Za)),this.publicExponent=h(e,za,s.defaultValues(za)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Za:case za:return new z;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.modulus||S}),new z({name:t.publicExponent||S})]})}fromSchema(e){ge(e,cp);const t=ce(e,e,s.schema({names:{modulus:Za,publicExponent:za}}));re.assertSchema(t,this.className),this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent}toSchema(){return new R({value:[this.modulus.convertToDER(),this.publicExponent]})}toJSON(){return{n:ye.ep.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ye.ep.ToBase64Url(this.publicExponent.valueBlock.valueHexView)}}fromJSON(e){it.assert("json",e,"n","e");const t=Cr(wa(e.n,!0));this.modulus=new z({valueHex:t.slice(0,Math.pow(2,Um(t.byteLength)))}),this.publicExponent=new z({valueHex:Cr(wa(e.e,!0)).slice(0,3)})}}return s.CLASS_NAME="RSAPublicKey",s})();const Ga="algorithm",Wa="subjectPublicKey",hp=[Ga,Wa];let hs=(()=>{class s extends he{constructor(e={}){super(),this.algorithm=h(e,Ga,s.defaultValues(Ga)),this.subjectPublicKey=h(e,Wa,s.defaultValues(Wa));const t=h(e,"parsedKey",null);t&&(this.parsedKey=t),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}get parsedKey(){if(void 0===this._parsedKey){switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":if("algorithmParams"in this.algorithm&&this.algorithm.algorithmParams.constructor.blockName()===Oe.blockName())try{this._parsedKey=new js({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHexView})}catch{}break;case"1.2.840.113549.1.1.1":{const e=Ct(this.subjectPublicKey.valueBlock.valueHexView);if(-1!==e.offset)try{this._parsedKey=new Pd({schema:e.result})}catch{}}}this._parsedKey||(this._parsedKey=null)}return this._parsedKey||void 0}set parsedKey(e){this._parsedKey=e}static defaultValues(e){switch(e){case Ga:return new G;case Wa:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.algorithm||{}),new et({name:t.subjectPublicKey||S})]})}fromSchema(e){ge(e,hp);const t=ce(e,e,s.schema({names:{algorithm:{names:{blockName:Ga}},subjectPublicKey:Wa}}));re.assertSchema(t,this.className),this.algorithm=new G({schema:t.result.algorithm}),this.subjectPublicKey=t.result.subjectPublicKey}toSchema(){return new R({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}toJSON(){if(!this.parsedKey)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};const e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new js({json:e}),this.algorithm=new G({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Oe({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Pd({json:e}),this.algorithm=new G({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new _t});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.subjectPublicKey=new et({valueHex:this.parsedKey.toSchema().toBER(!1)})}}importKey(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){try{if(!e)throw new Error("Need to provide publicKey input parameter");const o=Ct(yield t.exportKey("spki",e));try{n.fromSchema(o.result)}catch{throw new Error("Error during initializing object from schema")}}catch(a){const o=a instanceof Error?a.message:`${a}`;throw new Error(`Error during exporting public key: ${o}`)}})()}}return s.CLASS_NAME="PublicKeyInfo",s})();const ii="version",ai="privateKey",ns="namedCurve",$s="publicKey",fp=[ii,ai,ns,$s];let Dd=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,ii,s.defaultValues(ii)),this.privateKey=h(e,ai,s.defaultValues(ai)),ns in e&&(this.namedCurve=h(e,ns,s.defaultValues(ns))),$s in e&&(this.publicKey=h(e,$s,s.defaultValues($s))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ii:return 1;case ai:return new de;case ns:return S;case $s:return new js;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ii:return t===s.defaultValues(e);case ai:return t.isEqual(s.defaultValues(e));case ns:return t===S;case $s:return js.compareWithDefault(ns,t.namedCurve)&&js.compareWithDefault("x",t.x)&&js.compareWithDefault("y",t.y);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),new de({name:t.privateKey||S}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Oe({name:t.namedCurve||S})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new et({name:t.publicKey||S})]})]})}fromSchema(e){ge(e,fp);const t=ce(e,e,s.schema({names:{version:ii,privateKey:ai,namedCurve:ns,publicKey:$s}}));if(re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKey=t.result.privateKey,ns in t.result&&(this.namedCurve=t.result.namedCurve.valueBlock.toString()),$s in t.result){const n={schema:t.result.publicKey.valueBlock.valueHex};ns in this&&(n.namedCurve=this.namedCurve),this.publicKey=new js(n)}}toSchema(){const e=[new z({value:this.version}),this.privateKey];return this.namedCurve&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[new Oe({value:this.namedCurve})]})),this.publicKey&&e.push(new $({idBlock:{tagClass:3,tagNumber:1},value:[new et({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new R({value:e})}toJSON(){if(!this.namedCurve||s.compareWithDefault(ns,this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');const e=Ks.find(this.namedCurve),t={crv:e?e.name:this.namedCurve,d:ye.ep.ToBase64Url(this.privateKey.valueBlock.valueHexView)};if(this.publicKey){const n=this.publicKey.toJSON();t.x=n.x,t.y=n.y}return t}fromJSON(e){it.assert("json",e,"crv","d");let t=0;const n=Ks.find(e.crv);n&&(this.namedCurve=n.id,t=n.size);const a=ye.ep.FromBase64Url(e.d);if(a.byteLength<t){const o=new ArrayBuffer(t),u=new Uint8Array(o),l=new Uint8Array(a);u.set(l,1),this.privateKey=new de({valueHex:o})}else this.privateKey=new de({valueHex:a.slice(0,t)});e.x&&e.y&&(this.publicKey=new js({json:e}))}}return s.CLASS_NAME="ECPrivateKey",s})();const Ya="prime",Qa="exponent",Xa="coefficient",dp=[Ya,Qa,Xa];let Oc=(()=>{class s extends he{constructor(e={}){super(),this.prime=h(e,Ya,s.defaultValues(Ya)),this.exponent=h(e,Qa,s.defaultValues(Qa)),this.coefficient=h(e,Xa,s.defaultValues(Xa)),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ya:case Qa:case Xa:return new z;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.prime||S}),new z({name:t.exponent||S}),new z({name:t.coefficient||S})]})}fromSchema(e){ge(e,dp);const t=ce(e,e,s.schema({names:{prime:Ya,exponent:Qa,coefficient:Xa}}));re.assertSchema(t,this.className),this.prime=t.result.prime.convertFromDER(),this.exponent=t.result.exponent.convertFromDER(),this.coefficient=t.result.coefficient.convertFromDER()}toSchema(){return new R({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}toJSON(){return{r:ye.ep.ToBase64Url(this.prime.valueBlock.valueHexView),d:ye.ep.ToBase64Url(this.exponent.valueBlock.valueHexView),t:ye.ep.ToBase64Url(this.coefficient.valueBlock.valueHexView)}}fromJSON(e){it.assert("json",e,"r","d","r"),this.prime=new z({valueHex:ye.ep.FromBase64Url(e.r)}),this.exponent=new z({valueHex:ye.ep.FromBase64Url(e.d)}),this.coefficient=new z({valueHex:ye.ep.FromBase64Url(e.t)})}}return s.CLASS_NAME="OtherPrimeInfo",s})();const eo="version",to="modulus",so="publicExponent",ro="privateExponent",no="prime1",io="prime2",ao="exponent1",oo="exponent2",lo="coefficient",Jr="otherPrimeInfos",mp=[eo,to,so,ro,no,io,ao,oo,lo,Jr];let Ud=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,eo,s.defaultValues(eo)),this.modulus=h(e,to,s.defaultValues(to)),this.publicExponent=h(e,so,s.defaultValues(so)),this.privateExponent=h(e,ro,s.defaultValues(ro)),this.prime1=h(e,no,s.defaultValues(no)),this.prime2=h(e,io,s.defaultValues(io)),this.exponent1=h(e,ao,s.defaultValues(ao)),this.exponent2=h(e,oo,s.defaultValues(oo)),this.coefficient=h(e,lo,s.defaultValues(lo)),Jr in e&&(this.otherPrimeInfos=h(e,Jr,s.defaultValues(Jr))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case eo:return 0;case to:case so:case ro:case no:case io:case ao:case oo:case lo:return new z;case Jr:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),new z({name:t.modulus||S}),new z({name:t.publicExponent||S}),new z({name:t.privateExponent||S}),new z({name:t.prime1||S}),new z({name:t.prime2||S}),new z({name:t.exponent1||S}),new z({name:t.exponent2||S}),new z({name:t.coefficient||S}),new R({optional:!0,value:[new ze({name:t.otherPrimeInfosName||S,value:Oc.schema(t.otherPrimeInfo||{})})]})]})}fromSchema(e){ge(e,mp);const t=ce(e,e,s.schema({names:{version:eo,modulus:to,publicExponent:so,privateExponent:ro,prime1:no,prime2:io,exponent1:ao,exponent2:oo,coefficient:lo,otherPrimeInfo:{names:{blockName:Jr}}}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.modulus=t.result.modulus.convertFromDER(256),this.publicExponent=t.result.publicExponent,this.privateExponent=t.result.privateExponent.convertFromDER(256),this.prime1=t.result.prime1.convertFromDER(128),this.prime2=t.result.prime2.convertFromDER(128),this.exponent1=t.result.exponent1.convertFromDER(128),this.exponent2=t.result.exponent2.convertFromDER(128),this.coefficient=t.result.coefficient.convertFromDER(128),Jr in t.result&&(this.otherPrimeInfos=Array.from(t.result.otherPrimeInfos,n=>new Oc({schema:n})))}toSchema(){const e=[];return e.push(new z({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),this.otherPrimeInfos&&e.push(new R({value:Array.from(this.otherPrimeInfos,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={n:ye.ep.ToBase64Url(this.modulus.valueBlock.valueHexView),e:ye.ep.ToBase64Url(this.publicExponent.valueBlock.valueHexView),d:ye.ep.ToBase64Url(this.privateExponent.valueBlock.valueHexView),p:ye.ep.ToBase64Url(this.prime1.valueBlock.valueHexView),q:ye.ep.ToBase64Url(this.prime2.valueBlock.valueHexView),dp:ye.ep.ToBase64Url(this.exponent1.valueBlock.valueHexView),dq:ye.ep.ToBase64Url(this.exponent2.valueBlock.valueHexView),qi:ye.ep.ToBase64Url(this.coefficient.valueBlock.valueHexView)};return this.otherPrimeInfos&&(e.oth=Array.from(this.otherPrimeInfos,t=>t.toJSON())),e}fromJSON(e){it.assert("json",e,"n","e","d","p","q","dp","dq","qi"),this.modulus=new z({valueHex:ye.ep.FromBase64Url(e.n)}),this.publicExponent=new z({valueHex:ye.ep.FromBase64Url(e.e)}),this.privateExponent=new z({valueHex:ye.ep.FromBase64Url(e.d)}),this.prime1=new z({valueHex:ye.ep.FromBase64Url(e.p)}),this.prime2=new z({valueHex:ye.ep.FromBase64Url(e.q)}),this.exponent1=new z({valueHex:ye.ep.FromBase64Url(e.dp)}),this.exponent2=new z({valueHex:ye.ep.FromBase64Url(e.dq)}),this.coefficient=new z({valueHex:ye.ep.FromBase64Url(e.qi)}),e.oth&&(this.otherPrimeInfos=Array.from(e.oth,t=>new Oc({json:t})))}}return s.CLASS_NAME="RSAPrivateKey",s})();const uo="version",co="privateKeyAlgorithm",ho="privateKey",Kr="attributes",ru="parsedKey",gp=[uo,co,ho,Kr];let fo=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,uo,s.defaultValues(uo)),this.privateKeyAlgorithm=h(e,co,s.defaultValues(co)),this.privateKey=h(e,ho,s.defaultValues(ho)),Kr in e&&(this.attributes=h(e,Kr,s.defaultValues(Kr))),ru in e&&(this.parsedKey=h(e,ru,s.defaultValues(ru))),e.json&&this.fromJSON(e.json),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case uo:return 0;case co:return new G;case ho:return new de;case Kr:return[];case ru:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),G.schema(t.privateKeyAlgorithm||{}),new de({name:t.privateKey||S}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ze({name:t.attributes||S,value:at.schema()})]})]})}fromSchema(e){ge(e,gp);const t=ce(e,e,s.schema({names:{version:uo,privateKeyAlgorithm:{names:{blockName:co}},privateKey:ho,attributes:Kr}}));switch(re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new G({schema:t.result.privateKeyAlgorithm}),this.privateKey=t.result.privateKey,Kr in t.result&&(this.attributes=Array.from(t.result.attributes,n=>new at({schema:n}))),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":{const n=Ct(this.privateKey.valueBlock.valueHexView);-1!==n.offset&&(this.parsedKey=new Ud({schema:n.result}))}break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof Oe){const n=Ct(this.privateKey.valueBlock.valueHexView);-1!==n.offset&&(this.parsedKey=new Dd({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:n.result}))}}}toSchema(){const e=[new z({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return this.attributes&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,t=>t.toSchema())})),new R({value:e})}toJSON(){if(!this.parsedKey){const n={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return this.attributes&&(n.attributes=Array.from(this.attributes,a=>a.toJSON())),n}const e={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}const t=this.parsedKey.toJSON();return Object.assign(e,t),e}fromJSON(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Dd({json:e}),this.privateKeyAlgorithm=new G({algorithmId:"1.2.840.10045.2.1",algorithmParams:new Oe({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new Ud({json:e}),this.privateKeyAlgorithm=new G({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new _t});break;default:throw new Error(`Invalid value for "kty" parameter: ${e.kty}`)}this.privateKey=new de({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}return s.CLASS_NAME="PrivateKeyInfo",s})();const oi="contentType",li="contentEncryptionAlgorithm",jr="encryptedContent",pp=[oi,li,jr];let Ut=(()=>{class s extends he{constructor(e={}){if(super(),this.contentType=h(e,oi,s.defaultValues(oi)),this.contentEncryptionAlgorithm=h(e,li,s.defaultValues(li)),jr in e&&e.encryptedContent&&(this.encryptedContent=e.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed&&!e.disableSplit)){const t=new de({idBlock:{isConstructed:!0},isConstructed:!0});let n=0;const a=this.encryptedContent.valueBlock.valueHexView.slice().buffer;let o=a.byteLength;for(;o>0;){const u=new Uint8Array(a,n,n+1024>a.byteLength?a.byteLength-n:1024),l=new ArrayBuffer(u.length),m=new Uint8Array(l);for(let k=0;k<m.length;k++)m[k]=u[k];t.valueBlock.value.push(new de({valueHex:l})),o-=u.length,n+=u.length}this.encryptedContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case oi:return S;case li:return new G;case jr:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case oi:return t===S;case li:return t.algorithmId===S&&!("algorithmParams"in t);case jr:return t.isEqual(s.defaultValues(jr));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.contentType||S}),G.schema(t.contentEncryptionAlgorithm||{}),new ft({value:[new $({name:t.encryptedContent||S,idBlock:{tagClass:3,tagNumber:0},value:[new ze({value:new de})]}),new Ue({name:t.encryptedContent||S,idBlock:{tagClass:3,tagNumber:0}})]})]})}fromSchema(e){ge(e,pp);const t=ce(e,e,s.schema({names:{contentType:oi,contentEncryptionAlgorithm:{names:{blockName:li}},encryptedContent:jr}}));re.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new G({schema:t.result.contentEncryptionAlgorithm}),jr in t.result&&(this.encryptedContent=t.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}toSchema(){const e={isIndefiniteForm:!1},t=[];if(t.push(new Oe({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),this.encryptedContent){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;const n=this.encryptedContent;n.idBlock.tagClass=3,n.idBlock.tagNumber=0,n.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(n)}return new R({lenBlock:e,value:t})}toJSON(){const e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return this.encryptedContent&&(e.encryptedContent=this.encryptedContent.toJSON()),e}getEncryptedContent(){if(!this.encryptedContent)throw new Error("Parameter 'encryptedContent' is undefined");return de.prototype.getValue.call(this.encryptedContent)}}return s.CLASS_NAME="EncryptedContentInfo",s})();const qs="hashAlgorithm",Zs="maskGenAlgorithm",zs="saltLength",Gs="trailerField",vp=[qs,Zs,zs,Gs];let Vc=(()=>{class s extends he{constructor(e={}){super(),this.hashAlgorithm=h(e,qs,s.defaultValues(qs)),this.maskGenAlgorithm=h(e,Zs,s.defaultValues(Zs)),this.saltLength=h(e,zs,s.defaultValues(zs)),this.trailerField=h(e,Gs,s.defaultValues(Gs)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case qs:return new G({algorithmId:"1.3.14.3.2.26",algorithmParams:new _t});case Zs:return new G({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new G({algorithmId:"1.3.14.3.2.26",algorithmParams:new _t}).toSchema()});case zs:return 20;case Gs:return 1;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new $({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[G.schema(t.hashAlgorithm||{})]}),new $({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[G.schema(t.maskGenAlgorithm||{})]}),new $({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new z({name:t.saltLength||S})]}),new $({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new z({name:t.trailerField||S})]})]})}fromSchema(e){ge(e,vp);const t=ce(e,e,s.schema({names:{hashAlgorithm:{names:{blockName:qs}},maskGenAlgorithm:{names:{blockName:Zs}},saltLength:zs,trailerField:Gs}}));re.assertSchema(t,this.className),qs in t.result&&(this.hashAlgorithm=new G({schema:t.result.hashAlgorithm})),Zs in t.result&&(this.maskGenAlgorithm=new G({schema:t.result.maskGenAlgorithm})),zs in t.result&&(this.saltLength=t.result.saltLength.valueBlock.valueDec),Gs in t.result&&(this.trailerField=t.result.trailerField.valueBlock.valueDec)}toSchema(){const e=[];return this.hashAlgorithm.isEqual(s.defaultValues(qs))||e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(s.defaultValues(Zs))||e.push(new $({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==s.defaultValues(zs)&&e.push(new $({idBlock:{tagClass:3,tagNumber:2},value:[new z({value:this.saltLength})]})),this.trailerField!==s.defaultValues(Gs)&&e.push(new $({idBlock:{tagClass:3,tagNumber:3},value:[new z({value:this.trailerField})]})),new R({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(s.defaultValues(qs))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(s.defaultValues(Zs))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==s.defaultValues(zs)&&(e.saltLength=this.saltLength),this.trailerField!==s.defaultValues(Gs)&&(e.trailerField=this.trailerField),e}}return s.CLASS_NAME="RSASSAPSSParams",s})();const ui="salt",mo="iterationCount",is="keyLength",_s="prf",yp=[ui,mo,is,_s];let go=(()=>{class s extends he{constructor(e={}){super(),this.salt=h(e,ui,s.defaultValues(ui)),this.iterationCount=h(e,mo,s.defaultValues(mo)),is in e&&(this.keyLength=h(e,is,s.defaultValues(is))),_s in e&&(this.prf=h(e,_s,s.defaultValues(_s))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ui:return{};case mo:return-1;case is:return 0;case _s:return new G({algorithmId:"1.3.14.3.2.26",algorithmParams:new _t});default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ft({value:[new de({name:t.saltPrimitive||S}),G.schema(t.saltConstructed||{})]}),new z({name:t.iterationCount||S}),new z({name:t.keyLength||S,optional:!0}),G.schema(t.prf||{names:{optional:!0}})]})}fromSchema(e){ge(e,yp);const t=ce(e,e,s.schema({names:{saltPrimitive:ui,saltConstructed:{names:{blockName:ui}},iterationCount:mo,keyLength:is,prf:{names:{blockName:_s,optional:!0}}}}));re.assertSchema(t,this.className),this.salt=t.result.salt,this.iterationCount=t.result.iterationCount.valueBlock.valueDec,is in t.result&&(this.keyLength=t.result.keyLength.valueBlock.valueDec),_s in t.result&&(this.prf=new G({schema:t.result.prf}))}toSchema(){const e=[];return e.push(this.salt),e.push(new z({value:this.iterationCount})),is in this&&s.defaultValues(is)!==this.keyLength&&e.push(new z({value:this.keyLength})),this.prf&&!1===s.defaultValues(_s).isEqual(this.prf)&&e.push(this.prf.toSchema()),new R({value:e})}toJSON(){const e={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return is in this&&s.defaultValues(is)!==this.keyLength&&(e.keyLength=this.keyLength),this.prf&&!1===s.defaultValues(_s).isEqual(this.prf)&&(e.prf=this.prf.toJSON()),e}}return s.CLASS_NAME="PBKDF2Params",s})();const po="keyDerivationFunc",vo="encryptionScheme",wp=[po,vo];let Md=(()=>{class s extends he{constructor(e={}){super(),this.keyDerivationFunc=h(e,po,s.defaultValues(po)),this.encryptionScheme=h(e,vo,s.defaultValues(vo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case po:case vo:return new G;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.keyDerivationFunc||{}),G.schema(t.encryptionScheme||{})]})}fromSchema(e){ge(e,wp);const t=ce(e,e,s.schema({names:{keyDerivationFunc:{names:{blockName:po}},encryptionScheme:{names:{blockName:vo}}}}));re.assertSchema(t,this.className),this.keyDerivationFunc=new G({schema:t.result.keyDerivationFunc}),this.encryptionScheme=new G({schema:t.result.encryptionScheme})}toSchema(){return new R({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}toJSON(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}return s.CLASS_NAME="PBES2Params",s})();function Fd(s,i,e,t,n,a){return Pc.apply(this,arguments)}function Pc(){return(Pc=(0,Ce.Z)(function*(s,i,e,t,n,a){let o,u;const l=[];switch(i.toUpperCase()){case"SHA-1":o=20,u=64;break;case"SHA-256":o=32,u=64;break;case"SHA-384":o=48,u=128;break;case"SHA-512":o=64,u=128;break;default:throw new Error("Unsupported hashing algorithm")}const m=new Uint8Array(t),k=new ArrayBuffer(2*t.byteLength+2),B=new Uint8Array(k);for(let je=0;je<m.length;je++)B[2*je]=0,B[2*je+1]=m[je];B[B.length-2]=0,B[B.length-1]=0,t=k.slice(0);const F=new ArrayBuffer(u),V=new Uint8Array(F);for(let je=0;je<F.byteLength;je++)V[je]=3;const le=n.byteLength,ve=u*Math.ceil(le/u),W=new ArrayBuffer(ve),q=new Uint8Array(W),ne=new Uint8Array(n);for(let je=0;je<ve;je++)q[je]=ne[je%le];const ae=t.byteLength,fe=u*Math.ceil(ae/u),ke=new ArrayBuffer(fe),be=new Uint8Array(ke),Ie=new Uint8Array(t);for(let je=0;je<fe;je++)be[je]=Ie[je%ae];let qe=new ArrayBuffer(W.byteLength+ke.byteLength),tt=new Uint8Array(qe);tt.set(q),tt.set(be,q.length);const Bt=Math.ceil((e>>3)/o);let Ye=Promise.resolve(qe);for(let je=0;je<=Bt;je++){Ye=Ye.then(Nt=>{const kt=new ArrayBuffer(F.byteLength+Nt.byteLength),Gt=new Uint8Array(kt);return Gt.set(V),Gt.set(tt,V.length),kt});for(let Nt=0;Nt<a;Nt++)Ye=Ye.then(kt=>s.digest({name:i},new Uint8Array(kt)));Ye=Ye.then(Nt=>{const kt=new ArrayBuffer(u),Gt=new Uint8Array(kt);for(let xe=0;xe<kt.byteLength;xe++)Gt[xe]=Nt[xe%Nt.byteLength];const ls=Math.ceil(le/u)+Math.ceil(ae/u),Dt=[];let rt=0,nt=u;for(let xe=0;xe<ls;xe++){const Le=Array.from(new Uint8Array(qe.slice(rt,rt+nt)));rt+=u,rt+u>qe.byteLength&&(nt=qe.byteLength-rt);let Re=511;for(let Ze=kt.byteLength-1;Ze>=0;Ze--)Re>>=8,Re+=Gt[Ze]+Le[Ze],Le[Ze]=255&Re;Dt.push(...Le)}return qe=new ArrayBuffer(Dt.length),tt=new Uint8Array(qe),tt.set(Dt),l.push(...new Uint8Array(Nt)),qe})}return Ye=Ye.then(()=>{const je=new ArrayBuffer(e>>3);return new Uint8Array(je).set(new Uint8Array(l).slice(0,e>>3)),je}),Ye})).apply(this,arguments)}function Hd(s){const i="string"==typeof s?{name:s}:s;return"hash"in i?{...i,hash:Hd(i.hash)}:i}class nu extends class Sp{constructor(i){this.crypto=i.crypto,this.subtle="webkitSubtle"in i.crypto?i.crypto.webkitSubtle:i.crypto.subtle,this.name=h(i,"name",S)}encrypt(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.encrypt(...i)})()}decrypt(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.decrypt(...i)})()}sign(...i){return this.subtle.sign(...i)}verify(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.verify(...i)})()}digest(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.digest(...i)})()}generateKey(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.generateKey(...i)})()}deriveKey(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.deriveKey(...i)})()}deriveBits(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.deriveBits(...i)})()}wrapKey(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.wrapKey(...i)})()}unwrapKey(...i){var e=this;return(0,Ce.Z)(function*(){return e.subtle.unwrapKey(...i)})()}exportKey(...i){return this.subtle.exportKey(...i)}importKey(...i){return this.subtle.importKey(...i)}getRandomValues(i){return this.crypto.getRandomValues(i)}}{importKey(i,e,t,n,a){var o=this;return(0,Ce.Z)(function*(){var u,l,m,k,B,F;let V={};const le=Hd(t);switch(i.toLowerCase()){case"raw":return o.subtle.importKey("raw",e,t,n,a);case"spki":{const ve=Ct(ye.vJ.toArrayBuffer(e));re.assert(ve,"keyData");const W=new hs;try{W.fromSchema(ve.result)}catch{throw new ct("Incorrect keyData")}switch(le.name.toUpperCase()){case"RSA-PSS":if(!le.hash)throw new it("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(le.hash.name.toUpperCase()){case"SHA-1":V.alg="PS1";break;case"SHA-256":V.alg="PS256";break;case"SHA-384":V.alg="PS384";break;case"SHA-512":V.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${le.hash.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(a=["verify"],V.kty="RSA",V.ext=n,V.key_ops=a,"1.2.840.113549.1.1.1"!==W.algorithm.algorithmId)throw new Error(`Incorrect public key algorithm: ${W.algorithm.algorithmId}`);if(!V.alg){if(!le.hash)throw new it("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(le.hash.name.toUpperCase()){case"SHA-1":V.alg="RS1";break;case"SHA-256":V.alg="RS256";break;case"SHA-384":V.alg="RS384";break;case"SHA-512":V.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${le.hash.name.toUpperCase()}`)}}const q=W.toJSON();Object.assign(V,q)}break;case"ECDSA":a=["verify"];case"ECDH":{if(V={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==W.algorithm.algorithmId)throw new Error(`Incorrect public key algorithm: ${W.algorithm.algorithmId}`);const q=W.toJSON();Object.assign(V,q)}break;case"RSA-OAEP":{if(V.kty="RSA",V.ext=n,V.key_ops=a,"safari"===o.name.toLowerCase())V.alg="RSA-OAEP";else{if(!le.hash)throw new it("hash","algorithm.hash","Incorrect hash algorithm: Hash algorithm is missed");switch(le.hash.name.toUpperCase()){case"SHA-1":V.alg="RSA-OAEP";break;case"SHA-256":V.alg="RSA-OAEP-256";break;case"SHA-384":V.alg="RSA-OAEP-384";break;case"SHA-512":V.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${le.hash.name.toUpperCase()}`)}}const q=W.toJSON();Object.assign(V,q)}break;case"RSAES-PKCS1-V1_5":{V.kty="RSA",V.ext=n,V.key_ops=a,V.alg="PS1";const q=W.toJSON();Object.assign(V,q)}break;default:throw new Error(`Incorrect algorithm name: ${le.name.toUpperCase()}`)}}break;case"pkcs8":{const ve=new fo,W=Ct(ye.vJ.toArrayBuffer(e));re.assert(W,"keyData");try{ve.fromSchema(W.result)}catch{throw new Error("Incorrect keyData")}if(!ve.parsedKey)throw new Error("Incorrect keyData");switch(le.name.toUpperCase()){case"RSA-PSS":switch(null===(u=le.hash)||void 0===u?void 0:u.name.toUpperCase()){case"SHA-1":V.alg="PS1";break;case"SHA-256":V.alg="PS256";break;case"SHA-384":V.alg="PS384";break;case"SHA-512":V.alg="PS512";break;default:throw new Error(`Incorrect hash algorithm: ${null===(l=le.hash)||void 0===l?void 0:l.name.toUpperCase()}`)}case"RSASSA-PKCS1-V1_5":{if(a=["sign"],V.kty="RSA",V.ext=n,V.key_ops=a,"1.2.840.113549.1.1.1"!==ve.privateKeyAlgorithm.algorithmId)throw new Error(`Incorrect private key algorithm: ${ve.privateKeyAlgorithm.algorithmId}`);if(!("alg"in V))switch(null===(m=le.hash)||void 0===m?void 0:m.name.toUpperCase()){case"SHA-1":V.alg="RS1";break;case"SHA-256":V.alg="RS256";break;case"SHA-384":V.alg="RS384";break;case"SHA-512":V.alg="RS512";break;default:throw new Error(`Incorrect hash algorithm: ${null===(k=le.hash)||void 0===k?void 0:k.name.toUpperCase()}`)}const q=ve.toJSON();Object.assign(V,q)}break;case"ECDSA":a=["sign"];case"ECDH":{if(V={kty:"EC",ext:n,key_ops:a},"1.2.840.10045.2.1"!==ve.privateKeyAlgorithm.algorithmId)throw new Error(`Incorrect algorithm: ${ve.privateKeyAlgorithm.algorithmId}`);const q=ve.toJSON();Object.assign(V,q)}break;case"RSA-OAEP":{if(V.kty="RSA",V.ext=n,V.key_ops=a,"safari"===o.name.toLowerCase())V.alg="RSA-OAEP";else switch(null===(B=le.hash)||void 0===B?void 0:B.name.toUpperCase()){case"SHA-1":V.alg="RSA-OAEP";break;case"SHA-256":V.alg="RSA-OAEP-256";break;case"SHA-384":V.alg="RSA-OAEP-384";break;case"SHA-512":V.alg="RSA-OAEP-512";break;default:throw new Error(`Incorrect hash algorithm: ${null===(F=le.hash)||void 0===F?void 0:F.name.toUpperCase()}`)}const q=ve.toJSON();Object.assign(V,q)}break;case"RSAES-PKCS1-V1_5":{a=["decrypt"],V.kty="RSA",V.ext=n,V.key_ops=a,V.alg="PS1";const q=ve.toJSON();Object.assign(V,q)}break;default:throw new Error(`Incorrect algorithm name: ${le.name.toUpperCase()}`)}}break;case"jwk":V=e;break;default:throw new Error(`Incorrect format: ${i}`)}if("safari"===o.name.toLowerCase())try{return o.subtle.importKey("jwk",Cr(JSON.stringify(V)),t,n,a)}catch{return o.subtle.importKey("jwk",V,t,n,a)}return o.subtle.importKey("jwk",V,t,n,a)})()}exportKey(i,e){var t=this;return(0,Ce.Z)(function*(){let n=yield t.subtle.exportKey("jwk",e);switch("safari"===t.name.toLowerCase()&&n instanceof ArrayBuffer&&(n=JSON.parse($l(n))),i.toLowerCase()){case"raw":return t.subtle.exportKey("raw",e);case"spki":{const a=new hs;try{a.fromJSON(n)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"pkcs8":{const a=new fo;try{a.fromJSON(n)}catch{throw new Error("Incorrect key data")}return a.toSchema().toBER(!1)}case"jwk":return n;default:throw new Error(`Incorrect format: ${i}`)}})()}convert(i,e,t,n,a,o){var u=this;return(0,Ce.Z)(function*(){if(i.toLowerCase()===e.toLowerCase())return t;const l=yield u.importKey(i,t,n,a,o);return u.exportKey(e,l)})()}getAlgorithmByOID(i,e=!1,t){switch(i){case"1.2.840.113549.1.1.1":return{name:"RSAES-PKCS1-v1_5"};case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}if(e)throw new Error(`Unsupported algorithm identifier ${t?`for ${t} `:S}: ${i}`);return{}}getOIDByAlgorithm(i,e=!1,t){let n=S;switch(i.name.toUpperCase()){case"RSAES-PKCS1-V1_5":n="1.2.840.113549.1.1.1";break;case"RSASSA-PKCS1-V1_5":switch(i.hash.name.toUpperCase()){case"SHA-1":n="1.2.840.113549.1.1.5";break;case"SHA-256":n="1.2.840.113549.1.1.11";break;case"SHA-384":n="1.2.840.113549.1.1.12";break;case"SHA-512":n="1.2.840.113549.1.1.13"}break;case"RSA-PSS":n="1.2.840.113549.1.1.10";break;case"RSA-OAEP":n="1.2.840.113549.1.1.7";break;case"ECDSA":switch(i.hash.name.toUpperCase()){case"SHA-1":n="1.2.840.10045.4.1";break;case"SHA-256":n="1.2.840.10045.4.3.2";break;case"SHA-384":n="1.2.840.10045.4.3.3";break;case"SHA-512":n="1.2.840.10045.4.3.4"}break;case"ECDH":switch(i.kdf.toUpperCase()){case"SHA-1":n="1.3.133.16.840.63.0.2";break;case"SHA-256":n="1.3.132.1.11.1";break;case"SHA-384":n="1.3.132.1.11.2";break;case"SHA-512":n="1.3.132.1.11.3"}break;case"AES-CTR":case"AES-CMAC":case"CONCAT":case"HKDF":break;case"AES-CBC":switch(i.length){case 128:n="2.16.840.1.101.3.4.1.2";break;case 192:n="2.16.840.1.101.3.4.1.22";break;case 256:n="2.16.840.1.101.3.4.1.42"}break;case"AES-GCM":switch(i.length){case 128:n="2.16.840.1.101.3.4.1.6";break;case 192:n="2.16.840.1.101.3.4.1.26";break;case 256:n="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(i.length){case 128:n="2.16.840.1.101.3.4.1.4";break;case 192:n="2.16.840.1.101.3.4.1.24";break;case 256:n="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(i.length){case 128:n="2.16.840.1.101.3.4.1.5";break;case 192:n="2.16.840.1.101.3.4.1.25";break;case 256:n="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(i.hash.name.toUpperCase()){case"SHA-1":n="1.2.840.113549.2.7";break;case"SHA-256":n="1.2.840.113549.2.9";break;case"SHA-384":n="1.2.840.113549.2.10";break;case"SHA-512":n="1.2.840.113549.2.11"}break;case"DH":n="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":n="1.3.14.3.2.26";break;case"SHA-256":n="2.16.840.1.101.3.4.2.1";break;case"SHA-384":n="2.16.840.1.101.3.4.2.2";break;case"SHA-512":n="2.16.840.1.101.3.4.2.3";break;case"PBKDF2":n="1.2.840.113549.1.5.12";break;case"P-256":n="1.2.840.10045.3.1.7";break;case"P-384":n="1.3.132.0.34";break;case"P-521":n="1.3.132.0.35"}if(!n&&e)throw new Error(`Unsupported algorithm ${t?`for ${t} `:S}: ${i.name}`);return n}getAlgorithmParameters(i,e){let t={algorithm:{},usages:[]};switch(i.toUpperCase()){case"RSAES-PKCS1-V1_5":case"RSASSA-PKCS1-V1_5":switch(e.toLowerCase()){case"generatekey":t={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":t={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(e.toLowerCase()){case"sign":case"verify":t={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":t={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":t={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(e.toLowerCase()){case"encrypt":case"decrypt":t={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":t={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":t={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(e.toLowerCase()){case"generatekey":t={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":t={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":t={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(e.toLowerCase()){case"exportkey":case"importkey":case"generatekey":t={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":t={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(e.toLowerCase()){case"importkey":case"exportkey":case"generatekey":t={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":t={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(e.toLowerCase()){case"importkey":case"exportkey":case"generatekey":t={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":t={algorithm:{name:"AES-CBC",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(e.toLowerCase()){case"importkey":case"exportkey":case"generatekey":t={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":t={algorithm:{name:"AES-GCM",iv:this.getRandomValues(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(e.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":t={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(e.toLowerCase()){case"sign":case"verify":t={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":t={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":if("derivekey"!==e.toLowerCase())return{algorithm:{name:"HKDF"},usages:[]};t={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;case"PBKDF2":if("derivekey"!==e.toLowerCase())return{algorithm:{name:"PBKDF2"},usages:[]};t={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e4},usages:["encrypt","decrypt"]}}return t}getHashAlgorithm(i){let e=S;switch(i.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":e="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":e="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":e="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":e="SHA-512";break;case"1.2.840.113549.1.1.10":try{const t=new Vc({schema:i.algorithmParams});if(t.hashAlgorithm){const n=this.getAlgorithmByOID(t.hashAlgorithm.algorithmId);if(!("name"in n))return S;e=n.name}else e="SHA-1"}catch{}}return e}encryptEncryptedContentInfo(i){var e=this;return(0,Ce.Z)(function*(){it.assert(i,"password","contentEncryptionAlgorithm","hmacHashAlgorithm","iterationCount","contentToEncrypt","contentToEncrypt","contentType");const t=e.getOIDByAlgorithm(i.contentEncryptionAlgorithm,!0,"contentEncryptionAlgorithm"),n=e.getOIDByAlgorithm({name:"PBKDF2"},!0,"PBKDF2"),a=e.getOIDByAlgorithm({name:"HMAC",hash:{name:i.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),o=new ArrayBuffer(16),u=new Uint8Array(o);e.getRandomValues(u);const l=new ArrayBuffer(64),m=new Uint8Array(l);e.getRandomValues(m);const k=new Uint8Array(i.contentToEncrypt),B=new go({salt:new de({valueHex:l}),iterationCount:i.iterationCount,prf:new G({algorithmId:a,algorithmParams:new _t})}),F=new Uint8Array(i.password),V=yield e.importKey("raw",F,"PBKDF2",!1,["deriveKey"]),le=yield e.deriveKey({name:"PBKDF2",hash:{name:i.hmacHashAlgorithm},salt:m,iterations:i.iterationCount},V,i.contentEncryptionAlgorithm,!1,["encrypt"]),ve=yield e.encrypt({name:i.contentEncryptionAlgorithm.name,iv:u},le,k),W=new Md({keyDerivationFunc:new G({algorithmId:n,algorithmParams:B.toSchema()}),encryptionScheme:new G({algorithmId:t,algorithmParams:new de({valueHex:o})})});return new Ut({contentType:i.contentType,contentEncryptionAlgorithm:new G({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:W.toSchema()}),encryptedContent:new de({valueHex:ve})})})()}decryptEncryptedContentInfo(i){var e=this;return(0,Ce.Z)(function*(){if(it.assert(i,"password","encryptedContentInfo"),"1.2.840.113549.1.5.13"!==i.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)throw new Error(`Unknown "contentEncryptionAlgorithm": ${i.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId}`);let t,n;try{t=new Md({schema:i.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbes2Parameters"')}try{n=new go({schema:t.keyDerivationFunc.algorithmParams})}catch{throw new Error('Incorrectly encoded "pbkdf2Params"')}const a=e.getAlgorithmByOID(t.encryptionScheme.algorithmId,!0),u=new Uint8Array(t.encryptionScheme.algorithmParams.valueBlock.valueHex),m=new Uint8Array(n.salt.valueBlock.valueHex),k=n.iterationCount;let B="SHA-1";n.prf&&(B=e.getAlgorithmByOID(n.prf.algorithmId,!0).hash.name);const F=yield e.importKey("raw",i.password,"PBKDF2",!1,["deriveKey"]),V=yield e.deriveKey({name:"PBKDF2",hash:{name:B},salt:m,iterations:k},F,a,!1,["decrypt"]),le=i.encryptedContentInfo.getEncryptedContent();return e.decrypt({name:a.name,iv:u},V,le)})()}stampDataWithPassword(i){var e=this;return(0,Ce.Z)(function*(){if(!(i instanceof Object))throw new Error('Parameters must have type "Object"');let t;switch(it.assert(i,"password","hashAlgorithm","iterationCount","salt","contentToStamp"),i.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${i.hashAlgorithm}`)}const n={name:"HMAC",length:t,hash:{name:i.hashAlgorithm}},a=yield Fd(e,i.hashAlgorithm,t,i.password,i.salt,i.iterationCount),o=yield e.importKey("raw",new Uint8Array(a),n,!1,["sign"]);return e.sign(n,o,new Uint8Array(i.contentToStamp))})()}verifyDataStampedWithPassword(i){var e=this;return(0,Ce.Z)(function*(){it.assert(i,"password","hashAlgorithm","salt","iterationCount","contentToVerify","signatureToVerify");let t=0;switch(i.hashAlgorithm.toLowerCase()){case"sha-1":t=160;break;case"sha-256":t=256;break;case"sha-384":t=384;break;case"sha-512":t=512;break;default:throw new Error(`Incorrect "parameters.hashAlgorithm" parameter: ${i.hashAlgorithm}`)}const n={name:"HMAC",length:t,hash:{name:i.hashAlgorithm}},a=yield Fd(e,i.hashAlgorithm,t,i.password,i.salt,i.iterationCount),o=yield e.importKey("raw",new Uint8Array(a),n,!1,["verify"]);return e.verify(n,o,new Uint8Array(i.signatureToVerify),new Uint8Array(i.contentToVerify))})()}getSignatureParameters(i,e="SHA-1"){var t=this;return(0,Ce.Z)(function*(){t.getOIDByAlgorithm({name:e},!0,"hashAlgorithm");const n=new G,a=t.getAlgorithmParameters(i.algorithm.name,"sign");if(!Object.keys(a.algorithm).length)throw new Error("Parameter 'algorithm' is empty");const o=a.algorithm;switch(o.hash.name=e,i.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":n.algorithmId=t.getOIDByAlgorithm(o,!0);break;case"RSA-PSS":{switch(e.toUpperCase()){case"SHA-256":o.saltLength=32;break;case"SHA-384":o.saltLength=48;break;case"SHA-512":o.saltLength=64}const u={};if("SHA-1"!==e.toUpperCase()){const m=t.getOIDByAlgorithm({name:e},!0,"hashAlgorithm");u.hashAlgorithm=new G({algorithmId:m,algorithmParams:new _t}),u.maskGenAlgorithm=new G({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:u.hashAlgorithm.toSchema()})}20!==o.saltLength&&(u.saltLength=o.saltLength);const l=new Vc(u);n.algorithmId="1.2.840.113549.1.1.10",n.algorithmParams=l.toSchema()}break;default:throw new Error(`Unsupported signature algorithm: ${i.algorithm.name}`)}return{signatureAlgorithm:n,parameters:a}})()}signWithPrivateKey(i,e,t){var n=this;return(0,Ce.Z)(function*(){const a=yield n.sign(t.algorithm,e,i);return"ECDSA"===t.algorithm.name?function _p(s){if(s.byteLength%2!=0)return Tt;const i=s.byteLength/2,e=new ArrayBuffer(i);new Uint8Array(e).set(new Uint8Array(s,0,i));const n=new z({valueHex:e}),a=new ArrayBuffer(i);new Uint8Array(a).set(new Uint8Array(s,i,i));const u=new z({valueHex:a});return new R({value:[n.convertToDER(),u.convertToDER()]}).toBER(!1)}(a):a})()}fillPublicKeyParameters(i,e){const t={},n=this.getHashAlgorithm(e);if(n===S)throw new Error(`Unsupported signature algorithm: ${e.algorithmId}`);let a;a="1.2.840.113549.1.1.10"===e.algorithmId?e.algorithmId:i.algorithm.algorithmId;const o=this.getAlgorithmByOID(a,!0);if(t.algorithm=this.getAlgorithmParameters(o.name,"importKey"),"hash"in t.algorithm.algorithm&&(t.algorithm.algorithm.hash.name=n),"ECDSA"===o.name){const u=i.algorithm;if(!u.algorithmParams)throw new Error("Algorithm parameters for ECDSA public key are missed");const l=u.algorithmParams;if("idBlock"in u.algorithmParams&&(1!==l.idBlock.tagClass||6!==l.idBlock.tagNumber))throw new Error("Incorrect type for ECDSA public key parameters");const m=this.getAlgorithmByOID(l.valueBlock.toString(),!0);t.algorithm.algorithm.namedCurve=m.name}return t}getPublicKey(i,e,t){var n=this;return(0,Ce.Z)(function*(){t||(t=n.fillPublicKeyParameters(i,e));const a=i.toSchema().toBER(!1);return n.importKey("spki",a,t.algorithm.algorithm,!0,t.algorithm.usages)})()}verifyWithPublicKey(i,e,t,n,a){var o=this;return(0,Ce.Z)(function*(){let u;if(a){const k={};let B;B="1.2.840.113549.1.1.10"===n.algorithmId?n.algorithmId:t.algorithm.algorithmId;const F=o.getAlgorithmByOID(B,!0);if(k.algorithm=o.getAlgorithmParameters(F.name,"importKey"),"hash"in k.algorithm.algorithm&&(k.algorithm.algorithm.hash.name=a),"ECDSA"===F.name){let V=!1;if("algorithmParams"in t.algorithm&&"idBlock"in t.algorithm.algorithmParams&&1===t.algorithm.algorithmParams.idBlock.tagClass&&6===t.algorithm.algorithmParams.idBlock.tagNumber&&(V=!0),!1===V)throw new Error("Incorrect type for ECDSA public key parameters");const le=o.getAlgorithmByOID(t.algorithm.algorithmParams.valueBlock.toString(),!0);k.algorithm.algorithm.namedCurve=le.name}u=yield o.getPublicKey(t,null,k)}else{if(!(a=o.getHashAlgorithm(n)))throw new Error(`Unsupported signature algorithm: ${n.algorithmId}`);u=yield o.getPublicKey(t,n)}const l=o.getAlgorithmParameters(u.algorithm.name,"verify");"hash"in l.algorithm&&(l.algorithm.hash.name=a);let m=e.valueBlock.valueHexView;if("ECDSA"===u.algorithm.name){const k=Ks.find(u.algorithm.namedCurve);if(!k)throw new Error("Unsupported named curve in use");const B=Ct(m);re.assert(B,"Signature value"),m=function Ap(s,i){if(!(s instanceof R&&2===s.valueBlock.value.length&&s.valueBlock.value[0]instanceof z&&s.valueBlock.value[1]instanceof z))return Tt;const e=s.valueBlock.value[0].convertFromDER().valueBlock.valueHexView,t=s.valueBlock.value[1].convertFromDER().valueBlock.valueHexView,n=new Uint8Array(2*i);return n.set(e,i-e.byteLength),n.set(t,2*i-t.byteLength),n.buffer}(B.result,k.size)}if("RSA-PSS"===u.algorithm.name){const k=new Vc({schema:n.algorithmParams});l.algorithm.saltLength="saltLength"in k?k.saltLength:20;let B="SHA-1";"hashAlgorithm"in k&&(B=o.getAlgorithmByOID(k.hashAlgorithm.algorithmId,!0).name),l.algorithm.hash.name=B}return o.verify(l.algorithm,u,m,i)})()}}let Jd={name:"none",crypto:null};function Kd(s){return!(!s||"object"!=typeof s||!("crypto"in s))}function jd(s,...i){let e=null;if(i.length<2)e=i.length?i[0]:"undefined"!=typeof self&&self.crypto?new nu({name:"browser",crypto:self.crypto}):null;else{const t=i[0],n=i[1];Kd(n)?e=n:Kd(t)?e=t:"subtle"in t&&"getRandomValues"in t&&(e=new nu({crypto:t}))}if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){if(void 0===global[process.pid])global[process.pid]={};else if("object"!=typeof global[process.pid])throw new Error(`Name global.${process.pid} already exists and it is not an object`);if(void 0===global[process.pid].pkijs)global[process.pid].pkijs={};else if("object"!=typeof global[process.pid].pkijs)throw new Error(`Name global.${process.pid}.pkijs already exists and it is not an object`);global[process.pid].pkijs.engine={name:s,crypto:e}}else Jd={name:s,crypto:e}}function Ge(s=!1){const i=function bp(){if("undefined"!=typeof process&&"pid"in process&&"undefined"!=typeof global&&"undefined"==typeof window){let s;try{s=global[process.pid].pkijs.engine}catch{throw new Error("Please call 'setEngine' before call to 'getEngine'")}return s}return Jd}();if(!i.crypto&&s)throw new Error("Unable to create WebCrypto object");return i.crypto}function Dc(s){return Ge(!0).getRandomValues(s)}function kp(s,i,e,t,n){return Uc.apply(this,arguments)}function Uc(){return(Uc=(0,Ce.Z)(function*(s,i,e,t,n){switch(s.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:throw new ct(`Unknown hash function: ${s}`)}if(ct.assert(i,"zBuffer","ArrayBuffer"),0===i.byteLength)throw new ct("'zBuffer' has zero length, error");if(ct.assert(t,"SharedInfo","ArrayBuffer"),e>255)throw new ct("Please set 'Counter' argument to value less or equal to 255");const a=new ArrayBuffer(4),o=new Uint8Array(a);o[0]=0,o[1]=0,o[2]=0,o[3]=e;let u=Tt;return u=jn(u,i),u=jn(u,a),u=jn(u,t),{counter:e,result:yield n.digest({name:s},u)}})).apply(this,arguments)}function $d(s,i,e,t){return Lc.apply(this,arguments)}function Lc(){return(Lc=(0,Ce.Z)(function*(s,i,e,t,n=Ge(!0)){let a=0,o=1;switch(s.toUpperCase()){case"SHA-1":a=160;break;case"SHA-256":a=256;break;case"SHA-384":a=384;break;case"SHA-512":a=512;break;default:throw new ct(`Unknown hash function: ${s}`)}if(ct.assert(i,"Zbuffer","ArrayBuffer"),0===i.byteLength)throw new ct("'Zbuffer' has zero length, error");ct.assert(t,"SharedInfo","ArrayBuffer");const u=e/a;Math.floor(u)>0&&(o=Math.floor(u),u-o>0&&o++);const l=[];for(let F=1;F<=o;F++)l.push(yield kp(s,i,F,t,n));let m=Tt,k=1,B=!0;for(;B;){B=!1;for(const F of l)if(F.counter===k){m=jn(m,F.result),B=!0;break}k++}if(m.byteLength>(e>>=3)){const F=new ArrayBuffer(e),V=new Uint8Array(F),le=new Uint8Array(m);for(let ve=0;ve<e;ve++)V[ve]=le[ve];return F}return m})).apply(this,arguments)}const Mc="version",Fc="logID",Hc="extensions",Jc="timestamp",Kc="hashAlgorithm",jc="signatureAlgorithm",$c="signature",Xd="anonymous";let Ep=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,Mc,s.defaultValues(Mc)),this.logID=h(e,Fc,s.defaultValues(Fc)),this.timestamp=h(e,Jc,s.defaultValues(Jc)),this.extensions=h(e,Hc,s.defaultValues(Hc)),this.hashAlgorithm=h(e,Kc,s.defaultValues(Kc)),this.signatureAlgorithm=h(e,jc,s.defaultValues(jc)),this.signature=h(e,$c,s.defaultValues($c)),"stream"in e&&e.stream&&this.fromStream(e.stream),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mc:return 0;case Fc:case Hc:return Tt;case Jc:return new Date(0);case Kc:case jc:return S;case $c:return new He;default:return super.defaultValues(e)}}fromSchema(e){if(!(e instanceof Wl))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestamp");const t=new Ea({stream:new vt({buffer:e.data})});this.fromStream(t)}fromStream(e){const t=e.getUint16();if(this.version=e.getBlock(1)[0],0===this.version){this.logID=new Uint8Array(e.getBlock(32)).buffer.slice(0),this.timestamp=new Date(Er(new Uint8Array(e.getBlock(8)),8));const n=e.getUint16();switch(this.extensions=new Uint8Array(e.getBlock(n)).buffer.slice(0),e.getBlock(1)[0]){case 0:this.hashAlgorithm="none";break;case 1:this.hashAlgorithm="md5";break;case 2:this.hashAlgorithm="sha1";break;case 3:this.hashAlgorithm="sha224";break;case 4:this.hashAlgorithm="sha256";break;case 5:this.hashAlgorithm="sha384";break;case 6:this.hashAlgorithm="sha512";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}switch(e.getBlock(1)[0]){case 0:this.signatureAlgorithm=Xd;break;case 1:this.signatureAlgorithm="rsa";break;case 2:this.signatureAlgorithm="dsa";break;case 3:this.signatureAlgorithm="ecdsa";break;default:throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}const a=e.getUint16(),u=Ct(new Uint8Array(e.getBlock(a)).buffer.slice(0));if(re.assert(u,"SignedCertificateTimestamp"),this.signature=u.result,t!==47+n+a)throw new Error("Object's stream was not correct for SignedCertificateTimestamp")}}toSchema(){const e=this.toStream();return new Wl({data:e.stream.buffer})}toStream(){const e=new Ea;e.appendUint16(47+this.extensions.byteLength+this.signature.valueBeforeDecodeView.byteLength),e.appendChar(this.version),e.appendView(new Uint8Array(this.logID));const t=new ArrayBuffer(8),n=new Uint8Array(t),a=ds(this.timestamp.valueOf(),8);let o,u;switch(n.set(new Uint8Array(a),8-a.byteLength),e.appendView(n),e.appendUint16(this.extensions.byteLength),this.extensions.byteLength&&e.appendView(new Uint8Array(this.extensions)),this.hashAlgorithm.toLowerCase()){case"none":o=0;break;case"md5":o=1;break;case"sha1":o=2;break;case"sha224":o=3;break;case"sha256":o=4;break;case"sha384":o=5;break;case"sha512":o=6;break;default:throw new Error(`Incorrect data for hashAlgorithm: ${this.hashAlgorithm}`)}switch(e.appendChar(o),this.signatureAlgorithm.toLowerCase()){case Xd:u=0;break;case"rsa":u=1;break;case"dsa":u=2;break;case"ecdsa":u=3;break;default:throw new Error(`Incorrect data for signatureAlgorithm: ${this.signatureAlgorithm}`)}e.appendChar(u);const l=this.signature.toBER(!1);return e.appendUint16(l.byteLength),e.appendView(new Uint8Array(l)),e}toJSON(){return{version:this.version,logID:rf(this.logID),timestamp:this.timestamp,extensions:rf(this.extensions),hashAlgorithm:this.hashAlgorithm,signatureAlgorithm:this.signatureAlgorithm,signature:this.signature.toJSON()}}verify(e,t,n=0,a=Ge(!0)){var o=this;return(0,Ce.Z)(function*(){const u=dc($l(o.logID));let l=null;const m=new Ea;for(const ve of e)if(ve.log_id===u){l=ve.key;break}if(!l)throw new Error(`Public key not found for CT with logId: ${u}`);const k=Cr(wa(l)),B=hs.fromBER(k);m.appendChar(0),m.appendChar(0);const F=new ArrayBuffer(8),V=new Uint8Array(F),le=ds(o.timestamp.valueOf(),8);return V.set(new Uint8Array(le),8-le.byteLength),m.appendView(V),m.appendUint16(n),0===n&&m.appendUint24(t.byteLength),m.appendView(new Uint8Array(t)),m.appendUint16(o.extensions.byteLength),0!==o.extensions.byteLength&&m.appendView(new Uint8Array(o.extensions)),a.verifyWithPublicKey(m.buffer.slice(0,m.length),new de({valueHex:o.signature.toBER(!1)}),B,{algorithmId:S},"SHA-256")})()}}return s.CLASS_NAME="SignedCertificateTimestamp",s})();const iu="timestamps";let Cp=(()=>{class s extends he{constructor(e={}){super(),this.timestamps=h(e,iu,s.defaultValues(iu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===iu?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===iu?0===t.length:super.defaultValues(e)}static schema(e={}){var t;const n=h(e,"names",{});return null!==(t=n.optional)&&void 0!==t||(n.optional=!1),new de({name:n.blockName||"SignedCertificateTimestampList",optional:n.optional})}fromSchema(e){if(!(e instanceof de))throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");const t=new Ea({stream:new vt({buffer:e.valueBlock.valueHex})});if(t.getUint16()!==t.length)throw new Error("Object's schema was not verified against input data for SignedCertificateTimestampList");for(;t.length;)this.timestamps.push(new Ep({stream:t}))}toSchema(){const e=new Ea;let t=0;const n=[];for(const a of this.timestamps){const o=a.toStream();n.push(o),t+=o.stream.buffer.byteLength}e.appendUint16(t);for(const a of n)e.appendView(a.stream.view);return new de({valueHex:e.stream.buffer.slice(0)})}toJSON(){return{timestamps:Array.from(this.timestamps,e=>e.toJSON())}}}return s.CLASS_NAME="SignedCertificateTimestampList",s})();const yo="attributes",Np=[yo];let Ip=(()=>{class s extends he{constructor(e={}){super(),this.attributes=h(e,yo,s.defaultValues(yo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===yo?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.attributes||S,value:at.schema()})]})}fromSchema(e){ge(e,Np);const t=ce(e,e,s.schema({names:{attributes:yo}}));re.assertSchema(t,this.className),this.attributes=Array.from(t.result.attributes,n=>new at({schema:n}))}toSchema(){return new R({value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){return{attributes:Array.from(this.attributes,e=>e.toJSON())}}}return s.CLASS_NAME="SubjectDirectoryAttributes",s})();class yt{static getItems(){return this.types||(this.types={},yt.register(od,"SubjectAltName",id),yt.register(ld,"IssuerAltName",id),yt.register(Nc,"AuthorityKeyIdentifier",_d),yt.register(Ec,"BasicConstraints",Ad),yt.register("1.3.6.1.4.1.311.21.1","MicrosoftCaVersion",Fg),yt.register(dd,"CertificatePolicies",Cd),yt.register("1.3.6.1.4.1.311.21.10","CertificatePoliciesMicrosoft",Cd),yt.register("1.3.6.1.4.1.311.21.7","MicrosoftCertTemplateV2",ti),yt.register(fd,"CRLDistributionPoints",Bd),yt.register(Cc,"FreshestCRL",Bd),yt.register("2.5.29.37","ExtKeyUsage",zg),yt.register(cd,"CertificateIssuer",xt),yt.register(Ic,"AuthorityInfoAccess",xd),yt.register("1.3.6.1.5.5.7.1.11","SubjectInfoAccess",xd),yt.register(ud,"IssuingDistributionPoint",Wg),yt.register(hd,"NameConstraints",Xg),yt.register(gd,"PolicyConstraints",tp),yt.register(md,"PolicyMappings",np),yt.register("2.5.29.16","PrivateKeyUsagePeriod",ap),yt.register("1.3.6.1.5.5.7.1.3","QCStatements",up),yt.register("1.3.6.1.4.1.11129.2.4.2","SignedCertificateTimestampList",Cp),yt.register("2.5.29.9","SubjectDirectoryAttributes",Ip)),this.types}static fromBER(i,e){const t=Ct(e);if(-1===t.offset)return null;const n=this.find(i);if(n)try{return new n.type({schema:t.result})}catch{const o=new n.type;return o.parsingError=`Incorrectly formatted value of extension ${n.name} (${i})`,o}return t.result}static find(i){return this.getItems()[i]||null}static register(i,e,t){this.getItems()[i]={name:e,type:t}}}const wo="extnID",Ws="critical",So="extnValue",au="parsedValue",Tp=[wo,Ws,So];let $r=(()=>{class s extends he{constructor(e={}){super(),this.extnID=h(e,wo,s.defaultValues(wo)),this.critical=h(e,Ws,s.defaultValues(Ws)),this.extnValue=So in e?new de({valueHex:e.extnValue}):s.defaultValues(So),au in e&&(this.parsedValue=h(e,au,s.defaultValues(au))),e.schema&&this.fromSchema(e.schema)}get parsedValue(){if(void 0===this._parsedValue){const e=yt.fromBER(this.extnID,this.extnValue.valueBlock.valueHexView);this._parsedValue=e}return this._parsedValue||void 0}set parsedValue(e){this._parsedValue=e}static defaultValues(e){switch(e){case wo:return S;case Ws:return!1;case So:return new de;case au:return{};default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.extnID||S}),new Bs({name:t.critical||S,optional:!0}),new de({name:t.extnValue||S})]})}fromSchema(e){ge(e,Tp);const t=ce(e,e,s.schema({names:{extnID:wo,critical:Ws,extnValue:So}}));re.assertSchema(t,this.className),this.extnID=t.result.extnID.valueBlock.toString(),Ws in t.result&&(this.critical=t.result.critical.valueBlock.value),this.extnValue=t.result.extnValue}toSchema(){const e=[];return e.push(new Oe({value:this.extnID})),this.critical!==s.defaultValues(Ws)&&e.push(new Bs({value:this.critical})),e.push(this.extnValue),new R({value:e})}toJSON(){const e={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==s.defaultValues(Ws)&&(e.critical=this.critical),this.parsedValue&&this.parsedValue.toJSON&&(e.parsedValue=this.parsedValue.toJSON()),e}}return s.CLASS_NAME="Extension",s})();const bo="extensions",Bp=[bo];let Rt=(()=>{class s extends he{constructor(e={}){super(),this.extensions=h(e,bo,s.defaultValues(bo)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===bo?[]:super.defaultValues(e)}static schema(e={},t=!1){const n=h(e,"names",{});return new R({optional:t,name:n.blockName||S,value:[new ze({name:n.extensions||S,value:$r.schema(n.extension||{})})]})}fromSchema(e){ge(e,Bp);const t=ce(e,e,s.schema({names:{extensions:bo}}));re.assertSchema(t,this.className),this.extensions=Array.from(t.result.extensions,n=>new $r({schema:n}))}toSchema(){return new R({value:Array.from(this.extensions,e=>e.toSchema())})}toJSON(){return{extensions:this.extensions.map(e=>e.toJSON())}}}return s.CLASS_NAME="Extensions",s})();const _o="issuer",Ao="serialNumber",qr="issuerUID",xp=[_o,Ao,qr];let As=(()=>{class s extends he{constructor(e={}){super(),this.issuer=h(e,_o,s.defaultValues(_o)),this.serialNumber=h(e,Ao,s.defaultValues(Ao)),qr in e&&(this.issuerUID=h(e,qr,s.defaultValues(qr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case _o:return new xt;case Ao:return new z;case qr:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[xt.schema(t.issuer||{}),new z({name:t.serialNumber||S}),new et({optional:!0,name:t.issuerUID||S})]})}fromSchema(e){ge(e,xp);const t=ce(e,e,s.schema({names:{issuer:{names:{blockName:_o}},serialNumber:Ao,issuerUID:qr}}));re.assertSchema(t,this.className),this.issuer=new xt({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber,qr in t.result&&(this.issuerUID=t.result.issuerUID)}toSchema(){const e=new R({value:[this.issuer.toSchema(),this.serialNumber]});return this.issuerUID&&e.valueBlock.value.push(this.issuerUID),e}toJSON(){const e={issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()};return this.issuerUID&&(e.issuerUID=this.issuerUID.toJSON()),e}}return s.CLASS_NAME="IssuerSerial",s})();const ko="version",Zr="baseCertificateID",zr="subjectName",Eo="issuer",Co="signature",No="serialNumber",Io="attrCertValidityPeriod",To="attributes",Gr="issuerUniqueID",Wr="extensions",Rp=[ko,Zr,zr,Eo,Co,No,Io,To,Gr,Wr];let Zc=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,ko,s.defaultValues(ko)),Zr in e&&(this.baseCertificateID=h(e,Zr,s.defaultValues(Zr))),zr in e&&(this.subjectName=h(e,zr,s.defaultValues(zr))),this.issuer=h(e,Eo,s.defaultValues(Eo)),this.signature=h(e,Co,s.defaultValues(Co)),this.serialNumber=h(e,No,s.defaultValues(No)),this.attrCertValidityPeriod=h(e,Io,s.defaultValues(Io)),this.attributes=h(e,To,s.defaultValues(To)),Gr in e&&(this.issuerUniqueID=h(e,Gr,s.defaultValues(Gr))),Wr in e&&(this.extensions=h(e,Wr,s.defaultValues(Wr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ko:return 0;case Zr:return new As;case zr:case Eo:return new xt;case Co:return new G;case No:return new z;case Io:return new ei;case To:return[];case Gr:return new et;case Wr:return new Rt;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),new ft({value:[new $({name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:As.schema().valueBlock.value}),new $({name:t.subjectName||S,idBlock:{tagClass:3,tagNumber:1},value:xt.schema().valueBlock.value})]}),xt.schema({names:{blockName:t.issuer||S}}),G.schema(t.signature||{}),new z({name:t.serialNumber||S}),ei.schema(t.attrCertValidityPeriod||{}),new R({name:t.attributes||S,value:[new ze({value:at.schema()})]}),new et({optional:!0,name:t.issuerUniqueID||S}),Rt.schema(t.extensions||{},!0)]})}fromSchema(e){ge(e,Rp);const t=ce(e,e,s.schema({names:{version:ko,baseCertificateID:Zr,subjectName:zr,issuer:Eo,signature:{names:{blockName:Co}},serialNumber:No,attrCertValidityPeriod:{names:{blockName:Io}},attributes:To,issuerUniqueID:Gr,extensions:{names:{blockName:Wr}}}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,Zr in t.result&&(this.baseCertificateID=new As({schema:new R({value:t.result.baseCertificateID.valueBlock.value})})),zr in t.result&&(this.subjectName=new xt({schema:new R({value:t.result.subjectName.valueBlock.value})})),this.issuer=t.result.issuer,this.signature=new G({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ei({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,n=>new at({schema:n})),Gr in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),Wr in t.result&&(this.extensions=new Rt({schema:t.result.extensions}))}toSchema(){const e=new R({value:[new z({value:this.version})]});return this.baseCertificateID&&e.valueBlock.value.push(new $({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.subjectName&&e.valueBlock.value.push(new $({idBlock:{tagClass:3,tagNumber:1},value:this.subjectName.toSchema().valueBlock.value})),e.valueBlock.value.push(this.issuer.toSchema()),e.valueBlock.value.push(this.signature.toSchema()),e.valueBlock.value.push(this.serialNumber),e.valueBlock.value.push(this.attrCertValidityPeriod.toSchema()),e.valueBlock.value.push(new R({value:Array.from(this.attributes,t=>t.toSchema())})),this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.subjectName&&(e.subjectName=this.subjectName.toJSON()),e.issuer=this.issuer.toJSON(),e.signature=this.signature.toJSON(),e.serialNumber=this.serialNumber.toJSON(),e.attrCertValidityPeriod=this.attrCertValidityPeriod.toJSON(),e.attributes=Array.from(this.attributes,t=>t.toJSON()),this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}return s.CLASS_NAME="AttributeCertificateInfoV1",s})();const Bo="acinfo",xo="signatureAlgorithm",Ro="signatureValue",Op=[Bo,Ro,xo];let zc=(()=>{class s extends he{constructor(e={}){super(),this.acinfo=h(e,Bo,s.defaultValues(Bo)),this.signatureAlgorithm=h(e,xo,s.defaultValues(xo)),this.signatureValue=h(e,Ro,s.defaultValues(Ro)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bo:return new Zc;case xo:return new G;case Ro:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[Zc.schema(t.acinfo||{}),G.schema(t.signatureAlgorithm||{}),new et({name:t.signatureValue||S})]})}fromSchema(e){ge(e,Op);const t=ce(e,e,s.schema({names:{acinfo:{names:{blockName:Bo}},signatureAlgorithm:{names:{blockName:xo}},signatureValue:Ro}}));re.assertSchema(t,this.className),this.acinfo=new Zc({schema:t.result.acinfo}),this.signatureAlgorithm=new G({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new R({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}return s.CLASS_NAME="AttributeCertificateV1",s})();const Oo="digestedObjectType",Yr="otherObjectTypeID",Vo="digestAlgorithm",Po="objectDigest",Vp=[Oo,Yr,Vo,Po];let ci=(()=>{class s extends he{constructor(e={}){super(),this.digestedObjectType=h(e,Oo,s.defaultValues(Oo)),Yr in e&&(this.otherObjectTypeID=h(e,Yr,s.defaultValues(Yr))),this.digestAlgorithm=h(e,Vo,s.defaultValues(Vo)),this.objectDigest=h(e,Po,s.defaultValues(Po)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Oo:return new _a;case Yr:return new Oe;case Vo:return new G;case Po:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new _a({name:t.digestedObjectType||S}),new Oe({optional:!0,name:t.otherObjectTypeID||S}),G.schema(t.digestAlgorithm||{}),new et({name:t.objectDigest||S})]})}fromSchema(e){ge(e,Vp);const t=ce(e,e,s.schema({names:{digestedObjectType:Oo,otherObjectTypeID:Yr,digestAlgorithm:{names:{blockName:Vo}},objectDigest:Po}}));re.assertSchema(t,this.className),this.digestedObjectType=t.result.digestedObjectType,Yr in t.result&&(this.otherObjectTypeID=t.result.otherObjectTypeID),this.digestAlgorithm=new G({schema:t.result.digestAlgorithm}),this.objectDigest=t.result.objectDigest}toSchema(){const e=new R({value:[this.digestedObjectType]});return this.otherObjectTypeID&&e.valueBlock.value.push(this.otherObjectTypeID),e.valueBlock.value.push(this.digestAlgorithm.toSchema()),e.valueBlock.value.push(this.objectDigest),e}toJSON(){const e={digestedObjectType:this.digestedObjectType.toJSON(),digestAlgorithm:this.digestAlgorithm.toJSON(),objectDigest:this.objectDigest.toJSON()};return this.otherObjectTypeID&&(e.otherObjectTypeID=this.otherObjectTypeID.toJSON()),e}}return s.CLASS_NAME="ObjectDigestInfo",s})();const Qr="issuerName",Xr="baseCertificateID",en="objectDigestInfo",Pp=[Qr,Xr,en];let rm=(()=>{class s extends he{constructor(e={}){super(),Qr in e&&(this.issuerName=h(e,Qr,s.defaultValues(Qr))),Xr in e&&(this.baseCertificateID=h(e,Xr,s.defaultValues(Xr))),en in e&&(this.objectDigestInfo=h(e,en,s.defaultValues(en))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qr:return new xt;case Xr:return new As;case en:return new ci;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[xt.schema({names:{blockName:t.issuerName}},!0),new $({optional:!0,name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:As.schema().valueBlock.value}),new $({optional:!0,name:t.objectDigestInfo||S,idBlock:{tagClass:3,tagNumber:1},value:ci.schema().valueBlock.value})]})}fromSchema(e){ge(e,Pp);const t=ce(e,e,s.schema({names:{issuerName:Qr,baseCertificateID:Xr,objectDigestInfo:en}}));re.assertSchema(t,this.className),Qr in t.result&&(this.issuerName=new xt({schema:t.result.issuerName})),Xr in t.result&&(this.baseCertificateID=new As({schema:new R({value:t.result.baseCertificateID.valueBlock.value})})),en in t.result&&(this.objectDigestInfo=new ci({schema:new R({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new R;return this.issuerName&&e.valueBlock.value.push(this.issuerName.toSchema()),this.baseCertificateID&&e.valueBlock.value.push(new $({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new $({idBlock:{tagClass:3,tagNumber:1},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.issuerName&&(e.issuerName=this.issuerName.toJSON()),this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}return s.CLASS_NAME="V2Form",s})();const tn="baseCertificateID",sn="entityName",rn="objectDigestInfo",Dp=[tn,sn,rn];let Gc=(()=>{class s extends he{constructor(e={}){super(),tn in e&&(this.baseCertificateID=h(e,tn,s.defaultValues(tn))),sn in e&&(this.entityName=h(e,sn,s.defaultValues(sn))),rn in e&&(this.objectDigestInfo=h(e,rn,s.defaultValues(rn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case tn:return new As;case sn:return new xt;case rn:return new ci;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new $({optional:!0,name:t.baseCertificateID||S,idBlock:{tagClass:3,tagNumber:0},value:As.schema().valueBlock.value}),new $({optional:!0,name:t.entityName||S,idBlock:{tagClass:3,tagNumber:1},value:xt.schema().valueBlock.value}),new $({optional:!0,name:t.objectDigestInfo||S,idBlock:{tagClass:3,tagNumber:2},value:ci.schema().valueBlock.value})]})}fromSchema(e){ge(e,Dp);const t=ce(e,e,s.schema({names:{baseCertificateID:tn,entityName:sn,objectDigestInfo:rn}}));re.assertSchema(t,this.className),tn in t.result&&(this.baseCertificateID=new As({schema:new R({value:t.result.baseCertificateID.valueBlock.value})})),sn in t.result&&(this.entityName=new xt({schema:new R({value:t.result.entityName.valueBlock.value})})),rn in t.result&&(this.objectDigestInfo=new ci({schema:new R({value:t.result.objectDigestInfo.valueBlock.value})}))}toSchema(){const e=new R;return this.baseCertificateID&&e.valueBlock.value.push(new $({idBlock:{tagClass:3,tagNumber:0},value:this.baseCertificateID.toSchema().valueBlock.value})),this.entityName&&e.valueBlock.value.push(new $({idBlock:{tagClass:3,tagNumber:1},value:this.entityName.toSchema().valueBlock.value})),this.objectDigestInfo&&e.valueBlock.value.push(new $({idBlock:{tagClass:3,tagNumber:2},value:this.objectDigestInfo.toSchema().valueBlock.value})),e}toJSON(){const e={};return this.baseCertificateID&&(e.baseCertificateID=this.baseCertificateID.toJSON()),this.entityName&&(e.entityName=this.entityName.toJSON()),this.objectDigestInfo&&(e.objectDigestInfo=this.objectDigestInfo.toJSON()),e}}return s.CLASS_NAME="Holder",s})();const Do="version",Uo="holder",Lo="issuer",Mo="signature",Fo="serialNumber",Ho="attrCertValidityPeriod",Jo="attributes",nn="issuerUniqueID",an="extensions",Up=[Do,Uo,Lo,Mo,Fo,Ho,Jo,nn,an];let Wc=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,Do,s.defaultValues(Do)),this.holder=h(e,Uo,s.defaultValues(Uo)),this.issuer=h(e,Lo,s.defaultValues(Lo)),this.signature=h(e,Mo,s.defaultValues(Mo)),this.serialNumber=h(e,Fo,s.defaultValues(Fo)),this.attrCertValidityPeriod=h(e,Ho,s.defaultValues(Ho)),this.attributes=h(e,Jo,s.defaultValues(Jo)),nn in e&&(this.issuerUniqueID=h(e,nn,s.defaultValues(nn))),an in e&&(this.extensions=h(e,an,s.defaultValues(an))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Do:return 1;case Uo:return new Gc;case Lo:return{};case Mo:return new G;case Fo:return new z;case Ho:return new ei;case Jo:return[];case nn:return new et;case an:return new Rt;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),Gc.schema(t.holder||{}),new ft({value:[xt.schema({names:{blockName:t.issuer||S}}),new $({name:t.issuer||S,idBlock:{tagClass:3,tagNumber:0},value:rm.schema().valueBlock.value})]}),G.schema(t.signature||{}),new z({name:t.serialNumber||S}),ei.schema(t.attrCertValidityPeriod||{}),new R({name:t.attributes||S,value:[new ze({value:at.schema()})]}),new et({optional:!0,name:t.issuerUniqueID||S}),Rt.schema(t.extensions||{},!0)]})}fromSchema(e){ge(e,Up);const t=ce(e,e,s.schema({names:{version:Do,holder:{names:{blockName:Uo}},issuer:Lo,signature:{names:{blockName:Mo}},serialNumber:Fo,attrCertValidityPeriod:{names:{blockName:Ho}},attributes:Jo,issuerUniqueID:nn,extensions:{names:{blockName:an}}}}));if(3!==(re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.holder=new Gc({schema:t.result.holder}),t.result.issuer.idBlock.tagClass))throw new Error("Incorrect value for 'issuer' in AttributeCertificateInfoV2");this.issuer=new rm({schema:new R({value:t.result.issuer.valueBlock.value})}),this.signature=new G({schema:t.result.signature}),this.serialNumber=t.result.serialNumber,this.attrCertValidityPeriod=new ei({schema:t.result.attrCertValidityPeriod}),this.attributes=Array.from(t.result.attributes.valueBlock.value,n=>new at({schema:n})),nn in t.result&&(this.issuerUniqueID=t.result.issuerUniqueID),an in t.result&&(this.extensions=new Rt({schema:t.result.extensions}))}toSchema(){const e=new R({value:[new z({value:this.version}),this.holder.toSchema(),new $({idBlock:{tagClass:3,tagNumber:0},value:this.issuer.toSchema().valueBlock.value}),this.signature.toSchema(),this.serialNumber,this.attrCertValidityPeriod.toSchema(),new R({value:Array.from(this.attributes,t=>t.toSchema())})]});return this.issuerUniqueID&&e.valueBlock.value.push(this.issuerUniqueID),this.extensions&&e.valueBlock.value.push(this.extensions.toSchema()),e}toJSON(){const e={version:this.version,holder:this.holder.toJSON(),issuer:this.issuer.toJSON(),signature:this.signature.toJSON(),serialNumber:this.serialNumber.toJSON(),attrCertValidityPeriod:this.attrCertValidityPeriod.toJSON(),attributes:Array.from(this.attributes,t=>t.toJSON())};return this.issuerUniqueID&&(e.issuerUniqueID=this.issuerUniqueID.toJSON()),this.extensions&&(e.extensions=this.extensions.toJSON()),e}}return s.CLASS_NAME="AttributeCertificateInfoV2",s})();const Ko="acinfo",jo="signatureAlgorithm",$o="signatureValue",Lp=[Ko,jo,$o];let on=(()=>{class s extends he{constructor(e={}){super(),this.acinfo=h(e,Ko,s.defaultValues(Ko)),this.signatureAlgorithm=h(e,jo,s.defaultValues(jo)),this.signatureValue=h(e,$o,s.defaultValues($o)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ko:return new Wc;case jo:return new G;case $o:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[Wc.schema(t.acinfo||{}),G.schema(t.signatureAlgorithm||{}),new et({name:t.signatureValue||S})]})}fromSchema(e){ge(e,Lp);const t=ce(e,e,s.schema({names:{acinfo:{names:{blockName:Ko}},signatureAlgorithm:{names:{blockName:jo}},signatureValue:$o}}));re.assertSchema(t,this.className),this.acinfo=new Wc({schema:t.result.acinfo}),this.signatureAlgorithm=new G({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}toSchema(){return new R({value:[this.acinfo.toSchema(),this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){return{acinfo:this.acinfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()}}}return s.CLASS_NAME="AttributeCertificateV2",s})();const ln="contentType",hi="content",Mp=[ln,hi];let Lt=(()=>{class s extends he{constructor(e={}){super(),this.contentType=h(e,ln,s.defaultValues(ln)),this.content=h(e,hi,s.defaultValues(hi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ln:return S;case hi:return new He;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ln:return"string"==typeof t&&t===this.defaultValues(ln);case hi:return t instanceof He;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return"optional"in t||(t.optional=!1),new R({name:t.blockName||"ContentInfo",optional:t.optional,value:[new Oe({name:t.contentType||ln}),new $({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:t.content||hi})]})]})}fromSchema(e){ge(e,Mp);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.contentType=t.result.contentType.valueBlock.toString(),this.content=t.result.content}toSchema(){return new R({value:[new Oe({value:this.contentType}),new $({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}toJSON(){const e={contentType:this.contentType};return this.content instanceof He||(e.content=this.content.toJSON()),e}}return s.CLASS_NAME="ContentInfo",s.DATA=Tc,s.SIGNED_DATA="1.2.840.113549.1.7.2",s.ENVELOPED_DATA=vd,s.ENCRYPTED_DATA=yd,s})();const Yc="type",Qc="value",Xc="utcTimeName",eh="generalTimeName",Fp=[Xc,eh];let Ot=(()=>{class s extends he{constructor(e={}){super(),this.type=h(e,Yc,s.defaultValues(Yc)),this.value=h(e,Qc,s.defaultValues(Qc)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yc:return 0;case Qc:return new Date(0,0,0);default:return super.defaultValues(e)}}static schema(e={},t=!1){const n=h(e,"names",{});return new ft({optional:t,value:[new Gn({name:n.utcTimeName||S}),new ht({name:n.generalTimeName||S})]})}fromSchema(e){ge(e,Fp);const t=ce(e,e,s.schema({names:{utcTimeName:Xc,generalTimeName:eh}}));re.assertSchema(t,this.className),Xc in t.result&&(this.type=0,this.value=t.result.utcTimeName.toDate()),eh in t.result&&(this.type=1,this.value=t.result.generalTimeName.toDate())}toSchema(){return 0===this.type?new Gn({valueDate:this.value}):1===this.type?new ht({valueDate:this.value}):{}}toJSON(){return{type:this.type,value:this.value}}}return s.CLASS_NAME="Time",s})();const Ys="version",ou="serialNumber",lu="signature",uu="issuer",cu="notBefore",hu="notAfter",fu="subject",du="subjectPublicKeyInfo",qo="issuerUniqueID",Zo="subjectUniqueID",zo="extensions",Go="signatureAlgorithm",Wo="signatureValue",Zt="tbsCertificate",mu=`${Zt}.${Ys}`,sh=`${Zt}.${ou}`,rh=`${Zt}.${lu}`,nh=`${Zt}.${uu}`,gu=`${Zt}.${cu}`,pu=`${Zt}.${hu}`,ih=`${Zt}.${fu}`,ah=`${Zt}.${du}`,vu=`${Zt}.${qo}`,yu=`${Zt}.${Zo}`,Yo=`${Zt}.${zo}`,Hp=[Zt,mu,sh,rh,nh,gu,pu,ih,ah,vu,yu,Yo,Go,Wo];function Jp(s={}){const i=h(s,"names",{});return new R({name:i.blockName||Zt,value:[new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new z({name:i.tbsCertificateVersion||mu})]}),new z({name:i.tbsCertificateSerialNumber||sh}),G.schema(i.signature||{names:{blockName:rh}}),dt.schema(i.issuer||{names:{blockName:nh}}),new R({name:i.tbsCertificateValidity||"tbsCertificate.validity",value:[Ot.schema(i.notBefore||{names:{utcTimeName:gu,generalTimeName:gu}}),Ot.schema(i.notAfter||{names:{utcTimeName:pu,generalTimeName:pu}})]}),dt.schema(i.subject||{names:{blockName:ih}}),hs.schema(i.subjectPublicKeyInfo||{names:{blockName:ah}}),new Ue({name:i.tbsCertificateIssuerUniqueID||vu,optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new Ue({name:i.tbsCertificateSubjectUniqueID||yu,optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Rt.schema(i.extensions||{names:{blockName:Yo}})]})]})}let ts=(()=>{class s extends he{constructor(e={}){super(),this.tbsView=new Uint8Array(h(e,"tbs",s.defaultValues("tbs"))),this.version=h(e,Ys,s.defaultValues(Ys)),this.serialNumber=h(e,ou,s.defaultValues(ou)),this.signature=h(e,lu,s.defaultValues(lu)),this.issuer=h(e,uu,s.defaultValues(uu)),this.notBefore=h(e,cu,s.defaultValues(cu)),this.notAfter=h(e,hu,s.defaultValues(hu)),this.subject=h(e,fu,s.defaultValues(fu)),this.subjectPublicKeyInfo=h(e,du,s.defaultValues(du)),qo in e&&(this.issuerUniqueID=h(e,qo,s.defaultValues(qo))),Zo in e&&(this.subjectUniqueID=h(e,Zo,s.defaultValues(Zo))),zo in e&&(this.extensions=h(e,zo,s.defaultValues(zo))),this.signatureAlgorithm=h(e,Go,s.defaultValues(Go)),this.signatureValue=h(e,Wo,s.defaultValues(Wo)),e.schema&&this.fromSchema(e.schema)}get tbs(){return ye.vJ.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case"tbs":return Tt;case Ys:return 0;case ou:return new z;case lu:return new G;case uu:return new dt;case cu:case hu:return new Ot;case fu:return new dt;case du:return new hs;case qo:case Zo:return Tt;case zo:return[];case Go:return new G;case Wo:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[Jp(t.tbsCertificate),G.schema(t.signatureAlgorithm||{names:{blockName:Go}}),new et({name:t.signatureValue||Wo})]})}fromSchema(e){ge(e,Hp);const t=ce(e,e,s.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:Yo}}}}}}));re.assertSchema(t,this.className),this.tbsView=t.result.tbsCertificate.valueBeforeDecodeView,mu in t.result&&(this.version=t.result[mu].valueBlock.valueDec),this.serialNumber=t.result[sh],this.signature=new G({schema:t.result[rh]}),this.issuer=new dt({schema:t.result[nh]}),this.notBefore=new Ot({schema:t.result[gu]}),this.notAfter=new Ot({schema:t.result[pu]}),this.subject=new dt({schema:t.result[ih]}),this.subjectPublicKeyInfo=new hs({schema:t.result[ah]}),vu in t.result&&(this.issuerUniqueID=t.result[vu].valueBlock.valueHex),yu in t.result&&(this.subjectUniqueID=t.result[yu].valueBlock.valueHex),Yo in t.result&&(this.extensions=Array.from(t.result[Yo],n=>new $r({schema:n}))),this.signatureAlgorithm=new G({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return Ys in this&&this.version!==s.defaultValues(Ys)&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new z({value:this.version})]})),e.push(this.serialNumber),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(new R({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),e.push(this.subject.toSchema()),e.push(this.subjectPublicKeyInfo.toSchema()),this.issuerUniqueID&&e.push(new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),this.subjectUniqueID&&e.push(new Ue({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),this.extensions&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new R({value:Array.from(this.extensions,t=>t.toSchema())})]})),new R({value:e})}toSchema(e=!1){let t;if(!1===e){if(!this.tbsView.byteLength)return s.schema().value[0];const n=Ct(this.tbsView);re.assert(n,"TBS Certificate"),t=n.result}else t=this.encodeTBS();return new R({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ye.ep.ToHex(this.tbsView),version:this.version,serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return Ys in this&&this.version!==s.defaultValues(Ys)&&(e.version=this.version),this.issuerUniqueID&&(e.issuerUniqueID=ye.ep.ToHex(this.issuerUniqueID)),this.subjectUniqueID&&(e.subjectUniqueID=ye.ep.ToHex(this.subjectUniqueID)),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}getPublicKey(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){return t.getPublicKey(n.subjectPublicKeyInfo,n.signatureAlgorithm,e)})()}getKeyHash(e="SHA-1",t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){return t.digest({name:e},n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView)})()}sign(e,t="SHA-1",n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){if(!e)throw new Error("Need to provide a private key for signing");const o=yield n.getSignatureParameters(e,t),u=o.parameters;a.signature=o.signatureAlgorithm,a.signatureAlgorithm=o.signatureAlgorithm,a.tbsView=new Uint8Array(a.encodeTBS().toBER());const l=yield n.signWithPrivateKey(a.tbsView,e,u);a.signatureValue=new et({valueHex:l})})()}verify(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){let a;if(e?a=e.subjectPublicKeyInfo:n.issuer.isEqual(n.subject)&&(a=n.subjectPublicKeyInfo),!(a instanceof hs))throw new Error("Please provide issuer certificate as a parameter");return t.verifyWithPublicKey(n.tbsView,n.signatureValue,a,n.signatureAlgorithm)})()}}return s.CLASS_NAME="Certificate",s})();function nm(s,i=null){if(i&&s.issuer.isEqual(i.issuer)&&s.serialNumber.isEqual(i.serialNumber))return null;let e=!1;if(s.extensions)for(const t of s.extensions)if(t.extnID===Ec&&t.parsedValue instanceof Ad&&t.parsedValue.cA){e=!0;break}return e?s:null}const fi="certId",di="certValue",mi="parsedValue",Kp=[fi,di];let oh=(()=>{class s extends he{constructor(e={}){super(),this.certId=h(e,fi,s.defaultValues(fi)),this.certValue=h(e,di,s.defaultValues(di)),mi in e&&(this.parsedValue=h(e,mi,s.defaultValues(mi))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fi:return S;case di:return new He;case mi:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fi:return t===S;case di:return t instanceof He;case mi:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.id||"id"}),new $({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:t.value||"value"})]})]})}fromSchema(e){ge(e,Kp);const t=ce(e,e,s.schema({names:{id:fi,value:di}}));re.assertSchema(t,this.className),this.certId=t.result.certId.valueBlock.toString(),this.certValue=t.result.certValue;const n=this.certValue.valueBlock.valueHexView;switch(this.certId){case wd:try{this.parsedValue=ts.fromBER(n)}catch{on.fromBER(n)}break;case Sd:this.parsedValue=on.fromBER(n);break;default:throw new Error(`Incorrect CERT_ID value in CertBag: ${this.certId}`)}}toSchema(){return mi in this&&(this.certId="acinfo"in this.parsedValue?Sd:wd,this.certValue=new de({valueHex:this.parsedValue.toSchema().toBER(!1)})),new R({value:[new Oe({value:this.certId}),new $({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}toJSON(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}return s.CLASS_NAME="CertBag",s})();const Qo="userCertificate",gi="revocationDate",un="crlEntryExtensions",jp=[Qo,gi,un];let $p=(()=>{class s extends he{constructor(e={}){super(),this.userCertificate=h(e,Qo,s.defaultValues(Qo)),this.revocationDate=h(e,gi,s.defaultValues(gi)),un in e&&(this.crlEntryExtensions=h(e,un,s.defaultValues(un))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Qo:return new z;case gi:return new Ot;case un:return new Rt;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.userCertificate||Qo}),Ot.schema({names:{utcTimeName:t.revocationDate||gi,generalTimeName:t.revocationDate||gi}}),Rt.schema({names:{blockName:t.crlEntryExtensions||un}},!0)]})}fromSchema(e){ge(e,jp);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.userCertificate=t.result.userCertificate,this.revocationDate=new Ot({schema:t.result.revocationDate}),un in t.result&&(this.crlEntryExtensions=new Rt({schema:t.result.crlEntryExtensions}))}toSchema(){const e=[this.userCertificate,this.revocationDate.toSchema()];return this.crlEntryExtensions&&e.push(this.crlEntryExtensions.toSchema()),new R({value:e})}toJSON(){const e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON()};return this.crlEntryExtensions&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}return s.CLASS_NAME="RevokedCertificate",s})();const Xo="version",uh="signature",ch="issuer",hh="thisUpdate",wu="nextUpdate",Su="revokedCertificates",bu="crlExtensions",el="signatureAlgorithm",tl="signatureValue",ks="tbsCertList",_u=`${ks}.version`,fh=`${ks}.signature`,dh=`${ks}.issuer`,Au=`${ks}.thisUpdate`,sl=`${ks}.nextUpdate`,ku=`${ks}.revokedCertificates`,Eu=`${ks}.extensions`,qp=[ks,_u,fh,dh,Au,sl,ku,Eu,el,tl];function Zp(s={}){const i=h(s,"names",{});return new R({name:i.blockName||ks,value:[new z({optional:!0,name:i.tbsCertListVersion||_u,value:2}),G.schema(i.signature||{names:{blockName:fh}}),dt.schema(i.issuer||{names:{blockName:dh}}),Ot.schema(i.tbsCertListThisUpdate||{names:{utcTimeName:Au,generalTimeName:Au}}),Ot.schema(i.tbsCertListNextUpdate||{names:{utcTimeName:sl,generalTimeName:sl}},!0),new R({optional:!0,value:[new ze({name:i.tbsCertListRevokedCertificates||ku,value:new R({value:[new z,Ot.schema(),Rt.schema({},!0)]})})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Rt.schema(i.crlExtensions||{names:{blockName:Eu}})]})]})}const zp=[Nc,ld,"2.5.29.20","2.5.29.27",ud,Cc,Ic,"2.5.29.21","2.5.29.24",cd];let Cu=(()=>{class s extends he{constructor(e={}){super(),this.tbsView=new Uint8Array(h(e,"tbs",s.defaultValues("tbs"))),this.version=h(e,Xo,s.defaultValues(Xo)),this.signature=h(e,uh,s.defaultValues(uh)),this.issuer=h(e,ch,s.defaultValues(ch)),this.thisUpdate=h(e,hh,s.defaultValues(hh)),wu in e&&(this.nextUpdate=h(e,wu,s.defaultValues(wu))),Su in e&&(this.revokedCertificates=h(e,Su,s.defaultValues(Su))),bu in e&&(this.crlExtensions=h(e,bu,s.defaultValues(bu))),this.signatureAlgorithm=h(e,el,s.defaultValues(el)),this.signatureValue=h(e,tl,s.defaultValues(tl)),e.schema&&this.fromSchema(e.schema)}get tbs(){return ye.vJ.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case"tbs":return Tt;case Xo:return 0;case uh:return new G;case ch:return new dt;case hh:case wu:return new Ot;case Su:return[];case bu:return new Rt;case el:return new G;case tl:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||"CertificateList",value:[Zp(e),G.schema(t.signatureAlgorithm||{names:{blockName:el}}),new et({name:t.signatureValue||tl})]})}fromSchema(e){ge(e,qp);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.tbsView=t.result.tbsCertList.valueBeforeDecodeView,_u in t.result&&(this.version=t.result[_u].valueBlock.valueDec),this.signature=new G({schema:t.result[fh]}),this.issuer=new dt({schema:t.result[dh]}),this.thisUpdate=new Ot({schema:t.result[Au]}),sl in t.result&&(this.nextUpdate=new Ot({schema:t.result[sl]})),ku in t.result&&(this.revokedCertificates=Array.from(t.result[ku],n=>new $p({schema:n}))),Eu in t.result&&(this.crlExtensions=new Rt({schema:t.result[Eu]})),this.signatureAlgorithm=new G({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[];return this.version!==s.defaultValues(Xo)&&e.push(new z({value:this.version})),e.push(this.signature.toSchema()),e.push(this.issuer.toSchema()),e.push(this.thisUpdate.toSchema()),this.nextUpdate&&e.push(this.nextUpdate.toSchema()),this.revokedCertificates&&e.push(new R({value:Array.from(this.revokedCertificates,t=>t.toSchema())})),this.crlExtensions&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new R({value:e})}toSchema(e=!1){let t;if(e)t=this.encodeTBS();else{if(!this.tbsView.byteLength)return s.schema();const n=Ct(this.tbsView);re.assert(n,"TBS Certificate Revocation List"),t=n.result}return new R({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ye.ep.ToHex(this.tbsView),version:this.version,signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==s.defaultValues(Xo)&&(e.version=this.version),this.nextUpdate&&(e.nextUpdate=this.nextUpdate.toJSON()),this.revokedCertificates&&(e.revokedCertificates=Array.from(this.revokedCertificates,t=>t.toJSON())),this.crlExtensions&&(e.crlExtensions=this.crlExtensions.toJSON()),e}isCertificateRevoked(e){if(!this.issuer.isEqual(e.issuer)||!this.revokedCertificates)return!1;for(const t of this.revokedCertificates)if(t.userCertificate.isEqual(e.serialNumber))return!0;return!1}sign(e,t="SHA-1",n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){if(!e)throw new Error("Need to provide a private key for signing");const o=yield n.getSignatureParameters(e,t),{parameters:u}=o;a.signature=o.signatureAlgorithm,a.signatureAlgorithm=o.signatureAlgorithm,a.tbsView=new Uint8Array(a.encodeTBS().toBER());const l=yield n.signWithPrivateKey(a.tbsView,e,u);a.signatureValue=new et({valueHex:l})})()}verify(e={},t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){let a;if(e.issuerCertificate&&(a=e.issuerCertificate.subjectPublicKeyInfo,!n.issuer.isEqual(e.issuerCertificate.subject)))return!1;if(e.publicKeyInfo&&(a=e.publicKeyInfo),!a)throw new Error("Issuer's certificate must be provided as an input parameter");if(n.crlExtensions)for(const o of n.crlExtensions.extensions)if(o.critical&&!zp.includes(o.extnID))return!1;return t.verifyWithPublicKey(n.tbsView,n.signatureValue,a,n.signatureAlgorithm)})()}}return s.CLASS_NAME="CertificateRevocationList",s})();const pi="crlId",vi="crlValue",rl="parsedValue",Gp=[pi,vi];let Wp=(()=>{class s extends he{constructor(e={}){super(),this.crlId=h(e,pi,s.defaultValues(pi)),this.crlValue=h(e,vi,s.defaultValues(vi)),rl in e&&(this.parsedValue=h(e,rl,s.defaultValues(rl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pi:return S;case vi:return new He;case rl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pi:return t===S;case vi:return t instanceof He;case rl:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.id||"id"}),new $({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:t.value||"value"})]})]})}fromSchema(e){ge(e,Gp);const t=ce(e,e,s.schema({names:{id:pi,value:vi}}));if(re.assertSchema(t,this.className),this.crlId=t.result.crlId.valueBlock.toString(),this.crlValue=t.result.crlValue,this.crlId!==bd)throw new Error(`Incorrect CRL_ID value in CRLBag: ${this.crlId}`);this.parsedValue=Cu.fromBER(this.certValue.valueBlock.valueHex)}toSchema(){return this.parsedValue&&(this.crlId=bd,this.crlValue=new de({valueHex:this.parsedValue.toSchema().toBER(!1)})),new R({value:[new Oe({value:this.crlId}),new $({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}toJSON(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}return s.CLASS_NAME="CRLBag",s})();const yi="version",wi="encryptedContentInfo",Qs="unprotectedAttrs",Yp=[yi,wi,Qs];let Nu=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,yi,s.defaultValues(yi)),this.encryptedContentInfo=h(e,wi,s.defaultValues(wi)),Qs in e&&(this.unprotectedAttrs=h(e,Qs,s.defaultValues(Qs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yi:return 0;case wi:return new Ut;case Qs:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yi:return 0===t;case wi:return Ut.compareWithDefault("contentType",t.contentType)&&Ut.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Ut.compareWithDefault("encryptedContent",t.encryptedContent);case Qs:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),Ut.schema(t.encryptedContentInfo||{}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ze({name:t.unprotectedAttrs||S,value:at.schema()})]})]})}fromSchema(e){ge(e,Yp);const t=ce(e,e,s.schema({names:{version:yi,encryptedContentInfo:{names:{blockName:wi}},unprotectedAttrs:Qs}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.encryptedContentInfo=new Ut({schema:t.result.encryptedContentInfo}),Qs in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,n=>new at({schema:n})))}toSchema(){const e=[];return e.push(new z({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}encrypt(e){var t=this;return(0,Ce.Z)(function*(){ct.assert(e,"parameters","object");const n={...e,contentType:"1.2.840.113549.1.7.1"};t.encryptedContentInfo=yield Ge(!0).encryptEncryptedContentInfo(n)})()}decrypt(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){ct.assert(e,"parameters","object");const a={...e,encryptedContentInfo:n.encryptedContentInfo};return t.decryptEncryptedContentInfo(a)})()}}return s.CLASS_NAME="EncryptedData",s})();const cn="encryptionAlgorithm",Xs="encryptedData",nl="parsedValue",Qp=[cn,Xs];let im=(()=>{class s extends he{constructor(e={}){super(),this.encryptionAlgorithm=h(e,cn,s.defaultValues(cn)),this.encryptedData=h(e,Xs,s.defaultValues(Xs)),nl in e&&(this.parsedValue=h(e,nl,s.defaultValues(nl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case cn:return new G;case Xs:return new de;case nl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case cn:return G.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case Xs:return t.isEqual(s.defaultValues(e));case nl:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.encryptionAlgorithm||{names:{blockName:cn}}),new ft({value:[new de({name:t.encryptedData||Xs}),new de({idBlock:{isConstructed:!0},name:t.encryptedData||Xs})]})]})}fromSchema(e){ge(e,Qp);const t=ce(e,e,s.schema({names:{encryptionAlgorithm:{names:{blockName:cn}},encryptedData:Xs}}));re.assertSchema(t,this.className),this.encryptionAlgorithm=new G({schema:t.result.encryptionAlgorithm}),this.encryptedData=t.result.encryptedData}toSchema(){return new R({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}toJSON(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}parseInternalValues(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){const o=yield new Nu({encryptedContentInfo:new Ut({contentEncryptionAlgorithm:n.encryptionAlgorithm,encryptedContent:n.encryptedData})}).decrypt(e,t);n.parsedValue=fo.fromBER(o)})()}makeInternalValues(e){var t=this;return(0,Ce.Z)(function*(){if(!t.parsedValue)throw new Error('Please initialize "parsedValue" first');const n=new Nu,a={...e,contentToEncrypt:t.parsedValue.toSchema().toBER(!1)};if(yield n.encrypt(a),!n.encryptedContentInfo.encryptedContent)throw new Error("The filed `encryptedContent` in EncryptedContentInfo is empty");t.encryptionAlgorithm=n.encryptedContentInfo.contentEncryptionAlgorithm,t.encryptedData=n.encryptedContentInfo.encryptedContent})()}}return s.CLASS_NAME="PKCS8ShroudedKeyBag",s})();const Si="secretTypeId",bi="secretValue",Xp=[Si,bi];let ev=(()=>{class s extends he{constructor(e={}){super(),this.secretTypeId=h(e,Si,s.defaultValues(Si)),this.secretValue=h(e,bi,s.defaultValues(bi)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Si:return S;case bi:return new He;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Si:return t===S;case bi:return t instanceof He;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.id||"id"}),new $({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:t.value||"value"})]})]})}fromSchema(e){ge(e,Xp);const t=ce(e,e,s.schema({names:{id:Si,value:bi}}));re.assertSchema(t,this.className),this.secretTypeId=t.result.secretTypeId.valueBlock.toString(),this.secretValue=t.result.secretValue}toSchema(){return new R({value:[new Oe({value:this.secretTypeId}),new $({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}toJSON(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}return s.CLASS_NAME="SecretBag",s})();class er{static getItems(){return this.items||(this.items={},er.register("1.2.840.113549.1.12.10.1.1",fo),er.register("1.2.840.113549.1.12.10.1.2",im),er.register("1.2.840.113549.1.12.10.1.3",oh),er.register("1.2.840.113549.1.12.10.1.4",Wp),er.register("1.2.840.113549.1.12.10.1.5",ev),er.register("1.2.840.113549.1.12.10.1.6",dn)),this.items}static register(i,e){this.getItems()[i]=e}static find(i){return this.getItems()[i]||null}}const hn="bagId",fn="bagValue",Es="bagAttributes",tv=[hn,fn,Es];let il=(()=>{class s extends he{constructor(e={}){super(),this.bagId=h(e,hn,s.defaultValues(hn)),this.bagValue=h(e,fn,s.defaultValues(fn)),Es in e&&(this.bagAttributes=h(e,Es,s.defaultValues(Es))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hn:return S;case fn:return new He;case Es:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case hn:return t===S;case fn:return t instanceof He;case Es:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.bagId||hn}),new $({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:t.bagValue||fn})]}),new At({optional:!0,value:[new ze({name:t.bagAttributes||Es,value:at.schema()})]})]})}fromSchema(e){ge(e,tv);const t=ce(e,e,s.schema({names:{bagId:hn,bagValue:fn,bagAttributes:Es}}));re.assertSchema(t,this.className),this.bagId=t.result.bagId.valueBlock.toString();const n=er.find(this.bagId);if(!n)throw new Error(`Invalid BAG_ID for SafeBag: ${this.bagId}`);this.bagValue=new n({schema:t.result.bagValue}),Es in t.result&&(this.bagAttributes=Array.from(t.result.bagAttributes,a=>new at({schema:a})))}toSchema(){const e=[new Oe({value:this.bagId}),new $({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return this.bagAttributes&&e.push(new At({value:Array.from(this.bagAttributes,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return this.bagAttributes&&(e.bagAttributes=Array.from(this.bagAttributes,t=>t.toJSON())),e}}return s.CLASS_NAME="SafeBag",s})();const _i="safeBags";let dn=(()=>{class s extends he{constructor(e={}){super(),this.safeBags=h(e,_i,s.defaultValues(_i)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===_i?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===_i?0===t.length:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.safeBags||S,value:il.schema()})]})}fromSchema(e){ge(e,[_i]);const t=ce(e,e,s.schema({names:{safeBags:_i}}));re.assertSchema(t,this.className),this.safeBags=Array.from(t.result.safeBags,n=>new il({schema:n}))}toSchema(){return new R({value:Array.from(this.safeBags,e=>e.toSchema())})}toJSON(){return{safeBags:Array.from(this.safeBags,e=>e.toJSON())}}}return s.CLASS_NAME="SafeContents",s})();const al="otherCertFormat",ol="otherCert",sv=[al,ol];class tr extends he{constructor(i={}){super(),this.otherCertFormat=h(i,al,tr.defaultValues(al)),this.otherCert=h(i,ol,tr.defaultValues(ol)),i.schema&&this.fromSchema(i.schema)}static defaultValues(i){switch(i){case al:return S;case ol:return new He;default:return super.defaultValues(i)}}static schema(i={}){const e=h(i,"names",{});return new R({name:e.blockName||S,value:[new Oe({name:e.otherCertFormat||al}),new He({name:e.otherCert||ol})]})}fromSchema(i){ge(i,sv);const e=ce(i,i,tr.schema());re.assertSchema(e,this.className),this.otherCertFormat=e.result.otherCertFormat.valueBlock.toString(),this.otherCert=e.result.otherCert}toSchema(){return new R({value:[new Oe({value:this.otherCertFormat}),this.otherCert]})}toJSON(){const i={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof He||(i.otherCert=this.otherCert.toJSON()),i}}const ll="certificates",rv=[ll];let Ai=(()=>{class s extends he{constructor(e={}){super(),this.certificates=h(e,ll,s.defaultValues(ll)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===ll?[]:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new At({name:t.blockName||S,value:[new ze({name:t.certificates||ll,value:new ft({value:[ts.schema(),new $({idBlock:{tagClass:3,tagNumber:0},value:[new He]}),new $({idBlock:{tagClass:3,tagNumber:1},value:[new R]}),new $({idBlock:{tagClass:3,tagNumber:2},value:on.schema().valueBlock.value}),new $({idBlock:{tagClass:3,tagNumber:3},value:tr.schema().valueBlock.value})]})})]})}fromSchema(e){ge(e,rv);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.certificates=Array.from(t.result.certificates||[],n=>{const a=n.idBlock.tagNumber;if(1===n.idBlock.tagClass)return new ts({schema:n});const o=new R({value:n.valueBlock.value});switch(a){case 1:return 1===o.valueBlock.value[0].valueBlock.value[0].valueBlock.valueDec?new on({schema:o}):new zc({schema:o});case 2:return new on({schema:o});case 3:return new tr({schema:o})}return n})}toSchema(){return new At({value:Array.from(this.certificates,e=>{switch(!0){case e instanceof ts:return e.toSchema();case e instanceof zc:return new $({idBlock:{tagClass:3,tagNumber:1},value:e.toSchema().valueBlock.value});case e instanceof on:return new $({idBlock:{tagClass:3,tagNumber:2},value:e.toSchema().valueBlock.value});case e instanceof tr:return new $({idBlock:{tagClass:3,tagNumber:3},value:e.toSchema().valueBlock.value})}return e.toSchema()})})}toJSON(){return{certificates:Array.from(this.certificates,e=>e.toJSON())}}}return s.CLASS_NAME="CertificateSet",s})();const ul="otherRevInfoFormat",cl="otherRevInfo",nv=[ul,cl];let Iu=(()=>{class s extends he{constructor(e={}){super(),this.otherRevInfoFormat=h(e,ul,s.defaultValues(ul)),this.otherRevInfo=h(e,cl,s.defaultValues(cl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ul:return S;case cl:return new He;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.otherRevInfoFormat||ul}),new He({name:t.otherRevInfo||cl})]})}fromSchema(e){ge(e,nv);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.otherRevInfoFormat=t.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=t.result.otherRevInfo}toSchema(){return new R({value:[new Oe({value:this.otherRevInfoFormat}),this.otherRevInfo]})}toJSON(){const e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof He||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}return s.CLASS_NAME="OtherRevocationInfoFormat",s})();const hl="crls",mh="otherRevocationInfos",iv=[hl];let Tu=(()=>{class s extends he{constructor(e={}){super(),this.crls=h(e,hl,s.defaultValues(hl)),this.otherRevocationInfos=h(e,mh,s.defaultValues(mh)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case hl:case mh:return[];default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new At({name:t.blockName||S,value:[new ze({name:t.crls||S,value:new ft({value:[Cu.schema(),new $({idBlock:{tagClass:3,tagNumber:1},value:[new Oe,new He]})]})})]})}fromSchema(e){ge(e,iv);const t=ce(e,e,s.schema({names:{crls:hl}}));if(re.assertSchema(t,this.className),t.result.crls)for(const n of t.result.crls)1===n.idBlock.tagClass?this.crls.push(new Cu({schema:n})):this.otherRevocationInfos.push(new Iu({schema:n}))}toSchema(){const e=[];return e.push(...Array.from(this.crls,t=>t.toSchema())),e.push(...Array.from(this.otherRevocationInfos,t=>{const n=t.toSchema();return n.idBlock.tagClass=3,n.idBlock.tagNumber=1,n})),new At({value:e})}toJSON(){return{crls:Array.from(this.crls,e=>e.toJSON()),otherRevocationInfos:Array.from(this.otherRevocationInfos,e=>e.toJSON())}}}return s.CLASS_NAME="RevocationInfoChoices",s})();const fl="certs",mn="crls",av=[fl,mn];let gh=(()=>{class s extends he{constructor(e={}){super(),this.crls=h(e,mn,s.defaultValues(mn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case fl:return new Ai;case mn:return new Tu;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case fl:return 0===t.certificates.length;case mn:return 0===t.crls.length&&0===t.otherRevocationInfos.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new $({name:t.certs||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ai.schema().valueBlock.value}),new $({name:t.crls||S,optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Tu.schema().valueBlock.value})]})}fromSchema(e){ge(e,av);const t=ce(e,e,s.schema({names:{certs:fl,crls:mn}}));re.assertSchema(t,this.className),fl in t.result&&(this.certs=new Ai({schema:new At({value:t.result.certs.valueBlock.value})})),mn in t.result&&(this.crls=new Tu({schema:new At({value:t.result.crls.valueBlock.value})}))}toSchema(){const e=[];return this.certs&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value})),this.crls&&e.push(new $({idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})),new R({value:e})}toJSON(){const e={};return this.certs&&(e.certs=this.certs.toJSON()),this.crls&&(e.crls=this.crls.toJSON()),e}}return s.CLASS_NAME="OriginatorInfo",s})();const dl="issuer",ml="serialNumber",ov=[dl,ml];let Vt=(()=>{class s extends he{constructor(e={}){super(),this.issuer=h(e,dl,s.defaultValues(dl)),this.serialNumber=h(e,ml,s.defaultValues(ml)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case dl:return new dt;case ml:return new z;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[dt.schema(t.issuer||{}),new z({name:t.serialNumber||S})]})}fromSchema(e){ge(e,ov);const t=ce(e,e,s.schema({names:{issuer:{names:{blockName:dl}},serialNumber:ml}}));re.assertSchema(t,this.className),this.issuer=new dt({schema:t.result.issuer}),this.serialNumber=t.result.serialNumber}toSchema(){return new R({value:[this.issuer.toSchema(),this.serialNumber]})}toJSON(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}return s.CLASS_NAME="IssuerAndSerialNumber",s})();const Bu="variant",gl="value",lv=["blockName"];let uv=(()=>{class s extends he{constructor(e={}){super(),this.variant=h(e,Bu,s.defaultValues(Bu)),gl in e&&(this.value=h(e,gl,s.defaultValues(gl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Bu:return-1;case gl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Bu:return-1===t;case gl:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new ft({value:[Vt.schema({names:{blockName:t.blockName||S}}),new Ue({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:0}})]})}fromSchema(e){ge(e,lv);const t=ce(e,e,s.schema({names:{blockName:"blockName"}}));re.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Vt({schema:t.result.blockName})):(this.variant=2,this.value=new de({valueHex:t.result.blockName.valueBlock.valueHex}))}toSchema(){switch(this.variant){case 1:if(!(this.value instanceof Vt))throw new Error("Incorrect type of RecipientIdentifier.value. It should be IssuerAndSerialNumber.");return this.value.toSchema();case 2:if(!(this.value instanceof de))throw new Error("Incorrect type of RecipientIdentifier.value. It should be ASN.1 OctetString.");return new Ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.value.valueBlock.valueHexView});default:return new He}}toJSON(){const e={variant:this.variant};return(1===this.variant||2===this.variant)&&this.value&&(e.value=this.value.toJSON()),e}}return s.CLASS_NAME="RecipientIdentifier",s})();const gn="version",ki="rid",Ei="keyEncryptionAlgorithm",Ci="encryptedKey",xu="recipientCertificate",cv=[gn,ki,Ei,Ci];let ph=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,gn,s.defaultValues(gn)),this.rid=h(e,ki,s.defaultValues(ki)),this.keyEncryptionAlgorithm=h(e,Ei,s.defaultValues(Ei)),this.encryptedKey=h(e,Ci,s.defaultValues(Ci)),this.recipientCertificate=h(e,xu,s.defaultValues(xu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case gn:return-1;case ki:return{};case Ei:return new G;case Ci:return new de;case xu:return new ts;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case gn:return t===s.defaultValues(gn);case ki:return 0===Object.keys(t).length;case Ei:case Ci:return t.isEqual(s.defaultValues(e));case xu:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),uv.schema(t.rid||{}),G.schema(t.keyEncryptionAlgorithm||{}),new de({name:t.encryptedKey||S})]})}fromSchema(e){ge(e,cv);const t=ce(e,e,s.schema({names:{version:gn,rid:{names:{blockName:ki}},keyEncryptionAlgorithm:{names:{blockName:Ei}},encryptedKey:Ci}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.rid=3===t.result.rid.idBlock.tagClass?new de({valueHex:t.result.rid.valueBlock.valueHex}):new Vt({schema:t.result.rid}),this.keyEncryptionAlgorithm=new G({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return this.rid instanceof Vt?(this.version=0,e.push(new z({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new z({value:this.version})),e.push(new Ue({idBlock:{tagClass:3,tagNumber:0},valueHex:this.rid.valueBlock.valueHexView}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new R({value:e})}toJSON(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}return s.CLASS_NAME="KeyTransRecipientInfo",s})();const Ni="algorithm",Ii="publicKey",hv=[Ni,Ii];let vh=(()=>{class s extends he{constructor(e={}){super(),this.algorithm=h(e,Ni,s.defaultValues(Ni)),this.publicKey=h(e,Ii,s.defaultValues(Ii)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ni:return new G;case Ii:return new et;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ni:case Ii:return t.isEqual(s.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.algorithm||{}),new et({name:t.publicKey||S})]})}fromSchema(e){ge(e,hv);const t=ce(e,e,s.schema({names:{algorithm:{names:{blockName:Ni}},publicKey:Ii}}));re.assertSchema(t,this.className),this.algorithm=new G({schema:t.result.algorithm}),this.publicKey=t.result.publicKey}toSchema(){return new R({value:[this.algorithm.toSchema(),this.publicKey]})}toJSON(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}return s.CLASS_NAME="OriginatorPublicKey",s})();const Ru="variant",pl="value",fv=["blockName"];let Ou=(()=>{class s extends he{constructor(e={}){super(),this.variant=h(e,Ru,s.defaultValues(Ru)),pl in e&&(this.value=h(e,pl,s.defaultValues(pl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ru:return-1;case pl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ru:return-1===t;case pl:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new ft({value:[Vt.schema({names:{blockName:t.blockName||S}}),new Ue({idBlock:{tagClass:3,tagNumber:0},name:t.blockName||S}),new $({idBlock:{tagClass:3,tagNumber:1},name:t.blockName||S,value:vh.schema().valueBlock.value})]})}fromSchema(e){ge(e,fv);const t=ce(e,e,s.schema({names:{blockName:"blockName"}}));re.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Vt({schema:t.result.blockName})):0===t.result.blockName.idBlock.tagNumber?(t.result.blockName.idBlock.tagClass=1,t.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=t.result.blockName):(this.variant=3,this.value=new vh({schema:new R({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:{const e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e}default:return new He}}toJSON(){const e={variant:this.variant};return(1===this.variant||2===this.variant||3===this.variant)&&(e.value=this.value.toJSON()),e}}return s.CLASS_NAME="OriginatorIdentifierOrKey",s})();const Ti="keyAttrId",fs="keyAttr",dv=[Ti,fs];let Bi=(()=>{class s extends he{constructor(e={}){super(),this.keyAttrId=h(e,Ti,s.defaultValues(Ti)),fs in e&&(this.keyAttr=h(e,fs,s.defaultValues(fs))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ti:return S;case fs:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ti:return"string"==typeof t&&t===S;case fs:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({optional:t.optional||!0,name:t.blockName||S,value:[new Oe({name:t.keyAttrId||S}),new He({optional:!0,name:t.keyAttr||S})]})}fromSchema(e){ge(e,dv);const t=ce(e,e,s.schema({names:{keyAttrId:Ti,keyAttr:fs}}));re.assertSchema(t,this.className),this.keyAttrId=t.result.keyAttrId.valueBlock.toString(),fs in t.result&&(this.keyAttr=t.result.keyAttr)}toSchema(){const e=[];return e.push(new Oe({value:this.keyAttrId})),fs in this&&e.push(this.keyAttr),new R({value:e})}toJSON(){const e={keyAttrId:this.keyAttrId};return fs in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}return s.CLASS_NAME="OtherKeyAttribute",s})();const pn="subjectKeyIdentifier",sr="date",rr="other",mv=[pn,sr,rr];let yh=(()=>{class s extends he{constructor(e={}){super(),this.subjectKeyIdentifier=h(e,pn,s.defaultValues(pn)),sr in e&&(this.date=h(e,sr,s.defaultValues(sr))),rr in e&&(this.other=h(e,rr,s.defaultValues(rr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case pn:return new de;case sr:return new ht;case rr:return new Bi;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case pn:return t.isEqual(s.defaultValues(pn));case sr:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case rr:return t.keyAttrId===S&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new de({name:t.subjectKeyIdentifier||S}),new ht({optional:!0,name:t.date||S}),Bi.schema(t.other||{})]})}fromSchema(e){ge(e,mv);const t=ce(e,e,s.schema({names:{subjectKeyIdentifier:pn,date:sr,other:{names:{blockName:rr}}}}));re.assertSchema(t,this.className),this.subjectKeyIdentifier=t.result.subjectKeyIdentifier,sr in t.result&&(this.date=t.result.date),rr in t.result&&(this.other=new Bi({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.subjectKeyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new R({value:e})}toJSON(){const e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return this.date&&(e.date=this.date.toJSON()),this.other&&(e.other=this.other.toJSON()),e}}return s.CLASS_NAME="RecipientKeyIdentifier",s})();const Vu="variant",Pu="value",gv=["blockName"];let vl=(()=>{class s extends he{constructor(e={}){super(),this.variant=h(e,Vu,s.defaultValues(Vu)),this.value=h(e,Pu,s.defaultValues(Pu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vu:return-1;case Pu:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vu:return-1===t;case Pu:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new ft({value:[Vt.schema(t.issuerAndSerialNumber||{names:{blockName:t.blockName||S}}),new $({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:0},value:yh.schema(t.rKeyId||{names:{blockName:t.blockName||S}}).valueBlock.value})]})}fromSchema(e){ge(e,gv);const t=ce(e,e,s.schema({names:{blockName:"blockName"}}));re.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Vt({schema:t.result.blockName})):(this.variant=2,this.value=new yh({schema:new R({value:t.result.blockName.valueBlock.value})}))}toSchema(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new $({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new He}}toJSON(){const e={variant:this.variant};return(1===this.variant||2===this.variant)&&(e.value=this.value.toJSON()),e}}return s.CLASS_NAME="KeyAgreeRecipientIdentifier",s})();const xi="rid",vn="encryptedKey",pv=[xi,vn];let wh=(()=>{class s extends he{constructor(e={}){super(),this.rid=h(e,xi,s.defaultValues(xi)),this.encryptedKey=h(e,vn,s.defaultValues(vn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case xi:return new vl;case vn:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case xi:return-1===t.variant&&!("value"in t);case vn:return t.isEqual(s.defaultValues(vn));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[vl.schema(t.rid||{}),new de({name:t.encryptedKey||S})]})}fromSchema(e){ge(e,pv);const t=ce(e,e,s.schema({names:{rid:{names:{blockName:xi}},encryptedKey:vn}}));re.assertSchema(t,this.className),this.rid=new vl({schema:t.result.rid}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new R({value:[this.rid.toSchema(),this.encryptedKey]})}toJSON(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}return s.CLASS_NAME="RecipientEncryptedKey",s})();const Du="encryptedKeys",am="RecipientEncryptedKeys",vv=[am];let Uu=(()=>{class s extends he{constructor(e={}){super(),this.encryptedKeys=h(e,Du,s.defaultValues(Du)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){return e===Du?[]:super.defaultValues(e)}static compareWithDefault(e,t){return e===Du?0===t.length:super.defaultValues(e)}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.RecipientEncryptedKeys||S,value:wh.schema()})]})}fromSchema(e){ge(e,vv);const t=ce(e,e,s.schema({names:{RecipientEncryptedKeys:am}}));re.assertSchema(t,this.className),this.encryptedKeys=Array.from(t.result.RecipientEncryptedKeys,n=>new wh({schema:n}))}toSchema(){return new R({value:Array.from(this.encryptedKeys,e=>e.toSchema())})}toJSON(){return{encryptedKeys:Array.from(this.encryptedKeys,e=>e.toJSON())}}}return s.CLASS_NAME="RecipientEncryptedKeys",s})();const Ri="version",Oi="originator",Cs="ukm",Vi="keyEncryptionAlgorithm",Pi="recipientEncryptedKeys",Lu="recipientCertificate",Mu="recipientPublicKey",yv=[Ri,Oi,Cs,Vi,Pi];let Sh=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,Ri,s.defaultValues(Ri)),this.originator=h(e,Oi,s.defaultValues(Oi)),Cs in e&&(this.ukm=h(e,Cs,s.defaultValues(Cs))),this.keyEncryptionAlgorithm=h(e,Vi,s.defaultValues(Vi)),this.recipientEncryptedKeys=h(e,Pi,s.defaultValues(Pi)),this.recipientCertificate=h(e,Lu,s.defaultValues(Lu)),this.recipientPublicKey=h(e,Mu,s.defaultValues(Mu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ri:return 0;case Oi:return new Ou;case Cs:return new de;case Vi:return new G;case Pi:return new Uu;case Lu:return new ts;case Mu:return null;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ri:return 0===t;case Oi:return-1===t.variant&&!("value"in t);case Cs:return t.isEqual(s.defaultValues(Cs));case Vi:return t.algorithmId===S&&!("algorithmParams"in t);case Pi:return 0===t.encryptedKeys.length;case Lu:case Mu:return!1;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),new $({idBlock:{tagClass:3,tagNumber:0},value:[Ou.schema(t.originator||{})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new de({name:t.ukm||S})]}),G.schema(t.keyEncryptionAlgorithm||{}),Uu.schema(t.recipientEncryptedKeys||{})]})}fromSchema(e){ge(e,yv);const t=ce(e,e,s.schema({names:{version:Ri,originator:{names:{blockName:Oi}},ukm:Cs,keyEncryptionAlgorithm:{names:{blockName:Vi}},recipientEncryptedKeys:{names:{blockName:Pi}}}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.originator=new Ou({schema:t.result.originator}),Cs in t.result&&(this.ukm=t.result.ukm),this.keyEncryptionAlgorithm=new G({schema:t.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new Uu({schema:t.result.recipientEncryptedKeys})}toSchema(){const e=[];return e.push(new z({value:this.version})),e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),this.ukm&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new R({value:e})}toJSON(){const e={version:this.version,originator:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),recipientEncryptedKeys:this.recipientEncryptedKeys.toJSON()};return this.ukm&&(e.ukm=this.ukm.toJSON()),e}}return s.CLASS_NAME="KeyAgreeRecipientInfo",s})();const yn="keyIdentifier",nr="date",ir="other",wv=[yn,nr,ir];let Fu=(()=>{class s extends he{constructor(e={}){super(),this.keyIdentifier=h(e,yn,s.defaultValues(yn)),nr in e&&(this.date=h(e,nr,s.defaultValues(nr))),ir in e&&(this.other=h(e,ir,s.defaultValues(ir))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case yn:return new de;case nr:return new ht;case ir:return new Bi;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case yn:return t.isEqual(s.defaultValues(yn));case nr:return 0===t.year&&0===t.month&&0===t.day&&0===t.hour&&0===t.minute&&0===t.second&&0===t.millisecond;case ir:return t.compareWithDefault("keyAttrId",t.keyAttrId)&&!("keyAttr"in t);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new de({name:t.keyIdentifier||S}),new ht({optional:!0,name:t.date||S}),Bi.schema(t.other||{})]})}fromSchema(e){ge(e,wv);const t=ce(e,e,s.schema({names:{keyIdentifier:yn,date:nr,other:{names:{blockName:ir}}}}));re.assertSchema(t,this.className),this.keyIdentifier=t.result.keyIdentifier,nr in t.result&&(this.date=t.result.date),ir in t.result&&(this.other=new Bi({schema:t.result.other}))}toSchema(){const e=[];return e.push(this.keyIdentifier),this.date&&e.push(this.date),this.other&&e.push(this.other.toSchema()),new R({value:e})}toJSON(){const e={keyIdentifier:this.keyIdentifier.toJSON()};return this.date&&(e.date=this.date),this.other&&(e.other=this.other.toJSON()),e}}return s.CLASS_NAME="KEKIdentifier",s})();const Di="version",Ui="kekid",Li="keyEncryptionAlgorithm",wn="encryptedKey",Hu="preDefinedKEK",Sv=[Di,Ui,Li,wn];let bh=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,Di,s.defaultValues(Di)),this.kekid=h(e,Ui,s.defaultValues(Ui)),this.keyEncryptionAlgorithm=h(e,Li,s.defaultValues(Li)),this.encryptedKey=h(e,wn,s.defaultValues(wn)),this.preDefinedKEK=h(e,Hu,s.defaultValues(Hu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Di:return 0;case Ui:return new Fu;case Li:return new G;case wn:return new de;case Hu:return Tt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"KEKRecipientInfo":return t===s.defaultValues(Di);case Ui:return t.compareWithDefault("keyIdentifier",t.keyIdentifier)&&!("date"in t)&&!("other"in t);case Li:return t.algorithmId===S&&!("algorithmParams"in t);case wn:return t.isEqual(s.defaultValues(wn));case Hu:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),Fu.schema(t.kekid||{}),G.schema(t.keyEncryptionAlgorithm||{}),new de({name:t.encryptedKey||S})]})}fromSchema(e){ge(e,Sv);const t=ce(e,e,s.schema({names:{version:Di,kekid:{names:{blockName:Ui}},keyEncryptionAlgorithm:{names:{blockName:Li}},encryptedKey:wn}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.kekid=new Fu({schema:t.result.kekid}),this.keyEncryptionAlgorithm=new G({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){return new R({value:[new z({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}toJSON(){return{version:this.version,kekid:this.kekid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}return s.CLASS_NAME="KEKRecipientInfo",s})();const Mi="version",ar="keyDerivationAlgorithm",Fi="keyEncryptionAlgorithm",Sn="encryptedKey",Ju="password",bv=[Mi,ar,Fi,Sn];let _h=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,Mi,s.defaultValues(Mi)),ar in e&&(this.keyDerivationAlgorithm=h(e,ar,s.defaultValues(ar))),this.keyEncryptionAlgorithm=h(e,Fi,s.defaultValues(Fi)),this.encryptedKey=h(e,Sn,s.defaultValues(Sn)),this.password=h(e,Ju,s.defaultValues(Ju)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mi:return-1;case ar:case Fi:return new G;case Sn:return new de;case Ju:return Tt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mi:return-1===t;case ar:case Fi:return t.algorithmId===S&&!("algorithmParams"in t);case Sn:return t.isEqual(s.defaultValues(Sn));case Ju:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),new $({name:t.keyDerivationAlgorithm||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:G.schema().valueBlock.value}),G.schema(t.keyEncryptionAlgorithm||{}),new de({name:t.encryptedKey||S})]})}fromSchema(e){ge(e,bv);const t=ce(e,e,s.schema({names:{version:Mi,keyDerivationAlgorithm:ar,keyEncryptionAlgorithm:{names:{blockName:Fi}},encryptedKey:Sn}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,ar in t.result&&(this.keyDerivationAlgorithm=new G({schema:new R({value:t.result.keyDerivationAlgorithm.valueBlock.value})})),this.keyEncryptionAlgorithm=new G({schema:t.result.keyEncryptionAlgorithm}),this.encryptedKey=t.result.encryptedKey}toSchema(){const e=[];return e.push(new z({value:this.version})),this.keyDerivationAlgorithm&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new R({value:e})}toJSON(){const e={version:this.version,keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()};return this.keyDerivationAlgorithm&&(e.keyDerivationAlgorithm=this.keyDerivationAlgorithm.toJSON()),e}}return s.CLASS_NAME="PasswordRecipientInfo",s})();const Hi="oriType",bn="oriValue",_v=[Hi,bn];let om=(()=>{class s extends he{constructor(e={}){super(),this.oriType=h(e,Hi,s.defaultValues(Hi)),this.oriValue=h(e,bn,s.defaultValues(bn)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Hi:return S;case bn:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Hi:return t===S;case bn:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.oriType||S}),new He({name:t.oriValue||S})]})}fromSchema(e){ge(e,_v);const t=ce(e,e,s.schema({names:{oriType:Hi,oriValue:bn}}));re.assertSchema(t,this.className),this.oriType=t.result.oriType.valueBlock.toString(),this.oriValue=t.result.oriValue}toSchema(){return new R({value:[new Oe({value:this.oriType}),this.oriValue]})}toJSON(){const e={oriType:this.oriType};return s.compareWithDefault(bn,this.oriValue)||(e.oriValue=this.oriValue.toJSON()),e}}return s.CLASS_NAME="OtherRecipientInfo",s})();const Ku="variant",yl="value",Av=["blockName"];let Ji=(()=>{class s extends he{constructor(e={}){super(),this.variant=h(e,Ku,s.defaultValues(Ku)),yl in e&&(this.value=h(e,yl,s.defaultValues(yl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ku:return-1;case yl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ku:return t===s.defaultValues(e);case yl:return 0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new ft({value:[ph.schema({names:{blockName:t.blockName||S}}),new $({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:1},value:Sh.schema().valueBlock.value}),new $({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:2},value:bh.schema().valueBlock.value}),new $({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:3},value:_h.schema().valueBlock.value}),new $({name:t.blockName||S,idBlock:{tagClass:3,tagNumber:4},value:om.schema().valueBlock.value})]})}fromSchema(e){ge(e,Av);const t=ce(e,e,s.schema({names:{blockName:"blockName"}}));if(re.assertSchema(t,this.className),1===t.result.blockName.idBlock.tagClass)this.variant=1,this.value=new ph({schema:t.result.blockName});else{const n=new R({value:t.result.blockName.valueBlock.value});switch(t.result.blockName.idBlock.tagNumber){case 1:this.variant=2,this.value=new Sh({schema:n});break;case 2:this.variant=3,this.value=new bh({schema:n});break;case 3:this.variant=4,this.value=new _h({schema:n});break;case 4:this.variant=5,this.value=new om({schema:n});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}toSchema(){it.assertEmpty(this.value,"value","RecipientInfo");const e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new He}}toJSON(){const e={variant:this.variant};return this.value&&this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}return s.CLASS_NAME="RecipientInfo",s})();const or="hashAlgorithm",lr="maskGenAlgorithm",ur="pSourceAlgorithm",kv=[or,lr,ur];let Ah=(()=>{class s extends he{constructor(e={}){super(),this.hashAlgorithm=h(e,or,s.defaultValues(or)),this.maskGenAlgorithm=h(e,lr,s.defaultValues(lr)),this.pSourceAlgorithm=h(e,ur,s.defaultValues(ur)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case or:return new G({algorithmId:"1.3.14.3.2.26",algorithmParams:new _t});case lr:return new G({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new G({algorithmId:"1.3.14.3.2.26",algorithmParams:new _t}).toSchema()});case ur:return new G({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new de({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new $({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[G.schema(t.hashAlgorithm||{})]}),new $({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[G.schema(t.maskGenAlgorithm||{})]}),new $({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[G.schema(t.pSourceAlgorithm||{})]})]})}fromSchema(e){ge(e,kv);const t=ce(e,e,s.schema({names:{hashAlgorithm:{names:{blockName:or}},maskGenAlgorithm:{names:{blockName:lr}},pSourceAlgorithm:{names:{blockName:ur}}}}));re.assertSchema(t,this.className),or in t.result&&(this.hashAlgorithm=new G({schema:t.result.hashAlgorithm})),lr in t.result&&(this.maskGenAlgorithm=new G({schema:t.result.maskGenAlgorithm})),ur in t.result&&(this.pSourceAlgorithm=new G({schema:t.result.pSourceAlgorithm}))}toSchema(){const e=[];return this.hashAlgorithm.isEqual(s.defaultValues(or))||e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(s.defaultValues(lr))||e.push(new $({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(s.defaultValues(ur))||e.push(new $({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new R({value:e})}toJSON(){const e={};return this.hashAlgorithm.isEqual(s.defaultValues(or))||(e.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(s.defaultValues(lr))||(e.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(s.defaultValues(ur))||(e.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),e}}return s.CLASS_NAME="RSAESOAEPParams",s})();const Ki="keyInfo",cr="entityUInfo",ji="suppPubInfo",Ev=[Ki,cr,ji];let lm=(()=>{class s extends he{constructor(e={}){super(),this.keyInfo=h(e,Ki,s.defaultValues(Ki)),cr in e&&(this.entityUInfo=h(e,cr,s.defaultValues(cr))),this.suppPubInfo=h(e,ji,s.defaultValues(ji)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ki:return new G;case cr:case ji:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ki:case cr:case ji:return t.isEqual(s.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.keyInfo||{}),new $({name:t.entityUInfo||S,idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new de]}),new $({name:t.suppPubInfo||S,idBlock:{tagClass:3,tagNumber:2},value:[new de]})]})}fromSchema(e){ge(e,Ev);const t=ce(e,e,s.schema({names:{keyInfo:{names:{blockName:Ki}},entityUInfo:cr,suppPubInfo:ji}}));re.assertSchema(t,this.className),this.keyInfo=new G({schema:t.result.keyInfo}),cr in t.result&&(this.entityUInfo=t.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=t.result.suppPubInfo.valueBlock.value[0]}toSchema(){const e=[];return e.push(this.keyInfo.toSchema()),this.entityUInfo&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new $({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new R({value:e})}toJSON(){const e={keyInfo:this.keyInfo.toJSON(),suppPubInfo:this.suppPubInfo.toJSON()};return this.entityUInfo&&(e.entityUInfo=this.entityUInfo.toJSON()),e}}return s.CLASS_NAME="ECCCMSSharedInfo",s})();const $i="version",hr="originatorInfo",qi="recipientInfos",Zi="encryptedContentInfo",fr="unprotectedAttrs",Cv=[$i,hr,qi,Zi,fr],um={kdfAlgorithm:"SHA-512",kekEncryptionLength:256},Nv={"P-256":256,"P-384":384,"P-521":528};let cm=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,$i,s.defaultValues($i)),hr in e&&(this.originatorInfo=h(e,hr,s.defaultValues(hr))),this.recipientInfos=h(e,qi,s.defaultValues(qi)),this.encryptedContentInfo=h(e,Zi,s.defaultValues(Zi)),fr in e&&(this.unprotectedAttrs=h(e,fr,s.defaultValues(fr))),this.policy={disableSplit:!!e.disableSplit},e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case $i:return 0;case hr:return new gh;case qi:return[];case Zi:return new Ut;case fr:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case $i:return t===s.defaultValues(e);case hr:return 0===t.certs.certificates.length&&0===t.crls.crls.length;case qi:case fr:return 0===t.length;case Zi:return Ut.compareWithDefault("contentType",t.contentType)&&Ut.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&Ut.compareWithDefault("encryptedContent",t.encryptedContent);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||S}),new $({name:t.originatorInfo||S,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:gh.schema().valueBlock.value}),new At({value:[new ze({name:t.recipientInfos||S,value:Ji.schema()})]}),Ut.schema(t.encryptedContentInfo||{}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ze({name:t.unprotectedAttrs||S,value:at.schema()})]})]})}fromSchema(e){ge(e,Cv);const t=ce(e,e,s.schema({names:{version:$i,originatorInfo:hr,recipientInfos:qi,encryptedContentInfo:{names:{blockName:Zi}},unprotectedAttrs:fr}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,hr in t.result&&(this.originatorInfo=new gh({schema:new R({value:t.result.originatorInfo.valueBlock.value})})),this.recipientInfos=Array.from(t.result.recipientInfos,n=>new Ji({schema:n})),this.encryptedContentInfo=new Ut({schema:t.result.encryptedContentInfo}),fr in t.result&&(this.unprotectedAttrs=Array.from(t.result.unprotectedAttrs,n=>new at({schema:n})))}toSchema(){const e=[];return e.push(new z({value:this.version})),this.originatorInfo&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new At({value:Array.from(this.recipientInfos,t=>t.toSchema())})),e.push(this.encryptedContentInfo.toSchema()),this.unprotectedAttrs&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={version:this.version,recipientInfos:Array.from(this.recipientInfos,t=>t.toJSON()),encryptedContentInfo:this.encryptedContentInfo.toJSON()};return this.originatorInfo&&(e.originatorInfo=this.originatorInfo.toJSON()),this.unprotectedAttrs&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,t=>t.toJSON())),e}addRecipientByCertificate(e,t,n,a=Ge(!0)){const o=Object.assign({useOAEP:!0,oaepHashAlgorithm:"SHA-512"},um,t||{});if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))n=1;else{if(-1===e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))throw new Error(`Unknown type of certificate's public key: ${e.subjectPublicKeyInfo.algorithm.algorithmId}`);n=2}switch(n){case 1:{let u,l;if(!0===o.useOAEP){u=a.getOIDByAlgorithm({name:"RSA-OAEP"},!0,"keyEncryptionAlgorithm");const k=a.getOIDByAlgorithm({name:o.oaepHashAlgorithm},!0,"RSAES-OAEP-params"),B=new G({algorithmId:k,algorithmParams:new _t});l=new Ah({hashAlgorithm:B,maskGenAlgorithm:new G({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:B.toSchema()})}).toSchema()}else{if(u=a.getOIDByAlgorithm({name:"RSAES-PKCS1-v1_5"}),u===S)throw new Error("Can not find OID for RSAES-PKCS1-v1_5");l=new _t}const m=new ph({version:0,rid:new Vt({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new G({algorithmId:u,algorithmParams:l}),recipientCertificate:e});this.recipientInfos.push(new Ji({variant:1,value:m}))}break;case 2:{const u=new vl({variant:1,value:new Vt({issuer:e.issuer,serialNumber:e.serialNumber})});this._addKeyAgreeRecipientInfo(u,o,{recipientCertificate:e},a)}break;default:throw new Error(`Unknown "variant" value: ${n}`)}return!0}addRecipientByPreDefinedData(e,t={},n,a=Ge(!0)){if(ct.assert(e,"preDefinedData","ArrayBuffer"),!e.byteLength)throw new Error("Pre-defined data could have zero length");if(!t.keyIdentifier){const o=new ArrayBuffer(16),u=new Uint8Array(o);a.getRandomValues(u),t.keyIdentifier=o}switch(t.hmacHashAlgorithm||(t.hmacHashAlgorithm="SHA-512"),void 0===t.iterationCount&&(t.iterationCount=2048),t.keyEncryptionAlgorithm||(t.keyEncryptionAlgorithm={name:"AES-KW",length:256}),t.keyEncryptionAlgorithmParams||(t.keyEncryptionAlgorithmParams=new _t),n){case 1:{const o=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),u=new bh({version:4,kekid:new Fu({keyIdentifier:new de({valueHex:t.keyIdentifier})}),keyEncryptionAlgorithm:new G({algorithmId:o,algorithmParams:t.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new Ji({variant:3,value:u}))}break;case 2:{const o=a.getOIDByAlgorithm({name:"PBKDF2"},!0,"keyDerivationAlgorithm"),u=new ArrayBuffer(64),l=new Uint8Array(u);a.getRandomValues(l);const m=a.getOIDByAlgorithm({name:"HMAC",hash:{name:t.hmacHashAlgorithm}},!0,"hmacHashAlgorithm"),k=new go({salt:new de({valueHex:u}),iterationCount:t.iterationCount,prf:new G({algorithmId:m,algorithmParams:new _t})}),B=a.getOIDByAlgorithm(t.keyEncryptionAlgorithm,!0,"keyEncryptionAlgorithm"),F=new _h({version:0,keyDerivationAlgorithm:new G({algorithmId:o,algorithmParams:k.toSchema()}),keyEncryptionAlgorithm:new G({algorithmId:B,algorithmParams:t.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new Ji({variant:4,value:F}))}break;default:throw new Error(`Unknown value for "variant": ${n}`)}}addRecipientByKeyIdentifier(e,t,n,a=Ge(!0)){const o=Object.assign({},um,n||{}),u=new vl({variant:2,value:new yh({subjectKeyIdentifier:new de({valueHex:t})})});this._addKeyAgreeRecipientInfo(u,o,{recipientPublicKey:e},a)}_addKeyAgreeRecipientInfo(e,t,n,a=Ge(!0)){const o=new wh({rid:e}),u=a.getOIDByAlgorithm({name:"AES-KW",length:t.kekEncryptionLength},!0,"keyEncryptionAlgorithm"),l=new G({algorithmId:u}),m=a.getOIDByAlgorithm({name:"ECDH",kdf:t.kdfAlgorithm},!0,"KeyAgreeRecipientInfo"),k=new ArrayBuffer(64),B=new Uint8Array(k);a.getRandomValues(B);const F={version:3,ukm:new de({valueHex:k}),keyEncryptionAlgorithm:new G({algorithmId:m,algorithmParams:l.toSchema()}),recipientEncryptedKeys:new Uu({encryptedKeys:[o]})},V=new Sh(Object.assign(F,n));this.recipientInfos.push(new Ji({variant:2,value:V}))}encrypt(e,t,n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){const o=new ArrayBuffer(16),u=new Uint8Array(o);n.getRandomValues(u);const l=new Uint8Array(t),m=n.getOIDByAlgorithm(e,!0,"contentEncryptionAlgorithm"),k=yield n.generateKey(e,!0,["encrypt"]),B=yield n.encrypt({name:e.name,iv:u},k,l),F=yield n.exportKey("raw",k);a.version=2,a.encryptedContentInfo=new Ut({disableSplit:a.policy.disableSplit,contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new G({algorithmId:m,algorithmParams:new de({valueHex:o})}),encryptedContent:new de({valueHex:B})});const V=function(){var ne=(0,Ce.Z)(function*(ae){const fe=a.recipientInfos[ae].value;let ke,be;if(fe.recipientPublicKey)ke=fe.recipientPublicKey.algorithm.namedCurve,be=fe.recipientPublicKey;else{if(!fe.recipientCertificate)throw new Error("Unsupported RecipientInfo");{const Re=fe.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(Re.constructor.blockName()!==Oe.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${ae}`);switch(Re.valueBlock.toString()){case"1.2.840.10045.3.1.7":ke="P-256";break;case"1.3.132.0.34":ke="P-384";break;case"1.3.132.0.35":ke="P-521";break;default:throw new Error(`Incorrect curve OID for index ${ae}`)}be=yield fe.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:ke},usages:[]}},n)}}const Ie=Nv[ke],Ve=yield n.generateKey({name:"ECDH",namedCurve:ke},!0,["deriveBits"]),qe=yield n.exportKey("spki",Ve.publicKey),tt=yield n.deriveBits({name:"ECDH",public:be},Ve.privateKey,Ie),Bt=new G({schema:fe.keyEncryptionAlgorithm.algorithmParams}),Ye=n.getAlgorithmByOID(Bt.algorithmId,!0,"aesKWAlgorithm");let je=Ye.length;const Nt=new ArrayBuffer(4),kt=new Uint8Array(Nt);for(let Re=3;Re>=0;Re--)kt[Re]=je,je>>=8;const ls=new lm({keyInfo:new G({algorithmId:Bt.algorithmId}),entityUInfo:fe.ukm,suppPubInfo:new de({valueHex:Nt})}).toSchema().toBER(!1),Dt=n.getAlgorithmByOID(fe.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm"),rt=yield $d(Dt.kdf,tt,Ye.length,ls,n),nt=yield n.importKey("raw",rt,{name:"AES-KW"},!0,["wrapKey"]),xe=yield n.wrapKey("raw",k,nt,{name:"AES-KW"}),Le=new Ou;return Le.variant=3,Le.value=vh.fromBER(qe),fe.originator=Le,fe.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new de({valueHex:xe}),{ecdhPrivateKey:Ve.privateKey}});return function(fe){return ne.apply(this,arguments)}}(),le=function(){var ne=(0,Ce.Z)(function*(ae){const fe=a.recipientInfos[ae].value,ke=n.getAlgorithmByOID(fe.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if("RSA-OAEP"===ke.name){const Ie=new Ah({schema:fe.keyEncryptionAlgorithm.algorithmParams});if(ke.hash=n.getAlgorithmByOID(Ie.hashAlgorithm.algorithmId),!("name"in ke.hash))throw new Error(`Incorrect OID for hash algorithm: ${Ie.hashAlgorithm.algorithmId}`)}try{const be=yield fe.recipientCertificate.getPublicKey({algorithm:{algorithm:ke,usages:["encrypt","wrapKey"]}},n),Ie=yield n.encrypt(be.algorithm,be,F);fe.encryptedKey=new de({valueHex:Ie})}catch{}});return function(fe){return ne.apply(this,arguments)}}(),ve=function(){var ne=(0,Ce.Z)(function*(ae){const fe=a.recipientInfos[ae].value,ke=n.getAlgorithmByOID(fe.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),be=yield n.importKey("raw",new Uint8Array(fe.preDefinedKEK),ke,!0,["wrapKey"]),Ie=yield n.wrapKey("raw",k,be,ke);fe.encryptedKey=new de({valueHex:Ie})});return function(fe){return ne.apply(this,arguments)}}(),W=function(){var ne=(0,Ce.Z)(function*(ae){const fe=a.recipientInfos[ae].value;let ke;if(!fe.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!fe.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{ke=new go({schema:fe.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const be=new Uint8Array(fe.password),Ie=yield n.importKey("raw",be,"PBKDF2",!1,["deriveKey"]),Ve=n.getAlgorithmByOID(fe.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm");let qe="SHA-1";ke.prf&&(qe=n.getAlgorithmByOID(ke.prf.algorithmId,!0,"prfAlgorithm").hash.name);const tt=new Uint8Array(ke.salt.valueBlock.valueHex),Bt=ke.iterationCount,Ye=yield n.deriveKey({name:"PBKDF2",hash:{name:qe},salt:tt,iterations:Bt},Ie,Ve,!0,["wrapKey"]),je=yield n.wrapKey("raw",k,Ye,Ve);fe.encryptedKey=new de({valueHex:je})});return function(fe){return ne.apply(this,arguments)}}(),q=[];for(let ne=0;ne<a.recipientInfos.length;ne++)switch(a.recipientInfos[ne].variant){case 1:q.push(yield le(ne));break;case 2:q.push(yield V(ne));break;case 3:q.push(yield ve(ne));break;case 4:q.push(yield W(ne));break;default:throw new Error(`Unknown recipient type in array with index ${ne}`)}return q})()}decrypt(e,t,n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){const o=t||{};if(e+1>a.recipientInfos.length)throw new Error('Maximum value for "index" is: '+(a.recipientInfos.length-1));const u=function(){var q=(0,Ce.Z)(function*(ne){const ae=a.recipientInfos[ne].value;let fe,ke,be;const Ie=ae.originator;if(o.recipientCertificate){const rt=o.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(rt.constructor.blockName()!==Oe.blockName())throw new Error(`Incorrect "recipientCertificate" for index ${ne}`);fe=rt.valueBlock.toString()}else{if(!Ie.value.algorithm.algorithmParams)throw new Error('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo" if algorithm params are missing from originator');{const rt=Ie.value.algorithm.algorithmParams;if(rt.constructor.blockName()!==Oe.blockName())throw new Error(`Incorrect originator for index ${ne}`);fe=rt.valueBlock.toString()}}if(!o.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');switch(fe){case"1.2.840.10045.3.1.7":ke="P-256",be=256;break;case"1.3.132.0.34":ke="P-384",be=384;break;case"1.3.132.0.35":ke="P-521",be=528;break;default:throw new Error(`Incorrect curve OID for index ${ne}`)}let Ve,qe=n;ye.vJ.isBufferSource(o.recipientPrivateKey)?Ve=yield n.importKey("pkcs8",o.recipientPrivateKey,{name:"ECDH",namedCurve:ke},!0,["deriveBits"]):(Ve=o.recipientPrivateKey,"crypto"in o&&o.crypto&&(qe=o.crypto.subtle)),"algorithmParams"in Ie.value.algorithm||(Ie.value.algorithm.algorithmParams=new Oe({value:fe}));const tt=Ie.value.toSchema().toBER(!1),Bt=yield n.importKey("spki",tt,{name:"ECDH",namedCurve:ke},!0,[]),Ye=yield qe.deriveBits({name:"ECDH",public:Bt},Ve,be);function je(rt){return Nt.apply(this,arguments)}function Nt(){return(Nt=(0,Ce.Z)(function*(rt){rt=rt||!1;const nt=new G({schema:ae.keyEncryptionAlgorithm.algorithmParams}),xe=n.getAlgorithmByOID(nt.algorithmId,!0,"kwAlgorithm");let Le=xe.length;const Re=new ArrayBuffer(4),Ze=new Uint8Array(Re);for(let Qe=3;Qe>=0;Qe--)Ze[Qe]=Le,Le>>=8;const ot={algorithmId:nt.algorithmId};rt&&(ot.algorithmParams=new _t);const us=new lm({keyInfo:new G(ot),entityUInfo:ae.ukm,suppPubInfo:new de({valueHex:Re})}).toSchema().toBER(!1),mt=n.getAlgorithmByOID(ae.keyEncryptionAlgorithm.algorithmId,!0,"ecdhAlgorithm");if(!mt.name)throw new Error(`Incorrect OID for key encryption algorithm: ${ae.keyEncryptionAlgorithm.algorithmId}`);return $d(mt.kdf,Ye,xe.length,us,n)})).apply(this,arguments)}const kt=yield je(),Gt=function(){var rt=(0,Ce.Z)(function*(nt){return n.importKey("raw",nt,{name:"AES-KW"},!0,["unwrapKey"])});return function(xe){return rt.apply(this,arguments)}}(),ls=yield Gt(kt),Dt=function(){var rt=(0,Ce.Z)(function*(nt){const Le=n.getAlgorithmByOID(a.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,!0,"contentEncryptionAlgorithm");return n.unwrapKey("raw",ae.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHexView,nt,{name:"AES-KW"},Le,!0,["decrypt"])});return function(xe){return rt.apply(this,arguments)}}();try{return yield Dt(ls)}catch{const rt=yield je(!0);return Dt(yield Gt(rt))}});return function(ae){return q.apply(this,arguments)}}(),l=function(){var q=(0,Ce.Z)(function*(ne){const ae=a.recipientInfos[ne].value;if(!o.recipientPrivateKey)throw new Error('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');const fe=n.getAlgorithmByOID(ae.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm");if("RSA-OAEP"===fe.name){const Bt=new Ah({schema:ae.keyEncryptionAlgorithm.algorithmParams});if(fe.hash=n.getAlgorithmByOID(Bt.hashAlgorithm.algorithmId),!("name"in fe.hash))throw new Error(`Incorrect OID for hash algorithm: ${Bt.hashAlgorithm.algorithmId}`)}let ke,be=n;ye.vJ.isBufferSource(o.recipientPrivateKey)?ke=yield n.importKey("pkcs8",o.recipientPrivateKey,fe,!0,["decrypt"]):(ke=o.recipientPrivateKey,"crypto"in o&&o.crypto&&(be=o.crypto.subtle));const Ie=yield be.decrypt(ke.algorithm,ke,ae.encryptedKey.valueBlock.valueHexView),Ve=a.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,qe=n.getAlgorithmByOID(Ve,!0,"contentEncryptionAlgorithm");if(!("name"in qe))throw new Error(`Incorrect "contentEncryptionAlgorithm": ${Ve}`);return n.importKey("raw",Ie,qe,!0,["decrypt"])});return function(ae){return q.apply(this,arguments)}}(),m=function(){var q=(0,Ce.Z)(function*(ne){const ae=a.recipientInfos[ne].value;if(!o.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');const fe=n.getAlgorithmByOID(ae.keyEncryptionAlgorithm.algorithmId,!0,"kekAlgorithm"),ke=yield n.importKey("raw",o.preDefinedData,fe,!0,["unwrapKey"]),be=a.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,Ie=n.getAlgorithmByOID(be,!0,"contentEncryptionAlgorithm");if(!Ie.name)throw new Error(`Incorrect "contentEncryptionAlgorithm": ${be}`);return n.unwrapKey("raw",ae.encryptedKey.valueBlock.valueHexView,ke,fe,Ie,!0,["decrypt"])});return function(ae){return q.apply(this,arguments)}}(),k=function(){var q=(0,Ce.Z)(function*(ne){const ae=a.recipientInfos[ne].value;let fe;if(!o.preDefinedData)throw new Error('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if(!ae.keyDerivationAlgorithm)throw new Error('Please append encoded "keyDerivationAlgorithm"');if(!ae.keyDerivationAlgorithm.algorithmParams)throw new Error('Incorrectly encoded "keyDerivationAlgorithm"');try{fe=new go({schema:ae.keyDerivationAlgorithm.algorithmParams})}catch{throw new Error('Incorrectly encoded "keyDerivationAlgorithm"')}const ke=yield n.importKey("raw",o.preDefinedData,"PBKDF2",!1,["deriveKey"]),be=n.getAlgorithmByOID(ae.keyEncryptionAlgorithm.algorithmId,!0,"keyEncryptionAlgorithm"),Ie=fe.prf?n.getAlgorithmByOID(fe.prf.algorithmId,!0,"prfAlgorithm").hash.name:"SHA-1",Ve=new Uint8Array(fe.salt.valueBlock.valueHex),qe=fe.iterationCount,tt=yield n.deriveKey({name:"PBKDF2",hash:{name:Ie},salt:Ve,iterations:qe},ke,be,!0,["unwrapKey"]),Ye=n.getAlgorithmByOID(a.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,!0,"contentEncryptionAlgorithm");return n.unwrapKey("raw",ae.encryptedKey.valueBlock.valueHexView,tt,be,Ye,!0,["decrypt"])});return function(ae){return q.apply(this,arguments)}}();let B;switch(a.recipientInfos[e].variant){case 1:B=yield l(e);break;case 2:B=yield u(e);break;case 3:B=yield m(e);break;case 4:B=yield k(e);break;default:throw new Error(`Unknown recipient type in array with index ${e}`)}const V=n.getAlgorithmByOID(a.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId,!0,"contentEncryptionAlgorithm"),ve=new Uint8Array(a.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex);if(!a.encryptedContentInfo.encryptedContent)throw new Error("Required property `encryptedContent` is empty");const W=a.encryptedContentInfo.getEncryptedContent();return n.decrypt({name:V.name,iv:ve},B,W)})()}}return s.CLASS_NAME="EnvelopedData",s})();const zi="safeContents",wl="parsedValue",hm="contentInfos";let kh=(()=>{class s extends he{constructor(e={}){super(),this.safeContents=h(e,zi,s.defaultValues(zi)),wl in e&&(this.parsedValue=h(e,wl,s.defaultValues(wl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zi:return[];case wl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case zi:return 0===t.length;case wl:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new ze({name:t.contentInfos||S,value:Lt.schema()})]})}fromSchema(e){ge(e,[hm]);const t=ce(e,e,s.schema({names:{contentInfos:hm}}));re.assertSchema(t,this.className),this.safeContents=Array.from(t.result.contentInfos,n=>new Lt({schema:n}))}toSchema(){return new R({value:Array.from(this.safeContents,e=>e.toSchema())})}toJSON(){return{safeContents:Array.from(this.safeContents,e=>e.toJSON())}}parseInternalValues(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){if(it.assert(e,zi),ct.assert(e.safeContents,zi,"Array"),e.safeContents.length!==n.safeContents.length)throw new ct('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');n.parsedValue={safeContents:[]};for(const[a,o]of n.safeContents.entries()){const u=e.safeContents[a],l=`parameters.safeContents[${a}]`;switch(o.contentType){case Tc:{ct.assert(o.content,"this.safeContents[j].content",de);const m=o.content.getValue();n.parsedValue.safeContents.push({privacyMode:0,value:dn.fromBER(m)})}break;case vd:{const m=new cm({schema:o.content});it.assert(l,u,"recipientCertificate","recipientKey");const B=u.recipientCertificate,F=u.recipientKey,V=yield m.decrypt(0,{recipientCertificate:B,recipientPrivateKey:F},t);n.parsedValue.safeContents.push({privacyMode:2,value:dn.fromBER(V)})}break;case yd:{const m=new Nu({schema:o.content});it.assert(l,u,"password");const k=u.password,B=yield m.decrypt({password:k},t);n.parsedValue.safeContents.push({privacyMode:1,value:dn.fromBER(B)})}break;default:throw new Error(`Unknown "contentType" for AuthenticatedSafe: " ${o.contentType}`)}}})()}makeInternalValues(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){if(!n.parsedValue)throw new Error('Please run "parseValues" first or add "parsedValue" manually');if(ct.assert(n.parsedValue,"this.parsedValue","object"),ct.assert(n.parsedValue.safeContents,"this.parsedValue.safeContents","Array"),ct.assert(e,"parameters","object"),it.assert(e,"safeContents"),ct.assert(e.safeContents,"parameters.safeContents","Array"),e.safeContents.length!==n.parsedValue.safeContents.length)throw new ct('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');n.safeContents=[];for(const[a,o]of n.parsedValue.safeContents.entries())switch(it.assert("content",o,"privacyMode","value"),ct.assert(o.value,"content.value",dn),o.privacyMode){case 0:{const u=o.value.toSchema().toBER(!1);n.safeContents.push(new Lt({contentType:"1.2.840.113549.1.7.1",content:new de({valueHex:u})}))}break;case 1:{const u=new Nu,l=e.safeContents[a];l.contentToEncrypt=o.value.toSchema().toBER(!1),yield u.encrypt(l),n.safeContents.push(new Lt({contentType:"1.2.840.113549.1.7.6",content:u.toSchema()}))}break;case 2:{const u=new cm,l=o.value.toSchema().toBER(!1),m=e.safeContents[a];switch(it.assert(`parameters.safeContents[${a}]`,m,"encryptingCertificate","encryptionAlgorithm"),!0){case"aes-cbc"===m.encryptionAlgorithm.name.toLowerCase():case"aes-gcm"===m.encryptionAlgorithm.name.toLowerCase():break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": ${m.encryptionAlgorithm}`)}switch(!0){case 128===m.encryptionAlgorithm.length:case 192===m.encryptionAlgorithm.length:case 256===m.encryptionAlgorithm.length:break;default:throw new Error(`Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": ${m.encryptionAlgorithm.length}`)}const k=m.encryptionAlgorithm;u.addRecipientByCertificate(m.encryptingCertificate,{},void 0,t),yield u.encrypt(k,l,t),n.safeContents.push(new Lt({contentType:"1.2.840.113549.1.7.3",content:u.toSchema()}))}break;default:throw new Error(`Incorrect value for "content.privacyMode": ${o.privacyMode}`)}return n})()}}return s.CLASS_NAME="AuthenticatedSafe",s})();const _n="hashAlgorithm",Gi="issuerNameHash",Wi="issuerKeyHash",An="serialNumber",Iv=[_n,Gi,Wi,An];let dr=(()=>{class s extends he{constructor(e={}){super(),this.hashAlgorithm=h(e,_n,s.defaultValues(_n)),this.issuerNameHash=h(e,Gi,s.defaultValues(Gi)),this.issuerKeyHash=h(e,Wi,s.defaultValues(Wi)),this.serialNumber=h(e,An,s.defaultValues(An)),e.schema&&this.fromSchema(e.schema)}static create(e,t,n=Ge(!0)){return(0,Ce.Z)(function*(){const a=new s;return yield a.createForCertificate(e,t,n),a})()}static defaultValues(e){switch(e){case _n:return new G;case Gi:case Wi:return new de;case An:return new z;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case _n:return t.algorithmId===S&&!("algorithmParams"in t);case Gi:case Wi:case An:return t.isEqual(s.defaultValues(An));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.hashAlgorithmObject||{names:{blockName:t.hashAlgorithm||S}}),new de({name:t.issuerNameHash||S}),new de({name:t.issuerKeyHash||S}),new z({name:t.serialNumber||S})]})}fromSchema(e){ge(e,Iv);const t=ce(e,e,s.schema({names:{hashAlgorithm:_n,issuerNameHash:Gi,issuerKeyHash:Wi,serialNumber:An}}));re.assertSchema(t,this.className),this.hashAlgorithm=new G({schema:t.result.hashAlgorithm}),this.issuerNameHash=t.result.issuerNameHash,this.issuerKeyHash=t.result.issuerKeyHash,this.serialNumber=t.result.serialNumber}toSchema(){return new R({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}isEqual(e){return!(this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId||!ye.vJ.isEqual(this.issuerNameHash.valueBlock.valueHexView,e.issuerNameHash.valueBlock.valueHexView)||!ye.vJ.isEqual(this.issuerKeyHash.valueBlock.valueHexView,e.issuerKeyHash.valueBlock.valueHexView)||!this.serialNumber.isEqual(e.serialNumber))}createForCertificate(e,t,n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){it.assert(t,_n,"issuerCertificate");const o=n.getOIDByAlgorithm({name:t.hashAlgorithm},!0,"hashAlgorithm");a.hashAlgorithm=new G({algorithmId:o,algorithmParams:new _t});const u=t.issuerCertificate;a.serialNumber=e.serialNumber;const l=yield n.digest({name:t.hashAlgorithm},u.subject.toSchema().toBER(!1));a.issuerNameHash=new de({valueHex:l});const m=u.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView,k=yield n.digest({name:t.hashAlgorithm},m);a.issuerKeyHash=new de({valueHex:k})})()}}return s.CLASS_NAME="CertID",s})();const Yi="certID",Qi="certStatus",Xi="thisUpdate",mr="nextUpdate",kn="singleExtensions",Tv=[Yi,Qi,Xi,mr,kn];let fm=(()=>{class s extends he{constructor(e={}){super(),this.certID=h(e,Yi,s.defaultValues(Yi)),this.certStatus=h(e,Qi,s.defaultValues(Qi)),this.thisUpdate=h(e,Xi,s.defaultValues(Xi)),mr in e&&(this.nextUpdate=h(e,mr,s.defaultValues(mr))),kn in e&&(this.singleExtensions=h(e,kn,s.defaultValues(kn))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Yi:return new dr;case Qi:return{};case Xi:case mr:return new Date(0,0,0);case kn:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Yi:return dr.compareWithDefault("hashAlgorithm",t.hashAlgorithm)&&dr.compareWithDefault("issuerNameHash",t.issuerNameHash)&&dr.compareWithDefault("issuerKeyHash",t.issuerKeyHash)&&dr.compareWithDefault("serialNumber",t.serialNumber);case Qi:return 0===Object.keys(t).length;case Xi:case mr:return t===s.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[dr.schema(t.certID||{}),new ft({value:[new Ue({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:0}}),new $({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:1},value:[new ht,new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new _a]})]}),new Ue({name:t.certStatus||S,idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new ht({name:t.thisUpdate||S}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ht({name:t.nextUpdate||S})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Rt.schema(t.singleExtensions||{})]})]})}fromSchema(e){ge(e,Tv);const t=ce(e,e,s.schema({names:{certID:{names:{blockName:Yi}},certStatus:Qi,thisUpdate:Xi,nextUpdate:mr,singleExtensions:{names:{blockName:kn}}}}));re.assertSchema(t,this.className),this.certID=new dr({schema:t.result.certID}),this.certStatus=t.result.certStatus,this.thisUpdate=t.result.thisUpdate.toDate(),mr in t.result&&(this.nextUpdate=t.result.nextUpdate.toDate()),kn in t.result&&(this.singleExtensions=Array.from(t.result.singleExtensions.valueBlock.value,n=>new $r({schema:n})))}toSchema(){const e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new ht({valueDate:this.thisUpdate})),this.nextUpdate&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[new ht({valueDate:this.nextUpdate})]})),this.singleExtensions&&e.push(new R({value:Array.from(this.singleExtensions,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return this.nextUpdate&&(e.nextUpdate=this.nextUpdate),this.singleExtensions&&(e.singleExtensions=Array.from(this.singleExtensions,t=>t.toJSON())),e}}return s.CLASS_NAME="SingleResponse",s})();const ju="tbs",En="version",Sl="responderID",bl="producedAt",_l="responses",ea="responseExtensions",Cn="ResponseData",$u=`${Cn}.${En}`,ta=`${Cn}.${Sl}`,Eh=`${Cn}.${bl}`,Ch=`${Cn}.${_l}`,qu=`${Cn}.${ea}`,Bv=[Cn,$u,ta,Eh,Ch,qu];let gr=(()=>{class s extends he{constructor(e={}){super(),this.tbsView=new Uint8Array(h(e,ju,s.defaultValues(ju))),En in e&&(this.version=h(e,En,s.defaultValues(En))),this.responderID=h(e,Sl,s.defaultValues(Sl)),this.producedAt=h(e,bl,s.defaultValues(bl)),this.responses=h(e,_l,s.defaultValues(_l)),ea in e&&(this.responseExtensions=h(e,ea,s.defaultValues(ea))),e.schema&&this.fromSchema(e.schema)}get tbs(){return ye.vJ.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case En:return 0;case ju:return Tt;case Sl:return{};case bl:return new Date(0,0,0);case _l:case ea:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ju:return 0===t.byteLength;case Sl:return 0===Object.keys(t).length;case bl:return t===s.defaultValues(e);case _l:case ea:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||Cn,value:[new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new z({name:t.version||$u})]}),new ft({value:[new $({name:t.responderID||ta,idBlock:{tagClass:3,tagNumber:1},value:[dt.schema(t.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new $({name:t.responderID||ta,idBlock:{tagClass:3,tagNumber:2},value:[new de({name:t.ResponseDataByKey||"ResponseData.byKey"})]})]}),new ht({name:t.producedAt||Eh}),new R({value:[new ze({name:Ch,value:fm.schema(t.response||{})})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Rt.schema(t.extensions||{names:{blockName:qu}})]})]})}fromSchema(e){ge(e,Bv);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.tbsView=t.result.ResponseData.valueBeforeDecodeView,$u in t.result&&(this.version=t.result[$u].valueBlock.valueDec),this.responderID=1===t.result[ta].idBlock.tagNumber?new dt({schema:t.result[ta].valueBlock.value[0]}):t.result[ta].valueBlock.value[0],this.producedAt=t.result[Eh].toDate(),this.responses=Array.from(t.result[Ch],n=>new fm({schema:n})),qu in t.result&&(this.responseExtensions=Array.from(t.result[qu].valueBlock.value,n=>new $r({schema:n})))}toSchema(e=!1){let t;if(!1===e){if(!this.tbsView.byteLength)return s.schema();const n=Ct(this.tbsView);re.assert(n,"TBS Response Data"),t=n.result}else{const n=[];En in this&&n.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[new z({value:this.version})]})),n.push(new $(this.responderID instanceof dt?{idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]}:{idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),n.push(new ht({valueDate:this.producedAt})),n.push(new R({value:Array.from(this.responses,a=>a.toSchema())})),this.responseExtensions&&n.push(new $({idBlock:{tagClass:3,tagNumber:1},value:[new R({value:Array.from(this.responseExtensions,a=>a.toSchema())})]})),t=new R({value:n})}return t}toJSON(){const e={};return En in this&&(e.version=this.version),this.responderID&&(e.responderID=this.responderID),this.producedAt&&(e.producedAt=this.producedAt),this.responses&&(e.responses=Array.from(this.responses,t=>t.toJSON())),this.responseExtensions&&(e.responseExtensions=Array.from(this.responseExtensions,t=>t.toJSON())),e}}return s.CLASS_NAME="ResponseData",s})();const Nh="trustedCerts",Ih="certs",Th="crls",Bh="ocsps",xh="checkDate",Rh="findOrigin",Oh="findIssuer";var pr=(()=>{return(s=pr||(pr={}))[s.unknown=-1]="unknown",s[s.success=0]="success",s[s.noRevocation=11]="noRevocation",s[s.noPath=60]="noPath",s[s.noValidPath=97]="noValidPath",pr;var s})();let Al=(()=>{class s extends Error{constructor(e,t){super(t),this.name=s.NAME,this.code=e,this.message=t}}return s.NAME="ChainValidationError",s})();class Zu{constructor(i={}){this.trustedCerts=h(i,Nh,this.defaultValues(Nh)),this.certs=h(i,Ih,this.defaultValues(Ih)),this.crls=h(i,Th,this.defaultValues(Th)),this.ocsps=h(i,Bh,this.defaultValues(Bh)),this.checkDate=h(i,xh,this.defaultValues(xh)),this.findOrigin=h(i,Rh,this.defaultValues(Rh)),this.findIssuer=h(i,Oh,this.defaultValues(Oh))}static defaultFindOrigin(i,e){0===i.tbsView.byteLength&&(i.tbsView=new Uint8Array(i.encodeTBS().toBER()));for(const t of e.certs)if(0===t.tbsView.byteLength&&(t.tbsView=new Uint8Array(t.encodeTBS().toBER())),ye.vJ.isEqual(i.tbsView,t.tbsView))return"Intermediate Certificates";for(const t of e.trustedCerts)if(0===t.tbsView.byteLength&&(t.tbsView=new Uint8Array(t.encodeTBS().toBER())),ye.vJ.isEqual(i.tbsView,t.tbsView))return"Trusted Certificates";return"Unknown"}defaultFindIssuer(i,e,t=Ge(!0)){return(0,Ce.Z)(function*(){const n=[];let a=null,o=null,u=null;if(i.subject.isEqual(i.issuer))try{if(yield i.verify(void 0,t))return[i]}catch{}if(i.extensions)for(const m of i.extensions)if(m.extnID===Nc&&m.parsedValue instanceof _d){m.parsedValue.keyIdentifier?a=m.parsedValue.keyIdentifier:(m.parsedValue.authorityCertIssuer&&(o=m.parsedValue.authorityCertIssuer),m.parsedValue.authorityCertSerialNumber&&(u=m.parsedValue.authorityCertSerialNumber));break}function l(m){if(null!==a&&m.extensions){let B=!1;for(const F of m.extensions)if("2.5.29.14"===F.extnID&&F.parsedValue){B=!0,ye.vJ.isEqual(F.parsedValue.valueBlock.valueHex,a.valueBlock.valueHexView)&&n.push(m);break}if(B)return}let k=!1;null!==u&&(k=m.serialNumber.isEqual(u)),null!==o?m.subject.isEqual(o)&&k&&n.push(m):i.issuer.isEqual(m.subject)&&n.push(m)}for(const m of e.trustedCerts)l(m);for(const m of e.certs)l(m);for(let m=0;m<n.length;m++)try{!1===(yield i.verify(n[m],t))&&n.splice(m,1)}catch{n.splice(m,1)}return n})()}defaultValues(i){switch(i){case Nh:case Ih:case Th:case Bh:return[];case xh:return new Date;case Rh:return Zu.defaultFindOrigin;case Oh:return this.defaultFindIssuer;default:throw new Error(`Invalid member name for CertificateChainValidationEngine class: ${i}`)}}sort(i=!1,e=Ge(!0)){var t=this;return(0,Ce.Z)(function*(){const n=[],a=function(){var W=(0,Ce.Z)(function*(q,ne){const ae=[];function fe(be){let Ie=!0;for(let Ve=0;Ve<be.length;Ve++){for(let qe=0;qe<be.length;qe++)if(qe!==Ve&&be[Ve]===be[qe]){Ie=!1;break}if(!Ie)break}return Ie}if(function xv(s,i){for(let e=0;e<i.length;e++)if(ye.vJ.isEqual(s.tbsView,i[e].tbsView))return!0;return!1}(q,t.trustedCerts))return[[q]];const ke=yield t.findIssuer(q,t,ne);if(0===ke.length)throw new Error("No valid certificate paths found");for(let be=0;be<ke.length;be++){if(ye.vJ.isEqual(ke[be].tbsView,q.tbsView)){ae.push([ke[be]]);continue}const Ie=yield a(ke[be],ne);for(let Ve=0;Ve<Ie.length;Ve++){const qe=Ie[Ve].slice();qe.splice(0,0,ke[be]),fe(qe)?ae.push(qe):ae.push(Ie[Ve])}}return ae});return function(ne,ae){return W.apply(this,arguments)}}(),o=function(){var W=(0,Ce.Z)(function*(q){const ne=[],ae=[],fe=[];if(ne.push(...n.filter(ke=>q.issuer.isEqual(ke.subject))),0===ne.length)return{status:1,statusMessage:"No certificate's issuers"};if(ae.push(...t.crls.filter(ke=>ke.issuer.isEqual(q.issuer))),0===ae.length)return{status:2,statusMessage:"No CRLs for specific certificate issuer"};for(let ke=0;ke<ae.length;ke++){const be=ae[ke];if(!(be.nextUpdate&&be.nextUpdate.value<t.checkDate))for(let Ie=0;Ie<ne.length;Ie++)try{if(yield ae[ke].verify({issuerCertificate:ne[Ie]},e)){fe.push({crl:ae[ke],certificate:ne[Ie]});break}}catch{}}return fe.length?{status:0,statusMessage:S,result:fe}:{status:3,statusMessage:"No valid CRLs found"}});return function(ne){return W.apply(this,arguments)}}(),u=function(){var W=(0,Ce.Z)(function*(q,ne){const ae=e.getAlgorithmByOID(q.signatureAlgorithm.algorithmId);if(!ae.name||!ae.hash)return 1;for(let fe=0;fe<t.ocsps.length;fe++){const be=yield t.ocsps[fe].getCertificateStatus(q,ne,e);if(be.isForCertificate)return 0===be.status?0:1}return 2});return function(ne,ae){return W.apply(this,arguments)}}();function l(W){return m.apply(this,arguments)}function m(){return(m=(0,Ce.Z)(function*(W,q=!1){let ne=!1,ae=!1,fe=!1,ke=!1;if(W.extensions){for(let be=0;be<W.extensions.length;be++){const Ie=W.extensions[be];if(Ie.critical&&!Ie.parsedValue)return{result:!1,resultCode:6,resultMessage:`Unable to parse critical certificate extension: ${Ie.extnID}`};if(Ie.extnID===_g){fe=!0;const Ve=new Uint8Array(Ie.parsedValue.valueBlock.valueHex);4==(4&Ve[0])&&(ae=!0),2==(2&Ve[0])&&(ke=!0)}Ie.extnID===Ec&&"cA"in Ie.parsedValue&&!0===Ie.parsedValue.cA&&(ne=!0)}if(!0===ae&&!1===ne)return{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstraints'};if(!0===fe&&!0===ne&&!1===ae)return{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'};if(!0===ne&&!0===fe&&q&&!1===ke)return{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'}}return!1===ne?{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"}:{result:!0,resultCode:0,resultMessage:S}})).apply(this,arguments)}const k=function(){var W=(0,Ce.Z)(function*(q,ne){for(let ae=0;ae<q.length;ae++)if(q[ae].notBefore.value>ne||q[ae].notAfter.value<ne)return{result:!1,resultCode:8,resultMessage:"The certificate is either not yet valid or expired"};if(q.length<2)return{result:!1,resultCode:9,resultMessage:"Too short certificate path"};for(let ae=q.length-2;ae>=0;ae--)if(!1===q[ae].issuer.isEqual(q[ae].subject)&&!1===q[ae].issuer.isEqual(q[ae+1].subject))return{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"};if(0!==t.crls.length||0!==t.ocsps.length)for(let ae=0;ae<q.length-1;ae++){let fe=2,ke={status:0,statusMessage:S};if(0!==t.ocsps.length)switch(fe=yield u(q[ae],q[ae+1]),fe){case 0:continue;case 1:return{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"}}if(0!==t.crls.length){if(ke=yield o(q[ae]),0===ke.status&&ke.result)for(let be=0;be<ke.result.length;be++){if(ke.result[be].crl.isCertificateRevoked(q[ae]))return{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"};if(!1===(yield l(ke.result[be].certificate,!0)).result)return{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"}}else if(!1===i)throw new Al(pr.noRevocation,`No revocation values found for one of certificates: ${ke.statusMessage}`)}else if(2===fe)return{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"};if(2===fe&&2===ke.status&&i){const be=q[ae+1];let Ie=!1;if(be.extensions)for(const Ve of be.extensions)switch(Ve.extnID){case fd:case Cc:case Ic:Ie=!0}if(Ie)throw new Al(pr.noRevocation,`No revocation values found for one of certificates: ${ke.statusMessage}`)}}for(const[ae,fe]of q.entries())if(ae&&!(yield l(fe)).result)return{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"};return{result:!0}});return function(ne,ae){return W.apply(this,arguments)}}();n.push(...t.trustedCerts),n.push(...t.certs);for(let W=0;W<n.length;W++)for(let q=0;q<n.length;q++)if(W!==q&&ye.vJ.isEqual(n[W].tbsView,n[q].tbsView)){n.splice(q,1),W=0;break}const B=n[n.length-1];let F;const V=[B];if(F=yield a(B,e),0===F.length)throw new Al(pr.noPath,"Unable to find certificate path");for(let W=0;W<F.length;W++){let q=!1;for(let ne=0;ne<F[W].length;ne++){const ae=F[W][ne];for(let fe=0;fe<t.trustedCerts.length;fe++)if(ye.vJ.isEqual(ae.tbsView,t.trustedCerts[fe].tbsView)){q=!0;break}if(q)break}q||(F.splice(W,1),W=0)}if(0===F.length)throw new Al(pr.noValidPath,"No valid certificate paths found");let le=F[0].length,ve=0;for(let W=0;W<F.length;W++)F[W].length<le&&(le=F[W].length,ve=W);for(let W=0;W<F[ve].length;W++)V.push(F[ve][W]);if(F=yield k(V,t.checkDate),!1===F.result)throw F;return V})()}verify(i={},e=Ge(!0)){var t=this;return(0,Ce.Z)(function*(){function n(m,k){const B=xs(m),F=xs(k),V=B.split("."),le=F.split("."),ve=V.length,W=le.length;if(0===ve||0===W||ve<W)return!1;for(let q=0;q<ve;q++)if(0===V[q].length)return!1;for(let q=0;q<W;q++)if(0===le[q].length){if(0===q){if(1===W)return!1;continue}return!1}for(let q=0;q<W;q++)if(0!==le[W-1-q].length&&0!==V[ve-1-q].localeCompare(le[W-1-q]))return!1;return!0}function a(m,k){const B=xs(m),F=xs(k),V=B.split("@"),le=F.split("@");if(0===V.length||0===le.length||V.length<le.length)return!1;if(1===le.length){if(n(V[1],le[0])){const W=V[1].split("."),q=le[0].split(".");return 0===q[0].length||W.length===q.length}return!1}return 0===B.localeCompare(F)}function o(m,k){let B=xs(m);const F=xs(k),V=B.split("/");if(F.split("/").length>1)return!1;if(V.length>1)for(let W=0;W<V.length;W++)if(V[W].length>0&&":"!==V[W].charAt(V[W].length-1)){B=V[W].split(":")[0];break}if(n(B,F)){const W=B.split("."),q=F.split(".");return 0===q[0].length||W.length===q.length}return!1}function u(m,k){const B=m.valueBlock.valueHexView,F=k.valueBlock.valueHexView;if(4===B.length&&8===F.length){for(let V=0;V<4;V++)if((B[V]^F[V])&F[V+4])return!1;return!0}if(16===B.length&&32===F.length){for(let V=0;V<16;V++)if((B[V]^F[V])&F[V+16])return!1;return!0}return!1}function l(m,k){if(0===m.typesAndValues.length||0===k.typesAndValues.length)return!0;if(m.typesAndValues.length<k.typesAndValues.length)return!1;let B=!0,F=0;for(let V=0;V<k.typesAndValues.length;V++){let le=!1;for(let ve=F;ve<m.typesAndValues.length;ve++)if(le=m.typesAndValues[ve].isEqual(k.typesAndValues[V]),m.typesAndValues[ve].type===k.typesAndValues[V].type&&(B=B&&le),!0===le){if(0===F||F===ve){F=ve+1;break}return!1}if(!1===le)return!1}return 0!==F&&B}try{if(0===t.certs.length)throw new Error("Empty certificate array");const m=i.passedWhenNotRevValues||!1,k=i.initialPolicySet||[es];let q=i.initialExplicitPolicy||!1,ne=i.initialPolicyMappingInhibit||!1,ae=i.initialInhibitPolicy||!1;const fe=[!1,!1,!1];let ke=0,be=0,Ie=0,Ve=i.initialPermittedSubtreesSet||[],qe=i.initialExcludedSubtreesSet||[];const tt=i.initialRequiredNameForms||[];let Bt=1;t.certs=yield t.sort(m,e);const Ye=[];Ye.push(es);const je=[],Nt=new Array(t.certs.length-1);for(let xe=0;xe<t.certs.length-1;xe++)Nt[xe]=!0;je.push(Nt);const kt=new Array(t.certs.length-1),Gt=new Array(t.certs.length-1);let ls=q?t.certs.length-1:-1;for(let xe=t.certs.length-2;xe>=0;xe--,Bt++){const Le=t.certs[xe];if(Le.extensions){for(let Re=0;Re<Le.extensions.length;Re++){const Ze=Le.extensions[Re];if(Ze.extnID===dd){Gt[xe]=Ze.parsedValue;for(let ot=0;ot<Ye.length;ot++)if(Ye[ot]===es){delete je[ot][xe];break}for(let ot=0;ot<Ze.parsedValue.certificatePolicies.length;ot++){let Mt=-1;const us=Ze.parsedValue.certificatePolicies[ot].policyIdentifier;for(let mt=0;mt<Ye.length;mt++)if(us===Ye[mt]){Mt=mt;break}if(-1===Mt){Ye.push(us);const mt=new Array(t.certs.length-1);mt[xe]=!0,je.push(mt)}else je[Mt][xe]=!0}}if(Ze.extnID===md){if(ne)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};kt[xe]=Ze.parsedValue}Ze.extnID===gd&&!1===q&&(0===Ze.parsedValue.requireExplicitPolicy?(q=!0,ls=xe):!1===fe[0]?(fe[0]=!0,ke=Ze.parsedValue.requireExplicitPolicy):ke=ke>Ze.parsedValue.requireExplicitPolicy?Ze.parsedValue.requireExplicitPolicy:ke,0===Ze.parsedValue.inhibitPolicyMapping?ne=!0:!1===fe[1]?(fe[1]=!0,be=Ze.parsedValue.inhibitPolicyMapping+1):be=be>Ze.parsedValue.inhibitPolicyMapping+1?Ze.parsedValue.inhibitPolicyMapping+1:be),"2.5.29.54"===Ze.extnID&&!1===ae&&(0===Ze.parsedValue.valueBlock.valueDec?ae=!0:!1===fe[2]?(fe[2]=!0,Ie=Ze.parsedValue.valueBlock.valueDec):Ie=Ie>Ze.parsedValue.valueBlock.valueDec?Ze.parsedValue.valueBlock.valueDec:Ie)}if(!0===ae){let Re=-1;for(let Ze=0;Ze<Ye.length;Ze++)if(Ye[Ze]===es){Re=Ze;break}-1!==Re&&delete je[0][xe]}!1===q&&!0===fe[0]&&(ke--,0===ke&&(q=!0,ls=xe,fe[0]=!1)),!1===ne&&!0===fe[1]&&(be--,0===be&&(ne=!0,fe[1]=!1)),!1===ae&&!0===fe[2]&&(Ie--,0===Ie&&(ae=!0,fe[2]=!1))}}for(let xe=0;xe<t.certs.length-1;xe++)if(xe<t.certs.length-2&&void 0!==kt[xe+1])for(let Le=0;Le<kt[xe+1].mappings.length;Le++){if(kt[xe+1].mappings[Le].issuerDomainPolicy===es||kt[xe+1].mappings[Le].subjectDomainPolicy===es)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};let Re=-1,Ze=-1;for(let ot=0;ot<Ye.length;ot++)Ye[ot]===kt[xe+1].mappings[Le].issuerDomainPolicy&&(Re=ot),Ye[ot]===kt[xe+1].mappings[Le].subjectDomainPolicy&&(Ze=ot);void 0!==je[Re][xe]&&delete je[Re][xe];for(let ot=0;ot<Gt[xe].certificatePolicies.length;ot++)if(kt[xe+1].mappings[Le].subjectDomainPolicy===Gt[xe].certificatePolicies[ot].policyIdentifier&&-1!==Re&&-1!==Ze)for(let Mt=0;Mt<=xe;Mt++)void 0!==je[Ze][Mt]&&(je[Re][Mt]=!0,delete je[Ze][Mt])}for(let xe=0;xe<Ye.length;xe++)if(Ye[xe]===es)for(let Le=0;Le<ls;Le++)delete je[xe][Le];const Dt=[];for(let xe=0;xe<je.length;xe++){let Le=!0;for(let Re=0;Re<t.certs.length-1;Re++){let Ze=!1;if(Re<ls&&Ye[xe]===es&&Ye.length>1){Le=!1;break}if(void 0===je[xe][Re]){if(Re>=ls)for(let ot=0;ot<Ye.length;ot++)if(Ye[ot]===es){!0===je[ot][Re]&&(Ze=!0);break}if(!Ze){Le=!1;break}}}!0===Le&&Dt.push(Ye[xe])}let rt=[];if(1===k.length&&k[0]===es&&!1===q)rt=k;else if(1===Dt.length&&Dt[0]===es)rt=k;else for(let xe=0;xe<Dt.length;xe++)for(let Le=0;Le<k.length;Le++)if(k[Le]===Dt[xe]||k[Le]===es){rt.push(Dt[xe]);break}const nt={result:rt.length>0,resultCode:0,resultMessage:rt.length>0?S:'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:Dt,userConstrPolicies:rt,explicitPolicyIndicator:q,policyMappings:kt,certificatePath:t.certs};if(0===rt.length||!1===nt.result)return nt;Bt=1;for(let xe=t.certs.length-2;xe>=0;xe--,Bt++){const Le=t.certs[xe];let Re=[],Ze=[],ot=[];if(Le.extensions)for(let Qe=0;Qe<Le.extensions.length;Qe++){const Je=Le.extensions[Qe];Je.extnID===hd&&("permittedSubtrees"in Je.parsedValue&&(Ze=Ze.concat(Je.parsedValue.permittedSubtrees)),"excludedSubtrees"in Je.parsedValue&&(ot=ot.concat(Je.parsedValue.excludedSubtrees))),Je.extnID===od&&(Re=Re.concat(Je.parsedValue.altNames))}let Mt=tt.length<=0;for(let Qe=0;Qe<tt.length;Qe++)switch(tt[Qe].base.type){case 4:if(tt[Qe].base.value.typesAndValues.length!==Le.subject.typesAndValues.length)continue;Mt=!0;for(let Je=0;Je<Le.subject.typesAndValues.length;Je++)if(Le.subject.typesAndValues[Je].type!==tt[Qe].base.value.typesAndValues[Je].type){Mt=!1;break}if(!0===Mt)break}if(!1===Mt)throw nt.result=!1,nt.resultCode=21,nt.resultMessage="No necessary name form found",nt;const us=[[],[],[],[],[]];for(let Qe=0;Qe<Ve.length;Qe++)switch(Ve[Qe].base.type){case 1:us[0].push(Ve[Qe]);break;case 2:us[1].push(Ve[Qe]);break;case 4:us[2].push(Ve[Qe]);break;case 6:us[3].push(Ve[Qe]);break;case 7:us[4].push(Ve[Qe])}for(let Qe=0;Qe<5;Qe++){let Je=!1,Hn=!1;const Sr=us[Qe];for(let br=0;br<Sr.length;br++){switch(Qe){case 0:if(Re.length>0)for(let gt=0;gt<Re.length;gt++)1===Re[gt].type&&(Hn=!0,Je=Je||a(Re[gt].value,Sr[br].base.value));else for(let gt=0;gt<Le.subject.typesAndValues.length;gt++)("1.2.840.113549.1.9.1"===Le.subject.typesAndValues[gt].type||"0.9.2342.19200300.100.1.3"===Le.subject.typesAndValues[gt].type)&&(Hn=!0,Je=Je||a(Le.subject.typesAndValues[gt].value.valueBlock.value,Sr[br].base.value));break;case 1:if(Re.length>0)for(let gt=0;gt<Re.length;gt++)2===Re[gt].type&&(Hn=!0,Je=Je||n(Re[gt].value,Sr[br].base.value));break;case 2:Hn=!0,Je=l(Le.subject,Sr[br].base.value);break;case 3:if(Re.length>0)for(let gt=0;gt<Re.length;gt++)6===Re[gt].type&&(Hn=!0,Je=Je||o(Re[gt].value,Sr[br].base.value));break;case 4:if(Re.length>0)for(let gt=0;gt<Re.length;gt++)7===Re[gt].type&&(Hn=!0,Je=Je||u(Re[gt].value,Sr[br].base.value))}if(Je)break}if(!1===Je&&Sr.length>0&&Hn)throw nt.result=!1,nt.resultCode=41,nt.resultMessage='Failed to meet "permitted sub-trees" name constraint',nt}let mt=!1;for(let Qe=0;Qe<qe.length;Qe++){switch(qe[Qe].base.type){case 1:if(Re.length>=0)for(let Je=0;Je<Re.length;Je++)1===Re[Je].type&&(mt=mt||a(Re[Je].value,qe[Qe].base.value));else for(let Je=0;Je<Le.subject.typesAndValues.length;Je++)("1.2.840.113549.1.9.1"===Le.subject.typesAndValues[Je].type||"0.9.2342.19200300.100.1.3"===Le.subject.typesAndValues[Je].type)&&(mt=mt||a(Le.subject.typesAndValues[Je].value.valueBlock.value,qe[Qe].base.value));break;case 2:if(Re.length>0)for(let Je=0;Je<Re.length;Je++)2===Re[Je].type&&(mt=mt||n(Re[Je].value,qe[Qe].base.value));break;case 4:mt=mt||l(Le.subject,qe[Qe].base.value);break;case 6:if(Re.length>0)for(let Je=0;Je<Re.length;Je++)6===Re[Je].type&&(mt=mt||o(Re[Je].value,qe[Qe].base.value));break;case 7:if(Re.length>0)for(let Je=0;Je<Re.length;Je++)7===Re[Je].type&&(mt=mt||u(Re[Je].value,qe[Qe].base.value))}if(mt)break}if(!0===mt)throw nt.result=!1,nt.resultCode=42,nt.resultMessage='Failed to meet "excluded sub-trees" name constraint',nt;Ve=Ve.concat(Ze),qe=qe.concat(ot)}return nt}catch(m){return m instanceof Error?m instanceof Al?{result:!1,resultCode:m.code,resultMessage:m.message,error:m}:{result:!1,resultCode:pr.unknown,resultMessage:m.message,error:m}:m&&"object"==typeof m&&"resultMessage"in m?m:{result:!1,resultCode:-1,resultMessage:`${m}`}}})()}}const zu="tbsResponseData",kl="signatureAlgorithm",El="signature",sa="certs",Cl="BasicOCSPResponse",Vh=`${Cl}.${zu}`,Ph=`${Cl}.${kl}`,Dh=`${Cl}.${El}`,Gu=`${Cl}.certs`,Rv=[Vh,Ph,Dh,Gu];let Ov=(()=>{class s extends he{constructor(e={}){super(),this.tbsResponseData=h(e,zu,s.defaultValues(zu)),this.signatureAlgorithm=h(e,kl,s.defaultValues(kl)),this.signature=h(e,El,s.defaultValues(El)),sa in e&&(this.certs=h(e,sa,s.defaultValues(sa))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case zu:return new gr;case kl:return new G;case El:return new et;case sa:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case"type":{let n=gr.compareWithDefault("tbs",t.tbs)&&gr.compareWithDefault("responderID",t.responderID)&&gr.compareWithDefault("producedAt",t.producedAt)&&gr.compareWithDefault("responses",t.responses);return"responseExtensions"in t&&(n=n&&gr.compareWithDefault("responseExtensions",t.responseExtensions)),n}case kl:return t.algorithmId===S&&!("algorithmParams"in t);case El:return t.isEqual(s.defaultValues(e));case sa:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||Cl,value:[gr.schema(t.tbsResponseData||{names:{blockName:Vh}}),G.schema(t.signatureAlgorithm||{names:{blockName:Ph}}),new et({name:t.signature||Dh}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new R({value:[new ze({name:Gu,value:ts.schema(t.certs||{})})]})]})]})}fromSchema(e){ge(e,Rv);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.tbsResponseData=new gr({schema:t.result[Vh]}),this.signatureAlgorithm=new G({schema:t.result[Ph]}),this.signature=t.result[Dh],Gu in t.result&&(this.certs=Array.from(t.result[Gu],n=>new ts({schema:n})))}toSchema(){const e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.certs&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:[new R({value:Array.from(this.certs,t=>t.toSchema())})]})),new R({value:e})}toJSON(){const e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.certs&&(e.certs=Array.from(this.certs,t=>t.toJSON())),e}getCertificateStatus(e,t,n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){const o={isForCertificate:!1,status:2},u={},l=[];for(const m of a.tbsResponseData.responses){const k=n.getAlgorithmByOID(m.certID.hashAlgorithm.algorithmId,!0,"CertID.hashAlgorithm");if(!u[k.name]){u[k.name]=1;const B=new dr;l.push(B),yield B.createForCertificate(e,{hashAlgorithm:k.name,issuerCertificate:t},n)}}for(const m of a.tbsResponseData.responses)for(const k of l)if(m.certID.isEqual(k)){o.isForCertificate=!0;try{switch(m.certStatus.idBlock.isConstructed){case!0:1===m.certStatus.idBlock.tagNumber&&(o.status=1);break;case!1:switch(m.certStatus.idBlock.tagNumber){case 0:o.status=0;break;case 2:o.status=2}}}catch{}return o}return o})()}sign(e,t="SHA-1",n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){if(!e)throw new Error("Need to provide a private key for signing");const o=yield n.getSignatureParameters(e,t),u=o.parameters.algorithm;if(!("name"in u))throw new Error("Empty algorithm");a.signatureAlgorithm=o.signatureAlgorithm,a.tbsResponseData.tbsView=new Uint8Array(a.tbsResponseData.toSchema(!0).toBER());const l=yield n.signWithPrivateKey(a.tbsResponseData.tbsView,e,{algorithm:u});a.signature=new et({valueHex:l})})()}verify(e={},t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){let a=null,o=-1;const u=e.trustedCerts||[];if(!n.certs)throw new Error("No certificates attached to the BasicOCSPResponse");switch(!0){case n.tbsResponseData.responderID instanceof dt:for(const[B,F]of n.certs.entries())if(F.subject.isEqual(n.tbsResponseData.responderID)){o=B;break}break;case n.tbsResponseData.responderID instanceof de:for(const[B,F]of n.certs.entries())if($n(yield t.digest({name:"sha-1"},F.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView),n.tbsResponseData.responderID.valueBlock.valueHex)){o=B;break}break;default:throw new Error("Wrong value for responderID")}if(-1===o)throw new Error("Correct certificate was not found in OCSP response");a=n.certs[o];const l=[a];for(const B of n.certs){const F=yield nm(B,a);F&&l.push(F)}if(!(yield new Zu({certs:l,trustedCerts:u}).verify({},t)).result)throw new Error("Validation of signer's certificate failed");return t.verifyWithPublicKey(n.tbsResponseData.tbsView,n.signature,n.certs[o].subjectPublicKeyInfo,n.signatureAlgorithm)})()}}return s.CLASS_NAME="BasicOCSPResponse",s})();const Lh="version",Mh="subject",Fh="subjectPublicKeyInfo",ra="attributes",Nl="signatureAlgorithm",Il="signatureValue",na="CertificationRequestInfo",Hh=`${na}.version`,Jh=`${na}.subject`,Kh=`${na}.subjectPublicKeyInfo`,Wu=`${na}.attributes`,Vv=[na,Hh,Jh,Kh,Wu,Nl,Il];function Pv(s={}){const i=h(s,"names",{});return new R({name:i.CertificationRequestInfo||na,value:[new z({name:i.CertificationRequestInfoVersion||Hh}),dt.schema(i.subject||{names:{blockName:Jh}}),hs.schema({names:{blockName:Kh}}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ze({optional:!0,name:i.CertificationRequestInfoAttributes||Wu,value:at.schema(i.attributes||{})})]})]})}let Dv=(()=>{class s extends he{constructor(e={}){super(),this.tbsView=new Uint8Array(h(e,"tbs",s.defaultValues("tbs"))),this.version=h(e,Lh,s.defaultValues(Lh)),this.subject=h(e,Mh,s.defaultValues(Mh)),this.subjectPublicKeyInfo=h(e,Fh,s.defaultValues(Fh)),ra in e&&(this.attributes=h(e,ra,s.defaultValues(ra))),this.signatureAlgorithm=h(e,Nl,s.defaultValues(Nl)),this.signatureValue=h(e,Il,s.defaultValues(Il)),e.schema&&this.fromSchema(e.schema)}get tbs(){return ye.vJ.toArrayBuffer(this.tbsView)}set tbs(e){this.tbsView=new Uint8Array(e)}static defaultValues(e){switch(e){case"tbs":return Tt;case Lh:return 0;case Mh:return new dt;case Fh:return new hs;case ra:return[];case Nl:return new G;case Il:return new et;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({value:[Pv(t.certificationRequestInfo||{}),new R({name:t.signatureAlgorithm||Nl,value:[new Oe,new He({optional:!0})]}),new et({name:t.signatureValue||Il})]})}fromSchema(e){ge(e,Vv);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.tbsView=t.result.CertificationRequestInfo.valueBeforeDecodeView,this.version=t.result[Hh].valueBlock.valueDec,this.subject=new dt({schema:t.result[Jh]}),this.subjectPublicKeyInfo=new hs({schema:t.result[Kh]}),Wu in t.result&&(this.attributes=Array.from(t.result[Wu],n=>new at({schema:n}))),this.signatureAlgorithm=new G({schema:t.result.signatureAlgorithm}),this.signatureValue=t.result.signatureValue}encodeTBS(){const e=[new z({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return ra in this&&e.push(new $({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes||[],t=>t.toSchema())})),new R({value:e})}toSchema(e=!1){let t;if(!1===e){if(0===this.tbsView.byteLength)return s.schema();const n=Ct(this.tbsView);re.assert(n,"PKCS#10 Certificate Request"),t=n.result}else t=this.encodeTBS();return new R({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}toJSON(){const e={tbs:ye.ep.ToHex(this.tbsView),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return ra in this&&(e.attributes=Array.from(this.attributes||[],t=>t.toJSON())),e}sign(e,t="SHA-1",n=Ge(!0)){var a=this;return(0,Ce.Z)(function*(){if(!e)throw new Error("Need to provide a private key for signing");const o=yield n.getSignatureParameters(e,t),u=o.parameters;a.signatureAlgorithm=o.signatureAlgorithm,a.tbsView=new Uint8Array(a.encodeTBS().toBER());const l=yield n.signWithPrivateKey(a.tbsView,e,u);a.signatureValue=new et({valueHex:l})})()}verify(e=Ge(!0)){var t=this;return(0,Ce.Z)(function*(){return e.verifyWithPublicKey(t.tbsView,t.signatureValue,t.subjectPublicKeyInfo,t.signatureAlgorithm)})()}getPublicKey(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){return t.getPublicKey(n.subjectPublicKeyInfo,n.signatureAlgorithm,e)})()}}return s.CLASS_NAME="CertificationRequest",s})();const Nn="digestAlgorithm",In="digest",Uv=[Nn,In];let ia=(()=>{class s extends he{constructor(e={}){super(),this.digestAlgorithm=h(e,Nn,s.defaultValues(Nn)),this.digest=h(e,In,s.defaultValues(In)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Nn:return new G;case In:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Nn:return G.compareWithDefault("algorithmId",t.algorithmId)&&!("algorithmParams"in t);case In:return t.isEqual(s.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.digestAlgorithm||{names:{blockName:Nn}}),new de({name:t.digest||In})]})}fromSchema(e){ge(e,Uv);const t=ce(e,e,s.schema({names:{digestAlgorithm:{names:{blockName:Nn}},digest:In}}));re.assertSchema(t,this.className),this.digestAlgorithm=new G({schema:t.result.digestAlgorithm}),this.digest=t.result.digest}toSchema(){return new R({value:[this.digestAlgorithm.toSchema(),this.digest]})}toJSON(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}return s.CLASS_NAME="DigestInfo",s})();const aa="eContentType",as="eContent",Lv=[aa,as];let oa=(()=>{class s extends he{constructor(e={}){if(super(),this.eContentType=h(e,aa,s.defaultValues(aa)),as in e&&(this.eContent=h(e,as,s.defaultValues(as)),1===this.eContent.idBlock.tagClass&&4===this.eContent.idBlock.tagNumber&&!1===this.eContent.idBlock.isConstructed)){const t=new de({idBlock:{isConstructed:!0},isConstructed:!0});let n=0;const a=this.eContent.valueBlock.valueHexView.slice().buffer;let o=a.byteLength;for(;o>0;){const u=new Uint8Array(a,n,n+65536>a.byteLength?a.byteLength-n:65536),l=new ArrayBuffer(u.length),m=new Uint8Array(l);for(let k=0;k<m.length;k++)m[k]=u[k];t.valueBlock.value.push(new de({valueHex:l})),o-=u.length,n+=u.length}this.eContent=t}e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case aa:return S;case as:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case aa:return t===S;case as:return 1===t.idBlock.tagClass&&4===t.idBlock.tagNumber&&t.isEqual(s.defaultValues(as));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new Oe({name:t.eContentType||S}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new He({name:t.eContent||S})]})]})}fromSchema(e){ge(e,Lv);const t=ce(e,e,s.schema({names:{eContentType:aa,eContent:as}}));re.assertSchema(t,this.className),this.eContentType=t.result.eContentType.valueBlock.toString(),as in t.result&&(this.eContent=t.result.eContent)}toSchema(){const e=[];return e.push(new Oe({value:this.eContentType})),this.eContent&&!1===s.compareWithDefault(as,this.eContent)&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new R({value:e})}toJSON(){const e={eContentType:this.eContentType};return this.eContent&&!1===s.compareWithDefault(as,this.eContent)&&(e.eContent=this.eContent.toJSON()),e}}return s.CLASS_NAME="EncapsulatedContentInfo",s})();const Tn="mac",Bn="macSalt",Ns="iterations",Mv=[Tn,Bn,Ns];let xn=(()=>{class s extends he{constructor(e={}){super(),this.mac=h(e,Tn,s.defaultValues(Tn)),this.macSalt=h(e,Bn,s.defaultValues(Bn)),Ns in e&&(this.iterations=h(e,Ns,s.defaultValues(Ns))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Tn:return new ia;case Bn:return new de;case Ns:return 1;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Tn:return ia.compareWithDefault("digestAlgorithm",t.digestAlgorithm)&&ia.compareWithDefault("digest",t.digest);case Bn:return t.isEqual(s.defaultValues(e));case Ns:return t===s.defaultValues(e);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,optional:t.optional||!0,value:[ia.schema(t.mac||{names:{blockName:Tn}}),new de({name:t.macSalt||Bn}),new z({optional:!0,name:t.iterations||Ns})]})}fromSchema(e){ge(e,Mv);const t=ce(e,e,s.schema({names:{mac:{names:{blockName:Tn}},macSalt:Bn,iterations:Ns}}));re.assertSchema(t,this.className),this.mac=new ia({schema:t.result.mac}),this.macSalt=t.result.macSalt,Ns in t.result&&(this.iterations=t.result.iterations.valueBlock.valueDec)}toSchema(){const e=[this.mac.toSchema(),this.macSalt];return void 0!==this.iterations&&e.push(new z({value:this.iterations})),new R({value:e})}toJSON(){const e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return void 0!==this.iterations&&(e.iterations=this.iterations),e}}return s.CLASS_NAME="MacData",s})();const Rn="hashAlgorithm",On="hashedMessage",Fv=[Rn,On];let Tl=(()=>{class s extends he{constructor(e={}){super(),this.hashAlgorithm=h(e,Rn,s.defaultValues(Rn)),this.hashedMessage=h(e,On,s.defaultValues(On)),e.schema&&this.fromSchema(e.schema)}static create(e,t,n=Ge(!0)){return(0,Ce.Z)(function*(){const a=n.getOIDByAlgorithm({name:e},!0,"hashAlgorithm"),o=yield n.digest(e,t);return new s({hashAlgorithm:new G({algorithmId:a,algorithmParams:new _t}),hashedMessage:new de({valueHex:o})})})()}static defaultValues(e){switch(e){case Rn:return new G;case On:return new de;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Rn:return t.algorithmId===S&&!("algorithmParams"in t);case On:return 0===t.isEqual(s.defaultValues(e));default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[G.schema(t.hashAlgorithm||{}),new de({name:t.hashedMessage||S})]})}fromSchema(e){ge(e,Fv);const t=ce(e,e,s.schema({names:{hashAlgorithm:{names:{blockName:Rn}},hashedMessage:On}}));re.assertSchema(t,this.className),this.hashAlgorithm=new G({schema:t.result.hashAlgorithm}),this.hashedMessage=t.result.hashedMessage}toSchema(){return new R({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}toJSON(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}return s.CLASS_NAME="MessageImprint",s})();const Vn="type",Is="attributes",Yu="encodedValue",zv=[Is];let zt=(()=>{class s extends he{constructor(e={}){super(),this.type=h(e,Vn,s.defaultValues(Vn)),this.attributes=h(e,Is,s.defaultValues(Is)),this.encodedValue=h(e,Yu,s.defaultValues(Yu)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Vn:return-1;case Is:return[];case Yu:return Tt;default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Vn:return t===s.defaultValues(Vn);case Is:return 0===t.length;case Yu:return 0===t.byteLength;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new $({name:t.blockName||S,optional:!0,idBlock:{tagClass:3,tagNumber:t.tagNumber||0},value:[new ze({name:t.attributes||S,value:at.schema()})]})}fromSchema(e){ge(e,zv);const t=ce(e,e,s.schema({names:{tagNumber:this.type,attributes:Is}}));if(re.assertSchema(t,this.className),this.type=t.result.idBlock.tagNumber,this.encodedValue=ye.vJ.toArrayBuffer(t.result.valueBeforeDecodeView),new Uint8Array(this.encodedValue)[0]=49,Is in t.result)this.attributes=Array.from(t.result.attributes,a=>new at({schema:a}));else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")}toSchema(){if(s.compareWithDefault(Vn,this.type)||s.compareWithDefault(Is,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new $({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,e=>e.toSchema())})}toJSON(){if(s.compareWithDefault(Vn,this.type)||s.compareWithDefault(Is,this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,e=>e.toJSON())}}}return s.CLASS_NAME="SignedAndUnsignedAttributes",s})();const la="version",Pn="sid",ua="digestAlgorithm",vr="signedAttrs",ca="signatureAlgorithm",xl="signature",yr="unsignedAttrs",wr="SignerInfo",jh=`${wr}.${la}`,Rl=`${wr}.sid`,$h=`${wr}.${ua}`,Qu=`${wr}.${vr}`,qh=`${wr}.${ca}`,Zh=`${wr}.${xl}`,Xu=`${wr}.${yr}`,Gv=[jh,Rl,$h,Qu,qh,Zh,Xu];let zh=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,la,s.defaultValues(la)),this.sid=h(e,Pn,s.defaultValues(Pn)),this.digestAlgorithm=h(e,ua,s.defaultValues(ua)),vr in e&&(this.signedAttrs=h(e,vr,s.defaultValues(vr))),this.signatureAlgorithm=h(e,ca,s.defaultValues(ca)),this.signature=h(e,xl,s.defaultValues(xl)),yr in e&&(this.unsignedAttrs=h(e,yr,s.defaultValues(yr))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case la:return 0;case Pn:return new He;case ua:return new G;case vr:return new zt({type:0});case ca:return new G;case xl:return new de;case yr:return new zt({type:1});default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case la:return s.defaultValues(la)===t;case Pn:return t instanceof He;case ua:return t instanceof G&&t.isEqual(s.defaultValues(ua));case vr:return zt.compareWithDefault("type",t.type)&&zt.compareWithDefault("attributes",t.attributes)&&zt.compareWithDefault("encodedValue",t.encodedValue);case ca:return t instanceof G&&t.isEqual(s.defaultValues(ca));case xl:case yr:return zt.compareWithDefault("type",t.type)&&zt.compareWithDefault("attributes",t.attributes)&&zt.compareWithDefault("encodedValue",t.encodedValue);default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:wr,value:[new z({name:t.version||jh}),new ft({value:[Vt.schema(t.sidSchema||{names:{blockName:Rl}}),new ft({value:[new $({optional:!0,name:t.sid||Rl,idBlock:{tagClass:3,tagNumber:0},value:[new de]}),new Ue({optional:!0,name:t.sid||Rl,idBlock:{tagClass:3,tagNumber:0}})]})]}),G.schema(t.digestAlgorithm||{names:{blockName:$h}}),zt.schema(t.signedAttrs||{names:{blockName:Qu,tagNumber:0}}),G.schema(t.signatureAlgorithm||{names:{blockName:qh}}),new de({name:t.signature||Zh}),zt.schema(t.unsignedAttrs||{names:{blockName:Xu,tagNumber:1}})]})}fromSchema(e){ge(e,Gv);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.version=t.result[jh].valueBlock.valueDec;const n=t.result[Rl];this.sid=1===n.idBlock.tagClass?new Vt({schema:n}):n,this.digestAlgorithm=new G({schema:t.result[$h]}),Qu in t.result&&(this.signedAttrs=new zt({type:0,schema:t.result[Qu]})),this.signatureAlgorithm=new G({schema:t.result[qh]}),this.signature=t.result[Zh],Xu in t.result&&(this.unsignedAttrs=new zt({type:1,schema:t.result[Xu]}))}toSchema(){if(s.compareWithDefault(Pn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e=[];return e.push(new z({value:this.version})),e.push(this.sid instanceof Vt?this.sid.toSchema():this.sid),e.push(this.digestAlgorithm.toSchema()),this.signedAttrs&&!1===s.compareWithDefault(vr,this.signedAttrs)&&e.push(this.signedAttrs.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),this.unsignedAttrs&&!1===s.compareWithDefault(yr,this.unsignedAttrs)&&e.push(this.unsignedAttrs.toSchema()),new R({value:e})}toJSON(){if(s.compareWithDefault(Pn,this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');const e={version:this.version,digestAlgorithm:this.digestAlgorithm.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return this.sid instanceof He||(e.sid=this.sid.toJSON()),this.signedAttrs&&!1===s.compareWithDefault(vr,this.signedAttrs)&&(e.signedAttrs=this.signedAttrs.toJSON()),this.unsignedAttrs&&!1===s.compareWithDefault(yr,this.unsignedAttrs)&&(e.unsignedAttrs=this.unsignedAttrs.toJSON()),e}}return s.CLASS_NAME="SignerInfo",s})();const Ol="version",Vl="policy",Pl="messageImprint",Dl="serialNumber",Ul="genTime",Dn="ordering",Un="nonce",ha="accuracy",fa="tsa",da="extensions",os="TSTInfo",Gh=`${os}.${Ol}`,Wh=`${os}.${Vl}`,Yh=`${os}.${Pl}`,Qh=`${os}.${Dl}`,Xh=`${os}.${Ul}`,ec=`${os}.${ha}`,tc=`${os}.${Dn}`,sc=`${os}.nonce`,rc=`${os}.tsa`,nc=`${os}.${da}`,Wv=[Gh,Wh,Yh,Qh,Xh,ec,tc,sc,rc,nc];let Yv=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,Ol,s.defaultValues(Ol)),this.policy=h(e,Vl,s.defaultValues(Vl)),this.messageImprint=h(e,Pl,s.defaultValues(Pl)),this.serialNumber=h(e,Dl,s.defaultValues(Dl)),this.genTime=h(e,Ul,s.defaultValues(Ul)),ha in e&&(this.accuracy=h(e,ha,s.defaultValues(ha))),Dn in e&&(this.ordering=h(e,Dn,s.defaultValues(Dn))),Un in e&&(this.nonce=h(e,Un,s.defaultValues(Un))),fa in e&&(this.tsa=h(e,fa,s.defaultValues(fa))),da in e&&(this.extensions=h(e,da,s.defaultValues(da))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Ol:return 0;case Vl:return S;case Pl:return new Tl;case Dl:return new z;case Ul:return new Date(0,0,0);case ha:return new Wn;case Dn:return!1;case Un:return new z;case fa:return new bt;case da:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Ol:case Vl:case Ul:case Dn:return t===s.defaultValues(Dn);case Pl:return Tl.compareWithDefault(Rn,t.hashAlgorithm)&&Tl.compareWithDefault(On,t.hashedMessage);case Dl:case Un:return t.isEqual(s.defaultValues(Un));case ha:return Wn.compareWithDefault(Rs,t.seconds)&&Wn.compareWithDefault(Os,t.millis)&&Wn.compareWithDefault(Vs,t.micros);case fa:return bt.compareWithDefault(Na,t.type)&&bt.compareWithDefault(Ia,t.value);case da:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||os,value:[new z({name:t.version||Gh}),new Oe({name:t.policy||Wh}),Tl.schema(t.messageImprint||{names:{blockName:Yh}}),new z({name:t.serialNumber||Qh}),new ht({name:t.genTime||Xh}),Wn.schema(t.accuracy||{names:{blockName:ec}}),new Bs({name:t.ordering||tc,optional:!0}),new z({name:t.nonce||sc,optional:!0}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[bt.schema(t.tsa||{names:{blockName:rc}})]}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ze({name:t.extensions||nc,value:$r.schema(t.extension||{})})]})]})}fromSchema(e){ge(e,Wv);const t=ce(e,e,s.schema());re.assertSchema(t,this.className),this.version=t.result[Gh].valueBlock.valueDec,this.policy=t.result[Wh].valueBlock.toString(),this.messageImprint=new Tl({schema:t.result[Yh]}),this.serialNumber=t.result[Qh],this.genTime=t.result[Xh].toDate(),ec in t.result&&(this.accuracy=new Wn({schema:t.result[ec]})),tc in t.result&&(this.ordering=t.result[tc].valueBlock.value),sc in t.result&&(this.nonce=t.result[sc]),rc in t.result&&(this.tsa=new bt({schema:t.result[rc]})),nc in t.result&&(this.extensions=Array.from(t.result[nc],n=>new $r({schema:n})))}toSchema(){const e=[];return e.push(new z({value:this.version})),e.push(new Oe({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new ht({valueDate:this.genTime})),this.accuracy&&e.push(this.accuracy.toSchema()),void 0!==this.ordering&&e.push(new Bs({value:this.ordering})),this.nonce&&e.push(this.nonce),this.tsa&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),this.extensions&&e.push(new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,t=>t.toSchema())})),new R({value:e})}toJSON(){const e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return this.accuracy&&(e.accuracy=this.accuracy.toJSON()),void 0!==this.ordering&&(e.ordering=this.ordering),this.nonce&&(e.nonce=this.nonce.toJSON()),this.tsa&&(e.tsa=this.tsa.toJSON()),this.extensions&&(e.extensions=Array.from(this.extensions,t=>t.toJSON())),e}verify(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){if(!e.data)throw new Error('"data" is a mandatory attribute for TST_INFO verification');const a=e.data;if(e.notBefore&&n.genTime<e.notBefore)throw new Error("Generation time for TSTInfo object is less than notBefore value");if(e.notAfter&&n.genTime>e.notAfter)throw new Error("Generation time for TSTInfo object is more than notAfter value");const o=t.getAlgorithmByOID(n.messageImprint.hashAlgorithm.algorithmId,!0,"MessageImprint.hashAlgorithm"),u=yield t.digest(o.name,new Uint8Array(a));return ye.vJ.isEqual(u,n.messageImprint.hashedMessage.valueBlock.valueHexView)})()}}return s.CLASS_NAME="TSTInfo",s})();const ma="version",Ll="digestAlgorithms",Ml="encapContentInfo",ga="certificates",pa="crls",Fl="signerInfos",Hl="ocsps",Ln="SignedData",ef=`${Ln}.${ma}`,ic=`${Ln}.${Ll}`,tf=`${Ln}.${Ml}`,ac=`${Ln}.${ga}`,oc=`${Ln}.crls`,lc=`${Ln}.${Fl}`,Qv=[ef,ic,tf,ac,oc,lc];class Pt extends Error{constructor({message:i,code:e=0,date:t=new Date,signatureVerified:n=null,signerCertificate:a=null,signerCertificateVerified:o=null,timestampSerial:u=null,certificatePath:l=[]}){super(i),this.name="SignedDataVerifyError",this.date=t,this.code=e,this.timestampSerial=u,this.signatureVerified=n,this.signerCertificate=a,this.signerCertificateVerified=o,this.certificatePath=l}}let dm=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,ma,s.defaultValues(ma)),this.digestAlgorithms=h(e,Ll,s.defaultValues(Ll)),this.encapContentInfo=h(e,Ml,s.defaultValues(Ml)),ga in e&&(this.certificates=h(e,ga,s.defaultValues(ga))),pa in e&&(this.crls=h(e,pa,s.defaultValues(pa))),Hl in e&&(this.ocsps=h(e,Hl,s.defaultValues(Hl))),this.signerInfos=h(e,Fl,s.defaultValues(Fl)),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case ma:return 0;case Ll:return[];case Ml:return new oa;case ga:case pa:case Hl:case Fl:return[];default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case ma:return t===s.defaultValues(ma);case Ml:return oa.compareWithDefault("eContentType",t.eContentType)&&oa.compareWithDefault("eContent",t.eContent);case Ll:case ga:case pa:case Hl:case Fl:return 0===t.length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return void 0===t.optional&&(t.optional=!1),new R({name:t.blockName||Ln,optional:t.optional,value:[new z({name:t.version||ef}),new At({value:[new ze({name:t.digestAlgorithms||ic,value:G.schema()})]}),oa.schema(t.encapContentInfo||{names:{blockName:tf}}),new $({name:t.certificates||ac,optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Ai.schema().valueBlock.value}),new $({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Tu.schema(t.crls||{names:{crls:oc}}).valueBlock.value}),new At({value:[new ze({name:t.signerInfos||lc,value:zh.schema()})]})]})}fromSchema(e){ge(e,Qv);const t=ce(e,e,s.schema());if(re.assertSchema(t,this.className),this.version=t.result[ef].valueBlock.valueDec,ic in t.result&&(this.digestAlgorithms=Array.from(t.result[ic],n=>new G({schema:n}))),this.encapContentInfo=new oa({schema:t.result[tf]}),ac in t.result){const n=new Ai({schema:new At({value:t.result[ac].valueBlock.value})});this.certificates=n.certificates.slice(0)}oc in t.result&&(this.crls=Array.from(t.result[oc],n=>1===n.idBlock.tagClass?new Cu({schema:n}):(n.idBlock.tagClass=1,n.idBlock.tagNumber=16,new Iu({schema:n})))),lc in t.result&&(this.signerInfos=Array.from(t.result[lc],n=>new zh({schema:n})))}toSchema(e=!1){const t=[];if(this.version=this.certificates&&this.certificates.length&&this.certificates.some(n=>n instanceof tr)||this.crls&&this.crls.length&&this.crls.some(n=>n instanceof Iu)?5:this.certificates&&this.certificates.length&&this.certificates.some(n=>n instanceof on)?4:this.certificates&&this.certificates.length&&this.certificates.some(n=>n instanceof zc)||this.signerInfos.some(n=>3===n.version)||this.encapContentInfo.eContentType!==s.ID_DATA?3:1,t.push(new z({value:this.version})),t.push(new At({value:Array.from(this.digestAlgorithms,n=>n.toSchema())})),t.push(this.encapContentInfo.toSchema()),this.certificates){const a=new Ai({certificates:this.certificates}).toSchema();t.push(new $({idBlock:{tagClass:3,tagNumber:0},value:a.valueBlock.value}))}return this.crls&&t.push(new $({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,n=>{if(n instanceof Iu){const a=n.toSchema();return a.idBlock.tagClass=3,a.idBlock.tagNumber=1,a}return n.toSchema(e)})})),t.push(new At({value:Array.from(this.signerInfos,n=>n.toSchema())})),new R({value:t})}toJSON(){const e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,t=>t.toJSON()),encapContentInfo:this.encapContentInfo.toJSON(),signerInfos:Array.from(this.signerInfos,t=>t.toJSON())};return this.certificates&&(e.certificates=Array.from(this.certificates,t=>t.toJSON())),this.crls&&(e.crls=Array.from(this.crls,t=>t.toJSON())),e}verify({signer:e=-1,data:t=Tt,trustedCerts:n=[],checkDate:a=new Date,checkChain:o=!1,passedWhenNotRevValues:u=!1,extendedMode:l=!1,findOrigin:m=null,findIssuer:k=null}={},B=Ge(!0)){var F=this;return(0,Ce.Z)(function*(){let V=null,le=null;try{let ve=Tt,W=S,q=[];const ne=F.signerInfos[e];if(!ne)throw new Pt({date:a,code:1,message:"Unable to get signer by supplied index"});if(!F.certificates)throw new Pt({date:a,code:2,message:"No certificates attached to this signed data"});if(ne.sid instanceof Vt){for(const be of F.certificates)if(be instanceof ts&&be.issuer.isEqual(ne.sid.issuer)&&be.serialNumber.isEqual(ne.sid.serialNumber)){V=be;break}}else{const be=ne.sid,Ie=be.idBlock.isConstructed?be.valueBlock.value[0].valueBlock.valueHex:be.valueBlock.valueHex;for(const Ve of F.certificates)if(Ve instanceof ts&&$n(yield B.digest({name:"sha-1"},Ve.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHexView),Ie)){V=Ve;break}}if(!V)throw new Pt({date:a,code:3,message:"Unable to find signer certificate"});if("1.2.840.113549.1.9.16.1.4"===F.encapContentInfo.eContentType){if(!F.encapContentInfo.eContent)throw new Pt({date:a,code:15,message:"Error during verification: TSTInfo eContent is empty",signatureVerified:null,signerCertificate:V,timestampSerial:le,signerCertificateVerified:!0});let be;try{be=Yv.fromBER(F.encapContentInfo.eContent.valueBlock.valueHexView)}catch{throw new Pt({date:a,code:15,message:"Error during verification: TSTInfo wrong ASN.1 schema ",signatureVerified:null,signerCertificate:V,timestampSerial:le,signerCertificateVerified:!0})}if(a=be.genTime,le=be.serialNumber.valueBlock.valueHexView.slice(),0===t.byteLength)throw new Pt({date:a,code:4,message:"Missed detached data input array"});if(!(yield be.verify({data:t},B)))throw new Pt({date:a,code:15,message:"Error during verification: TSTInfo verification is failed",signatureVerified:!1,signerCertificate:V,timestampSerial:le,signerCertificateVerified:!0})}if(o){const be=F.certificates.filter(tt=>tt instanceof ts&&!!nm(tt,V)),Ie={checkDate:a,certs:be,trustedCerts:n};k&&(Ie.findIssuer=k),m&&(Ie.findOrigin=m);const Ve=new Zu(Ie);if(Ve.certs.push(V),F.crls)for(const tt of F.crls)"thisUpdate"in tt?Ve.crls.push(tt):"1.3.6.1.5.5.7.48.1.1"===tt.otherRevInfoFormat&&Ve.ocsps.push(new Ov({schema:tt.otherRevInfo}));F.ocsps&&Ve.ocsps.push(...F.ocsps);const qe=yield Ve.verify({passedWhenNotRevValues:u},B).catch(tt=>{throw new Pt({date:a,code:5,message:`Validation of signer's certificate failed with error: ${tt instanceof Object?tt.resultMessage:tt}`,signerCertificate:V,signerCertificateVerified:!1})});if(qe.certificatePath&&(q=qe.certificatePath),!qe.result)throw new Pt({date:a,code:5,message:`Validation of signer's certificate failed: ${qe.resultMessage}`,signerCertificate:V,signerCertificateVerified:!1})}const ae=B.getAlgorithmByOID(ne.digestAlgorithm.algorithmId);if(!("name"in ae))throw new Pt({date:a,code:7,message:`Unsupported signature algorithm: ${ne.digestAlgorithm.algorithmId}`,signerCertificate:V,signerCertificateVerified:!0});W=ae.name;const fe=F.encapContentInfo.eContent;if(fe)t=1===fe.idBlock.tagClass&&4===fe.idBlock.tagNumber?fe.getValue():fe.valueBlock.valueBeforeDecodeView;else if(0===t.byteLength)throw new Pt({date:a,code:8,message:"Missed detached data input array",signerCertificate:V,signerCertificateVerified:!0});if(ne.signedAttrs){let be=!1,Ie=!1;for(const Ve of ne.signedAttrs.attributes)if("1.2.840.113549.1.9.3"===Ve.type&&(be=!0),"1.2.840.113549.1.9.4"===Ve.type&&(Ie=!0,ve=Ve.values[0].valueBlock.valueHex),be&&Ie)break;if(!1===be)throw new Pt({date:a,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signerCertificate:V,signerCertificateVerified:!0});if(!1===Ie)throw new Pt({date:a,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:V,signerCertificateVerified:!0})}if(ne.signedAttrs){if(!$n(yield B.digest(W,new Uint8Array(t)),ve))throw new Pt({date:a,code:15,message:"Error during verification: Message digest doesn't match",signatureVerified:null,signerCertificate:V,timestampSerial:le,signerCertificateVerified:!0});t=ne.signedAttrs.encodedValue}const ke=yield B.verifyWithPublicKey(t,ne.signature,V.subjectPublicKeyInfo,V.signatureAlgorithm,W);return l?{date:a,code:14,message:S,signatureVerified:ke,signerCertificate:V,timestampSerial:le,signerCertificateVerified:!0,certificatePath:q}:ke}catch(ve){throw ve instanceof Pt?ve:new Pt({date:a,code:15,message:`Error during verification: ${ve instanceof Error?ve.message:ve}`,signatureVerified:null,signerCertificate:V,timestampSerial:le,signerCertificateVerified:!0})}})()}sign(e,t,n="SHA-1",a=Tt,o=Ge(!0)){var u=this;return(0,Ce.Z)(function*(){if(!e)throw new Error("Need to provide a private key for signing");const l=o.getOIDByAlgorithm({name:n},!0,"hashAlgorithm");0===u.digestAlgorithms.filter(V=>V.algorithmId===l).length&&u.digestAlgorithms.push(new G({algorithmId:l,algorithmParams:new _t}));const m=u.signerInfos[t];if(!m)throw new RangeError("SignerInfo index is out of range");m.digestAlgorithm=new G({algorithmId:l,algorithmParams:new _t});const k=yield o.getSignatureParameters(e,n),B=k.parameters;if(m.signatureAlgorithm=k.signatureAlgorithm,m.signedAttrs)0!==m.signedAttrs.encodedValue.byteLength?a=m.signedAttrs.encodedValue:(a=m.signedAttrs.toSchema().toBER(),ye.vJ.toUint8Array(a)[0]=49);else{const V=u.encapContentInfo.eContent;if(V)a=1===V.idBlock.tagClass&&4===V.idBlock.tagNumber?V.getValue():V.valueBlock.valueBeforeDecodeView;else if(0===a.byteLength)throw new Error("Missed detached data input array")}const F=yield o.signWithPrivateKey(a,e,B);m.signature=new de({valueHex:F})})()}}return s.CLASS_NAME="SignedData",s.ID_DATA=Tc,s})();const Mn="version",Fn="authSafe",Ts="macData",Jl="parsedValue",Xv=[Mn,Fn,Ts];let ey=(()=>{class s extends he{constructor(e={}){super(),this.version=h(e,Mn,s.defaultValues(Mn)),this.authSafe=h(e,Fn,s.defaultValues(Fn)),Ts in e&&(this.macData=h(e,Ts,s.defaultValues(Ts))),Jl in e&&(this.parsedValue=h(e,Jl,s.defaultValues(Jl))),e.schema&&this.fromSchema(e.schema)}static defaultValues(e){switch(e){case Mn:return 3;case Fn:return new Lt;case Ts:return new xn;case Jl:return{};default:return super.defaultValues(e)}}static compareWithDefault(e,t){switch(e){case Mn:return t===s.defaultValues(e);case Fn:return Lt.compareWithDefault("contentType",t.contentType)&&Lt.compareWithDefault("content",t.content);case Ts:return xn.compareWithDefault("mac",t.mac)&&xn.compareWithDefault("macSalt",t.macSalt)&&xn.compareWithDefault("iterations",t.iterations);case Jl:return t instanceof Object&&0===Object.keys(t).length;default:return super.defaultValues(e)}}static schema(e={}){const t=h(e,"names",{});return new R({name:t.blockName||S,value:[new z({name:t.version||Mn}),Lt.schema(t.authSafe||{names:{blockName:Fn}}),xn.schema(t.macData||{names:{blockName:Ts,optional:!0}})]})}fromSchema(e){ge(e,Xv);const t=ce(e,e,s.schema({names:{version:Mn,authSafe:{names:{blockName:Fn}},macData:{names:{blockName:Ts}}}}));re.assertSchema(t,this.className),this.version=t.result.version.valueBlock.valueDec,this.authSafe=new Lt({schema:t.result.authSafe}),Ts in t.result&&(this.macData=new xn({schema:t.result.macData}))}toSchema(){const e=[new z({value:this.version}),this.authSafe.toSchema()];return this.macData&&e.push(this.macData.toSchema()),new R({value:e})}toJSON(){const e={version:this.version,authSafe:this.authSafe.toJSON()};return this.macData&&(e.macData=this.macData.toJSON()),e}makeInternalValues(e={},t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){if(ct.assert(e,"parameters","object"),!n.parsedValue)throw new Error('Please call "parseValues" function first in order to make "parsedValue" data');switch(it.assertEmpty(n.parsedValue.integrityMode,"integrityMode","parsedValue"),it.assertEmpty(n.parsedValue.authenticatedSafe,"authenticatedSafe","parsedValue"),n.parsedValue.integrityMode){case 0:{if(!("iterations"in e))throw new it("iterations");it.assertEmpty(e.pbkdf2HashAlgorithm,"pbkdf2HashAlgorithm"),it.assertEmpty(e.hmacHashAlgorithm,"hmacHashAlgorithm"),it.assertEmpty(e.password,"password");const a=new ArrayBuffer(64),o=new Uint8Array(a);t.getRandomValues(o);const u=n.parsedValue.authenticatedSafe.toSchema().toBER(!1);n.authSafe=new Lt({contentType:Lt.DATA,content:new de({valueHex:u})});const l=yield t.stampDataWithPassword({password:e.password,hashAlgorithm:e.hmacHashAlgorithm,salt:a,iterationCount:e.iterations,contentToStamp:u});n.macData=new xn({mac:new ia({digestAlgorithm:new G({algorithmId:t.getOIDByAlgorithm({name:e.hmacHashAlgorithm},!0,"hmacHashAlgorithm")}),digest:new de({valueHex:l})}),macSalt:new de({valueHex:a}),iterations:e.iterations})}break;case 1:{if(!("signingCertificate"in e))throw new it("signingCertificate");it.assertEmpty(e.privateKey,"privateKey"),it.assertEmpty(e.hashAlgorithm,"hashAlgorithm");const a=n.parsedValue.authenticatedSafe.toSchema().toBER(!1),o=new dm({version:1,encapContentInfo:new oa({eContentType:"1.2.840.113549.1.7.1",eContent:new de({valueHex:a})}),certificates:[e.signingCertificate]}),u=yield t.digest({name:e.hashAlgorithm},new Uint8Array(a)),l=[];l.push(new at({type:"1.2.840.113549.1.9.3",values:[new Oe({value:"1.2.840.113549.1.7.1"})]})),l.push(new at({type:"1.2.840.113549.1.9.5",values:[new Gn({valueDate:new Date})]})),l.push(new at({type:"1.2.840.113549.1.9.4",values:[new de({valueHex:u})]})),o.signerInfos.push(new zh({version:1,sid:new Vt({issuer:e.signingCertificate.issuer,serialNumber:e.signingCertificate.serialNumber}),signedAttrs:new zt({type:0,attributes:l})})),yield o.sign(e.privateKey,0,e.hashAlgorithm,void 0,t),n.authSafe=new Lt({contentType:"1.2.840.113549.1.7.2",content:o.toSchema(!0)})}break;default:throw new Error(`Parameter "integrityMode" has unknown value: ${n.parsedValue.integrityMode}`)}})()}parseInternalValues(e,t=Ge(!0)){var n=this;return(0,Ce.Z)(function*(){switch(ct.assert(e,"parameters","object"),void 0===e.checkIntegrity&&(e.checkIntegrity=!0),n.parsedValue={},n.authSafe.contentType){case Lt.DATA:{it.assertEmpty(e.password,"password"),n.parsedValue.integrityMode=0,ct.assert(n.authSafe.content,"authSafe.content",de);const a=n.authSafe.content.getValue();if(n.parsedValue.authenticatedSafe=kh.fromBER(a),e.checkIntegrity){if(!n.macData)throw new Error('Absent "macData" value, can not check PKCS#12 data integrity');const o=t.getAlgorithmByOID(n.macData.mac.digestAlgorithm.algorithmId,!0,"digestAlgorithm");if(!(yield t.verifyDataStampedWithPassword({password:e.password,hashAlgorithm:o.name,salt:ye.vJ.toArrayBuffer(n.macData.macSalt.valueBlock.valueHexView),iterationCount:n.macData.iterations||1,contentToVerify:a,signatureToVerify:ye.vJ.toArrayBuffer(n.macData.mac.digest.valueBlock.valueHexView)})))throw new Error("Integrity for the PKCS#12 data is broken!")}}break;case Lt.SIGNED_DATA:{n.parsedValue.integrityMode=1;const a=new dm({schema:n.authSafe.content}),o=a.encapContentInfo.eContent;it.assert(o,"eContent","cmsSigned.encapContentInfo"),ct.assert(o,"eContent",de);const u=o.getValue();if(n.parsedValue.authenticatedSafe=kh.fromBER(u),!(yield a.verify({signer:0,checkChain:!1},t)))throw new Error("Integrity for the PKCS#12 data is broken!")}break;default:throw new Error(`Incorrect value for "this.authSafe.contentType": ${n.authSafe.contentType}`)}})()}}return s.CLASS_NAME="PFX",s})();function yy(s,i){1&s&&(r.TgZ(0,"div"),r._uU(1," Certificate issued with success "),r.qZA())}function wy(s,i){1&s&&(r.TgZ(0,"div"),r._uU(1," Select cert issue method "),r.qZA())}function Sy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div")(1,"p"),r._uU(2,"There are four ways to issue a new certificate:"),r.qZA(),r.TgZ(3,"div",5)(4,"nb-card",6)(5,"nb-tabset",7)(6,"nb-tab",8)(7,"p"),r._uU(8,"Many operating systems and browsers require that certificates are imported as a password protected PKCS#12 keystore. If you want to manually generate the keystore, which is the recommended approach, click the corresponding button below and download the resulting zip file, unzip it and then use OpenSSL to generate the keystore using the following command: "),r._UZ(9,"br")(10,"br"),r.TgZ(11,"pre"),r._uU(12),r.qZA(),r._uU(13," This will prompt you for a passphrase to protect the keystore. If successful the command will result in a PKCS#12 keystore file called 'keystore.p12'. "),r._UZ(14,"br"),r._uU(15,"If you don't want to generate a keystore at all you can just skip executing the OpenSSL command. "),r.qZA(),r.TgZ(16,"div",9)(17,"button",10),r.NdJ("click",function(){return r.CHM(e),r.oxw().locallyWManualKeystore()}),r._uU(18,"Issue a cert locally with manual keystore setup"),r.qZA()()(),r.TgZ(19,"nb-tab",11)(20,"p"),r._uU(21," Many operating systems and browsers require that certificates are imported as a password protected PKCS#12 keystore. You can let your browser generate a keystore for you. NOTE that this action will take a little while and the resulting keystore will NOT be compatible with most major operating systems and browsers. "),r.qZA(),r.TgZ(22,"div",9)(23,"button",12),r.NdJ("click",function(){return r.CHM(e),r.oxw().locallyFromBrowser()}),r._uU(24,"Issue a cert locally from browser"),r.qZA()()(),r.TgZ(25,"nb-tab",13)(26,"p"),r._uU(27," MIR API server generate it for you? NOTE that it is strongly recommended to NOT let the server generate the key pair for you as in case of a breach of the MIR API server, a malicious third party can potentially take control over your identity by stealing your private key when it is generated. Also note that the possibility of getting server generated key pairs will be removed completely in the future, and that MCP ID service providers can already choose to disable it now. "),r.qZA(),r.TgZ(28,"div",9)(29,"button",14),r.NdJ("click",function(){return r.CHM(e),r.oxw().fromServer()}),r._uU(30,"Issue a cert from server"),r.qZA()()(),r.TgZ(31,"nb-tab",15)(32,"span"),r._uU(33," You can generate the key pair and a CSR from scratch by yourself - an example on how to do this can be found "),r.TgZ(34,"a",16),r._uU(35,"here"),r.qZA(),r._uU(36,". "),r._UZ(37,"br"),r._uU(38," .. and you are free to click 'Close' button to proceed. "),r.qZA()()()()(),r.TgZ(39,"p"),r._uU(40," We strongly recommend to read the instructions throughly as the security impact significantly differs from each other. "),r.qZA()()}if(2&s){const e=r.oxw();r.xp6(12),r.AsE("openssl pkcs12 -export -out keystore.p12 -in Certificate_",e.nameNoSpaces,".pem -inkey PrivateKey_",e.nameNoSpaces,".pem")}}function by(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",9)(1,"button",17),r.NdJ("click",function(){return r.CHM(e),r.oxw().zipAndDownload()}),r._uU(2,"Download certificate"),r.qZA()()}}!function vy(){if("undefined"!=typeof self){if("crypto"in self){let s="webcrypto";"webkitSubtle"in self.crypto&&(s="safari"),jd(s,new nu({name:s,crypto}))}}else if("undefined"!=typeof crypto&&"webcrypto"in crypto){const s="NodeJS ^15",i=crypto.webcrypto;jd(s,new nu({name:s,crypto:i}))}}();const _y=s=>String.fromCharCode.apply(null,new Uint16Array(s));let Ay=(()=>{class s{constructor(e){this.ref=e,this.serverGeneratedKeys=!1}ngOnInit(){this.isLoading=!1,this.entityMrn&&(this.generateLabelValues(),this.nameNoSpaces=this.entityTitle.split(" ").join("_"))}dismiss(){this.ref.close(),this.updateCertificate()}locallyWManualKeystore(){this.issueNewWithLocalKeys(!1)}locallyFromBrowser(){this.issueNewWithLocalKeys(!0)}fromServer(){this.issueNewWithServerKeys()}zipAndDownload(){this.fileHelper.downloadPemCertificate(this.certificateBundle,this.entityTitle,this.serverGeneratedKeys,this.notifierService),this.notifierService.notify("success","Chosen certificate has downloaded")}issueNewWithServerKeys(){this.isLoading=!0,this.certificateService.issueNewCertificateFromMIR(this.entityType,this.entityMrn,this.orgMrn,this.instanceVersion).subscribe(e=>{this.certificateBundle=e,this.serverGeneratedKeys=!0,this.isLoading=!1,this.notifierService.notify("success","You can now download the issued certificate")},e=>{this.isLoading=!1,410!==e.status?this.notifierService.notify("error","Error when trying to issue new certificate",e.error.message):this.notifierService.notify("error","Generating certificates with server generated keys is not supported by this ID provider")})}issueNewWithLocalKeys(e){this.isLoading=!0,crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-384",typedCurve:""},!0,["sign","verify"]).then(a=>{let o=new Dv;o.subject.typesAndValues.push(new Ac({type:"2.5.4.3",value:new Xt({value:"Test"})})),o.subjectPublicKeyInfo.importKey(a.publicKey).then(()=>{o.sign(a.privateKey,"SHA-384").then(()=>{let u=o.toSchema().toBER(!1),l=this.toPem(u,"CERTIFICATE REQUEST");this.certificateService.issueNewCertificate(l,this.entityType,this.entityMrn,this.orgMrn,this.instanceVersion).subscribe(m=>{},m=>{if(201===m.status){const k=m.error.text;crypto.subtle.exportKey("pkcs8",a.privateKey).then(B=>{crypto.subtle.exportKey("spki",a.publicKey).then(F=>{let V=new fo({schema:Ct(B).result});if(e){let ve=this.convertCertChain(k).map(q=>new ts({schema:Ct(q).result})),W=this.generatePassword();this.generatePKCS12(V,ve,W).then(q=>{this.certificateBundle={pemCertificate:{privateKey:this.toPem(B,"PRIVATE KEY"),publicKey:this.toPem(F,"PUBLIC KEY"),certificate:k},pkcs12Keystore:_y(q),keystorePassword:W},this.isLoading=!1,this.notifierService.notify("success","You can now download the issued certificate")},q=>{this.isLoading=!1,this.notifierService.notify("error","PKCS#12 keystore could not be generated - "+q.error.message)})}else this.certificateBundle={pemCertificate:{privateKey:this.toPem(B,"PRIVATE KEY"),publicKey:this.toPem(F,"PUBLIC KEY"),certificate:k}},this.notifierService.notify("success","You can now download the issued certificate"),this.isLoading=!1},F=>{this.isLoading=!1,this.notifierService.notify("error","Public key could not be exported - "+F.error.message)})},B=>{this.isLoading=!1,this.notifierService.notify("error","Private key could not be exported - "+B.error.message)})}else this.isLoading=!1,this.notifierService.notify("error","Error when trying to issue new certificate - "+m.error.message)})})})},a=>{this.isLoading=!1,this.notifierService.notify("error","Error when trying to issue new certificate - "+a.error.message)})}generateLabelValues(){this.labelValues=[],this.labelValues.push({label:"Name",valueHtml:this.entityTitle}),this.labelValues.push({label:"MRN",valueHtml:this.entityMrn.split("#\xa4#")[0]})}toPem(e,t){let n=ye.ep.ToBase64(e),a="";for(;n.length>0;)a+=n.substring(0,64)+"\n",n=n.substring(64);return`-----BEGIN ${t}-----\n${a}-----END ${t}-----\n`}convertCertChain(e){let t=e.split(/-----END CERTIFICATE-----/);return t=t.slice(0,t.length-1),t.map(a=>a.split(/-----BEGIN CERTIFICATE-----/)[1].replace(/\n/gm,"")).map(a=>ye.ep.FromBase64(a))}generatePassword(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_^$#&!%",t=new Uint32Array(26);crypto.getRandomValues(t);let n="";for(const a of t)n+=e[a%e.length];return n}generatePKCS12(e,t,n){return(0,Ce.Z)(function*(){const a=new ArrayBuffer(4);Dc(new Uint8Array(a));const u=new ArrayBuffer(4);Dc(new Uint8Array(u));const m=new ArrayBuffer(4);Dc(new Uint8Array(m));const B=new ArrayBuffer(1);new Uint8Array(B)[0]|=128;const V=new et({valueHex:B,unusedBits:7});e.attributes=[new at({type:"2.5.29.15",values:[V]})];let le="";t[0].subject.typesAndValues.forEach(ne=>{"2.5.4.3"===ne.type&&(le=ne.value.valueBlock.value)});let ve="";t[1].subject.typesAndValues.forEach(ne=>{"2.5.4.3"===ne.type&&(ve=ne.value.valueBlock.value)});const W=new ey({parsedValue:{integrityMode:0,authenticatedSafe:new kh({parsedValue:{safeContents:[{privacyMode:0,value:new dn({safeBags:[new il({bagId:"1.2.840.113549.1.12.10.1.2",bagValue:new im({parsedValue:e}),bagAttributes:[new at({type:"1.2.840.113549.1.9.20",values:[new rs({value:"PKCS8ShroudedKeyBag from PKIjs"})]}),new at({type:"1.2.840.113549.1.9.21",values:[new de({valueHex:a})]}),new at({type:"1.3.6.1.4.1.311.17.1",values:[new rs({value:"MCP using https://pkijs.org/"})]})]})]})},{privacyMode:1,value:new dn({safeBags:[new il({bagId:"1.2.840.113549.1.12.10.1.3",bagValue:new oh({parsedValue:t[0]}),bagAttributes:[new at({type:"1.2.840.113549.1.9.20",values:[new rs({value:le})]}),new at({type:"1.2.840.113549.1.9.21",values:[new de({valueHex:u})]}),new at({type:"1.3.6.1.4.1.311.17.1",values:[new rs({value:"MCP using https://pkijs.org/"})]})]}),new il({bagId:"1.2.840.113549.1.12.10.1.3",bagValue:new oh({parsedValue:t[1]}),bagAttributes:[new at({type:"1.2.840.113549.1.9.20",values:[new rs({value:ve})]}),new at({type:"1.2.840.113549.1.9.21",values:[new de({valueHex:m})]}),new at({type:"1.3.6.1.4.1.311.17.1",values:[new rs({value:"MCP using https://pkijs.org/"})]})]})]})}]}})}}),q=Cr(n);return yield W.parsedValue.authenticatedSafe.parsedValue.safeContents[0].value.safeBags[0].bagValue.makeInternalValues({password:q,contentEncryptionAlgorithm:{name:"AES-CBC",length:128},hmacHashAlgorithm:"SHA-1",iterationCount:1e5}),yield W.parsedValue.authenticatedSafe.makeInternalValues({safeContents:[{},{password:q,contentEncryptionAlgorithm:{name:"AES-CBC",length:128},hmacHashAlgorithm:"SHA-1",iterationCount:1e5}]}),yield W.makeInternalValues({password:q,iterations:1e5,pbkdf2HashAlgorithm:"SHA-256",hmacHashAlgorithm:"SHA-256"}),W.toSchema().toBER(!1)})()}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(K.X4l))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-cert-issue-dialog"]],inputs:{entityMrn:"entityMrn",entityTitle:"entityTitle",entityType:"entityType",orgMrn:"orgMrn",instanceVersion:"instanceVersion",notifierService:"notifierService",fileHelper:"fileHelper",certificateService:"certificateService",updateCertificate:"updateCertificate"},decls:11,vars:5,consts:[[4,"ngIf"],["nbSpinnerSize","large","nbSpinnerStatus","primary",3,"nbSpinner"],["class","container",4,"ngIf"],[1,"buttons-row"],["nbButton","","status","danger",3,"click"],[1,"col-12"],["size","small"],["fullWidth",""],["tabTitle","Locally with manual keystore setup"],[1,"container"],["nbButton","","status","success",1,"w-100",3,"click"],["tabTitle","Locally from browser"],["nbButton","","status","info",1,"w-100",3,"click"],["tabTitle","From server"],["nbButton","","status","warning",1,"w-100",3,"click"],["tabTitle","Locally from scratch with OpenSSL"],["href","https://github.com/maritimeconnectivity/IdentityRegistry#certificate-issuing-by-certificate-signing-request","target","_blank"],["type","button","nbButton","","status","success",1,"w-100",3,"click"]],template:function(e,t){1&e&&(r.TgZ(0,"nb-card")(1,"nb-card-header"),r.YNc(2,yy,2,0,"div",0),r.YNc(3,wy,2,0,"div",0),r.qZA(),r.TgZ(4,"nb-card-body",1),r.YNc(5,Sy,41,2,"div",0),r.YNc(6,by,3,0,"div",2),r.qZA(),r.TgZ(7,"nb-card-footer")(8,"div",3)(9,"button",4),r.NdJ("click",function(){return t.dismiss()}),r._uU(10,"Close"),r.qZA()()()()),2&e&&(r.xp6(2),r.Q6J("ngIf",t.certificateBundle),r.xp6(1),r.Q6J("ngIf",!t.certificateBundle),r.xp6(1),r.Q6J("nbSpinner",t.isLoading),r.xp6(1),r.Q6J("ngIf",!t.certificateBundle),r.xp6(1),r.Q6J("ngIf",t.certificateBundle))},directives:[K.Asz,K.ndF,_.O5,K.yKW,K.Q7R,K.kyn,K.TR4,K.DPz,K.XWE],styles:[""]}),s})();const ky={start:{title:"Valid from",type:"string",valuePrepareFunction:s=>(0,Et.r)(s)},end:{title:"Valid until",type:"string",valuePrepareFunction:s=>(0,Et.r)(s)}},Ey={revokeInfo:{title:"Revoked from",type:"string",valuePrepareFunction:s=>(0,Et.r)(s)},revokeReasonText:{title:"Reason",type:"string"}};var sf=M(9441),Cy=M(5650);let Ny=(()=>{class s{constructor(){}downloadPemCertificate(e,t,n,a){try{const o=t.split(" ").join("_"),u=n?this.replaceNewLines(e.pemCertificate.certificate):e.pemCertificate.certificate,l=n?this.replaceNewLines(e.pemCertificate.publicKey):e.pemCertificate.publicKey,m=n?this.replaceNewLines(e.pemCertificate.privateKey):e.pemCertificate.privateKey,k=e.pkcs12Keystore&&"string"==typeof e.pkcs12Keystore?this.convertBase64ToByteArray(e.pkcs12Keystore):e.pkcs12Keystore,B=new Cy;if(B.file("Certificate_"+o+".pem",u),m&&B.file("PrivateKey_"+o+".pem",m),l&&B.file("PublicKey_"+o+".pem",l),e.keystorePassword&&B.file("KeystorePassword.txt",this.replaceNewLines(e.keystorePassword)),e.jksKeystore){const F=this.convertBase64ToByteArray(e.jksKeystore),V=new Blob([F]);B.file("Keystore_"+o+".jks",V)}if(k){const V=new Blob([k]);B.file("Keystore_"+o+".p12",V)}B.generateAsync({type:"blob"}).then(function(F){sf.saveAs(F,"Certificate_"+o+".zip")})}catch(o){a.notify("error","Error when trying to download file - "+o)}}downloadXml(e,t){e?this.downloadFile(e.content,e.contentContentType,e.name,t):t.notify("error","No file to download")}downloadDoc(e,t){if(!e)return void t.notify("error","No file to download");if(e.filecontent.length>1&&e.filecontent.length<10)return void t.notify("error","File from Service Registry is in the wrong format. "+e.name);let n=e.filecontent.toString();this.downloadBase64File(n,e.filecontentContentType,e.name,t)}downloadBase64File(e,t,n,a){try{let o=this.convertBase64ToByteArray(e),u=new Blob([o],{type:t});sf.saveAs(u,n)}catch(o){a.notify("error","Error when trying to download file - "+o)}}downloadFile(e,t,n,a){try{let o=new Blob([e],{type:t});sf.saveAs(o,n)}catch(o){a.notify("error","Error when trying to download file - "+o)}}convertBase64ToByteArray(e){let t=window.atob(e),n=new Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return new Uint8Array(n)}replaceNewLines(e){let t="\n";return-1!=navigator.appVersion.indexOf("Win")&&(t="\r\n"),e?e.replace(/(\\n)/gm,t):""}}return s.\u0275fac=function(e){return new(e||s)},s.\u0275prov=r.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();function Iy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",4),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).openIssueDialog()}),r._uU(1,"Issue new certificate"),r.qZA()}}function Ty(s,i){if(1&s&&(r.TgZ(0,"div",2),r.YNc(1,Iy,2,0,"button",3),r.qZA()),2&s){const e=r.oxw();r.xp6(1),r.Q6J("ngIf",e.hasPermissionInMIR)}}let By=(()=>{class s{constructor(e,t,n,a){this.notifierService=e,this.fileHelper=t,this.certificateService=n,this.dialogService=a,this.settings={mode:"external",edit:{editButtonContent:'<small><i class="fas fa-file-download fa-xs"></i></small>',saveButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>'},delete:{deleteButtonContent:'<small><i class="fas fa-ban fa-xs"></i></small>',confirmDelete:!0},hideSubHeader:!0,actions:{position:"right"}},this.source=new d.nC,this.onUpdate=new r.vpe,this.certificateTitle="Certificate for "}ngOnInit(){this.forRevoked?(this.settings.actions=void 0,this.settings.columns=Ey):this.settings.columns=ky}openIssueDialog(){this.hasPermissionInMIR?this.dialogService.open(Ay,{context:{entityMrn:this.entityMrn,entityTitle:this.entityTitle,entityType:this.entityType,orgMrn:this.orgMrn,instanceVersion:this.instanceVersion,notifierService:this.notifierService,fileHelper:this.fileHelper,certificateService:this.certificateService,updateCertificate:()=>this.onUpdate.emit()},closeOnBackdropClick:!1,closeOnEsc:!1}):this.notifierService.notify("error","You don't have right permission")}openRevokeDialog(e){this.hasPermissionInMIR?this.dialogService.open(Vm,{context:{entityMrn:this.entityMrn,entityTitle:this.entityTitle,entityType:this.entityType,orgMrn:this.orgMrn,certificateId:e.serialNumber,instanceVersion:this.instanceVersion,notifierService:this.notifierService,certificateService:this.certificateService,updateCertificate:()=>this.onUpdate.emit()},closeOnBackdropClick:!1,closeOnEsc:!1}):this.notifierService.notify("error","You don't have right permission")}onEdit(e){this.download(e.data),this.notifierService.notify("success","Chosen certificate has downloaded")}onDelete(e){this.openRevokeDialog(e.data)}download(e){this.fileHelper.downloadPemCertificate({pemCertificate:{certificate:e.certificate}},"Certificate for "+this.entityTitle,!0,this.notifierService)}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(Me.lG),r.Y36(Ny),r.Y36(De),r.Y36(K.Gln))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-certificates"]],inputs:{data:"data",forRevoked:"forRevoked",entityMrn:"entityMrn",entityTitle:"entityTitle",entityType:"entityType",orgMrn:"orgMrn",instanceVersion:"instanceVersion",hasPermissionInMIR:"hasPermissionInMIR"},outputs:{onUpdate:"onUpdate"},decls:2,vars:3,consts:[[3,"settings","source","edit","delete"],["class","pt-1",4,"ngIf"],[1,"pt-1"],["class","w-100","status","primary","type","button","nbButton","",3,"click",4,"ngIf"],["status","primary","type","button","nbButton","",1,"w-100",3,"click"]],template:function(e,t){1&e&&(r.TgZ(0,"ng2-smart-table",0),r.NdJ("edit",function(a){return t.onEdit(a)})("delete",function(a){return t.onDelete(a)}),r.qZA(),r.YNc(1,Ty,2,1,"div",1)),2&e&&(r.Q6J("settings",t.settings)("source",t.data),r.xp6(1),r.Q6J("ngIf",!t.forRevoked))},directives:[d.T5,_.O5,K.DPz],styles:[""]}),s})();var xy=M(8493);const Ry=["map"];function Oy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",14),r.NdJ("click",function(){r.CHM(e);const n=r.oxw(4);return n.submit(n.formGroup)}),r._uU(1,"Submit"),r.qZA()}if(2&s){const e=r.oxw(4);r.Q6J("disabled",!e.formGroup.valid)}}function Vy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(){return r.CHM(e),r.oxw(4).cancel()}),r._uU(1,"Cancel"),r.qZA()}}function Py(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",16),r.NdJ("click",function(){return r.CHM(e),r.oxw(4).invertIsEditing()}),r._uU(1,"Edit"),r.qZA()}}function Dy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(){return r.CHM(e),r.oxw(4).delete()}),r._uU(1,"Delete"),r.qZA()}}function Uy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",17),r.NdJ("click",function(){r.CHM(e);const n=r.oxw(4);return n.openXmlDialog(n.loadedData.instanceAsXml,!0)}),r._uU(1,"Edit By XML"),r.qZA()}}function Ly(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",14),r.NdJ("click",function(){return r.CHM(e),r.oxw(4).updateForNewVer()}),r._uU(1,"New version"),r.qZA()}if(2&s){const e=r.oxw(4);r.Q6J("disabled",!e.formGroup.valid)}}function My(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",14),r.NdJ("click",function(){return r.CHM(e),r.oxw(4).submit()}),r._uU(1,"Update"),r.qZA()}if(2&s){const e=r.oxw(4);r.Q6J("disabled",!e.formGroup.valid)}}function Fy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",15),r.NdJ("click",function(){return r.CHM(e),r.oxw(4).cancelEdit()}),r._uU(1,"Cancel"),r.qZA()}}function Hy(s,i){if(1&s&&(r.TgZ(0,"div"),r.YNc(1,Oy,2,1,"button",10),r.YNc(2,Vy,2,0,"button",11),r.YNc(3,Py,2,0,"button",12),r.YNc(4,Dy,2,0,"button",11),r.YNc(5,Uy,2,0,"button",13),r.YNc(6,Ly,2,1,"button",10),r.YNc(7,My,2,1,"button",10),r.YNc(8,Fy,2,0,"button",11),r.qZA()),2&s){const e=r.oxw(3);r.xp6(1),r.Q6J("ngIf",e.isForNew),r.xp6(1),r.Q6J("ngIf",e.isForNew),r.xp6(1),r.Q6J("ngIf",!e.isEditing&&!e.isForNew),r.xp6(1),r.Q6J("ngIf",!e.isEditing&&!e.isForNew),r.xp6(1),r.Q6J("ngIf",e.isEditing&&e.isServiceInstance),r.xp6(1),r.Q6J("ngIf",e.isEditing&&!e.isForNew&&"service"===e.menuType),r.xp6(1),r.Q6J("ngIf",e.isEditing&&!e.isForNew),r.xp6(1),r.Q6J("ngIf",e.isEditing&&!e.isForNew)}}function Jy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div")(1,"button",16),r.NdJ("click",function(){return r.CHM(e),r.oxw(3).approve()}),r._uU(2,"Approve"),r.qZA(),r.TgZ(3,"button",15),r.NdJ("click",function(){return r.CHM(e),r.oxw(3).reject()}),r._uU(4,"Reject"),r.qZA()()}}function Ky(s,i){if(1&s&&(r.TgZ(0,"div",9),r.YNc(1,Hy,9,8,"div",0),r.YNc(2,Jy,5,0,"div",0),r.qZA()),2&s){const e=r.oxw(2);r.xp6(1),r.Q6J("ngIf",e.isAdmin),r.xp6(1),r.Q6J("ngIf",e.canApproveOrg)}}function jy(s,i){if(1&s&&(r.TgZ(0,"nb-card-header")(1,"div",4)(2,"div",5)(3,"span",6),r._UZ(4,"nb-icon",7),r.qZA(),r._uU(5),r.qZA(),r.YNc(6,Ky,3,2,"div",8),r.qZA()()),2&s){const e=r.oxw();r.xp6(4),r.Q6J("icon",e.iconName),r.xp6(1),r.hij("",e.title," "),r.xp6(1),r.Q6J("ngIf",e.showButtons)}}function $y(s,i){1&s&&(r.TgZ(0,"div",4)(1,"div",5)(2,"h1"),r._uU(3,"Failed to load"),r.qZA()()())}function qy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",21)(1,"label",22),r._uU(2),r.qZA(),r.TgZ(3,"div",23)(4,"input",24),r.NdJ("input",function(n){r.CHM(e);const a=r.oxw().$implicit;return r.oxw(2).addShortIdToMrn(a.key,n.target.value)}),r.qZA()()()}if(2&s){const e=r.oxw().$implicit,t=r.oxw(2);r.xp6(2),r.hij("Short ID for ",e.value.title,""),r.xp6(2),r.MGl("id","input_shortId_",e.key,""),r.s9C("status",e.value.required?t.validateMrn(t.formGroup.get(e.key).value)?"success":"danger":""),r.s9C("value",t.shortId)}}function Zy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"ngx-input-button-list",33),r.NdJ("onUpdate",function(n){return r.CHM(e),r.oxw(4).onDataChanged(n)}),r.qZA()}if(2&s){const e=r.oxw(2).$implicit,t=r.oxw(2);r.Q6J("items",t.loadedData[e.key])("isEditing",t.isEditing)("options",e.value.options)("fieldName",e.key)("placeholder",e.value.placeholder)("required",e.value.required)}}function zy(s,i){if(1&s&&r._UZ(0,"ngx-input-image",34),2&s){const e=r.oxw(2).$implicit,t=r.oxw(2);r.Q6J("isEditing",t.isEditing)("orgMrn",t.orgMrn)("entityMrn",t.entityMrn)("menuType",t.menuType)("allowedExtensions",e.value.allowedExtensions)}}function Gy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"ngx-input-mcp-entity",35),r.NdJ("onUpdate",function(n){return r.CHM(e),r.oxw(4).onLinkChanged(n)}),r.qZA()}if(2&s){const e=r.oxw(2).$implicit,t=r.oxw(2);r.Q6J("entity",t.loadedData[e.key])("isEditing",t.isEditing)("orgMrn",t.orgMrn)("menuType","vessel")("required",e.value.required)}}function Wy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"ngx-input-file-list",36),r.NdJ("onUpdate",function(n){return r.CHM(e),r.oxw(4).onDataChanged(n)})("onDelete",function(n){return r.CHM(e),r.oxw(4).onFileDeleted(n)}),r.qZA()}if(2&s){const e=r.oxw(2).$implicit,t=r.oxw(2);r.Q6J("fieldName",e.key)("docIds",t.loadedData[e.key])("isEditing",t.isEditing)("instanceId",t.numberId)("fieldName",e.key)("placeholder",e.value.placeholder)("required",e.value.required)}}function Yy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"ngx-input-file-list",37),r.NdJ("onUpdate",function(n){return r.CHM(e),r.oxw(4).onDataChanged(n)})("onDelete",function(n){return r.CHM(e),r.oxw(4).onFileDeleted(n)}),r.qZA()}if(2&s){const e=r.oxw(2).$implicit,t=r.oxw(2);r.Q6J("fieldName",e.key)("file",t.loadedData[e.key])("isEditing",t.isEditing)("instanceId",t.numberId)("fieldName",e.key)("placeholder",e.value.placeholder)("required",e.value.required)}}function Qy(s,i){if(1&s&&(r.TgZ(0,"span",38),r._uU(1),r.qZA()),2&s){const e=r.oxw(2).$implicit,t=r.oxw(2);r.xp6(1),r.Oqu("instance"!==t.menuType&&t.isForTime(e.key)?t.convertTimeString(t.formGroup.get(e.key).value):t.formGroup.get(e.key).value)}}function Xy(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",39),r.NdJ("click",function(){r.CHM(e);const n=r.oxw(2).$implicit,a=r.oxw(2);return a.openXmlDialog(a.loadedData[n.key],a.isEditing)}),r._uU(1,"Read XML"),r.qZA()}}function ew(s,i){if(1&s&&r._UZ(0,"input",44),2&s){const e=r.oxw(3).$implicit,t=r.oxw(2);r.MGl("id","input_",e.key,""),r.s9C("status",t.formGroup.get(e.key).value?t.formGroup.get(e.key).valid?"success":"danger":e.value.required?"danger":""),r.s9C("formControlName",e.key),r.s9C("placeholder",void 0!==e.value.placeholder?e.value.placeholder:""),r.s9C("required",!0===e.value.required)}}function tw(s,i){if(1&s&&r._UZ(0,"input",45),2&s){const e=r.oxw(3).$implicit,t=r.oxw(2);r.MGl("id","input_",e.key,""),r.s9C("status",t.formGroup.get(e.key).value?t.formGroup.get(e.key).valid?"success":"danger":e.value.required?"danger":""),r.s9C("formControlName",e.key),r.s9C("required",!0===e.value.required)}}function sw(s,i){if(1&s&&(r.TgZ(0,"nb-option",48),r._uU(1),r.qZA()),2&s){const e=i.$implicit;r.s9C("value",e.value),r.xp6(1),r.Oqu(e.title)}}function rw(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"nb-select",46),r.NdJ("selectedChange",function(n){r.CHM(e);const a=r.oxw(3).$implicit;return r.oxw(2).onMenuItemSelected({key:a.key,value:n,type:a.value.type})})("selectedChange",function(n){r.CHM(e);const a=r.oxw(3).$implicit;return r.oxw(2).formGroup.get(a.key).value=n}),r.YNc(1,sw,2,2,"nb-option",47),r.qZA()}if(2&s){const e=r.oxw(3).$implicit,t=r.oxw(2);r.s9C("status",t.formGroup.get(e.key).value?t.formGroup.get(e.key).valid?"success":"danger":e.value.required?"danger":""),r.Q6J("selected",t.formGroup.get(e.key).value),r.xp6(1),r.Q6J("ngForOf",e.value.options)}}function nw(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"button",49),r.NdJ("click",function(){r.CHM(e);const n=r.oxw(3).$implicit,a=r.oxw(2);return a.openXmlDialog(a.formGroup.get(n.key).value,a.isEditing)}),r._uU(1,"Edit XML"),r.qZA()}}function iw(s,i){if(1&s&&(r.TgZ(0,"div"),r.YNc(1,ew,1,5,"input",40),r.YNc(2,tw,1,4,"input",41),r.YNc(3,rw,2,3,"nb-select",42),r.YNc(4,nw,2,0,"button",43),r.qZA()),2&s){const e=r.oxw(2).$implicit;r.xp6(1),r.Q6J("ngIf","string"===e.value.type&&!e.value.options),r.xp6(1),r.Q6J("ngIf","string"===e.value.type&&e.value.options),r.xp6(1),r.Q6J("ngIf","string"===e.value.type&&e.value.options),r.xp6(1),r.Q6J("ngIf","xml"===e.value.type)}}function aw(s,i){if(1&s&&(r.TgZ(0,"div",21)(1,"label",25),r._uU(2),r.qZA(),r.TgZ(3,"div",23),r.YNc(4,Zy,1,6,"ngx-input-button-list",26),r.YNc(5,zy,1,5,"ngx-input-image",27),r.YNc(6,Gy,1,5,"ngx-input-mcp-entity",28),r.YNc(7,Wy,1,7,"ngx-input-file-list",29),r.YNc(8,Yy,1,7,"ngx-input-file-list",30),r.YNc(9,Qy,2,1,"span",31),r.YNc(10,Xy,2,0,"button",32),r.YNc(11,iw,5,4,"div",0),r.qZA()()),2&s){const e=r.oxw().$implicit,t=r.oxw(2);r.xp6(1),r.MGl("for","input",e.key,""),r.s9C("nbPopover",e.value.description),r.xp6(1),r.Oqu(e.value.title),r.xp6(2),r.Q6J("ngIf","stringArray"===e.value.type),r.xp6(1),r.Q6J("ngIf",!t.isForNew&&"image"===e.value.type),r.xp6(1),r.Q6J("ngIf","vessel"===e.value.type),r.xp6(1),r.Q6J("ngIf","fileArray"===e.value.type),r.xp6(1),r.Q6J("ngIf","file"===e.value.type),r.xp6(1),r.Q6J("ngIf",!t.isEditing&&"string"===e.value.type),r.xp6(1),r.Q6J("ngIf",!t.isEditing&&"xml"===e.value.type),r.xp6(1),r.Q6J("ngIf",t.isEditing)}}function ow(s,i){if(1&s&&(r.TgZ(0,"div"),r.YNc(1,qy,5,4,"div",20),r.YNc(2,aw,12,11,"div",20),r.qZA()),2&s){const e=i.$implicit,t=r.oxw(2);r.xp6(1),r.Q6J("ngIf",t.isForNew&&"role"!==t.menuType&&t.needShortId(e.key)),r.xp6(1),r.Q6J("ngIf",!t.isEditing||t.isEditing&&t.isFieldVisible(e.key))}}function lw(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",21)(1,"label",50),r._uU(2,"Active certificates"),r.qZA(),r.TgZ(3,"div",51)(4,"ngx-certificates",52),r.NdJ("onUpdate",function(){return r.CHM(e),r.oxw(2).refreshData()}),r.qZA()()()}if(2&s){const e=r.oxw(2);r.xp6(4),r.Q6J("data",e.activeCertificates)("forRevoked",!1)("entityType",e.menuType)("entityTitle",e.title)("entityMrn",e.entityMrn)("orgMrn",e.orgMrn)("instanceVersion",e.instanceVersion)("hasPermissionInMIR",e.isAdmin)}}function uw(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",21)(1,"label",53),r._uU(2,"Revoked certificates"),r.qZA(),r.TgZ(3,"div",51)(4,"ngx-certificates",54),r.NdJ("onUpdate",function(){return r.CHM(e),r.oxw(2).refreshData()}),r.qZA()()()}if(2&s){const e=r.oxw(2);r.xp6(4),r.Q6J("data",e.revokedCertificates)("forRevoked",!0)}}function cw(s,i){1&s&&(r.TgZ(0,"div",21)(1,"label",53),r._uU(2,"Coverage"),r.qZA()())}function hw(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div",21)(1,"div",51)(2,"ngx-input-geometry",55,56),r.NdJ("onUpdate",function(n){return r.CHM(e),r.oxw(2).onUpdateGeometry(n)}),r.qZA()()()}if(2&s){const e=r.oxw(2);r.xp6(2),r.Q6J("isEditing",e.isEditing)("geometries",e.geometries)}}function fw(s,i){if(1&s&&(r.TgZ(0,"form",18),r.YNc(1,ow,3,2,"div",19),r.ALo(2,"keyvalue"),r.YNc(3,lw,5,8,"div",20),r.YNc(4,uw,5,2,"div",20),r.YNc(5,cw,3,0,"div",20),r.YNc(6,hw,4,2,"div",20),r.qZA()),2&s){const e=r.oxw();r.Q6J("formGroup",e.formGroup),r.xp6(1),r.Q6J("ngForOf",r.xi3(2,6,e.columnForMenu,e.sortColumnForMenu)),r.xp6(2),r.Q6J("ngIf",e.isEntity&&!e.isForNew&&!e.isEditing),r.xp6(1),r.Q6J("ngIf",e.isEntity&&!e.isForNew&&!e.isEditing),r.xp6(1),r.Q6J("ngIf",e.isServiceInstance),r.xp6(1),r.Q6J("ngIf",e.isServiceInstance)}}const dw=s=>void 0!==s;let mw=(()=>{class s{constructor(e,t,n,a,o,u){this.mrnHelperService=e,this.formBuilder=t,this.iconsLibrary=n,this.certificateService=a,this.dialogService=o,this.authService=u,this.onCancel=new r.vpe,this.onDelete=new r.vpe,this.onSubmit=new r.vpe,this.onApprove=new r.vpe,this.onReject=new r.vpe,this.onRefresh=new r.vpe,this.isAdmin=!1,this.loadedData={},this.nonStringForm={},this.fetchList=["mrn","version","orgMrn","adminMrn","instanceId","organizationId","implementsServiceDesign","email","orgEmail","adminEmail","instanceVersion"],this.isEditing=!1,this.isEntity=!1,this.fieldVisibility={},this.shortId="",this.roleId=-1,this.contextForAttributes="detail",this.menuTypeName="",this.activeCertificates=[],this.revokedCertificates=[],this.isServiceInstance=!1,this.geometries=[],this.canApproveOrg=!1,this.needShortId=l=>void 0!==this.getShortIdType(l),this.getShortIdType=l=>this.columnForMenu[l]?this.columnForMenu[l].shortIdType:void 0,this.setForm=()=>{this.columnForMenu={},Object.entries(A.A[this.menuType]).map(([l,m])=>{Array.isArray(m.visibleFrom)&&m.visibleFrom.includes(this.contextForAttributes)&&(!this.isEditing||this.isForNew&&!0!==m.notShowOnEdit)&&(this.columnForMenu[l]=m)}),this.setFormWithValidators()},this.setFormFieldVisibility=l=>{const m=[];if(Object.entries(this.columnForMenu).forEach(([k,B])=>{this.fieldVisibility[k]=!B.notShowOnEdit||!B.notShowOnEdit,B.options&&m.push({key:k,value:B.options})}),l){let k=!1;const B=new Set;m.forEach(F=>F.value.map(V=>V.value===l[F.key]?V.showField:void 0).filter(dw).forEach(V=>{this.setFieldVisible(V.key,V.value),B.add(V.key),k=!0})),k||m.forEach(F=>F.value.forEach(V=>{V.showField&&V.showField.key&&!this.columnForMenu[F.key].required&&this.formGroup.get(V.showField.key).disable()}))}},this.fetchMissingValuesFromForm=l=>{const m={};for(const k of l)this.formGroup.get(k)&&(m[k]=this.formGroup.get(k).value);return m},this.getFormValue=()=>{this.menuType===w._g.Instance&&(this.loadedData.instanceAsDoc&&(this.loadedData.instanceAsDocId=this.loadedData.instanceAsDoc.id,this.loadedData.instanceAsDocName=this.loadedData.instanceAsDoc.name),this.loadedData.instanceAsDocId&&(delete this.loadedData.instanceAsDoc,Object.assign(this.loadedData,{instanceAsDoc:{id:this.loadedData.instanceAsDocId}})));const l=this.filterUnselected(this.formGroup.value,Object.entries(this.columnForMenu).filter(m=>m[1].options));return Object.assign(this.loadedData,l,this.fetchMissingValuesFromForm(this.fetchList))},this.filterUnselected=(l,m)=>{const k=Object.assign({},l);return Object.keys(k).forEach(B=>{m.filter(F=>F[0]===B).length&&(!k[B]||0===k[B].length)&&delete k[B]}),k},this.setIsAdmin=()=>{if(this.menuType===w._g.Instance){const l=this.isEditing?pe.e.staticAuthInfo.orgMrn===this.formGroup.get("organizationId").value:pe.e.staticAuthInfo.orgMrn===this.loadedData.organizationId;this.isAdmin=H(this.menuType,this.authService,!0,l)}else this.isAdmin=H(this.menuType,this.authService,!0,!1),this.menuType===w._g.OrgCandidate&&(this.canApproveOrg=!0)},this.isForTime=l=>l.endsWith("At")||"end"===l||"start"===l,this.convertTimeString=l=>(0,Et.r)(l),this.invertIsEditing=()=>{this.isEditing=!this.isEditing,this.isEditing||(this.formGroup.reset(),this.adjustData(this.loadedData)),this.geometryMap&&this.geometryMap.applyEditingToMap&&this.geometryMap.applyEditingToMap(this.isEditing)},this.settled=l=>{this.isLoaded=l,this.isLoading=!1},this.adjustTitle=(l,m)=>{this.menuType=l,this.menuTypeName=w.RJ[this.menuType],this.isEntity=w.DC.includes(this.menuType),this.title=m,this.isServiceInstance=this.menuType===w._g.Instance||this.menuType===w._g.InstanceOfOrg},this.addShortIdToMrn=(l,m)=>{const k=this.mrnHelperService.mrnMask(this.getShortIdType(l),this.orgShortId)+m;if(this.formGroup.get(l).setValue(k),"orgMrn"===l&&(this.orgShortId=this.orgShortId?this.orgShortId:this.formGroup.get("orgMrn").value.split(":").pop(),this.formGroup.get("adminMrn"))){const B=this.formGroup.get("adminMrn").value.split(":").pop();this.formGroup.get("adminMrn").setValue(this.mrnHelperService.mrnMaskForUserOfOrg(this.orgShortId)+B)}},this.validateMrn=l=>!(!l||l.includes("::")||l.endsWith(":")||0===l.length)&&(l.includes(":org:")?new RegExp(this.mrnHelperService.mrnMcpIdpRegexForOrg()).test(l):new RegExp(this.mrnHelperService.mrnMcpIdpRegex(this.orgShortId?this.orgShortId:this.menuType===w._g.NewOrganization?this.getOrgShortId():void 0)).test(l)),this.getOrgShortId=()=>this.formGroup.get("orgMrn")?this.formGroup.get("orgMrn").value.split(":").pop():this.orgMrn.split(":").pop(),this.getValidators=(l,m)=>{const k=[];return m.required&&k.push(Pe.kI.required),(l.includes("email")||l.includes("Email"))&&k.push(Pe.kI.email),"mrnSubsidiary"!==l&&(l.includes("mrn")||l.includes("Mrn"))&&k.push(Pe.kI.pattern(this.menuType===w._g.Organization||this.menuType===w._g.OrgCandidate?this.mrnHelperService.mrnMcpIdpRegexForOrg():this.mrnHelperService.mrnMcpIdpRegex(this.orgShortId))),k},this.adjustData=l=>{const m=c(l);if(this.loadedData=m,Object.entries(this.columnForMenu).forEach(([B,F])=>{if(!0===F.immutable&&this.formGroup.get(B).disable(),this.isThisForMCPMRN(this.menuType,B)){this.shortId=this.mrnHelperService.shortIdFromMrn(m[B]);const V=this.mrnHelperService.mrnMask(this.menuType,this.orgShortId)+this.shortId;this.formGroup.get(B).setValue(V)}else"string"===F.type&&this.formGroup.get(B).setValue(m[B])}),m.certificates&&m.certificates.length>0){const B=this.certificateService.splitByRevokeStatus(m.certificates);this.activeCertificates=B.activeCertificates,this.revokedCertificates=B.revokedCertificates}this.geometries=[m.geometry],this.geometryMap&&this.geometryMap.loadGeometryOnMap(),this.setFormFieldVisibility(m),this.authService.authState.rolesLoaded?this.setIsAdmin():this.authService.rolesLoaded.subscribe(B=>{this.setIsAdmin()})},this.setFormWithValidators=()=>{const l={};Object.entries(this.columnForMenu).forEach(([m,k])=>{"string"===k.type&&(l[m]=[null,this.getValidators(m,k)])}),this.formGroup=this.formBuilder.group(l)},this.onMenuItemSelected=l=>{"string"===l.type&&(this.formGroup.get(l.key).setValue(l.value),this.updateFieldVisibility(l.key,l.value))},this.updateFieldVisibility=(l,m)=>{var k;const B=null===(k=this.columnForMenu[l].options)||void 0===k?void 0:k.filter(F=>F.value===m);B[0].showField&&this.setFieldVisible(B[0].showField.key,B[0].showField.value)},this.setFieldVisible=(l,m)=>{m?(this.fieldVisibility[l]=m,this.formGroup.get(l).enable()):(this.loadedData[l]=void 0,this.fieldVisibility[l]=m,this.formGroup.get(l).disable())},this.onDataChanged=l=>{l.data&&l.fieldName&&(this.loadedData=Object.assign(this.loadedData,{[l.fieldName]:l.data}))},this.onLinkChanged=l=>{l.fieldName&&l.value&&(this.loadedData[l.fieldName]=l.value)},this.onUpdateGeometry=l=>{l.data&&l.fieldName&&(this.loadedData={...this.loadedData,[l.fieldName]:l.data})},this.openXmlDialog=(l,m=!1)=>{this.dialogService.open(J,{context:{xml:l,isEditing:m,onUpdate:k=>this.updateXml(k)}})},this.updateXml=l=>{this.loadedData.instanceAsXml=l},this.onFileDeleted=l=>{"instanceAsDoc"===l.fieldName&&(this.loadedData.instanceAsDoc=void 0)},this.sortColumnForMenu=(l,m)=>l.order>m.order?-1:1,n.registerFontPack("fas",{packClass:"fas",iconClassPrefix:"fa"})}ngOnInit(){this.setForm(),this.isForNew&&(this.isEditing=!0,this.setFormFieldVisibility(),Object.keys(this.formGroup.controls).forEach(e=>{this.needShortId(e)&&(this.formGroup.get(e).setValue(this.mrnHelperService.mrnMask(this.getShortIdType(e),this.orgShortId)),this.formGroup.get(e).disable())}),this.defaultPermissions&&this.formGroup.get("permissions").setValue(this.defaultPermissions),this.menuType===w._g.Instance&&(this.formGroup.get("organizationId").setValue(pe.e.staticAuthInfo.orgMrn),this.formGroup.get("organizationId").disable(),Object.entries(A.A[this.menuType]).map(([e,t])=>{"stringArray"===t.type&&(this.loadedData[e]=[])})),this.isForRegistration?this.isAdmin=!0:this.authService.authState.rolesLoaded?this.setIsAdmin():this.authService.rolesLoaded.subscribe(e=>{this.setIsAdmin()}),this.settled(!0))}isFieldVisible(e){return this.fieldVisibility[e]}cancel(){this.onCancel.emit()}delete(){this.onDelete.emit()}reject(){this.onReject.emit()}approve(){this.onApprove.emit()}submit(){this.onSubmit.emit(this.getFormValue())}refreshData(){this.onRefresh.emit()}cancelEdit(){this.invertIsEditing(),this.refreshData()}updateForNewVer(){this.formGroup.get("instanceVersion").enable(),this.isForNew=!0}isThisForMCPMRN(e,t){return"role"!==e&&"mrn"===t}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(me),r.Y36(Pe.qu),r.Y36(K.B7b),r.Y36(De),r.Y36(K.Gln),r.Y36(pe.e))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-editable-form"]],viewQuery:function(e,t){if(1&e&&r.Gf(Ry,5),2&e){let n;r.iGM(n=r.CRH())&&(t.geometryMap=n.first)}},inputs:{menuType:"menuType",instanceVersion:"instanceVersion",isForNew:"isForNew",isForRegistration:"isForRegistration",entityMrn:"entityMrn",orgMrn:"orgMrn",title:"title",iconName:"iconName",isLoading:"isLoading",isLoaded:"isLoaded",showButtons:"showButtons",hasHeader:"hasHeader",numberId:"numberId",orgShortId:"orgShortId",defaultPermissions:"defaultPermissions"},outputs:{onCancel:"onCancel",onDelete:"onDelete",onSubmit:"onSubmit",onApprove:"onApprove",onReject:"onReject",onRefresh:"onRefresh"},decls:5,vars:4,consts:[[4,"ngIf"],["nbSpinnerSize","large","nbSpinnerStatus","primary",3,"nbSpinner"],["class","row",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"row"],[1,"col","my-auto"],[1,"icon_header"],["pack","fas",3,"icon"],["class","col-md-auto",4,"ngIf"],[1,"col-md-auto"],["type","submit","nbButton","","status","primary",3,"disabled","click",4,"ngIf"],["type","button","nbButton","","status","danger",3,"click",4,"ngIf"],["type","button","nbButton","","status","primary",3,"click",4,"ngIf"],["type","button","nbButton","","status","success",3,"click",4,"ngIf"],["type","submit","nbButton","","status","primary",3,"disabled","click"],["type","button","nbButton","","status","danger",3,"click"],["type","button","nbButton","","status","primary",3,"click"],["type","button","nbButton","","status","success",3,"click"],[3,"formGroup"],[4,"ngFor","ngForOf"],["class","form-group row",4,"ngIf"],[1,"form-group","row"],[1,"label","col-sm-3","col-form-label"],[1,"col-sm-9","my-auto"],["type","text","nbInput","","fullWidth","","required","menu.value.required === true",1,"form-control",3,"id","status","value","input"],["nbPopoverTrigger","hint","nbPopoverPlacement","top",1,"label","col-sm-3","col-form-label",3,"for","nbPopover"],[3,"items","isEditing","options","fieldName","placeholder","required","onUpdate",4,"ngIf"],[3,"isEditing","orgMrn","entityMrn","menuType","allowedExtensions",4,"ngIf"],[3,"entity","isEditing","orgMrn","menuType","required","onUpdate",4,"ngIf"],[3,"fieldName","docIds","isEditing","instanceId","placeholder","required","onUpdate","onDelete",4,"ngIf"],[3,"fieldName","file","isEditing","instanceId","placeholder","required","onUpdate","onDelete",4,"ngIf"],["id","keyword.name",4,"ngIf"],["type","button","class","m-0","fullWidth","","nbButton","",3,"click",4,"ngIf"],[3,"items","isEditing","options","fieldName","placeholder","required","onUpdate"],[3,"isEditing","orgMrn","entityMrn","menuType","allowedExtensions"],[3,"entity","isEditing","orgMrn","menuType","required","onUpdate"],[3,"fieldName","docIds","isEditing","instanceId","placeholder","required","onUpdate","onDelete"],[3,"fieldName","file","isEditing","instanceId","placeholder","required","onUpdate","onDelete"],["id","keyword.name"],["type","button","fullWidth","","nbButton","",1,"m-0",3,"click"],["type","text","nbInput","","fullWidth","","class","form-control",3,"id","status","formControlName","placeholder","required",4,"ngIf"],["type","text","nbInput","","fullWidth","","class","form-control","hidden","",3,"id","status","formControlName","required",4,"ngIf"],["type","string","fullWidth","","required","menu.value.required === true",3,"selected","status","selectedChange",4,"ngIf"],["type","button","nbButton","","class","m-0","fullWidth","",3,"click",4,"ngIf"],["type","text","nbInput","","fullWidth","",1,"form-control",3,"id","status","formControlName","placeholder","required"],["type","text","nbInput","","fullWidth","","hidden","",1,"form-control",3,"id","status","formControlName","required"],["type","string","fullWidth","","required","menu.value.required === true",3,"selected","status","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["type","button","nbButton","","fullWidth","",1,"m-0",3,"click"],["for","inputActiveCert",1,"label","col-sm-3","col-form-label"],[1,"col"],[3,"data","forRevoked","entityType","entityTitle","entityMrn","orgMrn","instanceVersion","hasPermissionInMIR","onUpdate"],["for","inputRevokedCert",1,"label","col-sm-3","col-form-label"],[3,"data","forRevoked","onUpdate"],[3,"isEditing","geometries","onUpdate"],["map",""]],template:function(e,t){1&e&&(r.TgZ(0,"nb-card"),r.YNc(1,jy,7,3,"nb-card-header",0),r.TgZ(2,"nb-card-body",1),r.YNc(3,$y,4,0,"div",2),r.YNc(4,fw,7,9,"form",3),r.qZA()()),2&e&&(r.xp6(1),r.Q6J("ngIf",t.isLoaded&&t.hasHeader),r.xp6(1),r.Q6J("nbSpinner",t.isLoading),r.xp6(1),r.Q6J("ngIf",!t.isLoaded),r.xp6(1),r.Q6J("ngIf",t.isLoaded))},directives:[K.Asz,_.O5,K.ndF,K.fMN,K.DPz,K.yKW,K.Q7R,Pe._Y,Pe.JL,Pe.sg,_.sg,K.h8i,ya,vm,_m,Bm,Pe.Fj,Pe.JJ,Pe.u,Pe.Q7,K.rs,K.q51,By,xy.J],pipes:[_.Nd],styles:["nb-card-body[_ngcontent-%COMP%]{overflow:visible;padding-top:0}nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}.icon_header[_ngcontent-%COMP%]{display:inline-block;width:28px}[_nghost-%COMP%]   .buttons-row[_ngcontent-%COMP%]{margin:-.5rem}[_nghost-%COMP%]   button[nbButton][_ngcontent-%COMP%]{margin:.5rem}[dir=ltr]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-right:.5rem}[dir=rtl]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-left:.5rem}[_nghost-%COMP%]   .actions-card[_ngcontent-%COMP%]{height:8rem}"]}),s})();var gw=P.uU.RoleNameEnum;const pw=["editableForm"],vw=["supplementForm"];function yw(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"div")(1,"button",6),r.NdJ("click",function(){return r.CHM(e),r.oxw().cancel()}),r._UZ(2,"nb-icon",7),r._uU(3),r.qZA()()}if(2&s){const e=r.oxw();r.xp6(3),r.hij(" Back to ",e.entityTypeName," list ")}}function ww(s,i){if(1&s){const e=r.EpF();r.TgZ(0,"ngx-editable-form",8,9),r.NdJ("onApprove",function(){return r.CHM(e),r.oxw().approve()})("onReject",function(){return r.CHM(e),r.oxw().delete()})("onCancel",function(){return r.CHM(e),r.oxw().cancel()})("onSubmit",function(n){return r.CHM(e),r.oxw().submit(n)})("onDelete",function(){return r.CHM(e),r.oxw().delete()})("onRefresh",function(){return r.CHM(e),r.oxw().refreshData()}),r.qZA()}if(2&s){const e=r.oxw();r.Q6J("menuType","user")("isForNew",!0)("orgShortId",e.orgShortId)("defaultPermissions",e.defaultPermissionForAdminUser)("title","Administrator account of "+e.title)("iconName","user")("numberId",e.numberId)("orgMrn",e.entityMrn)("instanceVersion",e.instanceVersion)("isLoading",e.isLoading)("isLoaded",e.isLoaded)("hasHeader",!0)("showButtons",!1)}}const _w=[{path:"",component:E,children:[{path:"",component:Fe},{path:":id",component:(()=>{class s{constructor(e,t,n,a,o,u,l,m,k,B,F,V,le,ve){this.route=e,this.router=t,this.userControllerService=n,this.deviceControllerService=a,this.roleControllerService=o,this.vesselControllerService=u,this.serviceControllerService=l,this.mmsControllerService=m,this.organizationControllerService=k,this.instanceControllerService=B,this.notifierService=F,this.authService=V,this.location=le,this.translate=ve,this.title="",this.isLoading=!1,this.menuType=w._g.Device,this.iconName="circle",this.instanceVersion="",this.noBacklink=!1,this.isForNew=!1,this.columnForMenu=A.A[this.menuType],this.contextForAttributes="detail",this.menuTypeName="",this.entityMrn="",this.orgMrn="",this.values={},this.activeCertificates=[],this.revokedCertificates=[],this.isEditing=!1,this.shortId="",this.numberId=-1,this.isLoaded=!0,this.mrnMask="",this.isForServiceForOrg=!1,this.orgShortId=void 0,this.defaultPermissionForAdminUser=ut,this.registerData=(W,q,ne)=>W===w._g.User?this.userControllerService.createUser(q,ne):W===w._g.Device?this.deviceControllerService.createDevice(q,ne):W===w._g.Vessel?this.vesselControllerService.createVessel(q,ne):W===w._g.MMS?this.mmsControllerService.createMMS(q,ne):W===w._g.Service?this.serviceControllerService.createService(q,ne):W===w._g.Organization?this.organizationControllerService.applyOrganization(q):W===w._g.Role?this.roleControllerService.createRole(q,ne):W===w._g.Instance?this.instanceControllerService.createInstance(q):new I.Observable,this.updateData=(W,q,ne,ae,fe,ke)=>W===w._g.User?this.userControllerService.updateUser(q,ne,ae):W===w._g.Device?this.deviceControllerService.updateDevice(q,ne,ae):W===w._g.Vessel?this.vesselControllerService.updateVessel((s=>{const i=[];for(const e in s){const t=U(e);Object.values(g.AttributeNameEnum).find(n=>n===t)&&(i.push({createdAt:new Date,updatedAt:new Date,attributeName:t,attributeValue:s[e]}),delete s[e])}return s.attributes=i,s})(q),ne,ae):W===w._g.MMS?this.mmsControllerService.updateMMS(q,ne,ae):W===w._g.Service&&fe?this.serviceControllerService.updateService(q,ne,ae,fe):W===w._g.Organization||W===w._g.OrgCandidate?this.organizationControllerService.updateOrganization(q,ae):W===w._g.Role?this.roleControllerService.updateRole(q,ne,this.numberId):W===w._g.Instance?this.instanceControllerService.updateInstance(Object.assign({},q,{id:ke}),ke):new I.Observable,this.deleteData=(W,q,ne,ae,fe)=>W===w._g.User?this.userControllerService.deleteUser(q,ne):W===w._g.Device?this.deviceControllerService.deleteDevice(q,ne):W===w._g.Vessel?this.vesselControllerService.deleteVessel(q,ne):W===w._g.MMS?this.mmsControllerService.deleteMMS(q,ne):W===w._g.Service&&ae?this.serviceControllerService.deleteService(q,ne,ae):W===w._g.Organization||W===w._g.OrgCandidate?this.organizationControllerService.deleteOrg(ne):W===w._g.Role?this.roleControllerService.deleteRole(q,this.numberId):W===w._g.Instance?this.instanceControllerService.deleteInstance(this.numberId):new I.Observable,this.loadDataContent=(W,q,ne,ae,fe)=>W===w._g.User?this.userControllerService.getUser(q,ne):W===w._g.Device?this.deviceControllerService.getDevice(q,ne):W===w._g.Vessel?this.vesselControllerService.getVessel(q,ne):W===w._g.MMS?this.mmsControllerService.getMMS(q,ne):W===w._g.Service&&ae?this.serviceControllerService.getServiceVersion(q,ne,ae):W===w._g.Organization?this.organizationControllerService.getOrganization1(ne):W===w._g.Instance?this.instanceControllerService.getInstance(fe):new I.Observable,(0,O.$M)(ve)}ngOnInit(){const e=this.router.url.split("/"),n=(e.pop(),e.pop());n===w._g.InstanceOfOrg?(this.isForServiceForOrg=!0,this.menuType=w._g.Instance):this.menuType=n.replace("-","").substr(0,n.length-1),this.entityMrn=decodeURIComponent(this.route.snapshot.paramMap.get("id")),this.orgMrn=this.authService.authState.orgMrn,this.isForNew="new"===this.entityMrn,this.numberId=this.menuType===w._g.Instance||this.menuType===w._g.Role?parseInt(this.entityMrn):-1,this.router.routeReuseStrategy.shouldReuseRoute=()=>!1,this.route.queryParams.subscribe(a=>{this.noBacklink=void 0===a.name,this.title=a.name,this.instanceVersion=a.version}),this.iconName=w.nZ[this.menuType.toString()],this.isForNew?(this.isEditing=!0,this.title="New "+w.RJ[this.menuType]):this.fetchFieldValues()}cancel(){this.location.back()}settle(e){this.isLoading=!1,this.editableForm&&this.editableForm.settled(e)}fetchFieldValues(){if(!A.A.hasOwnProperty(this.menuType))throw this.settle(!1),new Error(`${this.translate.instant("error.resource.noDataService")}${this.menuType}`);if(this.isLoading=!0,!Object.values(w._g).includes(this.menuType))throw this.settle(!1),new Error(`${this.translate.instant("error.resource.noDataService")}${this.menuType}`);if(this.menuType===w._g.OrgCandidate)this.organizationControllerService.getUnapprovedOrganizations().subscribe(e=>{this.settle(!0),this.editableForm.adjustTitle(this.menuType,this.title),this.editableForm.adjustData(e.content.filter(t=>t.mrn===this.entityMrn).pop()),this.orgShortId=this.entityMrn.split(":").pop()},e=>{this.notifierService.notify("error",e.message),this.router.navigateByUrl("/pages/404")});else if(this.menuType===w._g.Role){const e=parseInt(this.entityMrn);this.roleControllerService.getRole(this.orgMrn,e).subscribe(t=>{this.settle(!0),this.numberId=t.id,this.editableForm.adjustTitle(this.menuType,this.title),this.editableForm.adjustData(t)},t=>{this.notifierService.notify("error",t.message),this.router.navigateByUrl("/pages/404")})}else this.route.queryParams.subscribe(e=>this.loadDataContent(this.menuType,this.authService.authState.user.organization,this.entityMrn,e.version,this.numberId).subscribe(t=>{this.settle(!0),this.menuType===w._g.User?this.title=t.firstName+" "+t.lastName:this.menuType===w._g.Organization&&(this.title=t.name),this.editableForm.adjustTitle(this.menuType,this.title),this.editableForm.adjustData(t)},t=>{this.notifierService.notify("error",t.message),this.router.navigateByUrl("/pages/404")}))}refreshData(){this.fetchFieldValues()}moveToListPage(){this.router.navigate(["../../"+this.menuType+"s"],{relativeTo:this.route})}delete(){let e=this.translate.instant("warning.list.beforeDeletion");e=w.DC.indexOf(this.menuType)>=0?e+this.translate.instant("warning.list.beforeRevoke"):e,confirm(e)&&this.deleteData(this.menuType,this.orgMrn,this.entityMrn,this.instanceVersion).subscribe(t=>{this.notifierService.notify("success",this.menuTypeName+this.translate.instant("success.list.delete")),this.moveToListPage()},t=>this.notifierService.notify("error",this.translate.instant("error.resource.errorInDeletion")+t.error.message))}approve(){this.menuType===w._g.OrgCandidate&&(this.supplementForm.formGroup.valid?this.organizationControllerService.approveOrganization(this.entityMrn).subscribe(e=>{this.createAdminRole().subscribe(t=>{this.createAdminUser(this.supplementForm.getFormValue()).subscribe(n=>{this.notifierService.notify("success",this.translate.instant("success.resource.approveOrganization")),this.moveToListPage()},n=>this.notifierService.notify("error",this.translate.instant("error.resource.approveOrganization.userCreation")+n.error.message))},t=>this.notifierService.notify("error",this.translate.instant("error.resource.approveOrganization.roleCreation")+t.error.message))},e=>this.notifierService.notify("error",this.translate.instant("error.resource.approveOrganization.reject")+e.error.message)):this.notifierService.notify("error",this.translate.instant("error.resource.missingInformation")))}createAdminRole(){return this.roleControllerService.createRole({permission:ut,roleName:gw.ORGADMIN},this.entityMrn)}createAdminUser(e){if(!e)throw new Error(this.translate.instant("error.resource.noUser"));return e.permissions&&0!==e.permissions.length?e.permissions.length>0&&e.permissions.indexOf(ut)<0&&(e.permissions=","+ut):e.permissions=ut,this.createUser(e)}createUser(e){if(!e)throw new Error(this.translate.instant("error.resource.noUser"));return this.userControllerService.createUser(e,this.entityMrn)}submit(e){this.menuType===w._g.Role?this.organizationControllerService.getOrganization1(this.orgMrn).subscribe(t=>this.submitDataToBackend({...e,idOrganization:t.id}),t=>this.notifierService.notify("error",this.translate.instant("error.resource.fetchOrgInfo"))):this.submitDataToBackend(e,e.mrn)}submitDataToBackend(e,t){this.isForNew?this.registerData(this.menuType,e,this.authService.authState.orgMrn).subscribe(n=>{this.notifierService.notify("success","New "+this.menuType+this.translate.instant("success.resource.create")),this.settle(!0),this.moveToListPage()},n=>{this.notifierService.notify("error",this.translate.instant("error.resource.creationFailed")+n.error.message),this.settle(!0)}):this.updateData(this.menuType,e,this.authService.authState.orgMrn,t,this.instanceVersion,this.numberId).subscribe(n=>{this.notifierService.notify("success",this.menuType+this.translate.instant("success.resource.update")),this.editableForm&&(this.editableForm.invertIsEditing(),this.refreshData()),this.settle(!0)},n=>{this.notifierService.notify("error",this.translate.instant("error.resource.updateFailed")+n.error.message),this.settle(!0)})}}return s.\u0275fac=function(e){return new(e||s)(r.Y36(b.gz),r.Y36(b.F0),r.Y36(P.pj),r.Y36(P.$O),r.Y36(P.Uv),r.Y36(P.HI),r.Y36(P.ei),r.Y36(P.Tg),r.Y36(P.rY),r.Y36(y.$),r.Y36(Me.lG),r.Y36(pe.e),r.Y36(_.Ye),r.Y36(We.sK))},s.\u0275cmp=r.Xpm({type:s,selectors:[["ngx-detail"]],viewQuery:function(e,t){if(1&e&&(r.Gf(pw,5),r.Gf(vw,5)),2&e){let n;r.iGM(n=r.CRH())&&(t.editableForm=n.first),r.iGM(n=r.CRH())&&(t.supplementForm=n.first)}},decls:6,vars:14,consts:[[1,"row"],[1,"col-lg-12"],[4,"ngIf"],[3,"menuType","isForNew","title","iconName","entityMrn","orgMrn","numberId","instanceVersion","isLoading","isLoaded","hasHeader","showButtons","onApprove","onReject","onCancel","onSubmit","onDelete","onRefresh"],["editableForm",""],[3,"menuType","isForNew","orgShortId","defaultPermissions","title","iconName","numberId","entityMrn","orgMrn","instanceVersion","isLoading","isLoaded","hasHeader","showButtons","onApprove","onReject","onCancel","onSubmit","onDelete","onRefresh",4,"ngIf"],["nbButton","","status","info","ghost","",3,"click"],["icon","arrow-ios-back","pack","eva"],[3,"menuType","isForNew","orgShortId","defaultPermissions","title","iconName","numberId","entityMrn","orgMrn","instanceVersion","isLoading","isLoaded","hasHeader","showButtons","onApprove","onReject","onCancel","onSubmit","onDelete","onRefresh"],["supplementForm",""]],template:function(e,t){1&e&&(r.TgZ(0,"div",0)(1,"div",1),r.YNc(2,yw,4,1,"div",2),r.TgZ(3,"ngx-editable-form",3,4),r.NdJ("onApprove",function(){return t.approve()})("onReject",function(){return t.delete()})("onCancel",function(){return t.cancel()})("onSubmit",function(a){return t.submit(a)})("onDelete",function(){return t.delete()})("onRefresh",function(){return t.refreshData()}),r.qZA(),r.YNc(5,ww,2,13,"ngx-editable-form",5),r.qZA()()),2&e&&(r.xp6(2),r.Q6J("ngIf",!t.noBacklink&&!t.isForNew),r.xp6(1),r.Q6J("menuType",t.menuType)("isForNew",t.isForNew)("title",t.title)("iconName",t.iconName)("entityMrn",t.entityMrn)("orgMrn",t.orgMrn)("numberId",t.numberId)("instanceVersion",t.instanceVersion)("isLoading",t.isLoading)("isLoaded",t.isLoaded)("hasHeader",!0)("showButtons",!0),r.xp6(2),r.Q6J("ngIf","orgcandidate"===t.menuType&&t.orgShortId))},directives:[_.O5,K.DPz,K.fMN,mw],styles:["nb-card-body[_ngcontent-%COMP%]{overflow:visible;padding-top:0}nb-card-body[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:1rem}.icon_header[_ngcontent-%COMP%]{display:inline-block;width:28px}[_nghost-%COMP%]   .buttons-row[_ngcontent-%COMP%]{margin:-.5rem}[_nghost-%COMP%]   button[nbButton][_ngcontent-%COMP%]{margin:.5rem}[dir=ltr]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-right:.5rem}[dir=rtl]   [_nghost-%COMP%]   .action-icon[_ngcontent-%COMP%]{margin-left:.5rem}[_nghost-%COMP%]   .actions-card[_ngcontent-%COMP%]{height:8rem}"]}),s})()},{path:"**",component:M(5477).w}]}];let Aw=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=r.oAB({type:s}),s.\u0275inj=r.cJS({imports:[[b.Bz.forChild(_w)],b.Bz]}),s})();var kw=M(5493);let Ew=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=r.oAB({type:s}),s.\u0275inj=r.cJS({providers:[Me.lG],imports:[[_.ez,D.m,K.nKr,K.zyh,K.KdK,K.uuI,K.EoG,K.T2N,K.spT,K.IIj,kw.O,K.OA,d.ne,Aw]]}),s})()},9441:function(pt,T){var _;void 0!==(_=function(){"use strict";function b(d,g,c){var p=new XMLHttpRequest;p.open("GET",d),p.responseType="blob",p.onload=function(){A(p.response,g,c)},p.onerror=function(){console.error("could not download file")},p.send()}function E(d){var g=new XMLHttpRequest;g.open("HEAD",d,!1);try{g.send()}catch{}return 200<=g.status&&299>=g.status}function O(d){try{d.dispatchEvent(new MouseEvent("click"))}catch{var g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(g)}}var w="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,I=w.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),A=w.saveAs||("object"!=typeof window||window!==w?function(){}:"download"in HTMLAnchorElement.prototype&&!I?function(d,g,c){var p=w.URL||w.webkitURL,v=document.createElement("a");v.download=g=g||d.name||"download",v.rel="noopener","string"==typeof d?(v.href=d,v.origin===location.origin?O(v):E(v.href)?b(d,g,c):O(v,v.target="_blank")):(v.href=p.createObjectURL(d),setTimeout(function(){p.revokeObjectURL(v.href)},4e4),setTimeout(function(){O(v)},0))}:"msSaveOrOpenBlob"in navigator?function(d,g,c){if(g=g||d.name||"download","string"!=typeof d)navigator.msSaveOrOpenBlob(function r(d,g){return void 0===g?g={autoBom:!1}:"object"!=typeof g&&(console.warn("Deprecated: Expected third argument to be a object"),g={autoBom:!g}),g.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(d.type)?new Blob(["\ufeff",d],{type:d.type}):d}(d,c),g);else if(E(d))b(d,g,c);else{var p=document.createElement("a");p.href=d,p.target="_blank",setTimeout(function(){O(p)})}}:function(d,g,c,p){if((p=p||open("","_blank"))&&(p.document.title=p.document.body.innerText="downloading..."),"string"==typeof d)return b(d,g,c);var v="application/octet-stream"===d.type,C=/constructor/i.test(w.HTMLElement)||w.safari,U=/CriOS\/[\d]+/.test(navigator.userAgent);if((U||v&&C||I)&&"undefined"!=typeof FileReader){var L=new FileReader;L.onloadend=function(){var X=L.result;X=U?X:X.replace(/^data:[^;]*;/,"data:attachment/file;"),p?p.location.href=X:location=X,p=null},L.readAsDataURL(d)}else{var H=w.URL||w.webkitURL,te=H.createObjectURL(d);p?p.location=te:location.href=te,p=null,setTimeout(function(){H.revokeObjectURL(te)},4e4)}});w.saveAs=A.saveAs=A,pt.exports=A}.apply(T,[]))&&(pt.exports=_)},5650:pt=>{pt.exports=function T(M,D,_){function r(O,w){if(!D[O]){if(!M[O]){if(b)return b(O,!0);var A=new Error("Cannot find module '"+O+"'");throw A.code="MODULE_NOT_FOUND",A}var d=D[O]={exports:{}};M[O][0].call(d.exports,function(g){return r(M[O][1][g]||g)},d,d.exports,T,M,D,_)}return D[O].exports}for(var b=void 0,E=0;E<_.length;E++)r(_[E]);return r}({1:[function(T,M,D){"use strict";var _=T("./utils"),r=T("./support"),b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";D.encode=function(E){for(var O,w,I,d,g,c,p=[],v=0,C=E.length,U=C,L="string"!==_.getTypeOf(E);v<E.length;)U=C-v,I=L?(O=E[v++],w=v<C?E[v++]:0,v<C?E[v++]:0):(O=E.charCodeAt(v++),w=v<C?E.charCodeAt(v++):0,v<C?E.charCodeAt(v++):0),d=(3&O)<<4|w>>4,g=1<U?(15&w)<<2|I>>6:64,c=2<U?63&I:64,p.push(b.charAt(O>>2)+b.charAt(d)+b.charAt(g)+b.charAt(c));return p.join("")},D.decode=function(E){var O,w,I,A,d,g,c=0,p=0,v="data:";if(E.substr(0,v.length)===v)throw new Error("Invalid base64 input, it looks like a data url.");var C,U=3*(E=E.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(E.charAt(E.length-1)===b.charAt(64)&&U--,E.charAt(E.length-2)===b.charAt(64)&&U--,U%1!=0)throw new Error("Invalid base64 input, bad content length.");for(C=r.uint8array?new Uint8Array(0|U):new Array(0|U);c<E.length;)O=b.indexOf(E.charAt(c++))<<2|(A=b.indexOf(E.charAt(c++)))>>4,w=(15&A)<<4|(d=b.indexOf(E.charAt(c++)))>>2,I=(3&d)<<6|(g=b.indexOf(E.charAt(c++))),C[p++]=O,64!==d&&(C[p++]=w),64!==g&&(C[p++]=I);return C}},{"./support":30,"./utils":32}],2:[function(T,M,D){"use strict";var _=T("./external"),r=T("./stream/DataWorker"),b=T("./stream/Crc32Probe"),E=T("./stream/DataLengthProbe");function O(w,I,A,d,g){this.compressedSize=w,this.uncompressedSize=I,this.crc32=A,this.compression=d,this.compressedContent=g}O.prototype={getContentWorker:function(){var w=new r(_.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new E("data_length")),I=this;return w.on("end",function(){if(this.streamInfo.data_length!==I.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),w},getCompressedWorker:function(){return new r(_.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},O.createWorkerFrom=function(w,I,A){return w.pipe(new b).pipe(new E("uncompressedSize")).pipe(I.compressWorker(A)).pipe(new E("compressedSize")).withStreamInfo("compression",I)},M.exports=O},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(T,M,D){"use strict";var _=T("./stream/GenericWorker");D.STORE={magic:"\0\0",compressWorker:function(){return new _("STORE compression")},uncompressWorker:function(){return new _("STORE decompression")}},D.DEFLATE=T("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(T,M,D){"use strict";var _=T("./utils"),r=function(){for(var b,E=[],O=0;O<256;O++){b=O;for(var w=0;w<8;w++)b=1&b?3988292384^b>>>1:b>>>1;E[O]=b}return E}();M.exports=function(b,E){return void 0!==b&&b.length?"string"!==_.getTypeOf(b)?function(O,w,I,A){var d=r,g=0+I;O^=-1;for(var c=0;c<g;c++)O=O>>>8^d[255&(O^w[c])];return-1^O}(0|E,b,b.length):function(O,w,I,A){var d=r,g=0+I;O^=-1;for(var c=0;c<g;c++)O=O>>>8^d[255&(O^w.charCodeAt(c))];return-1^O}(0|E,b,b.length):0}},{"./utils":32}],5:[function(T,M,D){"use strict";D.base64=!1,D.binary=!1,D.dir=!1,D.createFolders=!0,D.date=null,D.compression=null,D.compressionOptions=null,D.comment=null,D.unixPermissions=null,D.dosPermissions=null},{}],6:[function(T,M,D){"use strict";var _;_="undefined"!=typeof Promise?Promise:T("lie"),M.exports={Promise:_}},{lie:37}],7:[function(T,M,D){"use strict";var _="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=T("pako"),b=T("./utils"),E=T("./stream/GenericWorker"),O=_?"uint8array":"array";function w(I,A){E.call(this,"FlateWorker/"+I),this._pako=null,this._pakoAction=I,this._pakoOptions=A,this.meta={}}D.magic="\b\0",b.inherits(w,E),w.prototype.processChunk=function(I){this.meta=I.meta,null===this._pako&&this._createPako(),this._pako.push(b.transformTo(O,I.data),!1)},w.prototype.flush=function(){E.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},w.prototype.cleanUp=function(){E.prototype.cleanUp.call(this),this._pako=null},w.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var I=this;this._pako.onData=function(A){I.push({data:A,meta:I.meta})}},D.compressWorker=function(I){return new w("Deflate",I)},D.uncompressWorker=function(){return new w("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(T,M,D){"use strict";function _(d,g){var c,p="";for(c=0;c<g;c++)p+=String.fromCharCode(255&d),d>>>=8;return p}function r(d,g,c,p,v,C){var U,L,H=d.file,te=d.compression,X=C!==O.utf8encode,K=b.transformTo("string",C(H.name)),ee=b.transformTo("string",O.utf8encode(H.name)),_e=H.comment,Ke=b.transformTo("string",C(_e)),P=b.transformTo("string",O.utf8encode(_e)),se=ee.length!==H.name.length,y=P.length!==_e.length,oe="",Me="",pe="",We=H.dir,we=H.date,$e={crc32:0,compressedSize:0,uncompressedSize:0};g&&!c||($e.crc32=d.crc32,$e.compressedSize=d.compressedSize,$e.uncompressedSize=d.uncompressedSize);var Y=0;g&&(Y|=8),X||!se&&!y||(Y|=2048);var Ee,Et,Z=0,Fe=0;We&&(Z|=16),"UNIX"===v?(Fe=798,Z|=(Et=Ee=H.unixPermissions,Ee||(Et=We?16893:33204),(65535&Et)<<16)):(Fe=20,Z|=function(Ee){return 63&(Ee||0)}(H.dosPermissions)),U=we.getUTCHours(),U<<=6,U|=we.getUTCMinutes(),U<<=5,U|=we.getUTCSeconds()/2,L=we.getUTCFullYear()-1980,L<<=4,L|=we.getUTCMonth()+1,L<<=5,L|=we.getUTCDate(),se&&(Me=_(1,1)+_(w(K),4)+ee,oe+="up"+_(Me.length,2)+Me),y&&(pe=_(1,1)+_(w(Ke),4)+P,oe+="uc"+_(pe.length,2)+pe);var Te="";return Te+="\n\0",Te+=_(Y,2),Te+=te.magic,Te+=_(U,2),Te+=_(L,2),Te+=_($e.crc32,4),Te+=_($e.compressedSize,4),Te+=_($e.uncompressedSize,4),Te+=_(K.length,2),Te+=_(oe.length,2),{fileRecord:I.LOCAL_FILE_HEADER+Te+K+oe,dirRecord:I.CENTRAL_FILE_HEADER+_(Fe,2)+Te+_(Ke.length,2)+"\0\0\0\0"+_(Z,4)+_(p,4)+K+oe+Ke}}var b=T("../utils"),E=T("../stream/GenericWorker"),O=T("../utf8"),w=T("../crc32"),I=T("../signature");function A(d,g,c,p){E.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=c,this.encodeFileName=p,this.streamFiles=d,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}b.inherits(A,E),A.prototype.push=function(d){var g=d.meta.percent||0,c=this.entriesCount,p=this._sources.length;this.accumulate?this.contentBuffer.push(d):(this.bytesWritten+=d.data.length,E.prototype.push.call(this,{data:d.data,meta:{currentFile:this.currentFile,percent:c?(g+100*(c-p-1))/c:100}}))},A.prototype.openedSource=function(d){this.currentSourceOffset=this.bytesWritten,this.currentFile=d.file.name;var g=this.streamFiles&&!d.file.dir;if(g){var c=r(d,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},A.prototype.closedSource=function(d){this.accumulate=!1;var p,g=this.streamFiles&&!d.file.dir,c=r(d,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),g)this.push({data:(p=d,I.DATA_DESCRIPTOR+_(p.crc32,4)+_(p.compressedSize,4)+_(p.uncompressedSize,4)),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},A.prototype.flush=function(){for(var d=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var v,C,U,te,p=(v=this.dirRecords.length,C=this.bytesWritten-d,U=d,te=b.transformTo("string",(0,this.encodeFileName)(this.zipComment)),I.CENTRAL_DIRECTORY_END+"\0\0\0\0"+_(v,2)+_(v,2)+_(C,4)+_(U,4)+_(te.length,2)+te);this.push({data:p,meta:{percent:100}})},A.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},A.prototype.registerPrevious=function(d){this._sources.push(d);var g=this;return d.on("data",function(c){g.processChunk(c)}),d.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),d.on("error",function(c){g.error(c)}),this},A.prototype.resume=function(){return!!E.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},A.prototype.error=function(d){var g=this._sources;if(!E.prototype.error.call(this,d))return!1;for(var c=0;c<g.length;c++)try{g[c].error(d)}catch{}return!0},A.prototype.lock=function(){E.prototype.lock.call(this);for(var d=this._sources,g=0;g<d.length;g++)d[g].lock()},M.exports=A},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(T,M,D){"use strict";var _=T("../compressions"),r=T("./ZipFileWorker");D.generateWorker=function(b,E,O){var w=new r(E.streamFiles,O,E.platform,E.encodeFileName),I=0;try{b.forEach(function(A,d){I++;var g=function(C,U){var L=C||U,H=_[L];if(!H)throw new Error(L+" is not a valid compression method !");return H}(d.options.compression,E.compression),p=d.dir,v=d.date;d._compressWorker(g,d.options.compressionOptions||E.compressionOptions||{}).withStreamInfo("file",{name:A,dir:p,date:v,comment:d.comment||"",unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions}).pipe(w)}),w.entriesCount=I}catch(A){w.error(A)}return w}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(T,M,D){"use strict";function _(){if(!(this instanceof _))return new _;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new _;for(var b in this)"function"!=typeof this[b]&&(r[b]=this[b]);return r}}(_.prototype=T("./object")).loadAsync=T("./load"),_.support=T("./support"),_.defaults=T("./defaults"),_.version="3.10.1",_.loadAsync=function(r,b){return(new _).loadAsync(r,b)},_.external=T("./external"),M.exports=_},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(T,M,D){"use strict";var _=T("./utils"),r=T("./external"),b=T("./utf8"),E=T("./zipEntries"),O=T("./stream/Crc32Probe"),w=T("./nodejsUtils");function I(A){return new r.Promise(function(d,g){var c=A.decompressed.getContentWorker().pipe(new O);c.on("error",function(p){g(p)}).on("end",function(){c.streamInfo.crc32!==A.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):d()}).resume()})}M.exports=function(A,d){var g=this;return d=_.extend(d||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:b.utf8decode}),w.isNode&&w.isStream(A)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):_.prepareContent("the loaded zip file",A,!0,d.optimizedBinaryString,d.base64).then(function(c){var p=new E(d);return p.load(c),p}).then(function(c){var p=[r.Promise.resolve(c)],v=c.files;if(d.checkCRC32)for(var C=0;C<v.length;C++)p.push(I(v[C]));return r.Promise.all(p)}).then(function(c){for(var p=c.shift(),v=p.files,C=0;C<v.length;C++){var U=v[C],L=U.fileNameStr,H=_.resolve(U.fileNameStr);g.file(H,U.decompressed,{binary:!0,optimizedBinaryString:!0,date:U.date,dir:U.dir,comment:U.fileCommentStr.length?U.fileCommentStr:null,unixPermissions:U.unixPermissions,dosPermissions:U.dosPermissions,createFolders:d.createFolders}),U.dir||(g.file(H).unsafeOriginalName=L)}return p.zipComment.length&&(g.comment=p.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(T,M,D){"use strict";var _=T("../utils"),r=T("../stream/GenericWorker");function b(E,O){r.call(this,"Nodejs stream input adapter for "+E),this._upstreamEnded=!1,this._bindStream(O)}_.inherits(b,r),b.prototype._bindStream=function(E){var O=this;(this._stream=E).pause(),E.on("data",function(w){O.push({data:w,meta:{percent:0}})}).on("error",function(w){O.isPaused?this.generatedError=w:O.error(w)}).on("end",function(){O.isPaused?O._upstreamEnded=!0:O.end()})},b.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},b.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},M.exports=b},{"../stream/GenericWorker":28,"../utils":32}],13:[function(T,M,D){"use strict";var _=T("readable-stream").Readable;function r(b,E,O){_.call(this,E),this._helper=b;var w=this;b.on("data",function(I,A){w.push(I)||w._helper.pause(),O&&O(A)}).on("error",function(I){w.emit("error",I)}).on("end",function(){w.push(null)})}T("../utils").inherits(r,_),r.prototype._read=function(){this._helper.resume()},M.exports=r},{"../utils":32,"readable-stream":16}],14:[function(T,M,D){"use strict";M.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(_,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(_,r);if("number"==typeof _)throw new Error('The "data" argument must not be a number');return new Buffer(_,r)},allocBuffer:function(_){if(Buffer.alloc)return Buffer.alloc(_);var r=new Buffer(_);return r.fill(0),r},isBuffer:function(_){return Buffer.isBuffer(_)},isStream:function(_){return _&&"function"==typeof _.on&&"function"==typeof _.pause&&"function"==typeof _.resume}}},{}],15:[function(T,M,D){"use strict";function _(H,te,X){var K,ee=b.getTypeOf(te),_e=b.extend(X||{},w);_e.date=_e.date||new Date,null!==_e.compression&&(_e.compression=_e.compression.toUpperCase()),"string"==typeof _e.unixPermissions&&(_e.unixPermissions=parseInt(_e.unixPermissions,8)),_e.unixPermissions&&16384&_e.unixPermissions&&(_e.dir=!0),_e.dosPermissions&&16&_e.dosPermissions&&(_e.dir=!0),_e.dir&&(H=v(H)),_e.createFolders&&(K=p(H))&&C.call(this,K,!0),X&&void 0!==X.binary||(_e.binary=!("string"===ee&&!1===_e.binary&&!1===_e.base64)),(te instanceof I&&0===te.uncompressedSize||_e.dir||!te||0===te.length)&&(_e.base64=!1,_e.binary=!0,te="",_e.compression="STORE",ee="string");var P;P=te instanceof I||te instanceof E?te:g.isNode&&g.isStream(te)?new c(H,te):b.prepareContent(H,te,_e.binary,_e.optimizedBinaryString,_e.base64);var se=new A(H,P,_e);this.files[H]=se}var r=T("./utf8"),b=T("./utils"),E=T("./stream/GenericWorker"),O=T("./stream/StreamHelper"),w=T("./defaults"),I=T("./compressedObject"),A=T("./zipObject"),d=T("./generate"),g=T("./nodejsUtils"),c=T("./nodejs/NodejsStreamInputAdapter"),p=function(H){"/"===H.slice(-1)&&(H=H.substring(0,H.length-1));var te=H.lastIndexOf("/");return 0<te?H.substring(0,te):""},v=function(H){return"/"!==H.slice(-1)&&(H+="/"),H},C=function(H,te){return te=void 0!==te?te:w.createFolders,H=v(H),this.files[H]||_.call(this,H,null,{dir:!0,createFolders:te}),this.files[H]};function U(H){return"[object RegExp]"===Object.prototype.toString.call(H)}var L={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(H){var te,X,K;for(te in this.files)K=this.files[te],(X=te.slice(this.root.length,te.length))&&te.slice(0,this.root.length)===this.root&&H(X,K)},filter:function(H){var te=[];return this.forEach(function(X,K){H(X,K)&&te.push(K)}),te},file:function(H,te,X){if(1!==arguments.length)return _.call(this,H=this.root+H,te,X),this;if(U(H)){var K=H;return this.filter(function(_e,Ke){return!Ke.dir&&K.test(_e)})}var ee=this.files[this.root+H];return ee&&!ee.dir?ee:null},folder:function(H){if(!H)return this;if(U(H))return this.filter(function(ee,_e){return _e.dir&&H.test(ee)});var X=C.call(this,this.root+H),K=this.clone();return K.root=X.name,K},remove:function(H){var te=this.files[H=this.root+H];if(te||("/"!==H.slice(-1)&&(H+="/"),te=this.files[H]),te&&!te.dir)delete this.files[H];else for(var X=this.filter(function(ee,_e){return _e.name.slice(0,H.length)===H}),K=0;K<X.length;K++)delete this.files[X[K].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(H){var te,X={};try{if((X=b.extend(H||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=X.type.toLowerCase(),X.compression=X.compression.toUpperCase(),"binarystring"===X.type&&(X.type="string"),!X.type)throw new Error("No output type specified.");b.checkSupport(X.type),"darwin"!==X.platform&&"freebsd"!==X.platform&&"linux"!==X.platform&&"sunos"!==X.platform||(X.platform="UNIX"),"win32"===X.platform&&(X.platform="DOS"),te=d.generateWorker(this,X,X.comment||this.comment||"")}catch(ee){(te=new E("error")).error(ee)}return new O(te,X.type||"string",X.mimeType)},generateAsync:function(H,te){return this.generateInternalStream(H).accumulate(te)},generateNodeStream:function(H,te){return(H=H||{}).type||(H.type="nodebuffer"),this.generateInternalStream(H).toNodejsStream(te)}};M.exports=L},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(T,M,D){"use strict";M.exports=T("stream")},{stream:void 0}],17:[function(T,M,D){"use strict";var _=T("./DataReader");function r(b){_.call(this,b);for(var E=0;E<this.data.length;E++)b[E]=255&b[E]}T("../utils").inherits(r,_),r.prototype.byteAt=function(b){return this.data[this.zero+b]},r.prototype.lastIndexOfSignature=function(b){for(var E=b.charCodeAt(0),O=b.charCodeAt(1),w=b.charCodeAt(2),I=b.charCodeAt(3),A=this.length-4;0<=A;--A)if(this.data[A]===E&&this.data[A+1]===O&&this.data[A+2]===w&&this.data[A+3]===I)return A-this.zero;return-1},r.prototype.readAndCheckSignature=function(b){var E=b.charCodeAt(0),O=b.charCodeAt(1),w=b.charCodeAt(2),I=b.charCodeAt(3),A=this.readData(4);return E===A[0]&&O===A[1]&&w===A[2]&&I===A[3]},r.prototype.readData=function(b){if(this.checkOffset(b),0===b)return[];var E=this.data.slice(this.zero+this.index,this.zero+this.index+b);return this.index+=b,E},M.exports=r},{"../utils":32,"./DataReader":18}],18:[function(T,M,D){"use strict";var _=T("../utils");function r(b){this.data=b,this.length=b.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(b){this.checkIndex(this.index+b)},checkIndex:function(b){if(this.length<this.zero+b||b<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+b+"). Corrupted zip ?")},setIndex:function(b){this.checkIndex(b),this.index=b},skip:function(b){this.setIndex(this.index+b)},byteAt:function(){},readInt:function(b){var E,O=0;for(this.checkOffset(b),E=this.index+b-1;E>=this.index;E--)O=(O<<8)+this.byteAt(E);return this.index+=b,O},readString:function(b){return _.transformTo("string",this.readData(b))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var b=this.readInt(4);return new Date(Date.UTC(1980+(b>>25&127),(b>>21&15)-1,b>>16&31,b>>11&31,b>>5&63,(31&b)<<1))}},M.exports=r},{"../utils":32}],19:[function(T,M,D){"use strict";var _=T("./Uint8ArrayReader");function r(b){_.call(this,b)}T("../utils").inherits(r,_),r.prototype.readData=function(b){this.checkOffset(b);var E=this.data.slice(this.zero+this.index,this.zero+this.index+b);return this.index+=b,E},M.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(T,M,D){"use strict";var _=T("./DataReader");function r(b){_.call(this,b)}T("../utils").inherits(r,_),r.prototype.byteAt=function(b){return this.data.charCodeAt(this.zero+b)},r.prototype.lastIndexOfSignature=function(b){return this.data.lastIndexOf(b)-this.zero},r.prototype.readAndCheckSignature=function(b){return b===this.readData(4)},r.prototype.readData=function(b){this.checkOffset(b);var E=this.data.slice(this.zero+this.index,this.zero+this.index+b);return this.index+=b,E},M.exports=r},{"../utils":32,"./DataReader":18}],21:[function(T,M,D){"use strict";var _=T("./ArrayReader");function r(b){_.call(this,b)}T("../utils").inherits(r,_),r.prototype.readData=function(b){if(this.checkOffset(b),0===b)return new Uint8Array(0);var E=this.data.subarray(this.zero+this.index,this.zero+this.index+b);return this.index+=b,E},M.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(T,M,D){"use strict";var _=T("../utils"),r=T("../support"),b=T("./ArrayReader"),E=T("./StringReader"),O=T("./NodeBufferReader"),w=T("./Uint8ArrayReader");M.exports=function(I){var A=_.getTypeOf(I);return _.checkSupport(A),"string"!==A||r.uint8array?"nodebuffer"===A?new O(I):r.uint8array?new w(_.transformTo("uint8array",I)):new b(_.transformTo("array",I)):new E(I)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(T,M,D){"use strict";D.LOCAL_FILE_HEADER="PK\x03\x04",D.CENTRAL_FILE_HEADER="PK\x01\x02",D.CENTRAL_DIRECTORY_END="PK\x05\x06",D.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",D.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",D.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(T,M,D){"use strict";var _=T("./GenericWorker"),r=T("../utils");function b(E){_.call(this,"ConvertWorker to "+E),this.destType=E}r.inherits(b,_),b.prototype.processChunk=function(E){this.push({data:r.transformTo(this.destType,E.data),meta:E.meta})},M.exports=b},{"../utils":32,"./GenericWorker":28}],25:[function(T,M,D){"use strict";var _=T("./GenericWorker"),r=T("../crc32");function b(){_.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}T("../utils").inherits(b,_),b.prototype.processChunk=function(E){this.streamInfo.crc32=r(E.data,this.streamInfo.crc32||0),this.push(E)},M.exports=b},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(T,M,D){"use strict";var _=T("../utils"),r=T("./GenericWorker");function b(E){r.call(this,"DataLengthProbe for "+E),this.propName=E,this.withStreamInfo(E,0)}_.inherits(b,r),b.prototype.processChunk=function(E){E&&(this.streamInfo[this.propName]=(this.streamInfo[this.propName]||0)+E.data.length),r.prototype.processChunk.call(this,E)},M.exports=b},{"../utils":32,"./GenericWorker":28}],27:[function(T,M,D){"use strict";var _=T("../utils"),r=T("./GenericWorker");function b(E){r.call(this,"DataWorker");var O=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,E.then(function(w){O.dataIsReady=!0,O.data=w,O.max=w&&w.length||0,O.type=_.getTypeOf(w),O.isPaused||O._tickAndRepeat()},function(w){O.error(w)})}_.inherits(b,r),b.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},b.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,_.delay(this._tickAndRepeat,[],this)),!0)},b.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(_.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},b.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var E=null,O=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":E=this.data.substring(this.index,O);break;case"uint8array":E=this.data.subarray(this.index,O);break;case"array":case"nodebuffer":E=this.data.slice(this.index,O)}return this.index=O,this.push({data:E,meta:{percent:this.max?this.index/this.max*100:0}})},M.exports=b},{"../utils":32,"./GenericWorker":28}],28:[function(T,M,D){"use strict";function _(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}_.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,b){return this._listeners[r].push(b),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,b){if(this._listeners[r])for(var E=0;E<this._listeners[r].length;E++)this._listeners[r][E].call(this,b)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var b=this;return r.on("data",function(E){b.processChunk(E)}),r.on("end",function(){b.end()}),r.on("error",function(E){b.error(E)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,b){return this.extraStreamInfo[r]=b,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},M.exports=_},{}],29:[function(T,M,D){"use strict";var _=T("../utils"),r=T("./ConvertWorker"),b=T("./GenericWorker"),E=T("../base64"),O=T("../support"),w=T("../external"),I=null;if(O.nodestream)try{I=T("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(g,c,p){var v=c;switch(c){case"blob":case"arraybuffer":v="uint8array";break;case"base64":v="string"}try{this._internalType=v,this._outputType=c,this._mimeType=p,_.checkSupport(v),this._worker=g.pipe(new r(v)),g.lock()}catch(C){this._worker=new b("error"),this._worker.error(C)}}d.prototype={accumulate:function(g){return function A(g,c){return new w.Promise(function(p,v){var C=[],U=g._internalType,L=g._outputType,H=g._mimeType;g.on("data",function(te,X){C.push(te),c&&c(X)}).on("error",function(te){C=[],v(te)}).on("end",function(){try{var te=function(X,K,ee){switch(X){case"blob":return _.newBlob(_.transformTo("arraybuffer",K),ee);case"base64":return E.encode(K);default:return _.transformTo(X,K)}}(L,function(X,K){var ee,_e=0,Ke=null,P=0;for(ee=0;ee<K.length;ee++)P+=K[ee].length;switch(X){case"string":return K.join("");case"array":return Array.prototype.concat.apply([],K);case"uint8array":for(Ke=new Uint8Array(P),ee=0;ee<K.length;ee++)Ke.set(K[ee],_e),_e+=K[ee].length;return Ke;case"nodebuffer":return Buffer.concat(K);default:throw new Error("concat : unsupported type '"+X+"'")}}(U,C),H);p(te)}catch(X){v(X)}C=[]}).resume()})}(this,g)},on:function(g,c){var p=this;return this._worker.on(g,"data"===g?function(v){c.call(p,v.data,v.meta)}:function(){_.delay(c,arguments,p)}),this},resume:function(){return _.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(_.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new I(this,{objectMode:"nodebuffer"!==this._outputType},g)}},M.exports=d},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(T,M,D){"use strict";if(D.base64=!0,D.array=!0,D.string=!0,D.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,D.nodebuffer="undefined"!=typeof Buffer,D.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)D.blob=!1;else{var _=new ArrayBuffer(0);try{D.blob=0===new Blob([_],{type:"application/zip"}).size}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(_),D.blob=0===r.getBlob("application/zip").size}catch{D.blob=!1}}}try{D.nodestream=!!T("readable-stream").Readable}catch{D.nodestream=!1}},{"readable-stream":16}],31:[function(T,M,D){"use strict";for(var _=T("./utils"),r=T("./support"),b=T("./nodejsUtils"),E=T("./stream/GenericWorker"),O=new Array(256),w=0;w<256;w++)O[w]=252<=w?6:248<=w?5:240<=w?4:224<=w?3:192<=w?2:1;function I(){E.call(this,"utf-8 decode"),this.leftOver=null}function A(){E.call(this,"utf-8 encode")}O[254]=O[254]=1,D.utf8encode=function(d){return r.nodebuffer?b.newBufferFrom(d,"utf-8"):function(g){var c,p,v,C,U,L=g.length,H=0;for(C=0;C<L;C++)55296==(64512&(p=g.charCodeAt(C)))&&C+1<L&&56320==(64512&(v=g.charCodeAt(C+1)))&&(p=65536+(p-55296<<10)+(v-56320),C++),H+=p<128?1:p<2048?2:p<65536?3:4;for(c=r.uint8array?new Uint8Array(H):new Array(H),C=U=0;U<H;C++)55296==(64512&(p=g.charCodeAt(C)))&&C+1<L&&56320==(64512&(v=g.charCodeAt(C+1)))&&(p=65536+(p-55296<<10)+(v-56320),C++),p<128?c[U++]=p:(p<2048?c[U++]=192|p>>>6:(p<65536?c[U++]=224|p>>>12:(c[U++]=240|p>>>18,c[U++]=128|p>>>12&63),c[U++]=128|p>>>6&63),c[U++]=128|63&p);return c}(d)},D.utf8decode=function(d){return r.nodebuffer?_.transformTo("nodebuffer",d).toString("utf-8"):function(g){var c,p,v,C,U=g.length,L=new Array(2*U);for(c=p=0;c<U;)if((v=g[c++])<128)L[p++]=v;else if(4<(C=O[v]))L[p++]=65533,c+=C-1;else{for(v&=2===C?31:3===C?15:7;1<C&&c<U;)v=v<<6|63&g[c++],C--;1<C?L[p++]=65533:v<65536?L[p++]=v:(L[p++]=55296|(v-=65536)>>10&1023,L[p++]=56320|1023&v)}return L.length!==p&&(L.subarray?L=L.subarray(0,p):L.length=p),_.applyFromCharCode(L)}(d=_.transformTo(r.uint8array?"uint8array":"array",d))},_.inherits(I,E),I.prototype.processChunk=function(d){var g=_.transformTo(r.uint8array?"uint8array":"array",d.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var c=g;(g=new Uint8Array(c.length+this.leftOver.length)).set(this.leftOver,0),g.set(c,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var p=function(C,U){var L;for((U=U||C.length)>C.length&&(U=C.length),L=U-1;0<=L&&128==(192&C[L]);)L--;return L<0||0===L?U:L+O[C[L]]>U?L:U}(g),v=g;p!==g.length&&(r.uint8array?(v=g.subarray(0,p),this.leftOver=g.subarray(p,g.length)):(v=g.slice(0,p),this.leftOver=g.slice(p,g.length))),this.push({data:D.utf8decode(v),meta:d.meta})},I.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:D.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},D.Utf8DecodeWorker=I,_.inherits(A,E),A.prototype.processChunk=function(d){this.push({data:D.utf8encode(d.data),meta:d.meta})},D.Utf8EncodeWorker=A},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(T,M,D){"use strict";var _=T("./support"),r=T("./base64"),b=T("./nodejsUtils"),E=T("./external");function O(c){return c}function w(c,p){for(var v=0;v<c.length;++v)p[v]=255&c.charCodeAt(v);return p}T("setimmediate"),D.newBlob=function(c,p){D.checkSupport("blob");try{return new Blob([c],{type:p})}catch{try{var v=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return v.append(c),v.getBlob(p)}catch{throw new Error("Bug : can't construct the Blob.")}}};var I={stringifyByChunk:function(c,p,v){var C=[],U=0,L=c.length;if(L<=v)return String.fromCharCode.apply(null,c);for(;U<L;)C.push(String.fromCharCode.apply(null,"array"===p||"nodebuffer"===p?c.slice(U,Math.min(U+v,L)):c.subarray(U,Math.min(U+v,L)))),U+=v;return C.join("")},stringifyByChar:function(c){for(var p="",v=0;v<c.length;v++)p+=String.fromCharCode(c[v]);return p},applyCanBeUsed:{uint8array:function(){try{return _.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch{return!1}}(),nodebuffer:function(){try{return _.nodebuffer&&1===String.fromCharCode.apply(null,b.allocBuffer(1)).length}catch{return!1}}()}};function A(c){var p=65536,v=D.getTypeOf(c),C=!0;if("uint8array"===v?C=I.applyCanBeUsed.uint8array:"nodebuffer"===v&&(C=I.applyCanBeUsed.nodebuffer),C)for(;1<p;)try{return I.stringifyByChunk(c,v,p)}catch{p=Math.floor(p/2)}return I.stringifyByChar(c)}function d(c,p){for(var v=0;v<c.length;v++)p[v]=c[v];return p}D.applyFromCharCode=A;var g={};g.string={string:O,array:function(c){return w(c,new Array(c.length))},arraybuffer:function(c){return g.string.uint8array(c).buffer},uint8array:function(c){return w(c,new Uint8Array(c.length))},nodebuffer:function(c){return w(c,b.allocBuffer(c.length))}},g.array={string:A,array:O,arraybuffer:function(c){return new Uint8Array(c).buffer},uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return b.newBufferFrom(c)}},g.arraybuffer={string:function(c){return A(new Uint8Array(c))},array:function(c){return d(new Uint8Array(c),new Array(c.byteLength))},arraybuffer:O,uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return b.newBufferFrom(new Uint8Array(c))}},g.uint8array={string:A,array:function(c){return d(c,new Array(c.length))},arraybuffer:function(c){return c.buffer},uint8array:O,nodebuffer:function(c){return b.newBufferFrom(c)}},g.nodebuffer={string:A,array:function(c){return d(c,new Array(c.length))},arraybuffer:function(c){return g.nodebuffer.uint8array(c).buffer},uint8array:function(c){return d(c,new Uint8Array(c.length))},nodebuffer:O},D.transformTo=function(c,p){if(p=p||"",!c)return p;D.checkSupport(c);var v=D.getTypeOf(p);return g[v][c](p)},D.resolve=function(c){for(var p=c.split("/"),v=[],C=0;C<p.length;C++){var U=p[C];"."===U||""===U&&0!==C&&C!==p.length-1||(".."===U?v.pop():v.push(U))}return v.join("/")},D.getTypeOf=function(c){return"string"==typeof c?"string":"[object Array]"===Object.prototype.toString.call(c)?"array":_.nodebuffer&&b.isBuffer(c)?"nodebuffer":_.uint8array&&c instanceof Uint8Array?"uint8array":_.arraybuffer&&c instanceof ArrayBuffer?"arraybuffer":void 0},D.checkSupport=function(c){if(!_[c.toLowerCase()])throw new Error(c+" is not supported by this platform")},D.MAX_VALUE_16BITS=65535,D.MAX_VALUE_32BITS=-1,D.pretty=function(c){var p,v,C="";for(v=0;v<(c||"").length;v++)C+="\\x"+((p=c.charCodeAt(v))<16?"0":"")+p.toString(16).toUpperCase();return C},D.delay=function(c,p,v){setImmediate(function(){c.apply(v||null,p||[])})},D.inherits=function(c,p){function v(){}v.prototype=p.prototype,c.prototype=new v},D.extend=function(){var c,p,v={};for(c=0;c<arguments.length;c++)for(p in arguments[c])Object.prototype.hasOwnProperty.call(arguments[c],p)&&void 0===v[p]&&(v[p]=arguments[c][p]);return v},D.prepareContent=function(c,p,v,C,U){return E.Promise.resolve(p).then(function(L){return _.blob&&(L instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(L)))&&"undefined"!=typeof FileReader?new E.Promise(function(H,te){var X=new FileReader;X.onload=function(K){H(K.target.result)},X.onerror=function(K){te(K.target.error)},X.readAsArrayBuffer(L)}):L}).then(function(L){var te,H=D.getTypeOf(L);return H?("arraybuffer"===H?L=D.transformTo("uint8array",L):"string"===H&&(U?L=r.decode(L):v&&!0!==C&&(L=w(te=L,_.uint8array?new Uint8Array(te.length):new Array(te.length)))),L):E.Promise.reject(new Error("Can't read the data of '"+c+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(T,M,D){"use strict";var _=T("./reader/readerFor"),r=T("./utils"),b=T("./signature"),E=T("./zipEntry"),O=T("./support");function w(I){this.files=[],this.loadOptions=I}w.prototype={checkSignature:function(I){if(!this.reader.readAndCheckSignature(I)){this.reader.index-=4;var A=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(A)+", expected "+r.pretty(I)+")")}},isSignature:function(I,A){var d=this.reader.index;this.reader.setIndex(I);var g=this.reader.readString(4)===A;return this.reader.setIndex(d),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var I=this.reader.readData(this.zipCommentLength),d=r.transformTo(O.uint8array?"uint8array":"array",I);this.zipComment=this.loadOptions.decodeFileName(d)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var I,A,d,g=this.zip64EndOfCentralSize-44;0<g;)I=this.reader.readInt(2),A=this.reader.readInt(4),d=this.reader.readData(A),this.zip64ExtensibleData[I]={id:I,length:A,value:d}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var I,A;for(I=0;I<this.files.length;I++)this.reader.setIndex((A=this.files[I]).localHeaderOffset),this.checkSignature(b.LOCAL_FILE_HEADER),A.readLocalPart(this.reader),A.handleUTF8(),A.processAttributes()},readCentralDir:function(){var I;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(b.CENTRAL_FILE_HEADER);)(I=new E({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(I);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var I=this.reader.lastIndexOfSignature(b.CENTRAL_DIRECTORY_END);if(I<0)throw this.isSignature(0,b.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(I);var A=I;if(this.checkSignature(b.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(I=this.reader.lastIndexOfSignature(b.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(I),this.checkSignature(b.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,b.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(b.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(b.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var d=this.centralDirOffset+this.centralDirSize;this.zip64&&(d+=20,d+=12+this.zip64EndOfCentralSize);var g=A-d;if(0<g)this.isSignature(A,b.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(I){this.reader=_(I)},load:function(I){this.prepareReader(I),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},M.exports=w},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(T,M,D){"use strict";var _=T("./reader/readerFor"),r=T("./utils"),b=T("./compressedObject"),E=T("./crc32"),O=T("./utf8"),w=T("./compressions"),I=T("./support");function A(d,g){this.options=d,this.loadOptions=g}A.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(d){var g,c;if(d.skip(22),this.fileNameLength=d.readInt(2),c=d.readInt(2),this.fileName=d.readData(this.fileNameLength),d.skip(c),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(g=function(p){for(var v in w)if(Object.prototype.hasOwnProperty.call(w,v)&&w[v].magic===p)return w[v];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new b(this.compressedSize,this.uncompressedSize,this.crc32,g,d.readData(this.compressedSize))},readCentralPart:function(d){this.versionMadeBy=d.readInt(2),d.skip(2),this.bitFlag=d.readInt(2),this.compressionMethod=d.readString(2),this.date=d.readDate(),this.crc32=d.readInt(4),this.compressedSize=d.readInt(4),this.uncompressedSize=d.readInt(4);var g=d.readInt(2);if(this.extraFieldsLength=d.readInt(2),this.fileCommentLength=d.readInt(2),this.diskNumberStart=d.readInt(2),this.internalFileAttributes=d.readInt(2),this.externalFileAttributes=d.readInt(4),this.localHeaderOffset=d.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");d.skip(g),this.readExtraFields(d),this.parseZIP64ExtraField(d),this.fileComment=d.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var d=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==d&&(this.dosPermissions=63&this.externalFileAttributes),3==d&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var d=_(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=d.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=d.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=d.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=d.readInt(4))}},readExtraFields:function(d){var g,c,p,v=d.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});d.index+4<v;)g=d.readInt(2),c=d.readInt(2),p=d.readData(c),this.extraFields[g]={id:g,length:c,value:p};d.setIndex(v)},handleUTF8:function(){var d=I.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=O.utf8decode(this.fileName),this.fileCommentStr=O.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(null!==g)this.fileNameStr=g;else{var c=r.transformTo(d,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var p=this.findExtraFieldUnicodeComment();if(null!==p)this.fileCommentStr=p;else{var v=r.transformTo(d,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(v)}}},findExtraFieldUnicodePath:function(){var d=this.extraFields[28789];if(d){var g=_(d.value);return 1!==g.readInt(1)||E(this.fileName)!==g.readInt(4)?null:O.utf8decode(g.readData(d.length-5))}return null},findExtraFieldUnicodeComment:function(){var d=this.extraFields[25461];if(d){var g=_(d.value);return 1!==g.readInt(1)||E(this.fileComment)!==g.readInt(4)?null:O.utf8decode(g.readData(d.length-5))}return null}},M.exports=A},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(T,M,D){"use strict";function _(g,c,p){this.name=g,this.dir=p.dir,this.date=p.date,this.comment=p.comment,this.unixPermissions=p.unixPermissions,this.dosPermissions=p.dosPermissions,this._data=c,this._dataBinary=p.binary,this.options={compression:p.compression,compressionOptions:p.compressionOptions}}var r=T("./stream/StreamHelper"),b=T("./stream/DataWorker"),E=T("./utf8"),O=T("./compressedObject"),w=T("./stream/GenericWorker");_.prototype={internalStream:function(g){var c=null,p="string";try{if(!g)throw new Error("No output type specified.");var v="string"===(p=g.toLowerCase())||"text"===p;"binarystring"!==p&&"text"!==p||(p="string"),c=this._decompressWorker();var C=!this._dataBinary;C&&!v&&(c=c.pipe(new E.Utf8EncodeWorker)),!C&&v&&(c=c.pipe(new E.Utf8DecodeWorker))}catch(U){(c=new w("error")).error(U)}return new r(c,p,"")},async:function(g,c){return this.internalStream(g).accumulate(c)},nodeStream:function(g,c){return this.internalStream(g||"nodebuffer").toNodejsStream(c)},_compressWorker:function(g,c){if(this._data instanceof O&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var p=this._decompressWorker();return this._dataBinary||(p=p.pipe(new E.Utf8EncodeWorker)),O.createWorkerFrom(p,g,c)},_decompressWorker:function(){return this._data instanceof O?this._data.getContentWorker():this._data instanceof w?this._data:new b(this._data)}};for(var I=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],A=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<I.length;d++)_.prototype[I[d]]=A;M.exports=_},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(T,M,D){(function(_){"use strict";var r,b,E=_.MutationObserver||_.WebKitMutationObserver;if(E){var O=0,w=new E(g),I=_.document.createTextNode("");w.observe(I,{characterData:!0}),r=function(){I.data=O=++O%2}}else if(_.setImmediate||void 0===_.MessageChannel)r="document"in _&&"onreadystatechange"in _.document.createElement("script")?function(){var c=_.document.createElement("script");c.onreadystatechange=function(){g(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},_.document.documentElement.appendChild(c)}:function(){setTimeout(g,0)};else{var A=new _.MessageChannel;A.port1.onmessage=g,r=function(){A.port2.postMessage(0)}}var d=[];function g(){var c,p;b=!0;for(var v=d.length;v;){for(p=d,d=[],c=-1;++c<v;)p[c]();v=d.length}b=!1}M.exports=function(c){1!==d.push(c)||b||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(T,M,D){"use strict";var _=T("immediate");function r(){}var b={},E=["REJECTED"],O=["FULFILLED"],w=["PENDING"];function I(v){if("function"!=typeof v)throw new TypeError("resolver must be a function");this.state=w,this.queue=[],this.outcome=void 0,v!==r&&c(this,v)}function A(v,C,U){this.promise=v,"function"==typeof C&&(this.onFulfilled=C,this.callFulfilled=this.otherCallFulfilled),"function"==typeof U&&(this.onRejected=U,this.callRejected=this.otherCallRejected)}function d(v,C,U){_(function(){var L;try{L=C(U)}catch(H){return b.reject(v,H)}L===v?b.reject(v,new TypeError("Cannot resolve promise with itself")):b.resolve(v,L)})}function g(v){var C=v&&v.then;if(v&&("object"==typeof v||"function"==typeof v)&&"function"==typeof C)return function(){C.apply(v,arguments)}}function c(v,C){var U=!1;function L(X){U||(U=!0,b.reject(v,X))}function H(X){U||(U=!0,b.resolve(v,X))}var te=p(function(){C(H,L)});"error"===te.status&&L(te.value)}function p(v,C){var U={};try{U.value=v(C),U.status="success"}catch(L){U.status="error",U.value=L}return U}(M.exports=I).prototype.finally=function(v){if("function"!=typeof v)return this;var C=this.constructor;return this.then(function(U){return C.resolve(v()).then(function(){return U})},function(U){return C.resolve(v()).then(function(){throw U})})},I.prototype.catch=function(v){return this.then(null,v)},I.prototype.then=function(v,C){if("function"!=typeof v&&this.state===O||"function"!=typeof C&&this.state===E)return this;var U=new this.constructor(r);return this.state!==w?d(U,this.state===O?v:C,this.outcome):this.queue.push(new A(U,v,C)),U},A.prototype.callFulfilled=function(v){b.resolve(this.promise,v)},A.prototype.otherCallFulfilled=function(v){d(this.promise,this.onFulfilled,v)},A.prototype.callRejected=function(v){b.reject(this.promise,v)},A.prototype.otherCallRejected=function(v){d(this.promise,this.onRejected,v)},b.resolve=function(v,C){var U=p(g,C);if("error"===U.status)return b.reject(v,U.value);var L=U.value;if(L)c(v,L);else{v.state=O,v.outcome=C;for(var H=-1,te=v.queue.length;++H<te;)v.queue[H].callFulfilled(C)}return v},b.reject=function(v,C){v.state=E,v.outcome=C;for(var U=-1,L=v.queue.length;++U<L;)v.queue[U].callRejected(C);return v},I.resolve=function(v){return v instanceof this?v:b.resolve(new this(r),v)},I.reject=function(v){var C=new this(r);return b.reject(C,v)},I.all=function(v){var C=this;if("[object Array]"!==Object.prototype.toString.call(v))return this.reject(new TypeError("must be an array"));var U=v.length,L=!1;if(!U)return this.resolve([]);for(var H=new Array(U),te=0,X=-1,K=new this(r);++X<U;)ee(v[X],X);return K;function ee(_e,Ke){C.resolve(_e).then(function(P){H[Ke]=P,++te!==U||L||(L=!0,b.resolve(K,H))},function(P){L||(L=!0,b.reject(K,P))})}},I.race=function(v){if("[object Array]"!==Object.prototype.toString.call(v))return this.reject(new TypeError("must be an array"));var U=v.length,L=!1;if(!U)return this.resolve([]);for(var H=-1,te=new this(r);++H<U;)this.resolve(v[H]).then(function(K){L||(L=!0,b.resolve(te,K))},function(K){L||(L=!0,b.reject(te,K))});return te}},{immediate:36}],38:[function(T,M,D){"use strict";var _={};(0,T("./lib/utils/common").assign)(_,T("./lib/deflate"),T("./lib/inflate"),T("./lib/zlib/constants")),M.exports=_},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(T,M,D){"use strict";var _=T("./zlib/deflate"),r=T("./utils/common"),b=T("./utils/strings"),E=T("./zlib/messages"),O=T("./zlib/zstream"),w=Object.prototype.toString;function c(v){if(!(this instanceof c))return new c(v);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},v||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new O,this.strm.avail_out=0;var U=_.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(0!==U)throw new Error(E[U]);if(C.header&&_.deflateSetHeader(this.strm,C.header),C.dictionary){var L;if(L="string"==typeof C.dictionary?b.string2buf(C.dictionary):"[object ArrayBuffer]"===w.call(C.dictionary)?new Uint8Array(C.dictionary):C.dictionary,0!==(U=_.deflateSetDictionary(this.strm,L)))throw new Error(E[U]);this._dict_set=!0}}function p(v,C){var U=new c(C);if(U.push(v,!0),U.err)throw U.msg||E[U.err];return U.result}c.prototype.push=function(v,C){var U,L,H=this.strm,te=this.options.chunkSize;if(this.ended)return!1;L=C===~~C?C:!0===C?4:0,H.input="string"==typeof v?b.string2buf(v):"[object ArrayBuffer]"===w.call(v)?new Uint8Array(v):v,H.next_in=0,H.avail_in=H.input.length;do{if(0===H.avail_out&&(H.output=new r.Buf8(te),H.next_out=0,H.avail_out=te),1!==(U=_.deflate(H,L))&&0!==U)return this.onEnd(U),!(this.ended=!0);0!==H.avail_out&&(0!==H.avail_in||4!==L&&2!==L)||this.onData("string"===this.options.to?b.buf2binstring(r.shrinkBuf(H.output,H.next_out)):r.shrinkBuf(H.output,H.next_out))}while((0<H.avail_in||0===H.avail_out)&&1!==U);return 4===L?(U=_.deflateEnd(this.strm),this.onEnd(U),this.ended=!0,0===U):2!==L||(this.onEnd(0),!(H.avail_out=0))},c.prototype.onData=function(v){this.chunks.push(v)},c.prototype.onEnd=function(v){0===v&&(this.result="string"===this.options.to?this.chunks.join(""):r.flattenChunks(this.chunks)),this.chunks=[],this.err=v,this.msg=this.strm.msg},D.Deflate=c,D.deflate=p,D.deflateRaw=function(v,C){return(C=C||{}).raw=!0,p(v,C)},D.gzip=function(v,C){return(C=C||{}).gzip=!0,p(v,C)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(T,M,D){"use strict";var _=T("./zlib/inflate"),r=T("./utils/common"),b=T("./utils/strings"),E=T("./zlib/constants"),O=T("./zlib/messages"),w=T("./zlib/zstream"),I=T("./zlib/gzheader"),A=Object.prototype.toString;function d(c){if(!(this instanceof d))return new d(c);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},c||{});var p=this.options;p.raw&&0<=p.windowBits&&p.windowBits<16&&(p.windowBits=-p.windowBits,0===p.windowBits&&(p.windowBits=-15)),!(0<=p.windowBits&&p.windowBits<16)||c&&c.windowBits||(p.windowBits+=32),15<p.windowBits&&p.windowBits<48&&0==(15&p.windowBits)&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new w,this.strm.avail_out=0;var v=_.inflateInit2(this.strm,p.windowBits);if(v!==E.Z_OK)throw new Error(O[v]);this.header=new I,_.inflateGetHeader(this.strm,this.header)}function g(c,p){var v=new d(p);if(v.push(c,!0),v.err)throw v.msg||O[v.err];return v.result}d.prototype.push=function(c,p){var v,C,U,L,H,te,X=this.strm,K=this.options.chunkSize,ee=this.options.dictionary,_e=!1;if(this.ended)return!1;C=p===~~p?p:!0===p?E.Z_FINISH:E.Z_NO_FLUSH,X.input="string"==typeof c?b.binstring2buf(c):"[object ArrayBuffer]"===A.call(c)?new Uint8Array(c):c,X.next_in=0,X.avail_in=X.input.length;do{if(0===X.avail_out&&(X.output=new r.Buf8(K),X.next_out=0,X.avail_out=K),(v=_.inflate(X,E.Z_NO_FLUSH))===E.Z_NEED_DICT&&ee&&(te="string"==typeof ee?b.string2buf(ee):"[object ArrayBuffer]"===A.call(ee)?new Uint8Array(ee):ee,v=_.inflateSetDictionary(this.strm,te)),v===E.Z_BUF_ERROR&&!0===_e&&(v=E.Z_OK,_e=!1),v!==E.Z_STREAM_END&&v!==E.Z_OK)return this.onEnd(v),!(this.ended=!0);X.next_out&&(0!==X.avail_out&&v!==E.Z_STREAM_END&&(0!==X.avail_in||C!==E.Z_FINISH&&C!==E.Z_SYNC_FLUSH)||("string"===this.options.to?(U=b.utf8border(X.output,X.next_out),L=X.next_out-U,H=b.buf2string(X.output,U),X.next_out=L,X.avail_out=K-L,L&&r.arraySet(X.output,X.output,U,L,0),this.onData(H)):this.onData(r.shrinkBuf(X.output,X.next_out)))),0===X.avail_in&&0===X.avail_out&&(_e=!0)}while((0<X.avail_in||0===X.avail_out)&&v!==E.Z_STREAM_END);return v===E.Z_STREAM_END&&(C=E.Z_FINISH),C===E.Z_FINISH?(v=_.inflateEnd(this.strm),this.onEnd(v),this.ended=!0,v===E.Z_OK):C!==E.Z_SYNC_FLUSH||(this.onEnd(E.Z_OK),!(X.avail_out=0))},d.prototype.onData=function(c){this.chunks.push(c)},d.prototype.onEnd=function(c){c===E.Z_OK&&(this.result="string"===this.options.to?this.chunks.join(""):r.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},D.Inflate=d,D.inflate=g,D.inflateRaw=function(c,p){return(p=p||{}).raw=!0,g(c,p)},D.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(T,M,D){"use strict";var _="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;D.assign=function(E){for(var O=Array.prototype.slice.call(arguments,1);O.length;){var w=O.shift();if(w){if("object"!=typeof w)throw new TypeError(w+"must be non-object");for(var I in w)w.hasOwnProperty(I)&&(E[I]=w[I])}}return E},D.shrinkBuf=function(E,O){return E.length===O?E:E.subarray?E.subarray(0,O):(E.length=O,E)};var r={arraySet:function(E,O,w,I,A){if(O.subarray&&E.subarray)E.set(O.subarray(w,w+I),A);else for(var d=0;d<I;d++)E[A+d]=O[w+d]},flattenChunks:function(E){var O,w,I,A,d,g;for(O=I=0,w=E.length;O<w;O++)I+=E[O].length;for(g=new Uint8Array(I),O=A=0,w=E.length;O<w;O++)g.set(d=E[O],A),A+=d.length;return g}},b={arraySet:function(E,O,w,I,A){for(var d=0;d<I;d++)E[A+d]=O[w+d]},flattenChunks:function(E){return[].concat.apply([],E)}};D.setTyped=function(E){E?(D.Buf8=Uint8Array,D.Buf16=Uint16Array,D.Buf32=Int32Array,D.assign(D,r)):(D.Buf8=Array,D.Buf16=Array,D.Buf32=Array,D.assign(D,b))},D.setTyped(_)},{}],42:[function(T,M,D){"use strict";var _=T("./common"),r=!0,b=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{b=!1}for(var E=new _.Buf8(256),O=0;O<256;O++)E[O]=252<=O?6:248<=O?5:240<=O?4:224<=O?3:192<=O?2:1;function w(I,A){if(A<65537&&(I.subarray&&b||!I.subarray&&r))return String.fromCharCode.apply(null,_.shrinkBuf(I,A));for(var d="",g=0;g<A;g++)d+=String.fromCharCode(I[g]);return d}E[254]=E[254]=1,D.string2buf=function(I){var A,d,g,c,p,v=I.length,C=0;for(c=0;c<v;c++)55296==(64512&(d=I.charCodeAt(c)))&&c+1<v&&56320==(64512&(g=I.charCodeAt(c+1)))&&(d=65536+(d-55296<<10)+(g-56320),c++),C+=d<128?1:d<2048?2:d<65536?3:4;for(A=new _.Buf8(C),c=p=0;p<C;c++)55296==(64512&(d=I.charCodeAt(c)))&&c+1<v&&56320==(64512&(g=I.charCodeAt(c+1)))&&(d=65536+(d-55296<<10)+(g-56320),c++),d<128?A[p++]=d:(d<2048?A[p++]=192|d>>>6:(d<65536?A[p++]=224|d>>>12:(A[p++]=240|d>>>18,A[p++]=128|d>>>12&63),A[p++]=128|d>>>6&63),A[p++]=128|63&d);return A},D.buf2binstring=function(I){return w(I,I.length)},D.binstring2buf=function(I){for(var A=new _.Buf8(I.length),d=0,g=A.length;d<g;d++)A[d]=I.charCodeAt(d);return A},D.buf2string=function(I,A){var d,g,c,p,v=A||I.length,C=new Array(2*v);for(d=g=0;d<v;)if((c=I[d++])<128)C[g++]=c;else if(4<(p=E[c]))C[g++]=65533,d+=p-1;else{for(c&=2===p?31:3===p?15:7;1<p&&d<v;)c=c<<6|63&I[d++],p--;1<p?C[g++]=65533:c<65536?C[g++]=c:(C[g++]=55296|(c-=65536)>>10&1023,C[g++]=56320|1023&c)}return w(C,g)},D.utf8border=function(I,A){var d;for((A=A||I.length)>I.length&&(A=I.length),d=A-1;0<=d&&128==(192&I[d]);)d--;return d<0||0===d?A:d+E[I[d]]>A?d:A}},{"./common":41}],43:[function(T,M,D){"use strict";M.exports=function(_,r,b,E){for(var O=65535&_|0,w=_>>>16&65535|0,I=0;0!==b;){for(b-=I=2e3<b?2e3:b;w=w+(O=O+r[E++]|0)|0,--I;);O%=65521,w%=65521}return O|w<<16|0}},{}],44:[function(T,M,D){"use strict";M.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(T,M,D){"use strict";var _=function(){for(var r,b=[],E=0;E<256;E++){r=E;for(var O=0;O<8;O++)r=1&r?3988292384^r>>>1:r>>>1;b[E]=r}return b}();M.exports=function(r,b,E,O){var w=_,I=O+E;r^=-1;for(var A=O;A<I;A++)r=r>>>8^w[255&(r^b[A])];return-1^r}},{}],46:[function(T,M,D){"use strict";var _,r=T("../utils/common"),b=T("./trees"),E=T("./adler32"),O=T("./crc32"),w=T("./messages"),g=-2,_e=258,Ke=262;function We(f,ie){return f.msg=w[ie],ie}function we(f){return(f<<1)-(4<f?9:0)}function $e(f){for(var ie=f.length;0<=--ie;)f[ie]=0}function Y(f){var ie=f.state,Q=ie.pending;Q>f.avail_out&&(Q=f.avail_out),0!==Q&&(r.arraySet(f.output,ie.pending_buf,ie.pending_out,Q,f.next_out),f.next_out+=Q,ie.pending_out+=Q,f.total_out+=Q,f.avail_out-=Q,ie.pending-=Q,0===ie.pending&&(ie.pending_out=0))}function Z(f,ie){b._tr_flush_block(f,0<=f.block_start?f.block_start:-1,f.strstart-f.block_start,ie),f.block_start=f.strstart,Y(f.strm)}function Fe(f,ie){f.pending_buf[f.pending++]=ie}function Te(f,ie){f.pending_buf[f.pending++]=ie>>>8&255,f.pending_buf[f.pending++]=255&ie}function Ee(f,ie){var Q,x,N=f.max_chain_length,J=f.strstart,ue=f.prev_length,me=f.nice_match,j=f.strstart>f.w_size-Ke?f.strstart-(f.w_size-Ke):0,Se=f.window,Ne=f.w_mask,Ae=f.prev,De=f.strstart+_e,lt=Se[J+ue-1],Xe=Se[J+ue];f.prev_length>=f.good_match&&(N>>=2),me>f.lookahead&&(me=f.lookahead);do{if(Se[(Q=ie)+ue]===Xe&&Se[Q+ue-1]===lt&&Se[Q]===Se[J]&&Se[++Q]===Se[J+1]){J+=2,Q++;do{}while(Se[++J]===Se[++Q]&&Se[++J]===Se[++Q]&&Se[++J]===Se[++Q]&&Se[++J]===Se[++Q]&&Se[++J]===Se[++Q]&&Se[++J]===Se[++Q]&&Se[++J]===Se[++Q]&&Se[++J]===Se[++Q]&&J<De);if(x=_e-(De-J),J=De-_e,ue<x){if(f.match_start=ie,me<=(ue=x))break;lt=Se[J+ue-1],Xe=Se[J+ue]}}}while((ie=Ae[ie&Ne])>j&&0!=--N);return ue<=f.lookahead?ue:f.lookahead}function ut(f){var ie,Q,x,N,J,ue,me,j,Se,Ne,Ae=f.w_size;do{if(N=f.window_size-f.lookahead-f.strstart,f.strstart>=Ae+(Ae-Ke)){for(r.arraySet(f.window,f.window,Ae,Ae,0),f.match_start-=Ae,f.strstart-=Ae,f.block_start-=Ae,ie=Q=f.hash_size;x=f.head[--ie],f.head[ie]=Ae<=x?x-Ae:0,--Q;);for(ie=Q=Ae;x=f.prev[--ie],f.prev[ie]=Ae<=x?x-Ae:0,--Q;);N+=Ae}if(0===f.strm.avail_in)break;if(me=f.window,j=f.strstart+f.lookahead,Ne=void 0,(Se=N)<(Ne=(ue=f.strm).avail_in)&&(Ne=Se),Q=0===Ne?0:(ue.avail_in-=Ne,r.arraySet(me,ue.input,ue.next_in,Ne,j),1===ue.state.wrap?ue.adler=E(ue.adler,me,Ne,j):2===ue.state.wrap&&(ue.adler=O(ue.adler,me,Ne,j)),ue.next_in+=Ne,ue.total_in+=Ne,Ne),f.lookahead+=Q,f.lookahead+f.insert>=3)for(f.ins_h=f.window[J=f.strstart-f.insert],f.ins_h=(f.ins_h<<f.hash_shift^f.window[J+1])&f.hash_mask;f.insert&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[J+3-1])&f.hash_mask,f.prev[J&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=J,J++,f.insert--,!(f.lookahead+f.insert<3)););}while(f.lookahead<Ke&&0!==f.strm.avail_in)}function Et(f,ie){for(var Q,x;;){if(f.lookahead<Ke){if(ut(f),f.lookahead<Ke&&0===ie)return 1;if(0===f.lookahead)break}if(Q=0,f.lookahead>=3&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,Q=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),0!==Q&&f.strstart-Q<=f.w_size-Ke&&(f.match_length=Ee(f,Q)),f.match_length>=3)if(x=b._tr_tally(f,f.strstart-f.match_start,f.match_length-3),f.lookahead-=f.match_length,f.match_length<=f.max_lazy_match&&f.lookahead>=3){for(f.match_length--;f.strstart++,f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,Q=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart,0!=--f.match_length;);f.strstart++}else f.strstart+=f.match_length,f.match_length=0,f.ins_h=f.window[f.strstart],f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+1])&f.hash_mask;else x=b._tr_tally(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++;if(x&&(Z(f,!1),0===f.strm.avail_out))return 1}return f.insert=f.strstart<2?f.strstart:2,4===ie?(Z(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(Z(f,!1),0===f.strm.avail_out)?1:2}function Pe(f,ie){for(var Q,x,N;;){if(f.lookahead<Ke){if(ut(f),f.lookahead<Ke&&0===ie)return 1;if(0===f.lookahead)break}if(Q=0,f.lookahead>=3&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,Q=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),f.prev_length=f.match_length,f.prev_match=f.match_start,f.match_length=2,0!==Q&&f.prev_length<f.max_lazy_match&&f.strstart-Q<=f.w_size-Ke&&(f.match_length=Ee(f,Q),f.match_length<=5&&(1===f.strategy||3===f.match_length&&4096<f.strstart-f.match_start)&&(f.match_length=2)),f.prev_length>=3&&f.match_length<=f.prev_length){for(N=f.strstart+f.lookahead-3,x=b._tr_tally(f,f.strstart-1-f.prev_match,f.prev_length-3),f.lookahead-=f.prev_length-1,f.prev_length-=2;++f.strstart<=N&&(f.ins_h=(f.ins_h<<f.hash_shift^f.window[f.strstart+3-1])&f.hash_mask,Q=f.prev[f.strstart&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=f.strstart),0!=--f.prev_length;);if(f.match_available=0,f.match_length=2,f.strstart++,x&&(Z(f,!1),0===f.strm.avail_out))return 1}else if(f.match_available){if((x=b._tr_tally(f,0,f.window[f.strstart-1]))&&Z(f,!1),f.strstart++,f.lookahead--,0===f.strm.avail_out)return 1}else f.match_available=1,f.strstart++,f.lookahead--}return f.match_available&&(x=b._tr_tally(f,0,f.window[f.strstart-1]),f.match_available=0),f.insert=f.strstart<2?f.strstart:2,4===ie?(Z(f,!0),0===f.strm.avail_out?3:4):f.last_lit&&(Z(f,!1),0===f.strm.avail_out)?1:2}function st(f,ie,Q,x,N){this.good_length=f,this.max_lazy=ie,this.nice_length=Q,this.max_chain=x,this.func=N}function It(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),$e(this.dyn_ltree),$e(this.dyn_dtree),$e(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),$e(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),$e(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function wt(f){var ie;return f&&f.state?(f.total_in=f.total_out=0,f.data_type=2,(ie=f.state).pending=0,ie.pending_out=0,ie.wrap<0&&(ie.wrap=-ie.wrap),ie.status=ie.wrap?42:113,f.adler=2===ie.wrap?0:1,ie.last_flush=0,b._tr_init(ie),0):We(f,g)}function Wt(f){var Q,ie=wt(f);return 0===ie&&((Q=f.state).window_size=2*Q.w_size,$e(Q.head),Q.max_lazy_match=_[Q.level].max_lazy,Q.good_match=_[Q.level].good_length,Q.nice_match=_[Q.level].nice_length,Q.max_chain_length=_[Q.level].max_chain,Q.strstart=0,Q.block_start=0,Q.lookahead=0,Q.insert=0,Q.match_length=Q.prev_length=2,Q.match_available=0,Q.ins_h=0),ie}function Kt(f,ie,Q,x,N,J){if(!f)return g;var ue=1;if(-1===ie&&(ie=6),x<0?(ue=0,x=-x):15<x&&(ue=2,x-=16),N<1||9<N||8!==Q||x<8||15<x||ie<0||9<ie||J<0||4<J)return We(f,g);8===x&&(x=9);var me=new It;return(f.state=me).strm=f,me.wrap=ue,me.gzhead=null,me.w_bits=x,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=N+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+3-1)/3),me.window=new r.Buf8(2*me.w_size),me.head=new r.Buf16(me.hash_size),me.prev=new r.Buf16(me.w_size),me.lit_bufsize=1<<N+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new r.Buf8(me.pending_buf_size),me.d_buf=1*me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=ie,me.strategy=J,me.method=Q,Wt(f)}_=[new st(0,0,0,0,function(f,ie){var Q=65535;for(Q>f.pending_buf_size-5&&(Q=f.pending_buf_size-5);;){if(f.lookahead<=1){if(ut(f),0===f.lookahead&&0===ie)return 1;if(0===f.lookahead)break}f.strstart+=f.lookahead,f.lookahead=0;var x=f.block_start+Q;if((0===f.strstart||f.strstart>=x)&&(f.lookahead=f.strstart-x,f.strstart=x,Z(f,!1),0===f.strm.avail_out)||f.strstart-f.block_start>=f.w_size-Ke&&(Z(f,!1),0===f.strm.avail_out))return 1}return f.insert=0,4===ie?(Z(f,!0),0===f.strm.avail_out?3:4):(f.strstart>f.block_start&&Z(f,!1),1)}),new st(4,4,8,4,Et),new st(4,5,16,8,Et),new st(4,6,32,32,Et),new st(4,4,16,16,Pe),new st(8,16,32,32,Pe),new st(8,16,128,128,Pe),new st(8,32,128,256,Pe),new st(32,128,258,1024,Pe),new st(32,258,258,4096,Pe)],D.deflateInit=function(f,ie){return Kt(f,ie,8,15,8,0)},D.deflateInit2=Kt,D.deflateReset=Wt,D.deflateResetKeep=wt,D.deflateSetHeader=function(f,ie){return f&&f.state?2!==f.state.wrap?g:(f.state.gzhead=ie,0):g},D.deflate=function(f,ie){var Q,x,N,J;if(!f||!f.state||5<ie||ie<0)return f?We(f,g):g;if(x=f.state,!f.output||!f.input&&0!==f.avail_in||666===x.status&&4!==ie)return We(f,0===f.avail_out?-5:g);if(x.strm=f,Q=x.last_flush,x.last_flush=ie,42===x.status)if(2===x.wrap)f.adler=0,Fe(x,31),Fe(x,139),Fe(x,8),x.gzhead?(Fe(x,(x.gzhead.text?1:0)+(x.gzhead.hcrc?2:0)+(x.gzhead.extra?4:0)+(x.gzhead.name?8:0)+(x.gzhead.comment?16:0)),Fe(x,255&x.gzhead.time),Fe(x,x.gzhead.time>>8&255),Fe(x,x.gzhead.time>>16&255),Fe(x,x.gzhead.time>>24&255),Fe(x,9===x.level?2:2<=x.strategy||x.level<2?4:0),Fe(x,255&x.gzhead.os),x.gzhead.extra&&x.gzhead.extra.length&&(Fe(x,255&x.gzhead.extra.length),Fe(x,x.gzhead.extra.length>>8&255)),x.gzhead.hcrc&&(f.adler=O(f.adler,x.pending_buf,x.pending,0)),x.gzindex=0,x.status=69):(Fe(x,0),Fe(x,0),Fe(x,0),Fe(x,0),Fe(x,0),Fe(x,9===x.level?2:2<=x.strategy||x.level<2?4:0),Fe(x,3),x.status=113);else{var ue=8+(x.w_bits-8<<4)<<8;ue|=(2<=x.strategy||x.level<2?0:x.level<6?1:6===x.level?2:3)<<6,0!==x.strstart&&(ue|=32),ue+=31-ue%31,x.status=113,Te(x,ue),0!==x.strstart&&(Te(x,f.adler>>>16),Te(x,65535&f.adler)),f.adler=1}if(69===x.status)if(x.gzhead.extra){for(N=x.pending;x.gzindex<(65535&x.gzhead.extra.length)&&(x.pending!==x.pending_buf_size||(x.gzhead.hcrc&&x.pending>N&&(f.adler=O(f.adler,x.pending_buf,x.pending-N,N)),Y(f),N=x.pending,x.pending!==x.pending_buf_size));)Fe(x,255&x.gzhead.extra[x.gzindex]),x.gzindex++;x.gzhead.hcrc&&x.pending>N&&(f.adler=O(f.adler,x.pending_buf,x.pending-N,N)),x.gzindex===x.gzhead.extra.length&&(x.gzindex=0,x.status=73)}else x.status=73;if(73===x.status)if(x.gzhead.name){N=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>N&&(f.adler=O(f.adler,x.pending_buf,x.pending-N,N)),Y(f),N=x.pending,x.pending===x.pending_buf_size)){J=1;break}J=x.gzindex<x.gzhead.name.length?255&x.gzhead.name.charCodeAt(x.gzindex++):0,Fe(x,J)}while(0!==J);x.gzhead.hcrc&&x.pending>N&&(f.adler=O(f.adler,x.pending_buf,x.pending-N,N)),0===J&&(x.gzindex=0,x.status=91)}else x.status=91;if(91===x.status)if(x.gzhead.comment){N=x.pending;do{if(x.pending===x.pending_buf_size&&(x.gzhead.hcrc&&x.pending>N&&(f.adler=O(f.adler,x.pending_buf,x.pending-N,N)),Y(f),N=x.pending,x.pending===x.pending_buf_size)){J=1;break}J=x.gzindex<x.gzhead.comment.length?255&x.gzhead.comment.charCodeAt(x.gzindex++):0,Fe(x,J)}while(0!==J);x.gzhead.hcrc&&x.pending>N&&(f.adler=O(f.adler,x.pending_buf,x.pending-N,N)),0===J&&(x.status=103)}else x.status=103;if(103===x.status&&(x.gzhead.hcrc?(x.pending+2>x.pending_buf_size&&Y(f),x.pending+2<=x.pending_buf_size&&(Fe(x,255&f.adler),Fe(x,f.adler>>8&255),f.adler=0,x.status=113)):x.status=113),0!==x.pending){if(Y(f),0===f.avail_out)return x.last_flush=-1,0}else if(0===f.avail_in&&we(ie)<=we(Q)&&4!==ie)return We(f,-5);if(666===x.status&&0!==f.avail_in)return We(f,-5);if(0!==f.avail_in||0!==x.lookahead||0!==ie&&666!==x.status){var me=2===x.strategy?function(j,Se){for(var Ne;;){if(0===j.lookahead&&(ut(j),0===j.lookahead)){if(0===Se)return 1;break}if(j.match_length=0,Ne=b._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++,Ne&&(Z(j,!1),0===j.strm.avail_out))return 1}return j.insert=0,4===Se?(Z(j,!0),0===j.strm.avail_out?3:4):j.last_lit&&(Z(j,!1),0===j.strm.avail_out)?1:2}(x,ie):3===x.strategy?function(j,Se){for(var Ne,Ae,De,lt,Xe=j.window;;){if(j.lookahead<=_e){if(ut(j),j.lookahead<=_e&&0===Se)return 1;if(0===j.lookahead)break}if(j.match_length=0,j.lookahead>=3&&0<j.strstart&&(Ae=Xe[De=j.strstart-1])===Xe[++De]&&Ae===Xe[++De]&&Ae===Xe[++De]){lt=j.strstart+_e;do{}while(Ae===Xe[++De]&&Ae===Xe[++De]&&Ae===Xe[++De]&&Ae===Xe[++De]&&Ae===Xe[++De]&&Ae===Xe[++De]&&Ae===Xe[++De]&&Ae===Xe[++De]&&De<lt);j.match_length=_e-(lt-De),j.match_length>j.lookahead&&(j.match_length=j.lookahead)}if(j.match_length>=3?(Ne=b._tr_tally(j,1,j.match_length-3),j.lookahead-=j.match_length,j.strstart+=j.match_length,j.match_length=0):(Ne=b._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++),Ne&&(Z(j,!1),0===j.strm.avail_out))return 1}return j.insert=0,4===Se?(Z(j,!0),0===j.strm.avail_out?3:4):j.last_lit&&(Z(j,!1),0===j.strm.avail_out)?1:2}(x,ie):_[x.level].func(x,ie);if(3!==me&&4!==me||(x.status=666),1===me||3===me)return 0===f.avail_out&&(x.last_flush=-1),0;if(2===me&&(1===ie?b._tr_align(x):5!==ie&&(b._tr_stored_block(x,0,0,!1),3===ie&&($e(x.head),0===x.lookahead&&(x.strstart=0,x.block_start=0,x.insert=0))),Y(f),0===f.avail_out))return x.last_flush=-1,0}return 4!==ie?0:x.wrap<=0?1:(2===x.wrap?(Fe(x,255&f.adler),Fe(x,f.adler>>8&255),Fe(x,f.adler>>16&255),Fe(x,f.adler>>24&255),Fe(x,255&f.total_in),Fe(x,f.total_in>>8&255),Fe(x,f.total_in>>16&255),Fe(x,f.total_in>>24&255)):(Te(x,f.adler>>>16),Te(x,65535&f.adler)),Y(f),0<x.wrap&&(x.wrap=-x.wrap),0!==x.pending?0:1)},D.deflateEnd=function(f){var ie;return f&&f.state?42!==(ie=f.state.status)&&69!==ie&&73!==ie&&91!==ie&&103!==ie&&113!==ie&&666!==ie?We(f,g):(f.state=null,113===ie?We(f,-3):0):g},D.deflateSetDictionary=function(f,ie){var Q,x,N,J,ue,me,j,Se,Ne=ie.length;if(!f||!f.state||2===(J=(Q=f.state).wrap)||1===J&&42!==Q.status||Q.lookahead)return g;for(1===J&&(f.adler=E(f.adler,ie,Ne,0)),Q.wrap=0,Ne>=Q.w_size&&(0===J&&($e(Q.head),Q.strstart=0,Q.block_start=0,Q.insert=0),Se=new r.Buf8(Q.w_size),r.arraySet(Se,ie,Ne-Q.w_size,Q.w_size,0),ie=Se,Ne=Q.w_size),ue=f.avail_in,me=f.next_in,j=f.input,f.avail_in=Ne,f.next_in=0,f.input=ie,ut(Q);Q.lookahead>=3;){for(x=Q.strstart,N=Q.lookahead-2;Q.ins_h=(Q.ins_h<<Q.hash_shift^Q.window[x+3-1])&Q.hash_mask,Q.prev[x&Q.w_mask]=Q.head[Q.ins_h],Q.head[Q.ins_h]=x,x++,--N;);Q.strstart=x,Q.lookahead=2,ut(Q)}return Q.strstart+=Q.lookahead,Q.block_start=Q.strstart,Q.insert=Q.lookahead,Q.lookahead=0,Q.match_length=Q.prev_length=2,Q.match_available=0,f.next_in=me,f.input=j,f.avail_in=ue,Q.wrap=J,0},D.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(T,M,D){"use strict";M.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(T,M,D){"use strict";M.exports=function(_,r){var b,E,O,w,I,A,d,g,c,p,v,C,U,L,H,te,X,K,ee,_e,Ke,P,se,y,oe;y=_.input,O=(E=_.next_in)+(_.avail_in-5),oe=_.output,I=(w=_.next_out)-(r-_.avail_out),A=w+(_.avail_out-257),d=(b=_.state).dmax,g=b.wsize,c=b.whave,p=b.wnext,v=b.window,C=b.hold,U=b.bits,L=b.lencode,H=b.distcode,te=(1<<b.lenbits)-1,X=(1<<b.distbits)-1;e:do{U<15&&(C+=y[E++]<<U,C+=y[E++]<<(U+=8),U+=8),K=L[C&te];t:for(;;){if(C>>>=ee=K>>>24,U-=ee,0==(ee=K>>>16&255))oe[w++]=65535&K;else{if(!(16&ee)){if(0==(64&ee)){K=L[(65535&K)+(C&(1<<ee)-1)];continue t}if(32&ee){b.mode=12;break e}_.msg="invalid literal/length code",b.mode=30;break e}_e=65535&K,(ee&=15)&&(U<ee&&(C+=y[E++]<<U,U+=8),_e+=C&(1<<ee)-1,C>>>=ee,U-=ee),U<15&&(C+=y[E++]<<U,C+=y[E++]<<(U+=8),U+=8),K=H[C&X];s:for(;;){if(C>>>=ee=K>>>24,U-=ee,!(16&(ee=K>>>16&255))){if(0==(64&ee)){K=H[(65535&K)+(C&(1<<ee)-1)];continue s}_.msg="invalid distance code",b.mode=30;break e}if(Ke=65535&K,U<(ee&=15)&&(C+=y[E++]<<U,(U+=8)<ee&&(C+=y[E++]<<U,U+=8)),d<(Ke+=C&(1<<ee)-1)){_.msg="invalid distance too far back",b.mode=30;break e}if(C>>>=ee,U-=ee,(ee=w-I)<Ke){if(c<(ee=Ke-ee)&&b.sane){_.msg="invalid distance too far back",b.mode=30;break e}if(se=v,(P=0)===p){if(P+=g-ee,ee<_e){for(_e-=ee;oe[w++]=v[P++],--ee;);P=w-Ke,se=oe}}else if(p<ee){if(P+=g+p-ee,(ee-=p)<_e){for(_e-=ee;oe[w++]=v[P++],--ee;);if(P=0,p<_e){for(_e-=ee=p;oe[w++]=v[P++],--ee;);P=w-Ke,se=oe}}}else if(P+=p-ee,ee<_e){for(_e-=ee;oe[w++]=v[P++],--ee;);P=w-Ke,se=oe}for(;2<_e;)oe[w++]=se[P++],oe[w++]=se[P++],oe[w++]=se[P++],_e-=3;_e&&(oe[w++]=se[P++],1<_e&&(oe[w++]=se[P++]))}else{for(P=w-Ke;oe[w++]=oe[P++],oe[w++]=oe[P++],oe[w++]=oe[P++],2<(_e-=3););_e&&(oe[w++]=oe[P++],1<_e&&(oe[w++]=oe[P++]))}break}}break}}while(E<O&&w<A);E-=_e=U>>3,C&=(1<<(U-=_e<<3))-1,_.next_in=E,_.next_out=w,_.avail_in=E<O?O-E+5:5-(E-O),_.avail_out=w<A?A-w+257:257-(w-A),b.hold=C,b.bits=U}},{}],49:[function(T,M,D){"use strict";var _=T("../utils/common"),r=T("./adler32"),b=T("./crc32"),E=T("./inffast"),O=T("./inftrees"),d=-2;function v(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}function C(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new _.Buf16(320),this.work=new _.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function U(P){var se;return P&&P.state?(P.total_in=P.total_out=(se=P.state).total=0,P.msg="",se.wrap&&(P.adler=1&se.wrap),se.mode=1,se.last=0,se.havedict=0,se.dmax=32768,se.head=null,se.hold=0,se.bits=0,se.lencode=se.lendyn=new _.Buf32(852),se.distcode=se.distdyn=new _.Buf32(592),se.sane=1,se.back=-1,0):d}function L(P){var se;return P&&P.state?((se=P.state).wsize=0,se.whave=0,se.wnext=0,U(P)):d}function H(P,se){var y,oe;return P&&P.state?(oe=P.state,se<0?(y=0,se=-se):(y=1+(se>>4),se<48&&(se&=15)),se&&(se<8||15<se)?d:(null!==oe.window&&oe.wbits!==se&&(oe.window=null),oe.wrap=y,oe.wbits=se,L(P))):d}function te(P,se){var y,oe;return P?(oe=new C,(P.state=oe).window=null,0!==(y=H(P,se))&&(P.state=null),y):d}var X,K,ee=!0;function _e(P){if(ee){var se;for(X=new _.Buf32(512),K=new _.Buf32(32),se=0;se<144;)P.lens[se++]=8;for(;se<256;)P.lens[se++]=9;for(;se<280;)P.lens[se++]=7;for(;se<288;)P.lens[se++]=8;for(O(1,P.lens,0,288,X,0,P.work,{bits:9}),se=0;se<32;)P.lens[se++]=5;O(2,P.lens,0,32,K,0,P.work,{bits:5}),ee=!1}P.lencode=X,P.lenbits=9,P.distcode=K,P.distbits=5}function Ke(P,se,y,oe){var Me,pe=P.state;return null===pe.window&&(pe.wsize=1<<pe.wbits,pe.wnext=0,pe.whave=0,pe.window=new _.Buf8(pe.wsize)),oe>=pe.wsize?(_.arraySet(pe.window,se,y-pe.wsize,pe.wsize,0),pe.wnext=0,pe.whave=pe.wsize):(oe<(Me=pe.wsize-pe.wnext)&&(Me=oe),_.arraySet(pe.window,se,y-oe,Me,pe.wnext),(oe-=Me)?(_.arraySet(pe.window,se,y-oe,oe,0),pe.wnext=oe,pe.whave=pe.wsize):(pe.wnext+=Me,pe.wnext===pe.wsize&&(pe.wnext=0),pe.whave<pe.wsize&&(pe.whave+=Me))),0}D.inflateReset=L,D.inflateReset2=H,D.inflateResetKeep=U,D.inflateInit=function(P){return te(P,15)},D.inflateInit2=te,D.inflate=function(P,se){var y,oe,Me,pe,We,we,$e,Y,Z,Fe,Te,Ee,ut,Et,Pe,st,It,wt,Wt,Kt,f,ie,Q,x,N=0,J=new _.Buf8(4),ue=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&0!==P.avail_in)return d;12===(y=P.state).mode&&(y.mode=13),We=P.next_out,Me=P.output,pe=P.next_in,oe=P.input,Y=y.hold,Z=y.bits,Fe=we=P.avail_in,Te=$e=P.avail_out,ie=0;e:for(;;)switch(y.mode){case 1:if(0===y.wrap){y.mode=13;break}for(;Z<16;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(2&y.wrap&&35615===Y){J[y.check=0]=255&Y,J[1]=Y>>>8&255,y.check=b(y.check,J,2,0),Z=Y=0,y.mode=2;break}if(y.flags=0,y.head&&(y.head.done=!1),!(1&y.wrap)||(((255&Y)<<8)+(Y>>8))%31){P.msg="incorrect header check",y.mode=30;break}if(8!=(15&Y)){P.msg="unknown compression method",y.mode=30;break}if(Z-=4,f=8+(15&(Y>>>=4)),0===y.wbits)y.wbits=f;else if(f>y.wbits){P.msg="invalid window size",y.mode=30;break}y.dmax=1<<f,P.adler=y.check=1,y.mode=512&Y?10:12,Z=Y=0;break;case 2:for(;Z<16;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(y.flags=Y,8!=(255&y.flags)){P.msg="unknown compression method",y.mode=30;break}if(57344&y.flags){P.msg="unknown header flags set",y.mode=30;break}y.head&&(y.head.text=Y>>8&1),512&y.flags&&(J[0]=255&Y,J[1]=Y>>>8&255,y.check=b(y.check,J,2,0)),Z=Y=0,y.mode=3;case 3:for(;Z<32;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}y.head&&(y.head.time=Y),512&y.flags&&(J[0]=255&Y,J[1]=Y>>>8&255,J[2]=Y>>>16&255,J[3]=Y>>>24&255,y.check=b(y.check,J,4,0)),Z=Y=0,y.mode=4;case 4:for(;Z<16;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}y.head&&(y.head.xflags=255&Y,y.head.os=Y>>8),512&y.flags&&(J[0]=255&Y,J[1]=Y>>>8&255,y.check=b(y.check,J,2,0)),Z=Y=0,y.mode=5;case 5:if(1024&y.flags){for(;Z<16;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}y.length=Y,y.head&&(y.head.extra_len=Y),512&y.flags&&(J[0]=255&Y,J[1]=Y>>>8&255,y.check=b(y.check,J,2,0)),Z=Y=0}else y.head&&(y.head.extra=null);y.mode=6;case 6:if(1024&y.flags&&(we<(Ee=y.length)&&(Ee=we),Ee&&(y.head&&(f=y.head.extra_len-y.length,y.head.extra||(y.head.extra=new Array(y.head.extra_len)),_.arraySet(y.head.extra,oe,pe,Ee,f)),512&y.flags&&(y.check=b(y.check,oe,Ee,pe)),we-=Ee,pe+=Ee,y.length-=Ee),y.length))break e;y.length=0,y.mode=7;case 7:if(2048&y.flags){if(0===we)break e;for(Ee=0;f=oe[pe+Ee++],y.head&&f&&y.length<65536&&(y.head.name+=String.fromCharCode(f)),f&&Ee<we;);if(512&y.flags&&(y.check=b(y.check,oe,Ee,pe)),we-=Ee,pe+=Ee,f)break e}else y.head&&(y.head.name=null);y.length=0,y.mode=8;case 8:if(4096&y.flags){if(0===we)break e;for(Ee=0;f=oe[pe+Ee++],y.head&&f&&y.length<65536&&(y.head.comment+=String.fromCharCode(f)),f&&Ee<we;);if(512&y.flags&&(y.check=b(y.check,oe,Ee,pe)),we-=Ee,pe+=Ee,f)break e}else y.head&&(y.head.comment=null);y.mode=9;case 9:if(512&y.flags){for(;Z<16;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(Y!==(65535&y.check)){P.msg="header crc mismatch",y.mode=30;break}Z=Y=0}y.head&&(y.head.hcrc=y.flags>>9&1,y.head.done=!0),P.adler=y.check=0,y.mode=12;break;case 10:for(;Z<32;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}P.adler=y.check=v(Y),Z=Y=0,y.mode=11;case 11:if(0===y.havedict)return P.next_out=We,P.avail_out=$e,P.next_in=pe,P.avail_in=we,y.hold=Y,y.bits=Z,2;P.adler=y.check=1,y.mode=12;case 12:if(5===se||6===se)break e;case 13:if(y.last){Y>>>=7&Z,Z-=7&Z,y.mode=27;break}for(;Z<3;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}switch(y.last=1&Y,Z-=1,3&(Y>>>=1)){case 0:y.mode=14;break;case 1:if(_e(y),y.mode=20,6!==se)break;Y>>>=2,Z-=2;break e;case 2:y.mode=17;break;case 3:P.msg="invalid block type",y.mode=30}Y>>>=2,Z-=2;break;case 14:for(Y>>>=7&Z,Z-=7&Z;Z<32;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if((65535&Y)!=(Y>>>16^65535)){P.msg="invalid stored block lengths",y.mode=30;break}if(y.length=65535&Y,Z=Y=0,y.mode=15,6===se)break e;case 15:y.mode=16;case 16:if(Ee=y.length){if(we<Ee&&(Ee=we),$e<Ee&&(Ee=$e),0===Ee)break e;_.arraySet(Me,oe,pe,Ee,We),we-=Ee,pe+=Ee,$e-=Ee,We+=Ee,y.length-=Ee;break}y.mode=12;break;case 17:for(;Z<14;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(y.nlen=257+(31&Y),Z-=5,y.ndist=1+(31&(Y>>>=5)),Z-=5,y.ncode=4+(15&(Y>>>=5)),Y>>>=4,Z-=4,286<y.nlen||30<y.ndist){P.msg="too many length or distance symbols",y.mode=30;break}y.have=0,y.mode=18;case 18:for(;y.have<y.ncode;){for(;Z<3;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}y.lens[ue[y.have++]]=7&Y,Y>>>=3,Z-=3}for(;y.have<19;)y.lens[ue[y.have++]]=0;if(y.lencode=y.lendyn,y.lenbits=7,ie=O(0,y.lens,0,19,y.lencode,0,y.work,Q={bits:y.lenbits}),y.lenbits=Q.bits,ie){P.msg="invalid code lengths set",y.mode=30;break}y.have=0,y.mode=19;case 19:for(;y.have<y.nlen+y.ndist;){for(;st=(N=y.lencode[Y&(1<<y.lenbits)-1])>>>16&255,It=65535&N,!((Pe=N>>>24)<=Z);){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(It<16)Y>>>=Pe,Z-=Pe,y.lens[y.have++]=It;else{if(16===It){for(x=Pe+2;Z<x;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(Y>>>=Pe,Z-=Pe,0===y.have){P.msg="invalid bit length repeat",y.mode=30;break}f=y.lens[y.have-1],Ee=3+(3&Y),Y>>>=2,Z-=2}else if(17===It){for(x=Pe+3;Z<x;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}Z-=Pe,f=0,Ee=3+(7&(Y>>>=Pe)),Y>>>=3,Z-=3}else{for(x=Pe+7;Z<x;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}Z-=Pe,f=0,Ee=11+(127&(Y>>>=Pe)),Y>>>=7,Z-=7}if(y.have+Ee>y.nlen+y.ndist){P.msg="invalid bit length repeat",y.mode=30;break}for(;Ee--;)y.lens[y.have++]=f}}if(30===y.mode)break;if(0===y.lens[256]){P.msg="invalid code -- missing end-of-block",y.mode=30;break}if(y.lenbits=9,ie=O(1,y.lens,0,y.nlen,y.lencode,0,y.work,Q={bits:y.lenbits}),y.lenbits=Q.bits,ie){P.msg="invalid literal/lengths set",y.mode=30;break}if(y.distbits=6,y.distcode=y.distdyn,ie=O(2,y.lens,y.nlen,y.ndist,y.distcode,0,y.work,Q={bits:y.distbits}),y.distbits=Q.bits,ie){P.msg="invalid distances set",y.mode=30;break}if(y.mode=20,6===se)break e;case 20:y.mode=21;case 21:if(6<=we&&258<=$e){P.next_out=We,P.avail_out=$e,P.next_in=pe,P.avail_in=we,y.hold=Y,y.bits=Z,E(P,Te),We=P.next_out,Me=P.output,$e=P.avail_out,pe=P.next_in,oe=P.input,we=P.avail_in,Y=y.hold,Z=y.bits,12===y.mode&&(y.back=-1);break}for(y.back=0;st=(N=y.lencode[Y&(1<<y.lenbits)-1])>>>16&255,It=65535&N,!((Pe=N>>>24)<=Z);){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(st&&0==(240&st)){for(wt=Pe,Wt=st,Kt=It;st=(N=y.lencode[Kt+((Y&(1<<wt+Wt)-1)>>wt)])>>>16&255,It=65535&N,!(wt+(Pe=N>>>24)<=Z);){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}Y>>>=wt,Z-=wt,y.back+=wt}if(Y>>>=Pe,Z-=Pe,y.back+=Pe,y.length=It,0===st){y.mode=26;break}if(32&st){y.back=-1,y.mode=12;break}if(64&st){P.msg="invalid literal/length code",y.mode=30;break}y.extra=15&st,y.mode=22;case 22:if(y.extra){for(x=y.extra;Z<x;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}y.length+=Y&(1<<y.extra)-1,Y>>>=y.extra,Z-=y.extra,y.back+=y.extra}y.was=y.length,y.mode=23;case 23:for(;st=(N=y.distcode[Y&(1<<y.distbits)-1])>>>16&255,It=65535&N,!((Pe=N>>>24)<=Z);){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(0==(240&st)){for(wt=Pe,Wt=st,Kt=It;st=(N=y.distcode[Kt+((Y&(1<<wt+Wt)-1)>>wt)])>>>16&255,It=65535&N,!(wt+(Pe=N>>>24)<=Z);){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}Y>>>=wt,Z-=wt,y.back+=wt}if(Y>>>=Pe,Z-=Pe,y.back+=Pe,64&st){P.msg="invalid distance code",y.mode=30;break}y.offset=It,y.extra=15&st,y.mode=24;case 24:if(y.extra){for(x=y.extra;Z<x;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}y.offset+=Y&(1<<y.extra)-1,Y>>>=y.extra,Z-=y.extra,y.back+=y.extra}if(y.offset>y.dmax){P.msg="invalid distance too far back",y.mode=30;break}y.mode=25;case 25:if(0===$e)break e;if(y.offset>(Ee=Te-$e)){if((Ee=y.offset-Ee)>y.whave&&y.sane){P.msg="invalid distance too far back",y.mode=30;break}ut=Ee>y.wnext?y.wsize-(Ee-=y.wnext):y.wnext-Ee,Ee>y.length&&(Ee=y.length),Et=y.window}else Et=Me,ut=We-y.offset,Ee=y.length;for($e<Ee&&(Ee=$e),$e-=Ee,y.length-=Ee;Me[We++]=Et[ut++],--Ee;);0===y.length&&(y.mode=21);break;case 26:if(0===$e)break e;Me[We++]=y.length,$e--,y.mode=21;break;case 27:if(y.wrap){for(;Z<32;){if(0===we)break e;we--,Y|=oe[pe++]<<Z,Z+=8}if(P.total_out+=Te-=$e,y.total+=Te,Te&&(P.adler=y.check=y.flags?b(y.check,Me,Te,We-Te):r(y.check,Me,Te,We-Te)),Te=$e,(y.flags?Y:v(Y))!==y.check){P.msg="incorrect data check",y.mode=30;break}Z=Y=0}y.mode=28;case 28:if(y.wrap&&y.flags){for(;Z<32;){if(0===we)break e;we--,Y+=oe[pe++]<<Z,Z+=8}if(Y!==(4294967295&y.total)){P.msg="incorrect length check",y.mode=30;break}Z=Y=0}y.mode=29;case 29:ie=1;break e;case 30:ie=-3;break e;case 31:return-4;default:return d}return P.next_out=We,P.avail_out=$e,P.next_in=pe,P.avail_in=we,y.hold=Y,y.bits=Z,(y.wsize||Te!==P.avail_out&&y.mode<30&&(y.mode<27||4!==se))&&Ke(P,P.output,P.next_out,Te-P.avail_out)?(y.mode=31,-4):(Te-=P.avail_out,P.total_in+=Fe-=P.avail_in,P.total_out+=Te,y.total+=Te,y.wrap&&Te&&(P.adler=y.check=y.flags?b(y.check,Me,Te,P.next_out-Te):r(y.check,Me,Te,P.next_out-Te)),P.data_type=y.bits+(y.last?64:0)+(12===y.mode?128:0)+(20===y.mode||15===y.mode?256:0),(0==Fe&&0===Te||4===se)&&0===ie&&(ie=-5),ie)},D.inflateEnd=function(P){if(!P||!P.state)return d;var se=P.state;return se.window&&(se.window=null),P.state=null,0},D.inflateGetHeader=function(P,se){var y;return P&&P.state?0==(2&(y=P.state).wrap)?d:((y.head=se).done=!1,0):d},D.inflateSetDictionary=function(P,se){var y,oe=se.length;return P&&P.state?0!==(y=P.state).wrap&&11!==y.mode?d:11===y.mode&&r(1,se,oe,0)!==y.check?-3:Ke(P,se,oe,oe)?(y.mode=31,-4):(y.havedict=1,0):d},D.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(T,M,D){"use strict";var _=T("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],b=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],E=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],O=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];M.exports=function(w,I,A,d,g,c,p,v){var C,U,L,H,te,X,K,ee,_e,Ke=v.bits,P=0,se=0,y=0,oe=0,Me=0,pe=0,We=0,we=0,$e=0,Y=0,Z=null,Fe=0,Te=new _.Buf16(16),Ee=new _.Buf16(16),ut=null,Et=0;for(P=0;P<=15;P++)Te[P]=0;for(se=0;se<d;se++)Te[I[A+se]]++;for(Me=Ke,oe=15;1<=oe&&0===Te[oe];oe--);if(oe<Me&&(Me=oe),0===oe)return g[c++]=20971520,g[c++]=20971520,v.bits=1,0;for(y=1;y<oe&&0===Te[y];y++);for(Me<y&&(Me=y),P=we=1;P<=15;P++)if(we<<=1,(we-=Te[P])<0)return-1;if(0<we&&(0===w||1!==oe))return-1;for(Ee[1]=0,P=1;P<15;P++)Ee[P+1]=Ee[P]+Te[P];for(se=0;se<d;se++)0!==I[A+se]&&(p[Ee[I[A+se]]++]=se);if(X=0===w?(Z=ut=p,19):1===w?(Z=r,Fe-=257,ut=b,Et-=257,256):(Z=E,ut=O,-1),P=y,te=c,We=se=Y=0,L=-1,H=($e=1<<(pe=Me))-1,1===w&&852<$e||2===w&&592<$e)return 1;for(;;){for(K=P-We,_e=p[se]<X?(ee=0,p[se]):p[se]>X?(ee=ut[Et+p[se]],Z[Fe+p[se]]):(ee=96,0),C=1<<P-We,y=U=1<<pe;g[te+(Y>>We)+(U-=C)]=K<<24|ee<<16|_e|0,0!==U;);for(C=1<<P-1;Y&C;)C>>=1;if(0!==C?(Y&=C-1,Y+=C):Y=0,se++,0==--Te[P]){if(P===oe)break;P=I[A+p[se]]}if(Me<P&&(Y&H)!==L){for(0===We&&(We=Me),te+=y,we=1<<(pe=P-We);pe+We<oe&&!((we-=Te[pe+We])<=0);)pe++,we<<=1;if($e+=1<<pe,1===w&&852<$e||2===w&&592<$e)return 1;g[L=Y&H]=Me<<24|pe<<16|te-c|0}}return 0!==Y&&(g[te+Y]=P-We<<24|64<<16|0),v.bits=Me,0}},{"../utils/common":41}],51:[function(T,M,D){"use strict";M.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(T,M,D){"use strict";var _=T("../utils/common");function E(N){for(var J=N.length;0<=--J;)N[J]=0}var I=256,A=286,d=30,p=15,X=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ee=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],_e=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Ke=new Array(576);E(Ke);var P=new Array(60);E(P);var se=new Array(512);E(se);var y=new Array(256);E(y);var oe=new Array(29);E(oe);var Me,pe,We,we=new Array(d);function $e(N,J,ue,me,j){this.static_tree=N,this.extra_bits=J,this.extra_base=ue,this.elems=me,this.max_length=j,this.has_stree=N&&N.length}function Y(N,J){this.dyn_tree=N,this.max_code=0,this.stat_desc=J}function Z(N){return N<256?se[N]:se[256+(N>>>7)]}function Fe(N,J){N.pending_buf[N.pending++]=255&J,N.pending_buf[N.pending++]=J>>>8&255}function Te(N,J,ue){N.bi_valid>16-ue?(N.bi_buf|=J<<N.bi_valid&65535,Fe(N,N.bi_buf),N.bi_buf=J>>16-N.bi_valid,N.bi_valid+=ue-16):(N.bi_buf|=J<<N.bi_valid&65535,N.bi_valid+=ue)}function Ee(N,J,ue){Te(N,ue[2*J],ue[2*J+1])}function ut(N,J){for(var ue=0;ue|=1&N,N>>>=1,ue<<=1,0<--J;);return ue>>>1}function Et(N,J,ue){var me,j,Se=new Array(16),Ne=0;for(me=1;me<=p;me++)Se[me]=Ne=Ne+ue[me-1]<<1;for(j=0;j<=J;j++){var Ae=N[2*j+1];0!==Ae&&(N[2*j]=ut(Se[Ae]++,Ae))}}function Pe(N){var J;for(J=0;J<A;J++)N.dyn_ltree[2*J]=0;for(J=0;J<d;J++)N.dyn_dtree[2*J]=0;for(J=0;J<19;J++)N.bl_tree[2*J]=0;N.dyn_ltree[512]=1,N.opt_len=N.static_len=0,N.last_lit=N.matches=0}function st(N){8<N.bi_valid?Fe(N,N.bi_buf):0<N.bi_valid&&(N.pending_buf[N.pending++]=N.bi_buf),N.bi_buf=0,N.bi_valid=0}function It(N,J,ue,me){var j=2*J,Se=2*ue;return N[j]<N[Se]||N[j]===N[Se]&&me[J]<=me[ue]}function wt(N,J,ue){for(var me=N.heap[ue],j=ue<<1;j<=N.heap_len&&(j<N.heap_len&&It(J,N.heap[j+1],N.heap[j],N.depth)&&j++,!It(J,me,N.heap[j],N.depth));)N.heap[ue]=N.heap[j],ue=j,j<<=1;N.heap[ue]=me}function Wt(N,J,ue){var me,j,Se,Ne,Ae=0;if(0!==N.last_lit)for(;me=N.pending_buf[N.d_buf+2*Ae]<<8|N.pending_buf[N.d_buf+2*Ae+1],j=N.pending_buf[N.l_buf+Ae],Ae++,0===me?Ee(N,j,J):(Ee(N,(Se=y[j])+I+1,J),0!==(Ne=X[Se])&&Te(N,j-=oe[Se],Ne),Ee(N,Se=Z(--me),ue),0!==(Ne=K[Se])&&Te(N,me-=we[Se],Ne)),Ae<N.last_lit;);Ee(N,256,J)}function Kt(N,J){var ue,me,j,Se=J.dyn_tree,Ne=J.stat_desc.static_tree,Ae=J.stat_desc.has_stree,De=J.stat_desc.elems,lt=-1;for(N.heap_len=0,N.heap_max=573,ue=0;ue<De;ue++)0!==Se[2*ue]?(N.heap[++N.heap_len]=lt=ue,N.depth[ue]=0):Se[2*ue+1]=0;for(;N.heap_len<2;)Se[2*(j=N.heap[++N.heap_len]=lt<2?++lt:0)]=1,N.depth[j]=0,N.opt_len--,Ae&&(N.static_len-=Ne[2*j+1]);for(J.max_code=lt,ue=N.heap_len>>1;1<=ue;ue--)wt(N,Se,ue);for(j=De;ue=N.heap[1],N.heap[1]=N.heap[N.heap_len--],wt(N,Se,1),me=N.heap[1],N.heap[--N.heap_max]=ue,N.heap[--N.heap_max]=me,Se[2*j]=Se[2*ue]+Se[2*me],N.depth[j]=(N.depth[ue]>=N.depth[me]?N.depth[ue]:N.depth[me])+1,Se[2*ue+1]=Se[2*me+1]=j,N.heap[1]=j++,wt(N,Se,1),2<=N.heap_len;);N.heap[--N.heap_max]=N.heap[1],function(Xe,Ft){var _r,Yt,Ar,St,Jn,ya,jt=Ft.dyn_tree,Kl=Ft.max_code,uc=Ft.stat_desc.static_tree,cc=Ft.stat_desc.has_stree,hc=Ft.stat_desc.extra_bits,jl=Ft.stat_desc.extra_base,kr=Ft.stat_desc.max_length,Kn=0;for(St=0;St<=p;St++)Xe.bl_count[St]=0;for(jt[2*Xe.heap[Xe.heap_max]+1]=0,_r=Xe.heap_max+1;_r<573;_r++)kr<(St=jt[2*jt[2*(Yt=Xe.heap[_r])+1]+1]+1)&&(St=kr,Kn++),jt[2*Yt+1]=St,Kl<Yt||(Xe.bl_count[St]++,Jn=0,jl<=Yt&&(Jn=hc[Yt-jl]),Xe.opt_len+=(ya=jt[2*Yt])*(St+Jn),cc&&(Xe.static_len+=ya*(uc[2*Yt+1]+Jn)));if(0!==Kn){do{for(St=kr-1;0===Xe.bl_count[St];)St--;Xe.bl_count[St]--,Xe.bl_count[St+1]+=2,Xe.bl_count[kr]--,Kn-=2}while(0<Kn);for(St=kr;0!==St;St--)for(Yt=Xe.bl_count[St];0!==Yt;)Kl<(Ar=Xe.heap[--_r])||(jt[2*Ar+1]!==St&&(Xe.opt_len+=(St-jt[2*Ar+1])*jt[2*Ar],jt[2*Ar+1]=St),Yt--)}}(N,J),Et(Se,lt,N.bl_count)}function f(N,J,ue){var me,j,Se=-1,Ne=J[1],Ae=0,De=7,lt=4;for(0===Ne&&(De=138,lt=3),J[2*(ue+1)+1]=65535,me=0;me<=ue;me++)j=Ne,Ne=J[2*(me+1)+1],++Ae<De&&j===Ne||(Ae<lt?N.bl_tree[2*j]+=Ae:0!==j?(j!==Se&&N.bl_tree[2*j]++,N.bl_tree[32]++):Ae<=10?N.bl_tree[34]++:N.bl_tree[36]++,Se=j,lt=(Ae=0)===Ne?(De=138,3):j===Ne?(De=6,3):(De=7,4))}function ie(N,J,ue){var me,j,Se=-1,Ne=J[1],Ae=0,De=7,lt=4;for(0===Ne&&(De=138,lt=3),me=0;me<=ue;me++)if(j=Ne,Ne=J[2*(me+1)+1],!(++Ae<De&&j===Ne)){if(Ae<lt)for(;Ee(N,j,N.bl_tree),0!=--Ae;);else 0!==j?(j!==Se&&(Ee(N,j,N.bl_tree),Ae--),Ee(N,16,N.bl_tree),Te(N,Ae-3,2)):Ae<=10?(Ee(N,17,N.bl_tree),Te(N,Ae-3,3)):(Ee(N,18,N.bl_tree),Te(N,Ae-11,7));Se=j,lt=(Ae=0)===Ne?(De=138,3):j===Ne?(De=6,3):(De=7,4)}}E(we);var Q=!1;function x(N,J,ue,me){var j,Se,Ne;Te(N,0+(me?1:0),3),Se=J,Ne=ue,st(j=N),Fe(j,Ne),Fe(j,~Ne),_.arraySet(j.pending_buf,j.window,Se,Ne,j.pending),j.pending+=Ne}D._tr_init=function(N){Q||(function(){var J,ue,me,j,Se,Ne=new Array(16);for(j=me=0;j<28;j++)for(oe[j]=me,J=0;J<1<<X[j];J++)y[me++]=j;for(y[me-1]=j,j=Se=0;j<16;j++)for(we[j]=Se,J=0;J<1<<K[j];J++)se[Se++]=j;for(Se>>=7;j<d;j++)for(we[j]=Se<<7,J=0;J<1<<K[j]-7;J++)se[256+Se++]=j;for(ue=0;ue<=p;ue++)Ne[ue]=0;for(J=0;J<=143;)Ke[2*J+1]=8,J++,Ne[8]++;for(;J<=255;)Ke[2*J+1]=9,J++,Ne[9]++;for(;J<=279;)Ke[2*J+1]=7,J++,Ne[7]++;for(;J<=287;)Ke[2*J+1]=8,J++,Ne[8]++;for(Et(Ke,287,Ne),J=0;J<d;J++)P[2*J+1]=5,P[2*J]=ut(J,5);Me=new $e(Ke,X,257,A,p),pe=new $e(P,K,0,d,p),We=new $e(new Array(0),ee,0,19,7)}(),Q=!0),N.l_desc=new Y(N.dyn_ltree,Me),N.d_desc=new Y(N.dyn_dtree,pe),N.bl_desc=new Y(N.bl_tree,We),N.bi_buf=0,N.bi_valid=0,Pe(N)},D._tr_stored_block=x,D._tr_flush_block=function(N,J,ue,me){var j,Se,Ne=0;0<N.level?(2===N.strm.data_type&&(N.strm.data_type=function(Ae){var De,lt=4093624447;for(De=0;De<=31;De++,lt>>>=1)if(1&lt&&0!==Ae.dyn_ltree[2*De])return 0;if(0!==Ae.dyn_ltree[18]||0!==Ae.dyn_ltree[20]||0!==Ae.dyn_ltree[26])return 1;for(De=32;De<I;De++)if(0!==Ae.dyn_ltree[2*De])return 1;return 0}(N)),Kt(N,N.l_desc),Kt(N,N.d_desc),Ne=function(Ae){var De;for(f(Ae,Ae.dyn_ltree,Ae.l_desc.max_code),f(Ae,Ae.dyn_dtree,Ae.d_desc.max_code),Kt(Ae,Ae.bl_desc),De=18;3<=De&&0===Ae.bl_tree[2*_e[De]+1];De--);return Ae.opt_len+=3*(De+1)+5+5+4,De}(N),(Se=N.static_len+3+7>>>3)<=(j=N.opt_len+3+7>>>3)&&(j=Se)):j=Se=ue+5,ue+4<=j&&-1!==J?x(N,J,ue,me):4===N.strategy||Se===j?(Te(N,2+(me?1:0),3),Wt(N,Ke,P)):(Te(N,4+(me?1:0),3),function(Ae,De,lt,Xe){var Ft;for(Te(Ae,De-257,5),Te(Ae,lt-1,5),Te(Ae,Xe-4,4),Ft=0;Ft<Xe;Ft++)Te(Ae,Ae.bl_tree[2*_e[Ft]+1],3);ie(Ae,Ae.dyn_ltree,De-1),ie(Ae,Ae.dyn_dtree,lt-1)}(N,N.l_desc.max_code+1,N.d_desc.max_code+1,Ne+1),Wt(N,N.dyn_ltree,N.dyn_dtree)),Pe(N),me&&st(N)},D._tr_tally=function(N,J,ue){return N.pending_buf[N.d_buf+2*N.last_lit]=J>>>8&255,N.pending_buf[N.d_buf+2*N.last_lit+1]=255&J,N.pending_buf[N.l_buf+N.last_lit]=255&ue,N.last_lit++,0===J?N.dyn_ltree[2*ue]++:(N.matches++,J--,N.dyn_ltree[2*(y[ue]+I+1)]++,N.dyn_dtree[2*Z(J)]++),N.last_lit===N.lit_bufsize-1},D._tr_align=function(N){var J;Te(N,2,3),Ee(N,256,Ke),16===(J=N).bi_valid?(Fe(J,J.bi_buf),J.bi_buf=0,J.bi_valid=0):8<=J.bi_valid&&(J.pending_buf[J.pending++]=255&J.bi_buf,J.bi_buf>>=8,J.bi_valid-=8)}},{"../utils/common":41}],53:[function(T,M,D){"use strict";M.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(T,M,D){(function(_){!function(r,b){"use strict";if(!r.setImmediate){var E,O,w,I,A=1,d={},g=!1,c=r.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(r);p=p&&p.setTimeout?p:r,E="[object process]"==={}.toString.call(r.process)?function(L){process.nextTick(function(){C(L)})}:function(){if(r.postMessage&&!r.importScripts){var L=!0,H=r.onmessage;return r.onmessage=function(){L=!1},r.postMessage("","*"),r.onmessage=H,L}}()?(I="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",U,!1):r.attachEvent("onmessage",U),function(L){r.postMessage(I+L,"*")}):r.MessageChannel?((w=new MessageChannel).port1.onmessage=function(L){C(L.data)},function(L){w.port2.postMessage(L)}):c&&"onreadystatechange"in c.createElement("script")?(O=c.documentElement,function(L){var H=c.createElement("script");H.onreadystatechange=function(){C(L),H.onreadystatechange=null,O.removeChild(H),H=null},O.appendChild(H)}):function(L){setTimeout(C,0,L)},p.setImmediate=function(L){"function"!=typeof L&&(L=new Function(""+L));for(var H=new Array(arguments.length-1),te=0;te<H.length;te++)H[te]=arguments[te+1];return d[A]={callback:L,args:H},E(A),A++},p.clearImmediate=v}function v(L){delete d[L]}function C(L){if(g)setTimeout(C,0,L);else{var H=d[L];if(H){g=!0;try{!function(te){var X=te.callback,K=te.args;switch(K.length){case 0:X();break;case 1:X(K[0]);break;case 2:X(K[0],K[1]);break;case 3:X(K[0],K[1],K[2]);break;default:X.apply(undefined,K)}}(H)}finally{v(L),g=!1}}}}function U(L){L.source===r&&"string"==typeof L.data&&0===L.data.indexOf(I)&&C(+L.data.slice(I.length))}}("undefined"==typeof self?void 0===_?this:_:self)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)},6801:(pt,T)=>{"use strict";class _{static isArrayBuffer(d){return"[object ArrayBuffer]"===Object.prototype.toString.call(d)}static toArrayBuffer(d){return this.isArrayBuffer(d)?d:d.byteLength===d.buffer.byteLength?d.buffer:this.toUint8Array(d).slice().buffer}static toUint8Array(d){return this.toView(d,Uint8Array)}static toView(d,g){if(d.constructor===g)return d;if(this.isArrayBuffer(d))return new g(d);if(this.isArrayBufferView(d))return new g(d.buffer,d.byteOffset,d.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(d){return this.isArrayBufferView(d)||this.isArrayBuffer(d)}static isArrayBufferView(d){return ArrayBuffer.isView(d)||d&&this.isArrayBuffer(d.buffer)}static isEqual(d,g){const c=_.toUint8Array(d),p=_.toUint8Array(g);if(c.length!==p.byteLength)return!1;for(let v=0;v<c.length;v++)if(c[v]!==p[v])return!1;return!0}static concat(...d){if(Array.isArray(d[0])){const g=d[0];let c=0;for(const C of g)c+=C.byteLength;const p=new Uint8Array(c);let v=0;for(const C of g){const U=this.toUint8Array(C);p.set(U,v),v+=U.length}return d[1]?this.toView(p,d[1]):p.buffer}return this.concat(d)}}class r{static fromString(d){const g=unescape(encodeURIComponent(d)),c=new Uint8Array(g.length);for(let p=0;p<g.length;p++)c[p]=g.charCodeAt(p);return c.buffer}static toString(d){const g=_.toUint8Array(d);let c="";for(let v=0;v<g.length;v++)c+=String.fromCharCode(g[v]);return decodeURIComponent(escape(c))}}class b{static toString(d,g=!1){const c=_.toArrayBuffer(d),p=new DataView(c);let v="";for(let C=0;C<c.byteLength;C+=2){const U=p.getUint16(C,g);v+=String.fromCharCode(U)}return v}static fromString(d,g=!1){const c=new ArrayBuffer(2*d.length),p=new DataView(c);for(let v=0;v<d.length;v++)p.setUint16(2*v,d.charCodeAt(v),g);return c}}let E=(()=>{class A{static isHex(g){return"string"==typeof g&&/^[a-z0-9]+$/i.test(g)}static isBase64(g){return"string"==typeof g&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(g)}static isBase64Url(g){return"string"==typeof g&&/^[a-zA-Z0-9-_]+$/i.test(g)}static ToString(g,c="utf8"){const p=_.toUint8Array(g);switch(c.toLowerCase()){case"utf8":return this.ToUtf8String(p);case"binary":return this.ToBinary(p);case"hex":return this.ToHex(p);case"base64":return this.ToBase64(p);case"base64url":return this.ToBase64Url(p);case"utf16le":return b.toString(p,!0);case"utf16":case"utf16be":return b.toString(p);default:throw new Error(`Unknown type of encoding '${c}'`)}}static FromString(g,c="utf8"){if(!g)return new ArrayBuffer(0);switch(c.toLowerCase()){case"utf8":return this.FromUtf8String(g);case"binary":return this.FromBinary(g);case"hex":return this.FromHex(g);case"base64":return this.FromBase64(g);case"base64url":return this.FromBase64Url(g);case"utf16le":return b.fromString(g,!0);case"utf16":case"utf16be":return b.fromString(g);default:throw new Error(`Unknown type of encoding '${c}'`)}}static ToBase64(g){const c=_.toUint8Array(g);if("undefined"!=typeof btoa){const p=this.ToString(c,"binary");return btoa(p)}return Buffer.from(c).toString("base64")}static FromBase64(g){const c=this.formatString(g);if(!c)return new ArrayBuffer(0);if(!A.isBase64(c))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!=typeof atob?this.FromBinary(atob(c)):new Uint8Array(Buffer.from(c,"base64")).buffer}static FromBase64Url(g){const c=this.formatString(g);if(!c)return new ArrayBuffer(0);if(!A.isBase64Url(c))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(c.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(g){return this.ToBase64(g).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(g,c=A.DEFAULT_UTF8_ENCODING){switch(c){case"ascii":return this.FromBinary(g);case"utf8":return r.fromString(g);case"utf16":case"utf16be":return b.fromString(g);case"utf16le":case"usc2":return b.fromString(g,!0);default:throw new Error(`Unknown type of encoding '${c}'`)}}static ToUtf8String(g,c=A.DEFAULT_UTF8_ENCODING){switch(c){case"ascii":return this.ToBinary(g);case"utf8":return r.toString(g);case"utf16":case"utf16be":return b.toString(g);case"utf16le":case"usc2":return b.toString(g,!0);default:throw new Error(`Unknown type of encoding '${c}'`)}}static FromBinary(g){const c=g.length,p=new Uint8Array(c);for(let v=0;v<c;v++)p[v]=g.charCodeAt(v);return p.buffer}static ToBinary(g){const c=_.toUint8Array(g);let p="";for(let v=0;v<c.length;v++)p+=String.fromCharCode(c[v]);return p}static ToHex(g){const c=_.toUint8Array(g),v=[],C=c.length;for(let U=0;U<C;U++){const L=c[U].toString(16).padStart(2,"0");v.push(L)}return v.join("")}static FromHex(g){let c=this.formatString(g);if(!c)return new ArrayBuffer(0);if(!A.isHex(c))throw new TypeError("Argument 'hexString' is not HEX encoded");c.length%2&&(c=`0${c}`);const p=new Uint8Array(c.length/2);for(let v=0;v<c.length;v+=2){const C=c.slice(v,v+2);p[v/2]=parseInt(C,16)}return p.buffer}static ToUtf16String(g,c=!1){return b.toString(g,c)}static FromUtf16String(g,c=!1){return b.fromString(g,c)}static Base64Padding(g){const c=4-g.length%4;if(c<4)for(let p=0;p<c;p++)g+="=";return g}static formatString(g){return(null==g?void 0:g.replace(/[\n\r\t ]/g,""))||""}}return A.DEFAULT_UTF8_ENCODING="utf8",A})();T.vJ=_,T.ep=E},7604:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var D=M(5742);T.Observable=D.Observable},1606:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),function D(_){for(var r in _)T.hasOwnProperty(r)||(T[r]=_[r])}(M(7604))},5742:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var D=M(1557),_=M(4802),r=M(7448),b=M(7302),E=M(4072),O=function(){function I(A){this._isScalar=!1,A&&(this._subscribe=A)}return I.prototype.lift=function(A){var d=new I;return d.source=this,d.operator=A,d},I.prototype.subscribe=function(A,d,g){var c=this.operator,p=_.toSubscriber(A,d,g);if(p.add(c?c.call(p,this.source):this.source||E.config.useDeprecatedSynchronousErrorHandling&&!p.syncErrorThrowable?this._subscribe(p):this._trySubscribe(p)),E.config.useDeprecatedSynchronousErrorHandling&&p.syncErrorThrowable&&(p.syncErrorThrowable=!1,p.syncErrorThrown))throw p.syncErrorValue;return p},I.prototype._trySubscribe=function(A){try{return this._subscribe(A)}catch(d){E.config.useDeprecatedSynchronousErrorHandling&&(A.syncErrorThrown=!0,A.syncErrorValue=d),D.canReportError(A)?A.error(d):console.warn(d)}},I.prototype.forEach=function(A,d){var g=this;return new(d=w(d))(function(c,p){var v;v=g.subscribe(function(C){try{A(C)}catch(U){p(U),v&&v.unsubscribe()}},p,c)})},I.prototype._subscribe=function(A){var d=this.source;return d&&d.subscribe(A)},I.prototype[r.observable]=function(){return this},I.prototype.pipe=function(){for(var A=[],d=0;d<arguments.length;d++)A[d]=arguments[d];return 0===A.length?this:b.pipeFromArray(A)(this)},I.prototype.toPromise=function(A){var d=this;return new(A=w(A))(function(g,c){var p;d.subscribe(function(v){return p=v},function(v){return c(v)},function(){return g(p)})})},I.create=function(A){return new I(A)},I}();function w(I){if(I||(I=E.config.Promise||Promise),!I)throw new Error("no Promise impl found");return I}T.Observable=O},7350:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var D=M(4072),_=M(2422);T.empty={closed:!0,next:function(r){},error:function(r){if(D.config.useDeprecatedSynchronousErrorHandling)throw r;_.hostReportError(r)},complete:function(){}}},3281:function(pt,T,M){"use strict";var d,D=this&&this.__extends||(d=function(g,c){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,v){p.__proto__=v}||function(p,v){for(var C in v)v.hasOwnProperty(C)&&(p[C]=v[C])})(g,c)},function(g,c){function p(){this.constructor=g}d(g,c),g.prototype=null===c?Object.create(c):(p.prototype=c.prototype,new p)});Object.defineProperty(T,"__esModule",{value:!0});var _=M(9607),r=M(7350),b=M(6052),E=M(2858),O=M(4072),w=M(2422),I=function(d){function g(c,p,v){var C=d.call(this)||this;switch(C.syncErrorValue=null,C.syncErrorThrown=!1,C.syncErrorThrowable=!1,C.isStopped=!1,arguments.length){case 0:C.destination=r.empty;break;case 1:if(!c){C.destination=r.empty;break}if("object"==typeof c){c instanceof g?(C.syncErrorThrowable=c.syncErrorThrowable,C.destination=c,c.add(C)):(C.syncErrorThrowable=!0,C.destination=new A(C,c));break}default:C.syncErrorThrowable=!0,C.destination=new A(C,c,p,v)}return C}return D(g,d),g.prototype[E.rxSubscriber]=function(){return this},g.create=function(c,p,v){var C=new g(c,p,v);return C.syncErrorThrowable=!1,C},g.prototype.next=function(c){this.isStopped||this._next(c)},g.prototype.error=function(c){this.isStopped||(this.isStopped=!0,this._error(c))},g.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},g.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,d.prototype.unsubscribe.call(this))},g.prototype._next=function(c){this.destination.next(c)},g.prototype._error=function(c){this.destination.error(c),this.unsubscribe()},g.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},g.prototype._unsubscribeAndRecycle=function(){var c=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=c,this},g}(b.Subscription);T.Subscriber=I;var A=function(d){function g(c,p,v,C){var U=d.call(this)||this;U._parentSubscriber=c;var L,H=U;return _.isFunction(p)?L=p:p&&(L=p.next,v=p.error,C=p.complete,p!==r.empty&&(H=Object.create(p),_.isFunction(H.unsubscribe)&&U.add(H.unsubscribe.bind(H)),H.unsubscribe=U.unsubscribe.bind(U))),U._context=H,U._next=L,U._error=v,U._complete=C,U}return D(g,d),g.prototype.next=function(c){if(!this.isStopped&&this._next){var p=this._parentSubscriber;O.config.useDeprecatedSynchronousErrorHandling&&p.syncErrorThrowable?this.__tryOrSetError(p,this._next,c)&&this.unsubscribe():this.__tryOrUnsub(this._next,c)}},g.prototype.error=function(c){if(!this.isStopped){var p=this._parentSubscriber,v=O.config.useDeprecatedSynchronousErrorHandling;if(this._error)v&&p.syncErrorThrowable?(this.__tryOrSetError(p,this._error,c),this.unsubscribe()):(this.__tryOrUnsub(this._error,c),this.unsubscribe());else if(p.syncErrorThrowable)v?(p.syncErrorValue=c,p.syncErrorThrown=!0):w.hostReportError(c),this.unsubscribe();else{if(this.unsubscribe(),v)throw c;w.hostReportError(c)}}},g.prototype.complete=function(){var c=this;if(!this.isStopped){var p=this._parentSubscriber;if(this._complete){var v=function(){return c._complete.call(c._context)};O.config.useDeprecatedSynchronousErrorHandling&&p.syncErrorThrowable?(this.__tryOrSetError(p,v),this.unsubscribe()):(this.__tryOrUnsub(v),this.unsubscribe())}else this.unsubscribe()}},g.prototype.__tryOrUnsub=function(c,p){try{c.call(this._context,p)}catch(v){if(this.unsubscribe(),O.config.useDeprecatedSynchronousErrorHandling)throw v;w.hostReportError(v)}},g.prototype.__tryOrSetError=function(c,p,v){if(!O.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{p.call(this._context,v)}catch(C){return O.config.useDeprecatedSynchronousErrorHandling?(c.syncErrorValue=C,c.syncErrorThrown=!0,!0):(w.hostReportError(C),!0)}return!1},g.prototype._unsubscribe=function(){var c=this._parentSubscriber;this._context=null,this._parentSubscriber=null,c.unsubscribe()},g}(I);T.SafeSubscriber=A},6052:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var D=M(5019),_=M(2556),r=M(9607),b=M(2142),E=function(){function w(I){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,I&&(this._ctorUnsubscribe=!0,this._unsubscribe=I)}return w.prototype.unsubscribe=function(){var I;if(!this.closed){var A=this,d=A._parentOrParents,g=A._ctorUnsubscribe,c=A._unsubscribe,p=A._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,d instanceof w)d.remove(this);else if(null!==d)for(var v=0;v<d.length;++v)d[v].remove(this);if(r.isFunction(c)){g&&(this._unsubscribe=void 0);try{c.call(this)}catch(H){I=H instanceof b.UnsubscriptionError?O(H.errors):[H]}}if(D.isArray(p)){v=-1;for(var U=p.length;++v<U;){var L=p[v];if(_.isObject(L))try{L.unsubscribe()}catch(te){I=I||[],te instanceof b.UnsubscriptionError?I=I.concat(O(te.errors)):I.push(te)}}}if(I)throw new b.UnsubscriptionError(I)}},w.prototype.add=function(I){var A=I;if(!I)return w.EMPTY;switch(typeof I){case"function":A=new w(I);case"object":if(A===this||A.closed||"function"!=typeof A.unsubscribe)return A;if(this.closed)return A.unsubscribe(),A;if(!(A instanceof w)){var d=A;(A=new w)._subscriptions=[d]}break;default:throw new Error("unrecognized teardown "+I+" added to Subscription.")}var g=A._parentOrParents;if(null===g)A._parentOrParents=this;else if(g instanceof w){if(g===this)return A;A._parentOrParents=[g,this]}else{if(-1!==g.indexOf(this))return A;g.push(this)}var c=this._subscriptions;return null===c?this._subscriptions=[A]:c.push(A),A},w.prototype.remove=function(I){var A=this._subscriptions;if(A){var d=A.indexOf(I);-1!==d&&A.splice(d,1)}},w.EMPTY=((I=new w).closed=!0,I),w;var I}();function O(w){return w.reduce(function(I,A){return I.concat(A instanceof b.UnsubscriptionError?A.errors:A)},[])}T.Subscription=E},4072:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var M=!1;T.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(D){if(D){var _=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+_.stack)}else M&&console.log("RxJS: Back to a better error behavior. Thank you. <3");M=D},get useDeprecatedSynchronousErrorHandling(){return M}}},7448:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},2858:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),T.$$rxSubscriber=T.rxSubscriber},2142:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var M=function(){function D(_){return Error.call(this),this.message=_?_.length+" errors occurred during unsubscription:\n"+_.map(function(r,b){return b+1+") "+r.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=_,this}return D.prototype=Object.create(Error.prototype),D}();T.UnsubscriptionError=M},1557:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var D=M(3281);T.canReportError=function _(r){for(;r;){var O=r.destination;if(r.closed||r.isStopped)return!1;r=O&&O instanceof D.Subscriber?O:null}return!0}},2422:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.hostReportError=function M(D){setTimeout(function(){throw D},0)}},6610:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.identity=function M(D){return D}},5019:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.isArray=Array.isArray||function(M){return M&&"number"==typeof M.length}},9607:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.isFunction=function M(D){return"function"==typeof D}},2556:(pt,T)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0}),T.isObject=function M(D){return null!==D&&"object"==typeof D}},7302:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var D=M(6610);function r(b){return 0===b.length?D.identity:1===b.length?b[0]:function(O){return b.reduce(function(w,I){return I(w)},O)}}T.pipe=function _(){for(var b=[],E=0;E<arguments.length;E++)b[E]=arguments[E];return r(b)},T.pipeFromArray=r},4802:(pt,T,M)=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});var D=M(3281),_=M(2858),r=M(7350);T.toSubscriber=function b(E,O,w){if(E){if(E instanceof D.Subscriber)return E;if(E[_.rxSubscriber])return E[_.rxSubscriber]()}return E||O||w?new D.Subscriber(E,O,w):new D.Subscriber(r.empty)}}}]);